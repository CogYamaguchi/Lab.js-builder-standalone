(this["webpackJsonplab.js.builder"]=this["webpackJsonplab.js.builder"]||[]).push([[5],{915:function(e,t,a){},916:function(e,t,a){},917:function(e,t,a){},918:function(e,t){},919:function(e,t){},920:function(e,t){},924:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return de}));var n=a(26),i=a(55),c=a(0),r=a.n(c),l=a(38),o=a(24),s=a(35),d=a(768),h=a(28),m=a(39),p=a.n(m),u=a(56),g=a(92),f=a.n(g),b=a(757),v=a(914),E=a(785),y=a(774),w=a(775),x=a(319),O=a(30),j=a(266);const k=({addHandler:e,cloneHandler:t,removeHandler:a,selection:n},{id:i})=>{let c=r.a.createRef();return(r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,null,r.a.createElement(v.a,{direction:"up"},r.a.createElement(E.a,{outline:!0,color:"secondary"},r.a.createElement(O.a,{icon:"plus",style:{position:"relative",top:"0.5px"}})),r.a.createElement(y.a,null,r.a.createElement(w.a,{header:!0},"Shapes"),r.a.createElement(w.a,{onClick:()=>e("line")},"Line"),r.a.createElement(w.a,{onClick:()=>e("circle")},"Circle"),r.a.createElement(w.a,{onClick:()=>e("ellipse")},"Ellipse"),r.a.createElement(w.a,{onClick:()=>e("triangle")},"Triangle"),r.a.createElement(w.a,{onClick:()=>e("rect")},"Rectangle"),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{header:!0},"Text"),r.a.createElement(w.a,{onClick:()=>e("text",{content:"text"})},"Text"),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{header:!0},"Media"),r.a.createElement(w.a,{onClick:Object(u.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.current.select();case 3:t.sent.forEach(({localPath:t})=>{e("image",{src:'${ this.files["'.concat(t,'"] }')})}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("Error while inserting images",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))},"Image"),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{header:!0},"Interaction"),r.a.createElement(w.a,{onClick:()=>e("aoi")},"AOI"),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{header:!0},"From selected"),r.a.createElement(w.a,{onClick:t,disabled:!n||void 0===n.type},"Duplicate"))),r.a.createElement(x.a,{outline:!0,color:"secondary",onClick:a,disabled:!n||void 0===n.type},r.a.createElement(O.a,{icon:"trash"}))),r.a.createElement(j.a,{ref:c,component:i,accept:"image/*"})))};k.contextTypes={id:f.a.oneOfType([f.a.string,f.a.number])};var S=k,C=a(736),H=a(405),N=a(325),A=(a(915),({selection:e,type:t})=>r.a.createElement(C.a,{className:"dimension-toolbar minimal-width-addons ml-2"},r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement("span",{className:"input-group-text"},r.a.createElement(O.a,{icon:"long-arrow-right",fixedWidth:!0}))),r.a.createElement(o.b,{name:"left",placeholder:"x",disabled:void 0===t,className:"form-control text-monospace"}),r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement(N.a,null,r.a.createElement(O.a,{icon:"long-arrow-down",fixedWidth:!0}))),r.a.createElement(o.b,{name:"top",placeholder:"y",disabled:void 0===t,className:"form-control text-monospace"}),r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement(N.a,null,r.a.createElement(O.a,{icon:"redo",fixedWidth:!0}))),r.a.createElement(o.b,{name:"angle",placeholder:"angle",disabled:["circle","i-text",void 0].includes(t),className:"form-control",style:{fontFamily:"Fira Mono"}}),r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement(N.a,null,r.a.createElement(O.a,{icon:"arrows-h",fixedWidth:!0}))),r.a.createElement(o.b,{name:"width",placeholder:"width",disabled:["i-text",void 0].includes(t)||"image"===t&&"width"===e.autoScale,className:"form-control text-monospace"}),r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement(N.a,null,r.a.createElement(O.a,{icon:"arrows-v",fixedWidth:!0}))),r.a.createElement(o.b,{name:"height",placeholder:"height",disabled:["line","circle","i-text",void 0].includes(t)||"image"===t&&"height"===e.autoScale,className:"form-control",style:{fontFamily:"Fira Mono"}}))),W=({upHandler:e,downHandler:t})=>r.a.createElement(b.a,{className:"ml-2"},r.a.createElement(x.a,{outline:!0,color:"secondary",onClick:e},r.a.createElement(O.a,{icon:"arrow-up"})),r.a.createElement(x.a,{outline:!0,color:"secondary",onClick:t},r.a.createElement(O.a,{icon:"arrow-down"}))),R=a(737);a(916);const T=({color:e,clickHandler:t})=>r.a.createElement("div",{className:"color-swatch",onClick:()=>t(e),style:{backgroundColor:e,border:"1px solid ".concat("#ffffff"===e?"#ccc":e)}}),F=["#0d3b83","#0070d9","#12864e","#a8ca09","#d6341a","#fcbb0a"],I=["#ffffff","#dddddd","#aaaaaa","#000000"];var M=({name:e,disabled:t,icon:a,iconWeight:n,iconFallbackWeight:l})=>{const s=Object(c.useState)(!1),d=Object(i.a)(s,2),h=d[0],m=d[1];let p=r.a.createRef();const u=Object(o.h)({name:e}),g=Object(i.a)(u,3),f=g[0],b=g[2],v=(e,t)=>{m(!1),b.setValue(e)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,{direction:"up",isOpen:h,toggle:()=>m(!h),style:{minWidth:"3.5rem"}},r.a.createElement(E.a,{caret:!0,outline:!0,color:"secondary",className:"border-left-0",disabled:t},r.a.createElement(O.a,{icon:a,weight:n,fallbackWeight:l,style:{position:"relative",top:"1px"}})),r.a.createElement(y.a,{right:!0,className:"color-dropdown"},r.a.createElement(w.a,{tag:"div",style:{height:"136px"},toggle:!1},F.map(e=>r.a.createElement(T,{key:e,color:e,clickHandler:e=>v(e)}))),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{tag:"div",style:{height:"90px"},toggle:!1},I.map(e=>r.a.createElement(T,{key:e,color:e,clickHandler:e=>v(e)}))),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{tag:"div",toggle:!1},r.a.createElement("div",{className:"btn btn-outline-secondary",style:{width:"126px"},onClick:()=>{p.current.focus(),p.current.select(),p.current.click(),m(!h)}},r.a.createElement(O.a,{icon:"eye-dropper"}))),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{tag:"div",toggle:!1},r.a.createElement("input",Object.assign({type:"text",placeholder:"CSS color",className:"form-control w-100 text-monospace"},f))))),r.a.createElement("input",Object.assign({type:"color",style:{visibility:"hidden",position:"absolute"},tabIndex:-1,ref:p},f)))};const L=({height:e})=>r.a.createElement("div",{className:"w-100",style:{backgroundColor:"black",height:e}});var X=({onChange:e,disabled:t})=>r.a.createElement(v.a,{direction:"up",style:{minWidth:"3.5rem"}},r.a.createElement(E.a,{caret:!0,outline:!0,color:"secondary",disabled:t},r.a.createElement(O.a,{icon:"paint-brush",style:{fontSize:"0.9em"}})),r.a.createElement(y.a,null,r.a.createElement(w.a,{onClick:()=>e(0)},"No line"),r.a.createElement(w.a,{divider:!0}),[2,5,10].map(t=>r.a.createElement(w.a,{key:"strokeWidthDropDown-".concat(t),style:{paddingTop:"10px",paddingBottom:"10px"},onClick:()=>e(t)},r.a.createElement(L,{height:"".concat(t,"px")})))));const Y=()=>r.a.createElement(y.a,{right:!0,style:{width:"300px"}},r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(C.a,null,r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement(N.a,null,r.a.createElement(O.a,{fixedWidth:!0,icon:"tag"}))),r.a.createElement(o.b,{name:"label",component:s.c,placeholder:"Label",className:"text-monospace"}))));Y.contextTypes={id:f.a.oneOfType([f.a.string,f.a.number])};var _=Y,z=a(328);const P=({selection:e,changeHandler:t},{id:a})=>r.a.createElement(y.a,{right:!0,style:{width:"500px"}},r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(z.a,{name:"src",accept:"image/*",tab:"pool",icon:"file-audio",component:a})),r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(C.a,{className:"d-flex flex-row image-autoscale",size:"sm"},r.a.createElement(H.a,{addonType:"prepend",style:{width:"25%"}},r.a.createElement(N.a,{className:"w-100 text-center"},"Auto resize")),r.a.createElement(H.a,{className:"flex-fill",addonType:"append"},r.a.createElement(x.a,{outline:!0,color:["width","height"].includes(e.autoScale)?"secondary":"primary",style:{width:"35%"},onClick:()=>t("autoScale",!1)},r.a.createElement(O.a,{icon:"power-off"})),r.a.createElement(x.a,{outline:!0,color:"width"===e.autoScale?"primary":"secondary",style:{width:"32.5%"},onClick:()=>t("autoScale","width")},r.a.createElement(O.a,{icon:"arrows-alt-h"})),r.a.createElement(x.a,{outline:!0,color:"height"===e.autoScale?"primary":"secondary",style:{width:"32.5%"},onClick:()=>t("autoScale","height")},r.a.createElement(O.a,{icon:"arrows-alt-v"}))))));P.contextTypes={id:f.a.oneOfType([f.a.string,f.a.number])};var q=P,V=({selection:e,changeHandler:t})=>r.a.createElement(y.a,{style:{width:"200px"}},r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(o.b,{name:"fontFamily",component:"select",className:"form-control custom-select"},r.a.createElement("option",{value:"serif"},"Serif"),r.a.createElement("option",{value:"sans-serif"},"Sans-serif"),r.a.createElement("option",{value:"monospace"},"Monospace"))),r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(b.a,{className:"w-100 typography-font-style"},r.a.createElement(x.a,{outline:!0,color:"italic"===e.fontStyle?"primary":"secondary",className:"w-50",onClick:()=>{"italic"===e.fontStyle?t("fontStyle","normal"):t("fontStyle","italic")}},r.a.createElement(O.a,{icon:"italic"})),r.a.createElement(x.a,{outline:!0,color:"bold"===e.fontWeight?"primary":"secondary",className:"w-50",onClick:()=>{"bold"===e.fontWeight?t("fontWeight","normal"):t("fontWeight","bold")}},r.a.createElement(O.a,{icon:"bold"})))),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(C.a,null,r.a.createElement(H.a,{addonType:"prepend"},r.a.createElement(N.a,null,r.a.createElement(O.a,{icon:"text-height"}))),r.a.createElement(o.b,{name:"fontSize",placeholder:"Size",className:"form-control text-monospace"}))),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{tag:"div",toggle:!1,className:"mute"},r.a.createElement(b.a,{className:"typography-alignment"},["left","center","right"].map(a=>r.a.createElement(x.a,{key:"text-align-".concat(a),outline:!0,color:e.textAlign===a?"primary":"secondary",onClick:()=>t({textAlign:a,originX:a})},r.a.createElement(O.a,{icon:"align-".concat(a)}))))));a(917);const D={aoi:"bullseye-pointer","i-text":"font",image:"image"},U=({type:e})=>r.a.createElement(E.a,{caret:!0,outline:!0,color:"secondary",disabled:!Object.keys(D).includes(e),style:{minWidth:"3.5rem"}},r.a.createElement(O.a,{icon:D[e]||"cog"})),B=e=>{switch(e.selection.type){case"aoi":return r.a.createElement(_,e);case"i-text":return r.a.createElement(V,e);case"image":return r.a.createElement(q,e);default:return null}};var J=({selection:e,changeHandler:t})=>{const a=Object(c.useState)(!1),n=Object(i.a)(a,2),l=n[0],o=n[1];return(r.a.createElement(R.a,{direction:"up",isOpen:l,toggle:()=>o(!l),inNavbar:!0},r.a.createElement(U,{type:e.type}),r.a.createElement(B,{selection:e,changeHandler:t,toggle:()=>o(!1)})))},$=({selection:e,changeHandler:t})=>r.a.createElement(b.a,{className:"ml-2"},r.a.createElement(J,{selection:e,changeHandler:t}),r.a.createElement(X,{onChange:e=>t("strokeWidth",e),disabled:["image","aoi",void 0].includes(e.type)}),r.a.createElement(M,{name:"stroke",icon:"circle",iconFallbackWeight:"r",disabled:["image","aoi",void 0].includes(e.type)}),r.a.createElement(M,{name:"fill",icon:"circle",iconFallbackWeight:"s",disabled:["line","image","aoi",void 0].includes(e.type)})),G=a(810),K=(e,t,a)=>{const n=e/window.devicePixelRatio,i=new G.fabric.StaticCanvas;return i.setDimensions({width:n,height:n}),Array(4).fill().forEach((e,c)=>{const r=c%2*n,l=Math.floor(c/2)*n;i.add(new G.fabric.Rect({width:1,height:1,left:r-1+t/window.devicePixelRatio,top:l-1+a/window.devicePixelRatio,fill:"rgba(0, 0, 0, 0.125)"}))}),i},Q=a(158);const Z={left:0,top:0,width:50,height:50,angle:0,stroke:null,fill:"black"},ee=e=>"string"===typeof e&&e.includes("$"),te=["text","src"],ae=/^\s*\${\s*this\.files\[['"]([^'"]+)['"]\]\s*}\s*$/,ne=(e,t,a,i=[])=>{if(e){const c=Object(n.a)({},e,{},Object(h.transform)(e,(t,a,n)=>{ee(a)&&!te.includes(n)?t[n]=Z[n]:["left","top","angle","width","height"].includes(n)&&(t[n]=((e,t=0)=>["","+","-"].includes(e)?0:Number(e)||t)(e[n],Z[n]))}),{lockMovementX:ee(e.left),lockMovementY:ee(e.top),lockScalingX:ee(e.width),lockScalingY:ee(e.height)||"line"===e.type,lockRotation:ee(e.angle)});return"circle"===e.type?c.radius=c.width/2:"ellipse"===c.type?(c.rx=c.width/2,c.ry=c.height/2):"line"===c.type?(c.x1=c.left-c.width/2,c.x2=c.left+c.width/2,c.y1=c.top,c.y2=c.top):"image"===c.type&&(c.scaleX=c.width/c.naturalWidth,c.scaleY=c.height/c.naturalHeight,c.width=c.naturalWidth,c.height=c.naturalHeight,c.src=((e,t,a)=>{const n=null===e||void 0===e?void 0:e.match(ae);if(n){const e=n[1],i=Object(Q.c)(t,a,e);return null===i||void 0===i?void 0:i.file.content}return ee(e)?void 0:e})(e.src,a,t)),i.forEach(e=>delete c[e]),c}return e},ie=(e,t)=>{if(!e||!t)return e;const a=Object(n.a)({},Object(h.pickBy)(e,(e,t)=>!t.startsWith("lock")),{},Object(h.transform)(e,(e,a,n)=>{ee(t[n])&&"text"!==n&&(e[n]=t[n])}));return"image"===e.type&&(a.width=ee(t.width)?t.width:a.scaleX*a.naturalWidth,a.height=ee(t.height)?t.height:a.scaleY*a.naturalHeight,a.autoScale=t.autoScale),a};var ce,re;G.fabric.Image.prototype.toObject=(ce=G.fabric.Image.prototype.toObject,function(e){const t=this.getOriginalSize(),a=t.width,i=t.height;return Object(n.a)({},ce.apply(this,[e]),{naturalWidth:a||this.width,naturalHeight:i||this.height,src:this._src?this._src:this.src})}),G.fabric.Image.prototype._renderFill=(re=G.fabric.Image.prototype._renderFill,function(e){if(this.src||this._pattern)re.apply(this,[e]);else{e.save(),e.beginPath();const t=this.width||50,a=this.height||50;e.fillStyle="rgba(50, 50, 50, 0.25)",e.fillRect(-t/2,-a/2,t,a),e.restore()}}),G.fabric.Image.fromObject=function(e,t){var a=G.fabric.util.object.clone(e);G.fabric.util.loadImage(a.src,(function(e,n){const i=new G.fabric.Image(n?new Image:e,a);i.crossOrigin="anonymous",t(i)}))},G.fabric.Aoi=G.fabric.util.createClass(G.fabric.Rect,{type:"aoi",label:"",initialize:function(e={}){e.fill="rgba(0, 0, 0, 0.2)",this.callSuper("initialize",e)}}),G.fabric.Aoi.fromObject=function(e,t,a){return G.fabric.Object._fromObject("Aoi",e,t,a)},G.fabric.disableStyleCopyPaste=!0;class le extends c.Component{constructor(...e){super(...e),this.state={objects:{},activeObject:null},this.updateActive=this.updateActive.bind(this),this.canvasRef=Object(c.createRef)()}componentDidMount(){const e=[800,600],t=this.canvasRef.current.parentElement;this.width=t.clientWidth-15,this.height=Math.max(Math.ceil(9*t.clientWidth/16),e[1]+50),this.offsetX=parseInt(this.width/2%25,10),this.offsetY=parseInt(this.height/2%25,10),this.canvas=new G.fabric.Canvas,this.canvas.initialize(this.canvasRef.current,{width:this.width,height:this.height,preserveObjectStacking:!0,enableRetinaScaling:!0,viewportTransform:[1,0,0,1,this.width/2,this.height/2],selection:!1}),G.fabric.Object.prototype.set({cornerSize:9,cornerStyle:"circle",lockSkewingX:!0,lockSkewingY:!0,rotatingPointOffset:30,padding:6,strokeLineJoin:"round",transparentCorners:!1}),G.fabric.Circle.prototype.hasRotatingPoint=!1,G.fabric.Circle.prototype.lockUniScaling=!0,G.fabric.Image.prototype.lockUniScaling=!0,G.fabric.Line.prototype.lockScalingY=!0,G.fabric.Line.prototype.setControlsVisibility({ml:!0,mr:!0,mt:!1,mb:!1,bl:!1,br:!1,tl:!1,tr:!1}),G.fabric.IText.prototype.hasControls=!1,this.props.data?this.canvas.loadFromJSON({objects:this.props.data},()=>{this.setupSnapping(25,10),this.setupHandlers(),this.setupGrid(25),this.setupOverlay(e),this.canvas.requestRenderAll()}):(this.setupSnapping(25,10),this.setupHandlers(),this.setupGrid(25),this.setupOverlay(e)),window.addEventListener("preview:preempt",this.updateActive)}componentWillUnmount(){window.removeEventListener("preview:preempt",this.updateActive)}setupSnapping(e,t){const a=(t,a=e)=>Math.round(t/a)*a,n=e=>Math.abs(e-a(e))<t,i=e=>n(e)?a(e):e;this.canvas.on("object:moving",({target:e,e:{shiftKey:t}})=>{const a=e.left,c=e.top;t||!n(a)&&!n(c)||e.set({left:i(a),top:i(c)}).setCoords()}),this.canvas.on("object:rotating",({target:e,e:{shiftKey:t}})=>{t||e.set({angle:a(e.angle,15)})})}setupHandlers(){this.canvas.on("object:added",this.props.addHandler),this.canvas.on("object:removed",this.props.deleteHandler),this.canvas.on("object:modified",({target:e})=>{e.set({width:e.width&&"image"!==e.type?e.width*e.scaleX:e.width,height:e.height&&"image"!==e.type?e.height*e.scaleY:e.height,radius:e.radius?e.radius*e.scaleX:e.radius,rx:e.rx?e.rx*e.scaleX:e.rx,ry:e.ry?e.ry*e.scaleY:e.ry,scaleX:"image"===e.type?e.scaleX:1,scaleY:"image"===e.type?e.scaleY:1}),this.props.updateHandler({target:e})}),this.canvas.on("selection:created",this.props.updateSelectionHandler),this.canvas.on("selection:updated",this.props.updateSelectionHandler),this.canvas.on("selection:cleared",this.props.clearSelectionHandler)}setupGrid(e){this.canvas.setBackgroundColor(new G.fabric.Pattern({source:K(e,this.offsetX,this.offsetY).getElement()}))}setupOverlay(e){this.canvas.setOverlayImage(((e,t,a)=>{const n=new G.fabric.StaticCanvas;n.setDimensions({width:e+20,height:t+20}),n.setViewportTransform([1,0,0,1,e/2+10,t/2+10]);const i=new G.fabric.Path("M ".concat(-e/2-10," ").concat(-t/2-10," ")+"L ".concat(-e/2-10," ").concat(+t/2+10," ")+"L ".concat(+e/2+10," ").concat(+t/2+10," ")+"L ".concat(+e/2+10," ").concat(-t/2-10," ")+"L ".concat(-e/2-10," ").concat(-t/2-10," z ")+"M ".concat(-a[0]/2-.5," ").concat(-a[1]/2-.5," ")+"L ".concat(+a[0]/2-.5," ").concat(-a[1]/2-.5," ")+"L ".concat(+a[0]/2-.5," ").concat(+a[1]/2-.5," ")+"L ".concat(-a[0]/2-.5," ").concat(+a[1]/2-.5," ")+"L ".concat(-a[0]/2-.5," ").concat(-a[1]/2-.5," z"));return i.setOptions({fill:"rgba(255, 255, 255, 0.6)"}),n.add(i),n.add(new G.fabric.Rect({width:a[0]+1,height:a[1]+1,left:-a[0]/2-1,top:-a[1]/2-1,fill:"transparent",stroke:"rgba(0, 0, 0, 0.125)"})),n})(this.width,this.height,e).toDataURL(),()=>this.canvas.requestRenderAll(),{originX:"center",originY:"center",_pattern:!0})}add(e,t={}){var a=this;return Object(u.a)(p.a.mark((function i(){var c;return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Object(u.a)(p.a.mark((function i(){var c,r,l,o;return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:c={originX:"center",originY:"center",left:0,top:0,fill:"black",id:a.props.idSource()},i.t0=e,i.next="line"===i.t0?4:"circle"===i.t0?5:"ellipse"===i.t0?6:"triangle"===i.t0?7:"rect"===i.t0?8:"text"===i.t0?9:"image"===i.t0?12:"aoi"===i.t0?18:19;break;case 4:return i.abrupt("return",new G.fabric.Line([-50,0,50,0],{stroke:"black",id:c.id,originX:"center",originY:"center"}));case 5:return i.abrupt("return",new G.fabric.Circle(Object(n.a)({radius:27.5},c,{},t)).setControlVisible("mtr",!1));case 6:return i.abrupt("return",new G.fabric.Ellipse(Object(n.a)({rx:30,ry:25},c,{},t)));case 7:return i.abrupt("return",new G.fabric.Triangle(Object(n.a)({width:100*Math.sqrt(1/3),height:50},c,{},t)));case 8:return i.abrupt("return",new G.fabric.Rect(Object(n.a)({width:50,height:50},c,{},t)));case 9:return r=t.content,delete t.content,i.abrupt("return",new G.fabric.IText(r,Object(n.a)({fontFamily:"sans-serif",fontSize:32,textAlign:"center"},c,{},t)));case 12:return(l=t.src.match(ae))&&(t._src=t.src,t.src=Object(Q.c)(a.context.store,a.props.id,l[1]).file.content),i.next=16,new Promise((e,a)=>{const n=new Image;n.addEventListener("load",()=>e(n)),n.addEventListener("error",e=>a(e)),n.crossOrigin="anonymous",n.src=t.src});case 16:return o=i.sent,i.abrupt("return",new G.fabric.Image(o,Object(n.a)({},c,{},t)));case 18:return i.abrupt("return",new G.fabric.Aoi(Object(n.a)({width:50,height:50},c)));case 19:return i.abrupt("return",void 0);case 20:case"end":return i.stop()}}),i)})))();case 2:(c=i.sent)&&(a.canvas.add(c),a.canvas.setActiveObject(c));case 4:case"end":return i.stop()}}),i)})))()}updateActive(){this.canvas.getActiveObjects().forEach(e=>{"i-text"===e.type&&this.props.updateHandler({target:e})})}modifyActive(e,...t){this.canvas.getActiveObjects().forEach(a=>{switch(e){case"remove":this.canvas.discardActiveObject(),this.canvas.remove(a);break;default:"image"===a.type&&t[0]&&t[0].src&&a.src!==t[0].src&&a.setSrc(t[0].src,()=>this.canvas.requestRenderAll()),a[e].call(a,...t),a.setCoords()}}),this.canvas.requestRenderAll()}cloneActive(){this.canvas.getActiveObjects().map(e=>e.clone(e=>{e.id=this.props.idSource(),this.canvas.add(e),this.canvas.setActiveObject(e)}))}toObject(){return this.canvas.toObject(["id"])}render(){return r.a.createElement("canvas",{ref:this.canvasRef})}}le.contextType=l.b;const oe=(e=[])=>{let t=Object(h.uniqueId)();for(;e.includes(t);)t=Object(h.uniqueId)();return t},se={left:"",top:"",angle:"",width:"",height:""};class de extends c.Component{constructor(...e){super(...e),this._isMounted=!1;const t=(e=>{const t=e.filter(e=>Object(h.isObject)(e)&&void 0!==e.id).map(e=>e.id),a=e.filter(e=>Object(h.isObject)(e)).map(e=>{if(e.id)return[e.id,e];{const a=oe(t);return t.push(a),e.id=a,[e.id,e]}});return[Object(h.fromPairs)(a),a.map(e=>e[0])]})(this.props.data),a=Object(i.a)(t,2),n=a[0],c=a[1];this.state={data:n,order:c,selection:void 0},this.updateState=this.updateState.bind(this),this.canvas=r.a.createRef(),this.form=r.a.createRef()}setState(e){this._isMounted?super.setState(e,()=>{this.updateForm(),this.updateState()}):this.updateState("override")}updateState(e="local"){"override"===e?this.props.onChange(this.canvas.current.canvas._objects.map(e=>ie(e.toObject(["id","label"]),this.state.data[e.id]))):this.props.onChange(this.canvas.current.canvas._objects.map(e=>this.state.data[e.id]))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1,this.canvas.current.updateActive()}set selection(e){this.setState({selection:e}),void 0===e&&this.form.current.setValues(se)}get selection(){return this.state.data[this.state.selection]||{type:void 0}}addContent(e){this.updateContent(e,!1),this.updateOrder()}deleteContent(e){this.setState({data:Object(h.omit)(this.state.data,[e.id])}),this.selection=void 0}updateContent(e,t=!0){e.id&&(this.setState({data:Object(n.a)({},this.state.data,{[e.id]:e})}),t&&this.canvas.current.modifyActive("set",ne(e,this.props.id,this.context.store,["text"])))}updateOrder(){this.setState({order:this.canvas.current.canvas._objects.map(e=>e.id)})}updateFromForm(e){if(this.state.data[this.state.selection]){const t=Object(n.a)({},e);this.updateContent(Object(n.a)({},t,{type:this.state.selection?this.state.data[this.state.selection].type:void 0,id:this.state.selection}),!0)}}updateForm(){this.form.current.setValues(this.selection)}uniqueId(){return oe(this.state.order)}render(){const e=this.selection;return(r.a.createElement(r.a.Fragment,null,r.a.createElement(le,{id:this.props.id,data:this.state.order.map(e=>ne(this.state.data[e],this.props.id,this.context.store)),ref:this.canvas,addHandler:({target:e})=>this.addContent(e.toObject(["id","label"])),deleteHandler:({target:e})=>this.deleteContent(e),updateHandler:({target:e})=>{this.updateContent(ie(e.toObject(["id","label"]),this.state.data[e.id]),!1)},updateSelectionHandler:({target:e})=>this.selection=e.id,clearSelectionHandler:()=>this.selection=void 0,idSource:()=>this.uniqueId()}),r.a.createElement("hr",null),r.a.createElement(o.e,{innerRef:this.form,initialValues:e},r.a.createElement(d.a,{className:"toolbar d-flex"},r.a.createElement(s.a,{interval:25,onSave:t=>{t!==e&&this.updateFromForm(t)}}),r.a.createElement(S,{addHandler:(...e)=>this.canvas.current.add(...e),removeHandler:()=>this.canvas.current.modifyActive("remove"),cloneHandler:()=>this.canvas.current.cloneActive(),selection:e}),r.a.createElement(W,{type:e.type,upHandler:()=>{this.canvas.current.modifyActive("bringForward"),this.updateOrder()},downHandler:()=>{this.canvas.current.modifyActive("sendBackwards"),this.updateOrder()}}),r.a.createElement(A,{selection:e,type:e.type}),r.a.createElement($,{type:e.type,selection:e,changeHandler:(e,t)=>{Object(h.isObject)(e)?this.form.current.setValues(e):this.form.current.setFieldValue(e,t)}})))))}}de.contextType=l.b}}]);
//# sourceMappingURL=5.333fc1be.chunk.js.map