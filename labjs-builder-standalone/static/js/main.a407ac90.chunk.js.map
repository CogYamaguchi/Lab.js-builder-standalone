{"version":3,"sources":["components/Nav/index.js","logic/util/files.js","components/Uploader/index.js","logic/tree/index.js","components/Modal/index.js","logic/util/fileType.js","components/ComponentOptions/components/Behavior/components/Timeline/util.js","components/FileSelector/Components/UploadTab.js","components/FileSelector/Components/PoolTab.js","components/FileSelector/index.js","components/Icon/index.js","components/FileSelector/field.js","components/Form/hooks.js","components/Form/index.js","components/Footer/flask_micro.png","logic/util/dataURI.js","reducers/version.js","logic/components.js","reducers/components.js","components/ComponentOptions/reducers.js","reducers/files.js","components/Modal/reducers.js","reducers/index.js","logic/io/upgrade.js","logic/io/load.js","logic/util/monitoring.js","logic/util/persistence.js","logic/util/remoteStudy.js","store.js","logic/util/slug.js","logic/io/filename.js","logic/io/save.js","components/Card/index.js","components/App/Error.js","components/Layout/index.js","components/Modal/components/AddComponent/components/newTab/index.js","components/ComponentOptions/components/Welcome/components/ExampleTab.js","components/Modal/components/AddComponent/components/importTab/index.js","components/Modal/components/AddComponent/components/templateTab/index.js","components/Modal/components/AddComponent/components/copyTab/index.js","components/Modal/components/AddComponent/index.js","actions/components.js","components/Modal/components/Options/MetadataForm.js","components/FileTable/index.js","components/FileStorageIndicator/index.js","components/Modal/components/Options/Files.js","components/Editor/index.js","components/Modal/components/Options/index.js","components/Modal/components/Confirm.js","logic/util/compatibility.js","components/Modal/components/SystemCompatibility/index.js","logic/plugins/library.js","logic/plugins/index.js","logic/util/makeType.js","logic/util/async.js","logic/io/assemble/script.js","logic/io/assemble/html.js","logic/io/assemble/index.js","logic/io/export/index.js","logic/io/export/modifiers/expfactory.js","components/Modal/components/ExportExpFactory/index.js","logic/io/export/modifiers/netlify.js","components/Modal/components/ExportNetlify/widget.js","components/Modal/components/ExportNetlify/index.js","components/Modal/components/ExportOpenLab/widget.js","components/Modal/components/ExportOpenLab/index.js","logic/io/export/modifiers/php.js","logic/io/export/modifiers/postMessage.js","components/Modal/components/Legal/index.js","components/Modal/redux.js","components/Modal/components/ExportPHP/index.js","components/Modal/components/ExportPostMessage/index.js","components/Shortcuts/index.js","components/System/index.js","logic/io/preview/index.js","logic/io/export/modifiers/preview.js","logic/io/export/modifiers/local.js","logic/io/preview/PreviewWindow.js","components/Toolbar/components/PreviewButton.js","logic/io/export/modifiers/jatos.js","logic/io/export/modifiers/pavlovia.js","logic/metadata/psych-ds.js","components/Toolbar/components/IOButton/index.js","components/Toolbar/index.js","components/Tree/index.js","components/Tree/components/AddButton/index.js","components/Tree/components/DropTarget/index.js","components/Tree/components/Node/dropdown/index.js","components/Tree/components/Node/index.js","components/Sidebar/index.js","components/Hint/index.js","components/Footer/imprint.js","components/Footer/index.js","components/ComponentHeader/index.js","components/ComponentOptions/components/Welcome/components/SplashTab/index.js","components/ComponentOptions/components/Welcome/index.js","components/ComponentOptions/components/Fallback.js","components/Spinner/index.js","components/ComponentOptions/components/Behavior/components/Timeline/index.js","components/Form/array.js","components/Form/table.js","components/ComponentOptions/components/Behavior/components/Responses.js","components/ComponentOptions/components/Behavior/components/Meta.js","components/ComponentOptions/components/Form.js","components/ComponentOptions/components/Behavior/index.js","components/ComponentOptions/components/Scripts/index.js","components/ComponentOptions/components/Files/footer.js","components/ComponentOptions/components/Files/index.js","components/ComponentOptions/components/Plugins/modal.js","components/ComponentOptions/components/Plugins/index.js","components/ComponentOptions/components/Template.js","components/ComponentOptions/components/Advanced.js","components/ComponentOptions/components/Content/Canvas/index.js","components/Editor/field.js","components/ComponentOptions/components/Content/Editor.js","components/ComponentOptions/components/Content/Frame.js","components/ComponentOptions/components/Content/Loop/Grid/header.js","components/ComponentOptions/components/Content/Loop/DesignWizard/FactorialModal.js","components/ComponentOptions/components/Content/Loop/Grid/footer.js","components/ComponentOptions/components/Content/Loop/Grid/index.js","components/ComponentOptions/components/Content/Loop/SampleWidget/index.js","components/ComponentOptions/components/Content/Loop/ShuffleGroups/Item.js","components/ComponentOptions/components/Content/Loop/ShuffleGroups/Group.js","components/ComponentOptions/components/Content/Loop/ShuffleGroups/index.js","components/ComponentOptions/components/Content/Loop/index.js","components/ComponentOptions/components/Content/Sequence/index.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Text.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Image.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Divider.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Raw.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/BaseOptions.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Input.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Coding.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Radio.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Checkbox.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Slider.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/components/Likert.js","components/ComponentOptions/components/Content/Page/components/ItemOptions/index.js","components/ComponentOptions/components/Content/Page/components/Columns.js","components/ComponentOptions/components/Content/Page/components/Footer.js","components/ComponentOptions/components/Content/Page/index.js","components/ComponentOptions/index.js","components/App/index.js","logic/io/preview/worker.js","registerServiceWorker.js","index.js"],"names":["NavEntry","id","activeId","setId","children","className","classnames","active","onClick","NavCloseModal","style","padding","type","aria-label","aria-hidden","embeddedFiles","components","componentFiles","Object","entries","map","_","files","filter","length","flatMap","c","f","poolPath","addFiles","store","processedFiles","data","content","component","localPath","console","log","Error","defaultPath","undefined","fileHash","sha256","update","digest","fileExtension","split","pop","source","checkSum","dispatch","getLocalFile","componentId","state","getState","localFile","file","Uploader","Component","constructor","props","super","this","handleClick","bind","handleDrop","handleInputChange","inputField","React","createRef","current","click","Array","from","checkFile","handleFiles","e","stopPropagation","preventDefault","dataTransfer","items","item","kind","getAsFile","clear","handleDragOver","size","maxSize","alert","minSize","accept","name","Promise","all","resolve","reader","FileReader","onload","target","result","decodeAs","readAsText","readAsDataURL","then","results","onUpload","render","Wrapper","tag","onDrop","onDragOver","multiple","display","ref","onChange","value","defaultProps","tree","isArray","nestedIds","concat","parents","immediateParents","includes","n","flatTree","level","output","forEach","push","isOpen","onRequestClose","modalProps","appElement","document","getElementById","overlayClassName","contentLabel","overlay","backgroundColor","opacity","overflowX","overflowY","mimeToIcon","mime","family","dataURItoIcon","uri","mimeFromDataURI","numberOrPlaceholder","integerOrPlaceholder","handleUpload","Icon","icon","fontSize","PoolTab","handleImport","initialComponent","useState","setComponent","useStore","localFiles","CustomInput","bsSize","defaultValue","index","key","repeat","title","ListGroup","ListGroupItem","action","href","disabled","checkAccept","fontFamily","overflow","textOverflow","fixedWidth","FileSelector","activeTab","tab","promiseHandlers","select","toggle","setTab","setState","prevState","reject","context","sourceComponent","sourceLocalPath","addToComponent","renderTab","UploadTab","Modal","Nav","tabs","weight","ModalBody","contextType","ReactReduxContext","iconSet","process","replacements","fallback","fallbackWeight","placeholder","fileSelector","useField","helpers","addonType","Input","outline","color","minWidth","a","setValue","useDebounce","fn","wait","args","effect","deps","initial","useRef","useEffect","useUpdates","timeout","setTimeout","clearTimeout","AutoSave","connect","formik","values","dirty","interval","onSave","field","module","exports","makeDataURI","encodeURIComponent","re","readDataURI","exec","encoding","base64","decodeURIComponent","blobFromDataURI","binary","window","atob","bytes","Uint8Array","i","charCodeAt","Blob","sizeFromDataURI","Math","ceil","indexOf","updateDataURI","updater","newData","defaultState","parameters","plugins","metadata","description","repository","contributors","defaultTabs","globalDefaults","responses","label","event","messageHandlers","message","code","category","minChildren","maxChildren","defaultTab","defaults","templateParameters","columns","rows","sample","mode","Infinity","iconWeight","iconFallbackWeight","stripIndent","scrollTop","contextSelector","submitButtonText","submitButtonPosition","viewport","idCounter","uniqueId","usedIds","k","v","candidate","toString","viewType","viewProps","bundledFiles","modalType","makeHydratable","reducer","hydrateActionType","combineReducers","version","oldParent","newParent","childrenStepOne","slice","oldIndex","childrenStepTwo","newIndex","componentData","parent","componentInUse","reduce","count","x","o","copy","copiedComponent","newId","oImport","importComponent","_collapsed","fromPairs","componentState","newFiles","currentFiles","pick","timeline","pluginType","componentDetail","modal","updates","mapValues","col","newKeyValues","r","newKeys","trim","join","newRow","replace","filename","payload","permanent","_tab","defaultHeader","RegExp","newHeader","l","fileContent","path","shuffle","start","stop","priority","omit","options","fromObject","upgrade","fromJSON","input","JSON","parse","quotaExceededErrors","lf","localForage","createInstance","persistState","subscribe","debounce","setItem","catch","some","navigator","storage","persist","persisted","retrieveState","getItem","fromURL","location","URL","searchParams","url","get","confirm","fetch","response","ok","status","statusText","json","history","pushState","configureStore","initialState","createStore","composeWithDevTools","slugify","defaultSlugify","toLowerCase","makeFilename","stateToJSON","exportedComponent","removeInternals","allComponents","allFiles","cloneDeep","filteredComponents","omitBy","startsWith","filesInUse","pickBy","stringify","stateToDownload","filenameOverride","stateJSON","fileprefix","timestamp","moment","format","saveAs","Card","open","badge","collapsable","wrapContent","CardBody","CardHeader","borderBottomStyle","Badge","mincedOaths","gifs","reset","error","errorInfo","eventId","backup","setBackup","Container","Row","Col","sm","offset","autoPlay","loop","width","height","marginTop","objectFit","src","Alert","background","border","Button","block","rel","ButtonGroup","whiteSpace","componentStack","sidebar","footer","fluid","maxWidth","minHeight","addComponent","ComponentShortcut","fontWeight","ComponentList","d","types","CardGroup","basePath","REACT_APP_EXAMPLE_PATH","etAl","acc","arr","Task","clickHandler","cursor","TaskList","tasks","componentDidMount","loadTask","task","loadHandler","taskLabel","CardTitle","CardSubtitle","CardText","root","ImportTab","REACT_APP_TEMPLATE_PATH","TemplateTab","CopyTab","sourceSelect","innerRef","TabContent","tabProps","updateComponent","mapDispatchToProps","initialValues","FormGroup","row","Label","for","paddingLeft","FormText","FileTableColGroup","FileTableHeader","FileTableRow","onDelete","lineHeight","position","top","FileTableBody","deleteFile","sources","sortBy","space","Progress","max","toFixed","Files","Table","borderBottom","colSpan","Editor","editorWillMount","monaco","editor","defineTheme","base","inherit","rules","token","foreground","colors","editorDidMount","model","getModel","updateOptions","tabSize","language","default","HTMLHint","onDidChangeContent","throttle","hints","verify","getValue","hint","startLineNumber","line","startColumn","endLineNumber","endColumn","raw","severity","setModelMarkers","theme","contextmenu","cursorBlinking","lineNumbers","lineNumbersMinChars","overviewRulerLanes","rulers","scrollbar","useShadows","scrollBeyondLastLine","wordWrap","wordWrapColumn","wrappingIndent","newContent","OptionsModal","closeHandler","ModalFooter","confirmLabel","confirmHandler","closeLabel","ModalHeader","errors","isNil","serviceWorker","localStorage","check","large","fullscreen","headers","mousetrap","coding","help","loadPlugin","embedPlugins","prev","loadedPlugins","uniqBy","p","pluginFiles","pluginName","prependPath","assign","pluginHeaders","attributes","template","pluginPath","parseHeaders","pluginPaths","makeType","toNumber","awaitRegex","AsyncFunction","Function","adaptiveFunction","match","createResponsePair","processResponses","pairs","processTemplateParameters","grid","colnames","every","zip","processGrid","processContent","nodeType","makeComponentTree","currentNode","node","filteredOptions","h","skip","skipCondition","shuffleGroups","groupBy","shuffleGroup","g","identity","processNode","isEmpty","makeScript","studyTree","makeStudyScript","componentTree","serialize","makeStudyTree","renderNode","attrs","createElement","attr","setAttribute","outerHTML","makeHeader","beforeHeader","libraryPath","dev","defer","makeHTML","headerOptions","escape","evaluate","header","assemble","stateModifier","additionalFiles","updatedState","updatedHeaderOptions","keys","createZip","JSZip","addFile","blob","generateAsync","downloadZip","Sentry","scope","setTag","downloadStatic","reduceAuthors","curr","next","makeReadme","credits","parseAuthor","makeConfig","exp_id","instructions","time","addTransmitPlugin","incremental","callbacks","setup","csrf_token","full","container","prefix","expId","moveFile","transform","request","text","ExportExpFactory","Confirm","vertical","downloadStaticExpFactory","addSubmissionForm","makeRedirects","site","createStaticBlob","validateApiKey","NetlifyForm","forwardRef","onSubmit","apiKey","touched","validate","NetlifyWidget","widgetState","formRef","triggerSubmit","findDOMNode","requestSubmit","send","exportStaticNetlify","studyBlob","method","body","site_url","ssl_url","subdomain","admin_url","statusCode","NavItem","NavLink","ExportNetlify","widget","OpenLabWidget","submit","FormData","append","ExportOpenLab","phpBackendStatic","addPostMessagePlugin","ExternalContent","load","dangerouslySetInnerHTML","__html","MODAL_COMPONENTS","ExportExpFactoryModal","ExportNetlifyModal","ExportOpenLabModal","MODAL_SIZES","hideModal","SpecificModal","commandKey","platform","Shortcuts","handleKeyDown","shiftKey","dispatchEvent","Event","addEventListener","componentWillUnmount","removeEventListener","SystemContext","createContext","previewState","SystemContextProvider","Provider","prePopulateCache","caches","cache","addAll","putFile","previewPath","put","Request","Response","linkStatic","populateCache","assemblyOptions","keylist","delete","study","addDebugPlugin","filePrefix","addDownloadPlugin","Preview","stateChangeCallback","close","checkWindow","once","reload","focus","openOrFocus","closed","PreviewButton","windowState","previewWindow","PreviewWindow","button","openPreview","simulateClick","Consumer","previewActive","onMouseEnter","uuid","groupStudy","dirName","comments","jsonData","componentList","batchList","updateIndex","updateScript","addJatosIntegration","addPavloviaPlugin","makeCreator","defaultVariables","makeSidecar","makeMetadata","IOButton","dropdownOpen","setDropdownOpen","ButtonDropdown","DropdownToggle","caret","DropdownMenu","DropdownItem","divider","downloadStaticLocal","downloadStaticJatos","fileName","downloadStaticPavlovia","downloadPsychDS","showModal","Tree","getChildContext","onNodeClick","onNodeAdd","onNodeDelete","onNodeDuplicate","Node","rootId","renderBody","parentId","childContextTypes","PropTypes","func","pinned","getParents","createDeepEqualSelector","createSelectorCreator","defaultMemoize","isEqual","flow","DropTarget","drop","targetProps","monitor","canDrop","itemProps","parentIds","connectDropTarget","dropTarget","isOver","validTarget","shallow","parentSelector","collapseComponent","collapsed","hasChildren","onDuplicate","UncontrolledDropdown","right","NodeBody","skipped","tardy","isDragging","contextTypes","NodeGap","NodeTail","vacancies","pills","childId","childIndex","DraggableNode","ConnectedNode","connectDragSource","_template","tailPinned","tailVacancies","nodeSource","beginDrag","DragSource","dragSource","deleteComponent","duplicateComponent","showComponentDetail","showAddModal","textAlign","marginBottom","HintTarget","HintPopover","Target","Popover","placement","trigger","delay","PopoverHeader","PopoverBody","HelpHint","ImprintHint","Imprint","alt","logo","tabIcons","HeaderForm","typeCategory","typeName","enableReinitialize","InputGroup","InputGroupAddon","UncontrolledTooltip","HeaderNav","t","visibleTabs","SplashHeader","margin","SplashTab","borderRight","SplashButton","splashOptions","switchTab","learn","support","SplashAdditions","Collapse","ExampleTab","justifyContent","show","hide","TimelineWidget","lazy","formikContext","useFormikContext","Spinner","xs","pattern","ArrayContext","ArrayContextProvider","arrayHelpers","setValues","setFieldValue","getRows","getIn","overwriteAll","baseName","columnName","mapRows","overwriteRows","newValue","addRow","addColumn","defaultCell","defaultColumn","clearColumn","fillColumn","availableCells","rowIndex","deleteColumn","useArrayContext","useContext","FormArray","Item","Header","Footer","wrapper","Fragment","wrapperProps","bodyWrapper","BodyWrapper","defaultItem","isLastItem","addItem","ButtonCell","DefaultColgroup","fill","DefaultRow","leftColumn","LeftColumn","rightColumn","RightColumn","remove","DefaultFooter","ResponseHeader","ResponseRow","as","InputGroupText","postProcess","Timeline","Responses","Meta","WrappedEditor","useMemo","parsingErrors","CardFooter","GridRow","form","onMouseUp","blur","oneOfType","string","number","FileIconCell","FileRow","requestClose","onAdd","pluginData","PluginHeader","PluginHint","visible","PluginControl","PluginOption","option","PluginBody","optionName","optionProps","PluginRow","PluginFooter","modalOpen","setModalOpen","getDefaultSettings","CellTypeSelector","meta","InputGroupButtonDropdown","boolean","TemplateRow","readOnly","inline","marginLeft","CanvasEditor","borderTop","CellTypeDropdown","actions","HeaderCell","product","sets","thresholds","s","reverse","counter","floor","TableRow","maxHeight","FactorialModal","factors","levels","table","names","generateTable","factorialModal","prompt","range","parseResult","unparse","fields","exportGrid","columnIndex","labels","samples","parseInt","isNaN","switchLabels","column","move","groupId","globalShuffle","groups","moveHandler","nextGroup","Number","group","Grid","SampleWidget","ShuffleGroups","paddingTop","ImageOptions","openItem","ItemContext","ImageSelector","folding","glyphMargin","minimap","enabled","BaseOptions","validation","CollapsingOptions","ExtraOptions","CodingGroup","w","htmlFor","Text","Image","Divider","Raw","Radio","Checkbox","Slider","Likert","selectItem","icons","setOpenItem","swap","AddWidget","defaultAddItem","required","direction","noGutters","anchors","ItemRow","ItemOptions","setIsOpen","ItemContextProvider","validateOnChange","GridFooter","ComponentDetail","Welcome","Fallback","Tab","CanvasContent","EditorContent","FrameContent","PageContent","LoopContent","SequenceContent","Behavior","Scripts","Plugins","Template","Advanced","selectTab","App","componentDidCatch","info","setExtras","setLevel","resetError","ComponentHeader","ComponentOptions","rootUrl","pathname","substring","lastIndexOf","getRegistrations","registrations","unregister","register","isLocalhost","Boolean","hostname","config","origin","swUrl","contentType","ready","registration","registerValidSW","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","REACT_APP_SENTRY_DSN","dsn","release","REACT_APP_SENTRY_RELEASE","installPreviewWorker","WrappedApp","DragDropContext","HTML5DragDropBackend","ReactDOM","registerServiceWorker"],"mappings":"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","file":"static/js/main.a407ac90.chunk.js","sourcesContent":["import React from 'react'\r\n\r\nimport { NavItem, NavLink } from 'reactstrap'\r\nimport classnames from 'classnames'\r\n\r\nexport const NavEntry = ({ id, activeId, setId, children }) =>\r\n  <NavItem>\r\n    <NavLink\r\n      className={ classnames({\r\n        active: activeId === id\r\n      }) }\r\n      onClick={ () => setId(id) }\r\n    >\r\n      { children }\r\n    </NavLink>\r\n  </NavItem>\r\n\r\nexport const NavCloseModal = ({ onClick }) =>\r\n  <NavItem\r\n    className=\"ml-auto\"\r\n    style={{\r\n      padding: '0.25em 0',\r\n    }}\r\n  >\r\n    <button\r\n      type=\"button\"\r\n      className=\"close\"\r\n      aria-label=\"Close\"\r\n      onClick={ onClick }\r\n    >\r\n      <span aria-hidden=\"true\">&times;</span>\r\n    </button>\r\n  </NavItem>\r\n","import { flatMap } from 'lodash'\r\nimport sha256 from 'hash.js/lib/hash/sha/256'\r\n\r\nexport const embeddedFiles = components => {\r\n  // Collect files embedded in components\r\n  // (extract files from component file setting,\r\n  // and the file URL from there)\r\n  const componentFiles = Object.entries(components)\r\n    .map(([_, { files }]) => files || [])\r\n    .filter(files => files.length > 0)\r\n\r\n  return flatMap(\r\n    componentFiles,\r\n    c => c.map(f => f.poolPath)\r\n  )\r\n}\r\n\r\nexport const addFiles = (store, files=[]) => {\r\n  // Normalize files for further processing and output\r\n  const processedFiles = files.map(f => {\r\n    if (\r\n      !(f.poolPath && f.data && f.data.content) && // New global file\r\n      !(f.component && f.localPath && f.poolPath) && // File import\r\n      !(f.component && f.localPath && f.data && f.data.content) // Add local\r\n    ) {\r\n      // These errors should only ever result from programming mistakes\r\n      console.log('Incomplete data for file', f)\r\n      throw Error('Incomplete data for file', f)\r\n    }\r\n\r\n    let defaultPath = undefined\r\n    let data = undefined\r\n\r\n    if (f.data && f.data.content) {\r\n      const fileHash = sha256().update(f.data.content).digest('hex')\r\n      const fileExtension = (f.localPath || f.poolPath).split('.').pop()\r\n      defaultPath = `embedded/${ fileHash }.${ fileExtension }`\r\n      data = {\r\n        content: f.data.content,\r\n        source: f.data.source || 'embedded',\r\n        checkSum: fileHash,\r\n      }\r\n    }\r\n\r\n    return {\r\n      poolPath: f.poolPath || defaultPath,\r\n      localPath: f.localPath,\r\n      component: f.component,\r\n      data,\r\n    }\r\n  })\r\n\r\n  store.dispatch({\r\n    type: 'ADD_FILES',\r\n    files: processedFiles,\r\n  })\r\n\r\n  return processedFiles\r\n}\r\n\r\nexport const getLocalFile = (store, componentId, localPath) => {\r\n  const state = store.getState()\r\n\r\n  if (state.components[componentId].files) {\r\n    const localFile = state.components[componentId].files\r\n      .filter(f => f.localPath === localPath) // Choose file\r\n      .pop() // Use the last match (arbitrarily)\r\n\r\n    if (localFile) {\r\n      // Look up file in global file store (by path)\r\n      return {\r\n        localPath,\r\n        poolPath: localFile.poolPath,\r\n        file: state.files.files[localFile.poolPath]\r\n      }\r\n    }\r\n  }\r\n\r\n  // File not found\r\n  return undefined\r\n}\r\n","import React, { Component } from 'react'\r\nimport accept from 'attr-accept'\r\n\r\nclass Uploader extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.handleClick = this.handleClick.bind(this)\r\n    this.handleDrop = this.handleDrop.bind(this)\r\n    this.handleInputChange = this.handleInputChange.bind(this)\r\n    this.inputField = React.createRef()\r\n  }\r\n\r\n  // User interactions ---------------------------------------------------------\r\n\r\n  handleClick() {\r\n    this.inputField.current.click()\r\n  }\r\n\r\n  handleInputChange() {\r\n    // Select the first file that meets all criteria\r\n    const files = Array.from(this.inputField.current.files)\r\n      .filter( f => this.checkFile(f) )\r\n\r\n    this.handleFiles(files)\r\n  }\r\n\r\n  handleDrop(e) {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n\r\n    if (e.dataTransfer.items) {\r\n      const files = Array.from(e.dataTransfer.items)\r\n        .filter(item => item.kind === 'file')\r\n        .map(item => item.getAsFile())\r\n        .filter(f => this.checkFile(f))\r\n\r\n      this.handleFiles(files)\r\n      e.dataTransfer.items.clear()\r\n    }\r\n  }\r\n\r\n  handleDragOver(e) {\r\n    // Capturing this event is necessary\r\n    // for the drop action to work\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n  }\r\n\r\n  // Internal file processing --------------------------------------------------\r\n\r\n  checkFile(file) {\r\n    if (file.size > this.props.maxSize) {\r\n      alert(\r\n        'This file is too large to be opened. ' +\r\n        'Please contact support for assistance!'\r\n      )\r\n    }\r\n\r\n    return (\r\n      file.size <= this.props.maxSize &&\r\n      file.size >= this.props.minSize &&\r\n      accept({\r\n        name: file.name,\r\n        type: file.type,\r\n      }, this.props.accept)\r\n    )\r\n  }\r\n\r\n  handleFiles(files) {\r\n    Promise.all(files.map(f => new Promise((resolve) => {\r\n      const reader = new FileReader()\r\n      reader.onload = e => resolve([e.target.result, f])\r\n\r\n      // reader.iMarriedHim\r\n      if (this.props.decodeAs === 'text') {\r\n        reader.readAsText(f)\r\n      } else if (this.props.decodeAs === 'dataURL') {\r\n        reader.readAsDataURL(f)\r\n      }\r\n    }))).then(results => {\r\n      this.props.onUpload(results)\r\n    })\r\n  }\r\n\r\n  // User interface ------------------------------------------------------------\r\n\r\n  render() {\r\n    // TODO: change wrapping <div> to array\r\n    // as soon as react-popper is ready\r\n    const Wrapper = this.props.tag || 'div'\r\n\r\n    return <>\r\n      <Wrapper\r\n        className={ this.props.className }\r\n        onClick={ this.handleClick }\r\n        onDrop={ this.handleDrop }\r\n        onDragOver={ this.handleDragOver }\r\n      >\r\n        { this.props.children }\r\n      </Wrapper>\r\n      <input\r\n        type=\"file\"\r\n        accept={ this.props.accept }\r\n        multiple={ this.props.multiple }\r\n        style={{ display: 'none' }}\r\n        ref={ this.inputField }\r\n        onChange={ this.handleInputChange }\r\n        // Reset value when selected\r\n        // (so that the same file can be uploaded twice)\r\n        onClick={ (e) => e.target.value = null }\r\n      />\r\n    </>\r\n  }\r\n}\r\n\r\nUploader.defaultProps = {\r\n  minSize: 0,\r\n  maxSize: 2.5 * 1024 ** 2, // 2.5MB ought to be enough for anybody\r\n  accept: '',\r\n  multiple: true,\r\n  decodeAs: 'text',\r\n}\r\n\r\nexport default Uploader\r\n","\r\nexport const children = (id, tree) => {\r\n  const data = tree[id]\r\n  if (data.children && Array.isArray(data.children)) {\r\n    const nestedIds = data.children.map(c => children(c, tree))\r\n    return data.children.concat(...nestedIds)\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n\r\nexport const parents = (target, tree) => {\r\n  const immediateParents = Object.entries(tree)\r\n    .filter(\r\n      ([id, data]) =>\r\n        data.children && Array.isArray(data.children) &&\r\n        data.children.includes(target)\r\n    ).map(\r\n      ([id, data]) => id\r\n    )\r\n\r\n  return immediateParents.concat(\r\n    ...immediateParents.map(n => parents(n, tree))\r\n  )\r\n}\r\n\r\n// Generate flat representation of tree,\r\n// alongside some component metadata\r\nexport const flatTree = (tree, id='root', level=0) => {\r\n  const output = []\r\n  if (tree[id].children) {\r\n    tree[id].children.forEach(\r\n      c => output.push(\r\n        [ c, level, tree[c] ],\r\n        ...flatTree(tree, c, level + 1)\r\n      )\r\n    )\r\n  }\r\n  return output\r\n}\r\n","import React from 'react'\r\nimport Modal from 'react-modal'\r\nimport classnames from 'classnames'\r\n\r\n// Overall general-purpose modal container style\r\nimport './index.css'\r\n\r\nexport default ({ isOpen, onRequestClose, modalProps={}, children }) =>\r\n  <Modal\r\n    appElement={ document.getElementById('root') }\r\n    isOpen={ isOpen }\r\n    onRequestClose={ onRequestClose }\r\n    className={ classnames({\r\n      'modal-dialog': true,\r\n      'modal-lg': modalProps.size === 'lg',\r\n      'modal-xl': modalProps.size === 'xl',\r\n    }) }\r\n    overlayClassName=\"modal fade show\"\r\n    contentLabel=\"App Modal\"\r\n    style={{\r\n      overlay: {\r\n        display: 'block',\r\n        backgroundColor : 'rgba(0, 0, 0, 0.5)',\r\n        opacity: '1',\r\n        overflowX: 'hidden',\r\n        overflowY: 'auto',\r\n      }\r\n    }}\r\n  >\r\n    { children }\r\n  </Modal>\r\n","import { mimeFromDataURI } from './dataURI'\r\n\r\nexport const mimeToIcon = (mime='') => {\r\n  const [family, ] = mime.split('/')\r\n\r\n  const mimeFamilies = [\r\n    'image', 'audio', 'video'\r\n  ]\r\n  const codeMimes = [\r\n    'text/html', 'text/css',\r\n    'application/javascript', 'application-json'\r\n  ]\r\n\r\n  if (mimeFamilies.includes(family)) {\r\n    return 'file-' + family\r\n  } else if (codeMimes.includes(mime)) {\r\n    return 'file-code'\r\n  } else if (mime === 'text/plain') {\r\n    return 'file-alt'\r\n  } else {\r\n    return 'file'\r\n  }\r\n}\r\n\r\nexport const dataURItoIcon = uri =>\r\n  mimeToIcon(mimeFromDataURI(uri))\r\n","// Accept number or placeholder\r\nexport const numberOrPlaceholder = \"(\\\\d+(\\\\.\\\\d+)?)|(\\\\$\\\\{.*\\\\})\"\r\nexport const integerOrPlaceholder = \"(\\\\d+)|(\\\\$\\\\{.*\\\\})\"\r\n","import React from 'react'\r\n\r\nimport Uploader from '../../Uploader'\r\nimport Icon from '../../Icon'\r\n\r\nexport default ({ handleUpload, accept='' }) =>\r\n  <Uploader\r\n    accept={ accept }\r\n    decodeAs=\"dataURL\"\r\n    onUpload={ handleUpload }\r\n  >\r\n    <div\r\n      className=\"btn btn-outline-secondary btn-block text-center p-5\"\r\n    >\r\n      <Icon\r\n        icon=\"file-upload\"\r\n        className=\"d-block text-muted p-3\"\r\n        style={{\r\n          fontSize: '3.5rem',\r\n        }}\r\n      />\r\n      <small className=\"text-muted\">\r\n        Please <strong>drop a file</strong> here to add,<br />\r\n        or <strong>click to choose</strong> one from your computer\r\n      </small>\r\n    </div>\r\n  </Uploader>\r\n","import React, { useState } from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { CustomInput, ListGroup, ListGroupItem } from 'reactstrap'\r\nimport { repeat } from 'lodash'\r\nimport { default as checkAccept } from 'attr-accept'\r\n\r\nimport { flatTree } from '../../../logic/tree'\r\nimport { mimeFromDataURI } from '../../../logic/util/dataURI'\r\nimport { mimeToIcon } from '../../../logic/util/fileType';\r\nimport Icon from '../../Icon';\r\n\r\nconst PoolTab = ({ accept, handleImport, initialComponent }) => {\r\n  const [component, setComponent] = useState(initialComponent)\r\n  const store = useStore()\r\n  const { components, files: { files } } = store.getState()\r\n\r\n  const localFiles = components[component]\r\n    .files?.map(f => ({\r\n      // Undo grid data format and look up mime type\r\n      type: files[f.poolPath]\r\n        ? mimeFromDataURI(files[f.poolPath].content)\r\n        : '',\r\n      ...f,\r\n    })) ?? []\r\n\r\n  return <>\r\n    <CustomInput\r\n      type=\"select\"\r\n      id=\"component\"\r\n      bsSize=\"lg\"\r\n      className=\"mb-2 font-weight-bold\"\r\n      defaultValue={ component }\r\n      onChange={ e => setComponent(e.target.value) }\r\n    >\r\n      {\r\n        flatTree(components).map(\r\n          ([id, level, data], index) =>\r\n            <option\r\n              value={ id } key={ index }\r\n            >\r\n              { level > 0 ? repeat(' ', level - 1) + '∙ ' : '' }\r\n              { data.title }\r\n            </option>\r\n        )\r\n      }\r\n    </CustomInput>\r\n    <ListGroup>\r\n      {\r\n        localFiles.map((f, index) =>\r\n          <ListGroupItem action\r\n            key={ index }\r\n            tag=\"a\" href=\"#\"\r\n            className=\"d-flex justify-content-between align-items-center\"\r\n            disabled={\r\n              !checkAccept(\r\n                { type: f.type, name: f.poolPath },\r\n                accept\r\n              )\r\n            }\r\n            onClick={ () => handleImport(\r\n              component,\r\n              f.localPath\r\n            ) }\r\n          >\r\n            <span\r\n              style={{\r\n                fontFamily: 'Fira Mono',\r\n                overflow: 'hidden',\r\n                textOverflow: 'ellipsis',\r\n              }}\r\n            >\r\n              { f.localPath }\r\n            </span>\r\n            <Icon\r\n              icon={ mimeToIcon(f.type) }\r\n              fixedWidth\r\n              className=\"ml-2\"\r\n            />\r\n          </ListGroupItem>\r\n        )\r\n      }\r\n    </ListGroup>\r\n  </>\r\n}\r\n\r\nexport default PoolTab\r\n","import React, { Component } from 'react'\r\nimport { ReactReduxContext } from 'react-redux'\r\nimport { Nav, ModalBody } from 'reactstrap'\r\n\r\nimport { addFiles, getLocalFile } from '../../logic/util/files'\r\n\r\nimport Modal from '../Modal'\r\nimport Icon from '../Icon'\r\nimport { NavEntry, NavCloseModal } from '../Nav'\r\n\r\nimport UploadTab from './Components/UploadTab'\r\nimport PoolTab from './Components/PoolTab'\r\n\r\nexport default class FileSelector extends Component {\r\n  static contextType = ReactReduxContext\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      active: false,\r\n      activeTab: this.props.tab,\r\n    }\r\n    this.promiseHandlers = {}\r\n\r\n    this.handleUpload = this.handleUpload.bind(this)\r\n    this.handleImport = this.handleImport.bind(this)\r\n    this.select = this.select.bind(this)\r\n    this.toggle = this.toggle.bind(this)\r\n    this.setTab = this.setTab.bind(this)\r\n  }\r\n\r\n  toggle() {\r\n    this.setState((prevState) => {\r\n      // Reject promise\r\n      if (prevState.active && this.promiseHandlers.reject) {\r\n        this.promiseHandlers.reject('FileSelector hidden')\r\n      }\r\n\r\n      // Switch state\r\n      return { active: !prevState.active }\r\n    })\r\n  }\r\n\r\n  setTab(name) {\r\n    this.setState({\r\n      activeTab: name\r\n    })\r\n  }\r\n\r\n  handleUpload(files) {\r\n    const result = addFiles(\r\n      this.context.store,\r\n      files.map(([content, file]) => ({\r\n        localPath: file.name,\r\n        component: this.props.component,\r\n        data: {\r\n          content,\r\n        },\r\n      }))\r\n    )\r\n\r\n    // Resolve promise\r\n    if (this.promiseHandlers.resolve) {\r\n      this.promiseHandlers.resolve(result)\r\n    }\r\n\r\n    return result\r\n  }\r\n\r\n  handleImport(sourceComponent, sourceLocalPath) {\r\n    const { poolPath } = getLocalFile(\r\n      this.context.store,\r\n      sourceComponent,\r\n      sourceLocalPath\r\n    )\r\n    // TODO: Consider whether it is ever possible\r\n    // that a file lookup might fail, and add error\r\n    // handling if so.\r\n\r\n    const result = [{\r\n      localPath: sourceLocalPath,\r\n      poolPath,\r\n    }]\r\n\r\n    if (\r\n      this.props.component && this.props.addToComponent &&\r\n      this.props.component !== sourceComponent\r\n    ) {\r\n      addFiles(this.context.store, [{\r\n        component: this.props.component,\r\n        localPath: result[0].localPath,\r\n        poolPath,\r\n      }])\r\n    }\r\n\r\n    // Resolve promise\r\n    if (this.promiseHandlers.resolve) {\r\n      this.promiseHandlers.resolve(result)\r\n    }\r\n\r\n    return result\r\n  }\r\n\r\n  async select() {\r\n    this.toggle()\r\n    return new Promise(\r\n      (resolve, reject) => {\r\n        this.promiseHandlers = {\r\n          resolve: result => {\r\n            this.setState({ active: false })\r\n            return resolve(result)\r\n          },\r\n          reject\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  renderTab() {\r\n    switch (this.state.activeTab) {\r\n      case 'pool':\r\n        return <PoolTab\r\n          initialComponent={ this.props.component }\r\n          accept={ this.props.accept }\r\n          handleImport={ this.handleImport }\r\n        />\r\n      default:\r\n        return <UploadTab\r\n          accept={ this.props.accept }\r\n          handleUpload={ this.handleUpload }\r\n        />\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <Modal\r\n      isOpen={ this.state.active }\r\n    >\r\n      <div className=\"modal-content\">\r\n        <Nav tabs>\r\n          <NavEntry\r\n            id=\"new\"\r\n            activeId={ this.state.activeTab }\r\n            setId={ this.setTab }\r\n          >\r\n            <Icon icon=\"plus\" weight=\"s\" />\r\n          </NavEntry>\r\n          <NavEntry\r\n            id=\"pool\"\r\n            activeId={ this.state.activeTab }\r\n            setId={ this.setTab }\r\n          >\r\n            <Icon icon=\"folder\" />\r\n          </NavEntry>\r\n          <NavCloseModal onClick={ this.toggle } />\r\n        </Nav>\r\n        <ModalBody>\r\n          { this.renderTab() }\r\n        </ModalBody>\r\n      </div>\r\n    </Modal>\r\n  }\r\n}\r\n\r\nFileSelector.defaultProps = {\r\n  addToComponent: true,\r\n  accept: '',\r\n  tab: 'new',\r\n}\r\n","import React from 'react'\r\nimport classnames from 'classnames'\r\n\r\n/* eslint-disable no-unused-expressions */\r\n// Font Awesome\r\nimport(`@fortawesome/fontawesome-${ process.env.REACT_APP_FA }/css/solid.css`)\r\nimport(`@fortawesome/fontawesome-${ process.env.REACT_APP_FA }/css/regular.css`)\r\nimport(`@fortawesome/fontawesome-${ process.env.REACT_APP_FA }/css/brands.css`)\r\n// Uncomment if FA-pro is available\r\n//import(`@fortawesome/fontawesome-${ process.env.REACT_APP_FA }/css/light.css`)\r\nimport(`@fortawesome/fontawesome-${ process.env.REACT_APP_FA }/css/fontawesome.css`)\r\n/* eslint-enable no-unused-expressions */\r\n\r\nexport const iconSet = `${ process.env.REACT_APP_FA }`\r\n\r\n// Alternate icons in the free set that substitute\r\n// only commercially availble icons.\r\nconst replacements = {\r\n  'alarm-clock': 'clock',\r\n  'arrows-v': 'arrows-alt-v',\r\n  'arrows-h': 'arrows-alt-h',\r\n  'bullseye-pointer': 'hand-pointer',\r\n  'comment-alt-minus': 'comment-alt',\r\n  'comment-alt-lines': 'comment-alt',\r\n  'ellipsis-h-alt': 'ellipsis-h',\r\n  'expand': 'square',\r\n  'file-exclamation': 'exclamation-circle',\r\n  'flask-potion': 'flask',\r\n  'heart-circle': 'heart',\r\n  'long-arrow-down': 'long-arrow-alt-down',\r\n  'long-arrow-right': 'long-arrow-alt-right',\r\n  'repeat': 'redo',\r\n  'spinner-third': 'spinner',\r\n  'tachometer': 'tachometer-alt',\r\n  'tachometer-average': 'tachometer-alt',\r\n  'volume': 'volume-up',\r\n}\r\n\r\nconst Icon = ({ icon, fixedWidth, weight, fallback, fallbackWeight,\r\n  id, className, title, style }) =>\r\n  <i\r\n    className={ classnames(\r\n      `fa${ iconSet === 'pro' ? weight : fallbackWeight } `,\r\n      `fa-${ iconSet === 'pro' ? icon : replacements[icon] || fallback || icon }`,\r\n      fixedWidth ? 'fa-fw' : null,\r\n      className\r\n    )}\r\n    aria-hidden\r\n    { ...{ id, title, style } }\r\n  />\r\n\r\nIcon.defaultProps = {\r\n  weight: 'r',\r\n  fallbackWeight: 's',\r\n}\r\n\r\nexport default Icon\r\n","import React, { createRef } from 'react'\r\n\r\nimport { useField, Field } from 'formik'\r\nimport { InputGroup, InputGroupAddon, InputGroupText, Button } from 'reactstrap'\r\n\r\nimport FileSelector from './index'\r\nimport Icon from '../Icon'\r\nimport { Input } from '../Form'\r\n\r\nexport default ({\r\n  name, component, icon=undefined, placeholder='source',\r\n  accept='*/*', tab\r\n}) => {\r\n  const fileSelector = createRef()\r\n  const [, , helpers] = useField({ name })\r\n\r\n  return <>\r\n    <FileSelector\r\n      accept={ accept }\r\n      component={ component }\r\n      tab={ tab }\r\n      ref={ fileSelector }\r\n    />\r\n    <InputGroup>\r\n      {\r\n        icon !== undefined\r\n          ? <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon fixedWidth icon={ icon } />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n          : null\r\n      }\r\n      <Field\r\n        name={ name }\r\n        placeholder={ placeholder }\r\n        component={ Input }\r\n        className=\"text-monospace\"\r\n      />\r\n      <InputGroupAddon addonType=\"append\">\r\n        <Button\r\n          outline color=\"secondary\"\r\n          style={{ minWidth: '3rem' }}\r\n          onClick={ async () => {\r\n            try {\r\n              const files = await fileSelector.current.select()\r\n              helpers.setValue(`\\${ this.files[\"${ files[0].localPath }\"] }`)\r\n            } catch (error) {\r\n              console.log('Error while selecting image', error)\r\n            }\r\n          } }\r\n        >\r\n          <Icon fixedWidth icon=\"folder\" />\r\n        </Button>\r\n      </InputGroupAddon>\r\n    </InputGroup>\r\n  </>\r\n}\r\n","import { useEffect, useRef } from 'react'\r\n\r\n// These hook variations are loosely adapted from react-use\r\n// (https://github.com/streamich/react-use), a public-domain library\r\n\r\nconst useUpdates = (effect, deps) => {\r\n  // Discard the initial call to an effect, but fire on subsequent ones\r\n  const initial = useRef(true)\r\n\r\n  useEffect(\r\n    initial.current\r\n      ? () => { initial.current = false }\r\n      : effect,\r\n    deps\r\n  )\r\n}\r\n\r\nexport const useDebounce = (fn, wait, args, filter=true) => {\r\n  // Debounce an effect for a given interval\r\n  useUpdates(() => {\r\n    // TODO: HERE BE DRAGONS!\r\n    // It's not 100% clear whether the filter criterion works the way\r\n    // it's intended here. It looks alright, but the code was written\r\n    // without super-in depth knowledge of hooks. This kinda matches the\r\n    // hooks rules (https://reactjs.org/docs/hooks-rules.html), but\r\n    // clearly it also deserves closer inspection.\r\n    let timeout = undefined\r\n    if (filter) {\r\n      timeout = setTimeout(() => fn(...args), wait)\r\n      // NOTE: the spread is a custom addition, and possibly a stupid one\r\n    }\r\n\r\n    // Reset timeout if the arguments change\r\n    return () => clearTimeout(timeout)\r\n  }, args)\r\n}\r\n","import React from 'react'\r\n\r\nimport { connect } from 'formik'\r\nimport { Input as BaseInput, CustomInput as BaseCustomInput } from 'reactstrap'\r\n\r\nimport { useDebounce } from './hooks'\r\n\r\nconst _AutoSave = ({ formik: { values, dirty }, interval=300, onSave }) => {\r\n  // Pass the form's dirtyness as a filter to the debounce function so\r\n  // that only user entries are autosaved, and update loops are avoided.\r\n  useDebounce(onSave, interval, [values], dirty)\r\n  return null\r\n}\r\n\r\nexport const AutoSave = connect(_AutoSave)\r\n\r\n// Trivial wrapper around reactstrap's <Input /> component,\r\n// to pass through all props\r\nexport const Input = ({ field, ...props }) =>\r\n  <BaseInput { ...field } { ...props } />\r\n\r\n// Likewise for CustomInput\r\nexport const CustomInput = ({ field, ...props }) =>\r\n  <BaseCustomInput { ...field } { ...props } />\r\n","module.exports = \"data:image/png;base64,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\"","export const makeDataURI = (data, mime='') =>\r\n  // Make data url from string\r\n  `data:${ mime },${ encodeURIComponent(data) }`\r\n\r\nconst re = /^\\s*data:([-+.\\w\\d]+\\/[-+.\\w\\d]+)?(;base64)?,(.*)$/\r\n\r\nexport const readDataURI = uri => {\r\n  // Split data URI into constituent parts\r\n  const [, mime, encoding, data] = re.exec(uri)\r\n\r\n  // Is the content encoded as base64?\r\n  const base64 = encoding === ';base64'\r\n\r\n  return {\r\n    data: base64 ? data : decodeURIComponent(data),\r\n    mime, base64\r\n  }\r\n}\r\n\r\nexport const mimeFromDataURI = uri => re.exec(uri)?.[1]\r\n\r\nexport const blobFromDataURI = uri => {\r\n  const { data, mime, base64 } = readDataURI(uri)\r\n\r\n  if (base64) {\r\n    // Convert base64 to binary\r\n    const binary = window.atob(data)\r\n    // Decode raw bytes\r\n    const bytes = new Uint8Array(binary.length)\r\n    for (var i = 0; i < binary.length; i++)        {\r\n      bytes[i] = binary.charCodeAt(i)\r\n    }\r\n    // Return as blob\r\n    return new Blob([bytes], { type: mime })\r\n  } else {\r\n    // Return blob from string data\r\n    return new Blob([data], { type: mime })\r\n  }\r\n}\r\n\r\nexport const sizeFromDataURI = uri =>\r\n  // Calculate a file size in KB\r\n  //\r\n  // base64 encoding inflates the file, storing 6 bits in every 8-bit\r\n  // character; the initial data URI indicator and the trailing equal\r\n  // sign don't count toward the file size.\r\n  //\r\n  // TODO: Even with all of these corrections, this is an approximation,\r\n  // and will differ from OS file managers. Corrections are welcome!\r\n  Math.ceil(\r\n    0.75 * (uri.length - uri.indexOf(',') - 1)\r\n    / 1000\r\n  )\r\n\r\nexport const updateDataURI = (uri, updater, ...args) => {\r\n  const { data, mime } = readDataURI(uri)\r\n  const newData = updater(data, ...args)\r\n  return makeDataURI(newData, mime)\r\n}\r\n","const defaultState = [20, 2, 1]\r\n\r\nexport default (state=defaultState, action) =>\r\n  state\r\n","import { stripIndent } from 'common-tags'\r\n\r\n// Define a default app state\r\nexport const defaultState = {\r\n  'root': {\r\n    id: 'root',\r\n    title: 'root',\r\n    type: 'lab.flow.Sequence',\r\n    children: [],\r\n    parameters: [],\r\n    plugins: [\r\n      {\r\n        type: 'lab.plugins.Metadata',\r\n      },\r\n    ],\r\n    metadata: {\r\n      title: '',\r\n      description: '',\r\n      repository: '',\r\n      contributors: '',\r\n    }\r\n  },\r\n}\r\n\r\nconst defaultTabs = [\r\n  'Content',\r\n  'Behavior',\r\n  'Scripts',\r\n  'Files',\r\n  'Plugins',\r\n  'Parameters',\r\n  'More',\r\n]\r\n\r\nconst globalDefaults = {\r\n  files: [],\r\n  responses: [\r\n    { label: '', event: '', target: '', filter: '' }\r\n  ],\r\n  parameters: [\r\n    { name: '', value: '', type: 'string' },\r\n  ],\r\n  messageHandlers: [\r\n    { title: '', message: '', code: '' },\r\n  ],\r\n}\r\n\r\nexport const metadata = {\r\n  'lab.flow.Loop': {\r\n    name: 'Loop',\r\n    description: 'Repeat a component',\r\n    category: 'Flow',\r\n    icon: 'repeat',\r\n    minChildren: 1,\r\n    maxChildren: 1,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.flow.Loop',\r\n      children: [],\r\n      templateParameters: {\r\n        columns: [{ name: '', type: 'string' }, { name: '', type: 'string' }],\r\n        rows: [ ['', ''] ],\r\n      },\r\n      sample: {\r\n        mode: 'draw-shuffle',\r\n      },\r\n      ...globalDefaults,\r\n    }\r\n  },\r\n  'lab.flow.Sequence': {\r\n    name: 'Sequence',\r\n    description: 'Show components sequentially',\r\n    category: 'Flow',\r\n    icon: 'sort-amount-down',\r\n    minChildren: 1,\r\n    maxChildren: Infinity,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.flow.Sequence',\r\n      children: [],\r\n      ...globalDefaults,\r\n    }\r\n  },\r\n  'lab.html.Form': {\r\n    name: 'Form',\r\n    description: 'Collect HTML form data',\r\n    category: 'HTML',\r\n    icon: 'list-alt',\r\n    iconWeight: 'r',\r\n    iconFallbackWeight: 'r',\r\n    minChildren: 0,\r\n    maxChildren: 0,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.html.Form',\r\n      content: stripIndent`\r\n        <form>\r\n          <input name=\"variable\">\r\n          <button type=\"submit\">Submit</button>\r\n        </form>\r\n      `,\r\n      scrollTop: true,\r\n      ...globalDefaults,\r\n    },\r\n  },\r\n  'lab.html.Frame': {\r\n    name: 'Frame',\r\n    description: 'Create a common frame around nested content',\r\n    category: 'HTML',\r\n    icon: 'expand-wide',\r\n    minChildren: 1,\r\n    maxChildren: 1,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.html.Frame',\r\n      context: '<main data-labjs-section=\"frame\">\\n  <!-- Content gets inserted here -->\\n</main>',\r\n      contextSelector: '[data-labjs-section=\"frame\"]',\r\n      ...globalDefaults,\r\n    },\r\n  },\r\n  'lab.html.Screen': {\r\n    name: 'Screen',\r\n    description: 'Show content using HTML',\r\n    category: 'HTML',\r\n    icon: 'window-maximize',\r\n    iconWeight: 'r',\r\n    iconFallbackWeight: 'r',\r\n    minChildren: 0,\r\n    maxChildren: 0,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.html.Screen',\r\n      ...globalDefaults,\r\n    },\r\n  },\r\n  'lab.html.Page': {\r\n    name: 'Page',\r\n    description: 'Graphical page builder',\r\n    category: 'HTML',\r\n    icon: 'clipboard-list',\r\n    iconWeight: 'r',\r\n    iconFallbackWeight: 's',\r\n    minChildren: 0,\r\n    maxChildren: 0,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.html.Page',\r\n      items: [\r\n        { type: 'text' },\r\n      ],\r\n      scrollTop: true,\r\n      submitButtonText: 'Continue →',\r\n      submitButtonPosition: 'right',\r\n      ...globalDefaults,\r\n    },\r\n  },\r\n  'lab.canvas.Frame': {\r\n    name: 'Frame',\r\n    description: 'Provide a common canvas for nested components',\r\n    category: 'Canvas',\r\n    icon: 'expand-wide',\r\n    minChildren: 1,\r\n    maxChildren: 1,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.canvas.Frame',\r\n      context: '<!-- Nested components use this canvas -->\\n<canvas />',\r\n      contextSelector: 'canvas',\r\n      ...globalDefaults,\r\n    },\r\n  },\r\n  'lab.canvas.Screen': {\r\n    name: 'Screen',\r\n    description: 'Show content using a canvas',\r\n    category: 'Canvas',\r\n    icon: 'image',\r\n    iconWeight: 'r',\r\n    iconFallbackWeight: 'r',\r\n    minChildren: 0,\r\n    maxChildren: 0,\r\n    tabs: defaultTabs,\r\n    defaultTab: 'Content',\r\n    defaults: {\r\n      type: 'lab.canvas.Screen',\r\n      content: [],\r\n      viewport: [800, 600],\r\n      ...globalDefaults,\r\n    },\r\n  },\r\n}\r\n\r\nexport const defaultTab = (tab, type) => {\r\n  if (tab && metadata[type].tabs.includes(tab)) {\r\n    return tab\r\n  } else if (type) {\r\n    return metadata[type].defaultTab\r\n  } else {\r\n    return undefined\r\n  }\r\n}\r\n\r\n// TODO: This is awkwardly named\r\nexport const defaults = [\r\n  'lab.canvas.Screen',\r\n  'lab.html.Page',\r\n  'lab.flow.Sequence',\r\n  'lab.flow.Loop',\r\n]\r\n\r\nexport const getMetadataByCategory = () =>\r\n  Object.entries(metadata)\r\n    .reduce((output, [type, d]) => {\r\n      output[d.category] = [...(output[d.category] || []), type]\r\n      return output\r\n    }, {})\r\n","import { defaultState } from '../logic/components'\r\nimport { fromPairs, pick } from 'lodash'\r\n\r\n// Provide unique ids for individual components\r\nlet idCounter = 0\r\nconst uniqueId = function(state={}) {\r\n  // Collect previously used ids\r\n  const usedIds = Object\r\n    .entries(state)\r\n    .map( ([k, v]) => k )\r\n\r\n  // Generate as yet unused candidate\r\n  let candidate\r\n  do {\r\n    candidate = (++idCounter).toString()\r\n  } while (usedIds.includes(candidate))\r\n\r\n  return candidate\r\n}\r\n\r\n// Define reducers that operate\r\n// on the main study representation\r\n\r\n// TODO: Refactor this so that the children\r\n// arrays are handled by their own reducers,\r\n// making this code more legible\r\nexport default (state=defaultState, action) => {\r\n  switch (action.type) {\r\n    case 'MOVE_COMPONENT':\r\n      if (action.oldParent === action.newParent) {\r\n        // Remove component from old position\r\n        const childrenStepOne = [\r\n          ...state[action.newParent].children.slice(0, action.oldIndex),\r\n          ...state[action.newParent].children.slice(action.oldIndex + 1)\r\n        ]\r\n\r\n        // Add component in new position\r\n        const childrenStepTwo = [\r\n          ...childrenStepOne.slice(0, action.newIndex),\r\n          action.id,\r\n          ...childrenStepOne.slice(action.newIndex),\r\n        ]\r\n\r\n        return {\r\n          ...state,\r\n          [action.newParent]: {\r\n            ...state[action.newParent],\r\n            children: childrenStepTwo\r\n          }\r\n        }\r\n      } else {\r\n        return {\r\n          ...state,\r\n          // Add component in new position\r\n          [action.newParent]: {\r\n            ...state[action.newParent],\r\n            children: !state[action.newParent].children ? [action.id] : [\r\n              ...state[action.newParent].children.slice(0, action.newIndex),\r\n              action.id,\r\n              ...state[action.newParent].children.slice(action.newIndex),\r\n            ]\r\n          },\r\n          // Remove component from old position\r\n          [action.oldParent]: {\r\n            ...state[action.oldParent],\r\n            children: [\r\n              ...state[action.oldParent].children.slice(0, action.oldIndex),\r\n              ...state[action.oldParent].children.slice(action.oldIndex + 1),\r\n            ]\r\n          },\r\n        }\r\n      }\r\n    case 'ADD_COMPONENT':\r\n      const componentData = {\r\n        id: action.id || uniqueId(state),\r\n        ...action.data,\r\n      }\r\n      return {\r\n        ...state,\r\n        [componentData.id]: componentData,\r\n        [action.parent]: {\r\n          ...state[action.parent],\r\n          children: !state[action.parent].children ? [componentData.id] : [\r\n            ...state[action.parent].children.slice(0, action.index),\r\n            componentData.id,\r\n            ...state[action.parent].children.slice(action.index),\r\n          ]\r\n        }\r\n      }\r\n    case 'DELETE_COMPONENT':\r\n      // Check whether the the component is\r\n      // in use in more than one place.\r\n      // TODO: The following lines count the\r\n      // instances of a given id in the entire\r\n      // study, and might profitably be extracted\r\n      // into the app logic (e.g. as a\r\n      // componentInstances function), someday.\r\n      // TODO: This does not remove nested\r\n      // components, however they are filtered\r\n      // when the study is saved.\r\n      const componentInUse = 1 < Object.entries(state)\r\n        .reduce(\r\n          (count, [id, c]) => count +\r\n            (c.children ? c.children.filter(x => x === action.id).length : 0),\r\n          0\r\n        )\r\n\r\n      const output = {\r\n        ...state,\r\n        [action.parent]: {\r\n          ...state[action.parent],\r\n          children: state[action.parent].children.filter(\r\n            (id, index) => !(id === action.id && index === action.index)\r\n          )\r\n        }\r\n      }\r\n\r\n      // If it is not used elsewhere, remove\r\n      // the component from the state object.\r\n      if (!componentInUse) {\r\n        delete output[action.id]\r\n      }\r\n\r\n      return output\r\n\r\n    case 'CLONE_COMPONENT':\r\n      return {\r\n        ...state,\r\n        [action.parent]: {\r\n          ...state[action.parent],\r\n          children: !state[action.parent].children ? [action.id] : [\r\n              ...state[action.parent].children.slice(0, action.index),\r\n              action.id,\r\n              ...state[action.parent].children.slice(action.index),\r\n            ]\r\n        }\r\n      }\r\n\r\n    case 'COPY_COMPONENT':\r\n      const o = { ...state }\r\n\r\n      const copy = id => {\r\n        const copiedComponent = { ...o[id] }\r\n        const newId = uniqueId(o)\r\n        if (copiedComponent.id) copiedComponent.id = newId\r\n        if (copiedComponent.children) {\r\n          copiedComponent.children =\r\n            copiedComponent.children.map(copy)\r\n        }\r\n        o[newId] = copiedComponent\r\n        return newId\r\n      }\r\n\r\n      o[action.parent] = {\r\n        ...o[action.parent],\r\n        children: !o[action.parent].children ? [copy(action.id)] : [\r\n          ...o[action.parent].children.slice(0, action.index),\r\n          copy(action.id),\r\n          ...o[action.parent].children.slice(action.index),\r\n        ]\r\n      }\r\n\r\n      return o\r\n\r\n    case 'IMPORT_COMPONENT':\r\n      const oImport = { ...state }\r\n\r\n      // TODO: Technical debt: This is\r\n      // copy-pasted from above with only\r\n      // minor modifications, and should\r\n      // be refactored properly\r\n      const importComponent = id => {\r\n        const copiedComponent = { ...action.source[id] }\r\n        const newId = uniqueId(oImport)\r\n        if (copiedComponent.id) copiedComponent.id = newId\r\n        if (copiedComponent.children) {\r\n          copiedComponent.children =\r\n            copiedComponent.children.map(importComponent)\r\n        }\r\n        oImport[newId] = copiedComponent\r\n        return newId\r\n      }\r\n\r\n      oImport[action.parent] = {\r\n        ...oImport[action.parent],\r\n        children: !oImport[action.parent].children ? [importComponent(action.id)] : [\r\n          ...oImport[action.parent].children.slice(0, action.index),\r\n          importComponent(action.id),\r\n          ...oImport[action.parent].children.slice(action.index),\r\n        ]\r\n      }\r\n\r\n      return oImport\r\n\r\n    case 'COLLAPSE_COMPONENT':\r\n      if (state[action.id].children && state[action.id].children.length > 0) {\r\n        return {\r\n          ...state,\r\n          [action.id]: {\r\n            ...state[action.id],\r\n            _collapsed: !state[action.id]._collapsed,\r\n          }\r\n        }\r\n      } else {\r\n        return state\r\n      }\r\n\r\n    case 'UPDATE_COMPONENT':\r\n      if (state[action.id]) {\r\n        return {\r\n          ...state,\r\n          [action.id]: {\r\n            ...state[action.id],\r\n            ...action.data,\r\n          },\r\n        }\r\n      } else {\r\n        console.log(`Skipping update to missing component ${ action.id }`)\r\n        // TODO: This fallback is designed to catch a very specific bug\r\n        // that occured when flushing pending updates to a deleted component.\r\n        // In principle, the same issue is present with all other reducers,\r\n        // although it is extremely unlikely to occur.\r\n        // In the long run, it may be worthwhile moving this check into\r\n        // component logic, or, alternatively, making it universal to\r\n        // all actions (e.g. by checking at the top of this reducer).\r\n        return state\r\n      }\r\n\r\n    case 'ADD_FILES':\r\n      return fromPairs(\r\n        Object.entries(state)\r\n          .map(([id, componentState]) => {\r\n            const newFiles = action.files.filter(f => f.component === id)\r\n\r\n            if (newFiles.length > 0) {\r\n              const currentFiles = state[id].files || []\r\n\r\n              return [id, {\r\n                ...state[id],\r\n                files: [\r\n                  ...currentFiles,\r\n                  ...newFiles.map(f => pick(f, ['localPath', 'poolPath']))\r\n                ]\r\n              }]\r\n            } else {\r\n              return [id, componentState]\r\n            }\r\n          })\r\n      )\r\n\r\n    case 'UPDATE_TIMELINE_ITEM':\r\n      return {\r\n        ...state,\r\n        [action.id]: {\r\n          ...state[action.id],\r\n          timeline: state[action.id].timeline.map((item, i) => {\r\n            if (i === action.item) {\r\n              return {\r\n                ...item,\r\n                ...action.data,\r\n              }\r\n            } else {\r\n              return item\r\n            }\r\n          })\r\n        },\r\n      }\r\n\r\n    case 'ADD_PLUGIN':\r\n      return {\r\n        ...state,\r\n        [action.id]: {\r\n          ...state[action.id],\r\n          plugins: [\r\n            ...(state[action.id].plugins || []),\r\n            { type: action.pluginType },\r\n          ]\r\n        }\r\n      }\r\n\r\n    case 'DELETE_PLUGIN':\r\n      return {\r\n        ...state,\r\n        [action.id]: {\r\n          ...state[action.id],\r\n          plugins: (state[action.id].plugins || [])\r\n            .filter((_, i) => i !== action.index),\r\n        }\r\n      }\r\n\r\n    case 'RESET_STATE':\r\n      return defaultState\r\n\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","const defaultState = {\r\n  viewType: 'COMPONENT_DETAIL',\r\n  viewProps: {\r\n    id: 'welcome',\r\n  },\r\n}\r\n\r\nexport default (state=defaultState, action) => {\r\n  switch(action.type) {\r\n    case 'SHOW_COMPONENT_DETAIL':\r\n      return {\r\n        viewType: 'COMPONENT_DETAIL',\r\n        viewProps: {\r\n          id: action.id\r\n        },\r\n      }\r\n    case 'RESET_STATE':\r\n      return defaultState\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","import { makeDataURI } from '../logic/util/dataURI'\r\nimport { fromPairs } from 'lodash'\r\n\r\nconst index_html = `<!doctype html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <title>Experiment</title>\r\n  <!-- viewport setup -->\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n  <!-- lab.js library and experiment code -->\r\n  \\${ header }\r\n</head>\r\n<body>\r\n  <!-- If you'd rather have a container with a fixed width\r\n       and variable height, try removing the fullscreen class below -->\r\n  <div class=\"container fullscreen\" data-labjs-section=\"main\">\r\n    <main class=\"content-vertical-center content-horizontal-center\">\r\n      <div>\r\n        <h2>Loading Experiment</h2>\r\n        <p>The experiment is loading and should start in a few seconds</p>\r\n      </div>\r\n    </main>\r\n  </div>\r\n</body>\r\n</html>\r\n`\r\n\r\nconst style_css = `/* Please define your custom styles here */`\r\n\r\nconst defaultState = {\r\n  files: {\r\n    'index.html': {\r\n      content: makeDataURI(index_html, 'text/html'),\r\n      source: 'library',\r\n    },\r\n    'style.css': {\r\n      content: makeDataURI(style_css, 'text/css'),\r\n      source: 'library',\r\n    }\r\n  },\r\n  bundledFiles: {\r\n    'lib/lab.js': {\r\n      type: 'application/javascript',\r\n    },\r\n    'lib/lab.js.map': {\r\n      type: 'text/plain',\r\n    },\r\n    'lib/lab.fallback.js': {\r\n      type: 'application/javascript',\r\n    },\r\n    'lib/lab.legacy.js': {\r\n      type: 'application/javascript',\r\n    },\r\n    'lib/lab.legacy.js.map': {\r\n      type: 'text/plain',\r\n    },\r\n    'lib/lab.css': {\r\n      type: 'text/css',\r\n    },\r\n    'lib/loading.svg': {\r\n      type: 'image/svg+xml',\r\n    },\r\n  }\r\n}\r\n\r\nexport default (state=defaultState, action) => {\r\n  switch (action.type) {\r\n    case 'ADD_FILES':\r\n      return {\r\n        ...state,\r\n        files: {\r\n          ...state.files,\r\n          ...fromPairs(action.files\r\n            .filter(f => f.data)\r\n            .map(f => [f.poolPath, f.data])\r\n          )\r\n        },\r\n      }\r\n    case 'UPDATE_FILE':\r\n      return {\r\n        ...state,\r\n        files: {\r\n          ...state.files,\r\n          [action.file]: {\r\n            ...state.files[action.file],\r\n            ...action.data,\r\n          },\r\n        },\r\n      }\r\n    case 'DELETE_FILE':\r\n      const output = {\r\n        ...state,\r\n        files: {\r\n          ...state.files\r\n        }\r\n      }\r\n\r\n      delete output.files[action.file]\r\n\r\n      return output\r\n    case 'MERGE_FILES':\r\n      return {\r\n        ...state,\r\n        files: {\r\n          ...action.files,\r\n          ...state.files,\r\n        }\r\n      }\r\n    case 'RESET_STATE':\r\n      return defaultState\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","const defaultState = {\r\n  modalType: null,\r\n  modalProps: {},\r\n}\r\n\r\nexport default (state=defaultState, action) => {\r\n  switch(action.type) {\r\n    case 'SHOW_MODAL':\r\n      return {\r\n        modalType: action.modalType,\r\n        modalProps: action.modalProps\r\n      }\r\n    case 'HIDE_MODAL':\r\n    case 'RESET_STATE':\r\n      return defaultState\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","import { combineReducers } from 'redux'\r\nimport version from './version'\r\nimport components from './components'\r\nimport componentDetail from '../components/ComponentOptions/reducers'\r\nimport files from './files'\r\nimport modal from '../components/Modal/reducers'\r\n\r\n// This is an awesome solution to overwriting\r\n// the entire app state, due to Dan Abramov\r\n// (https://github.com/reactjs/redux/pull/658#issuecomment-136485851)\r\nconst makeHydratable = (reducer, hydrateActionType) => {\r\n  return function (state, action) {\r\n    switch (action.type) {\r\n      case hydrateActionType:\r\n        return reducer(action.state, action)\r\n      default:\r\n        return reducer(state, action)\r\n    }\r\n  }\r\n}\r\n\r\nexport default makeHydratable(combineReducers({\r\n  version,\r\n  components,\r\n  componentDetail,\r\n  files,\r\n  modal,\r\n}), 'HYDRATE')\r\n","import { mapValues, omit } from 'lodash'\r\nimport { makeDataURI, updateDataURI } from '../util/dataURI'\r\nimport { stripIndent } from 'common-tags'\r\n\r\nconst updates = {\r\n  '2017.0.1': data => ({\r\n    ...data,\r\n    version: [2017, 0, 2],\r\n    // Add messageHandler property to all components\r\n    components: mapValues(data.components, c => ({\r\n      messageHandlers: {\r\n        rows: [\r\n          [ { title: '', message: '', code: '' }, ],\r\n        ],\r\n      },\r\n      ...c,\r\n    })),\r\n  }),\r\n  '2017.0.2': data => ({\r\n    ...data,\r\n    version: [2017, 0, 3],\r\n    // Add column type to loop template parameters\r\n    components: mapValues(data.components, c => {\r\n      if (c.type === 'lab.flow.Loop') {\r\n        return {\r\n          ...c,\r\n          templateParameters: {\r\n            ...c.templateParameters,\r\n            columns: c.templateParameters.columns.map(\r\n              col => ({ name: col, type: 'string' })\r\n            )\r\n          },\r\n        }\r\n      } else {\r\n        return {\r\n          ...c,\r\n        }\r\n      }\r\n    }),\r\n  }),\r\n  '2017.0.3': data => ({\r\n    ...data,\r\n    version: [2017, 0, 4],\r\n    // Switch keynames to KeyEvent standard\r\n    components: mapValues(data.components, c => {\r\n      const newKeyValues = {\r\n        'space': 'Space',\r\n        'enter': 'Enter',\r\n        'tab': 'Tab',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n      }\r\n\r\n      if (c.responses && c.responses.rows) {\r\n        c.responses.rows = c.responses.rows.map(r => {\r\n          if (r[1] === 'keypress') {\r\n            // Split and reassemble keys\r\n            const newKeys = r[3]\r\n              .split(',')\r\n              .map(k => k.trim())\r\n              .map(k => newKeyValues[k] || k)\r\n              .join(', ')\r\n\r\n            // Create new response entry\r\n            const newRow = r\r\n            newRow[3] = newKeys\r\n            return newRow\r\n          } else {\r\n            return r\r\n          }\r\n        })\r\n      }\r\n\r\n      return c\r\n    }),\r\n  }),\r\n  '2017.0.4': data => {\r\n    if (data.files.files['index.html']) {\r\n      data.files.files['index.html'].content =\r\n        data.files.files['index.html'].content.replace(\r\n          'id=\"labjs-content\"',\r\n          'data-labjs-section=\"main\"',\r\n        )\r\n    }\r\n\r\n    data.version = [2017, 0, 5]\r\n    return data\r\n  },\r\n  '2017.0.5': data => ({\r\n    ...data,\r\n    version: [2017, 1, 0],\r\n  }),\r\n  '2017.1.0': data => {\r\n    // Move library to lab.js (instead of lab.min.js),\r\n    // include source map\r\n    if (data.files.files['index.html']) {\r\n      data.files.files['index.html'].content =\r\n        data.files.files['index.html'].content.replace(\r\n          'src=\"lib/lab.min.js\"',\r\n          'src=\"lib/lab.js\"',\r\n        )\r\n    }\r\n\r\n    if (data.files.bundledFiles['lib/lab.min.js']) {\r\n      delete data.files.bundledFiles['lib/lab.min.js']\r\n    }\r\n\r\n    data.files.bundledFiles['lib/lab.js'] = { type: 'application/javascript' }\r\n    data.files.bundledFiles['lib/lab.js.map'] = { type: 'text/plain' }\r\n\r\n    data.version = [2017, 1, 1]\r\n    return data\r\n  },\r\n  '2017.1.1': data => {\r\n    // Convert files to data URIs and\r\n    // mark internal files as permanent\r\n    Object.entries(data.files.files).forEach(([filename, payload]) => {\r\n      data.files.files[filename] = {\r\n        content: makeDataURI(payload.content, payload.type)\r\n      }\r\n      if (['index.html', 'style.css'].includes(filename)) {\r\n        data.files.files[filename].permanent = true\r\n      }\r\n    })\r\n\r\n    data.version = [2017, 1, 2]\r\n    return data\r\n  },\r\n  '2017.1.2': data => {\r\n    // Add metadata plugin (and normalize\r\n    // plugin setting, which may have been\r\n    // altered in export postprocessing)\r\n    data.components['root'].plugins = [\r\n      {\r\n        type: 'lab.plugins.Metadata'\r\n      }\r\n    ]\r\n    data.version = [2017, 1, 3]\r\n\r\n    return data\r\n  },\r\n  '2017.1.3': data => ({\r\n    ...data,\r\n    version: [2017, 1, 4],\r\n    // Add viewport options to canvas.Screen\r\n    components: mapValues(data.components, c => {\r\n      if (c.type === 'lab.canvas.Screen') {\r\n        return {\r\n          ...c,\r\n          viewport: [800, 600],\r\n        }\r\n      }\r\n\r\n      return c\r\n    }),\r\n  }),\r\n  '2017.1.4': data => {\r\n    // Add study metadata\r\n    data.components['root'].metadata = data.components['root'].metadata || {\r\n      title: '',\r\n      description: '',\r\n      repository: '',\r\n      contributors: '',\r\n    }\r\n    data.version = [2017, 1, 5]\r\n\r\n    return data\r\n  },\r\n  '2017.1.5': data => {\r\n    // Move message handlers bound to the 'prepare' message\r\n    // to 'after:prepare' instead to make temporal order clearer\r\n    data.components = mapValues(data.components, c => {\r\n      if (c.messageHandlers && c.messageHandlers.rows) {\r\n        c.messageHandlers.rows = c.messageHandlers.rows.map(r => ([{\r\n          ...r[0],\r\n          // Replace 'prepare' with 'after:prepare'\r\n          message: r[0].message === 'prepare' ? 'after:prepare' : r[0].message,\r\n        }]))\r\n      }\r\n      return c\r\n    })\r\n\r\n    data.version = [2017, 1, 6]\r\n\r\n    return data\r\n  },\r\n  '2017.1.6': data => ({\r\n    ...data,\r\n    version: [2017, 1, 7],\r\n    // Add parameters option to every component\r\n    components: mapValues(data.components, c => ({\r\n      ...c,\r\n      parameters: { rows: [ [ { name: '', value: '', type: 'string' }, ], ], },\r\n    })),\r\n  }),\r\n  '2017.1.7': data => {\r\n    data.version = [2018, 0, 1]\r\n\r\n    if (data.files.files['index.html']) {\r\n      // Add fallback script\r\n      data.files.files['index.html'].content =\r\n        updateDataURI(\r\n          data.files.files['index.html'].content,\r\n          x => x.replace(\r\n            /^(\\s*)<script src=\"lib\\/lab\\.js\"><\\/script>/mg,\r\n            '$&\\n' +\r\n            '$1<script src=\"lib/lab.fallback.js\" data-labjs-script=\"fallback\"></script>',\r\n          )\r\n        )\r\n\r\n      // Add data-labjs-script property\r\n      data.files.files['index.html'].content =\r\n        updateDataURI(\r\n          data.files.files['index.html'].content,\r\n          x => x.replace(\r\n            '<script src=\"lib/lab.js\"></script>',\r\n            '<script src=\"lib/lab.js\" data-labjs-script=\"library\"></script>',\r\n          )\r\n        )\r\n    }\r\n\r\n    return data\r\n  },\r\n  '2018.0.1': data => {\r\n    data.version = [2018, 0, 2]\r\n\r\n    // Add fallback and legacy library versions\r\n    data.files.bundledFiles['lib/lab.fallback.js'] =\r\n      { type: 'application/javascript' }\r\n    data.files.bundledFiles['lib/lab.legacy.js'] =\r\n      { type: 'application/javascript' }\r\n    data.files.bundledFiles['lib/lab.legacy.js.map'] =\r\n      { type: 'text/plain' }\r\n\r\n    return data\r\n  },\r\n  '2018.0.2': data => {\r\n    data.version = [2018, 0, 3]\r\n\r\n    data.components = mapValues(data.components, c => {\r\n      if (c._tab && c._tab === 'Responses') {\r\n        c._tab = 'Behavior'\r\n      }\r\n      return c\r\n    })\r\n\r\n    return data\r\n  },\r\n  '2018.0.3': data => {\r\n    data.version = [2018, 0, 4]\r\n\r\n    const defaultHeader = new RegExp(stripIndent`\r\n      ^\\\\s+<!-- lab.js library and default styles -->$\r\n      ^\\\\s+<script [^>]* data-labjs-script=\"library\"></script>$\r\n      ^\\\\s+<script [^>]* data-labjs-script=\"fallback\"></script>$\r\n      ^\\\\s+<link rel=\"stylesheet\" href=\"lib/lab.css\">$\r\n      ^\\\\s+<!-- study code and styles -->$\r\n      ^\\\\s+<script defer src=\"script.js\"></script>$\r\n      ^\\\\s+<link rel=\"stylesheet\" href=\"style.css\">$\r\n    `, 'gm')\r\n\r\n    const newHeader = stripIndent`\r\n      <!-- lab.js library and experiment code -->\r\n      \\${ header }\r\n    `.split('\\n').map(l => `  ${ l }`).join('\\n')\r\n\r\n    // Insert header as a template placeholder\r\n    data.files.files['index.html'].content =\r\n      updateDataURI(\r\n        data.files.files['index.html'].content,\r\n        fileContent => fileContent.replace(\r\n          defaultHeader,\r\n          newHeader,\r\n        )\r\n      )\r\n\r\n    return data\r\n  },\r\n  '2018.0.4': data => ({\r\n    ...data,\r\n    version: [2018, 1, 0],\r\n    // Add files option to every component\r\n    components: mapValues(data.components, c => ({\r\n      ...c,\r\n      files: c.files || { rows: [] },\r\n    })),\r\n  }),\r\n  '2018.1.0': data => {\r\n    // Note source for files\r\n    Object.entries(data.files.files).forEach(([filename, payload]) => {\r\n      if (payload.permanent) {\r\n        data.files.files[filename].source = 'library'\r\n\r\n        // Remove permanent attribute\r\n        delete data.files.files[filename].permanent\r\n      } else {\r\n        // All other files (at the moment) must\r\n        // have been embedded globally\r\n        data.files.files[filename].source = 'embedded-global'\r\n      }\r\n    })\r\n\r\n    data.version = [2018, 1, 1]\r\n    return data\r\n  },\r\n  '2018.1.1': data => ({\r\n    ...data,\r\n    version: [2018, 1, 2],\r\n    // Improve Naming of component-level embedded files\r\n    components: mapValues(data.components, c => ({\r\n      ...c,\r\n      files: c.files\r\n        ? { rows: c.files.rows.map(\r\n          f => [{ localPath: f[0].path, poolPath: f[0].file }]\r\n        ) }\r\n        : undefined,\r\n    })),\r\n  }),\r\n  '2018.1.2': data => ({\r\n    ...data,\r\n    version: [19, 0, 0],\r\n    // Rework shuffle and sample options\r\n    components: mapValues(data.components, c => {\r\n      if (c.type === 'lab.flow.Loop') {\r\n        c.sample = c.sample || {}\r\n        if (['', undefined].includes(c.sample.n)) {\r\n          if (c.shuffle) {\r\n            c.sample.mode = 'draw-shuffle'\r\n          } else {\r\n            c.sample.mode = 'sequential'\r\n          }\r\n        } else {\r\n          if (c.sample.replace) {\r\n            c.sample.mode = 'draw-replace'\r\n          } else {\r\n            c.sample.mode = 'draw-shuffle'\r\n          }\r\n        }\r\n        // Deprecated options\r\n        delete c.sample.replace\r\n        delete c.shuffle\r\n\r\n        return c\r\n      } else {\r\n        return c\r\n      }\r\n    }),\r\n  }),\r\n  '19.0.0': data => ({\r\n    ...data,\r\n    version: [19, 0, 1],\r\n    components: mapValues(data.components, c => {\r\n      if (c.timeline && Array.isArray(c.timeline)) {\r\n        c.timeline = c.timeline.map(i => ({\r\n          // Only save position data at the top level ...\r\n          type: i.type,\r\n          start: i.start,\r\n          stop: i.stop,\r\n          priority: i.priority,\r\n          // ... everything else goes in the payload\r\n          payload: omit(\r\n            { ...i, ...i.options },\r\n            ['type', 'start', 'stop', 'priority', 'options'],\r\n          ),\r\n        }) )\r\n      }\r\n      return c\r\n    })\r\n  }),\r\n  '19.0.1': data => ({\r\n    ...data,\r\n    version: [19, 1, 0],\r\n  }),\r\n  '19.1.0': data => ({\r\n    ...data,\r\n    version: [19, 1, 1],\r\n    components: mapValues(data.components, (c, id) => {\r\n      if (id === 'root' && c.messageHandlers && c.messageHandlers.rows) {\r\n        // Filter JATOS integrations that leaked from export into study\r\n        c.messageHandlers.rows = c.messageHandlers.rows.filter(\r\n          r => r[0].title !== \"JATOS integration\" &&\r\n            r[0].message !== \"epilogue\"\r\n        )\r\n      }\r\n      return c\r\n    })\r\n  }),\r\n  '19.1.1': data => ({\r\n    // Replace explicit use of Times New Roman with generic serif font\r\n    ...data,\r\n    version: [19, 1, 2],\r\n    components: mapValues(data.components, c => {\r\n      if (c.type === 'lab.canvas.Screen') {\r\n        return {\r\n          ...c,\r\n          content: c.content.map(content => {\r\n            if (\r\n              content.type === 'i-text' &&\r\n              content.fontFamily === 'Times New Roman'\r\n            ) {\r\n              return {\r\n                ...content,\r\n                fontFamily: 'serif',\r\n              }\r\n            } else {\r\n              return content\r\n            }\r\n          })\r\n        }\r\n      } else {\r\n        return { ...c }\r\n      }\r\n    })\r\n  }),\r\n  '19.1.2': data => ({\r\n    ...data,\r\n    version: [20, 0, 0],\r\n  }),\r\n  '20.0.0': data => ({\r\n    ...data,\r\n    version: [20, 0, 1],\r\n  }),\r\n  '20.0.1': data => ({\r\n    ...data,\r\n    version: [20, 1, 0],\r\n  }),\r\n  // Dummy version, never published as stable release\r\n  '20.0.2': data => ({\r\n    ...data,\r\n    version: [20, 1, 0],\r\n  }),\r\n  '20.1.0': data => ({\r\n    ...data,\r\n    version: [20, 1, 1],\r\n  }),\r\n  '20.1.1': data => ({\r\n    ...data,\r\n    version: [20, 2, 0],\r\n    components: mapValues(data.components, (c, id) => {\r\n      return {\r\n        ...c,\r\n        parameters: c.parameters?.rows?.map(r => r[0]) ?? [],\r\n        messageHandlers: c.messageHandlers?.rows?.map(r => r[0]) ?? [],\r\n        files: c.files?.rows?.map(r => r[0]) ?? [],\r\n        responses: c.responses?.rows?.map(r => ({\r\n          label: r[0], event: r[1],\r\n          target: r[2], filter: r[3],\r\n        }))\r\n      }\r\n    })\r\n  }),\r\n  '20.2.0': data => ({\r\n    // Upgrade page components\r\n    ...data,\r\n    version: [20, 2, 1],\r\n    components: mapValues(data.components, (c, id) => {\r\n      if (c.type === 'lab.html.Page') {\r\n        return {\r\n          ...c,\r\n          items: c.items?.rows?.map(r => r[0]) ?? [],\r\n        }\r\n      } else {\r\n        return c\r\n      }\r\n    })\r\n  }),\r\n}\r\n\r\nexport default (data) => {\r\n  let output = data\r\n\r\n  while (output.version.join('.') in updates) {\r\n    console.log(`Updating file from ${ output.version.join('.') }`)\r\n    try {\r\n      output = updates[output.version.join('.')](output)\r\n    } catch (e) {\r\n      console.log('found error', e)\r\n    }\r\n    console.log('update complete')\r\n  }\r\n\r\n  return output\r\n}\r\n","import upgrade from './upgrade'\r\n\r\nexport const fromObject = o =>\r\n  upgrade({\r\n    // Inject an early fallback version,\r\n    // in case the data doesn't include one\r\n    // already.\r\n    // TODO: Remove this after versioning\r\n    // has been firmly established.\r\n    version: [2017, 1, 7],\r\n    ...o,\r\n  })\r\n\r\nexport const fromJSON = input =>\r\n  fromObject(\r\n    JSON.parse(input)\r\n  )\r\n","export const quotaExceededErrors = [\r\n  'keys and/or value are too large', // WebKit\r\n  'value is too large', // Firefox\r\n  'QuotaExceededError', // Various, possibly a cache error\r\n]\r\n","import localForage from 'localforage'\r\nimport { debounce } from 'lodash'\r\n\r\nimport { fromObject } from '../io/load'\r\nimport { quotaExceededErrors } from './monitoring'\r\n\r\nconst lf = localForage.createInstance({\r\n  name: \"lab.js\"\r\n})\r\n\r\nexport const persistState = async store => {\r\n  // Persist application state to localForage on changes\r\n  store.subscribe(debounce(() => {\r\n    lf.setItem(\r\n      'state:latest',\r\n      store.getState()\r\n    ).catch(e => {\r\n      if (quotaExceededErrors.some(message => e.message.includes(message))) {\r\n        // TODO alert user\r\n      } else {\r\n        throw e\r\n      }\r\n    })\r\n  }), 500)\r\n\r\n  // Check for persistence of in-browser storage\r\n  if (navigator.storage && navigator.storage.persist) {\r\n    if (await navigator.storage.persisted()) {\r\n      console.log('Persistent storage enabled')\r\n    } else {\r\n      console.log('Persistent storage not permitted')\r\n    }\r\n  } else {\r\n    console.log('No support for persistent storage')\r\n  }\r\n}\r\n\r\nexport const retrieveState = async () => {\r\n  // Load data from localForage\r\n  const data = await lf.getItem('state:latest')\r\n\r\n  return data\r\n    ? fromObject(data)\r\n    : undefined\r\n}\r\n","import { fromObject } from '../io/load'\r\n\r\n// Load a study from a remote URL\r\nexport const fromURL = async () => {\r\n  // Extract study URL from current location\r\n  const location = new URL(window.location.href)\r\n\r\n  // Stop during automated testing\r\n  if (!location || !location.searchParams) {\r\n    return\r\n  }\r\n\r\n  // Extract url parameter from path\r\n  const url = location.searchParams.get('url')\r\n\r\n  // Make sure URL is present and the user knows what is happening\r\n  if (\r\n    url &&\r\n    window.confirm(`Would you like to load the study from ${ url }?`)\r\n  ) {\r\n    let response\r\n    try {\r\n      response = await fetch(url)\r\n    } catch(e) {\r\n      alert(`Connection error while trying to load remote study: ${ e }`)\r\n      return\r\n    }\r\n\r\n    // Catch 404 responses, etc.\r\n    if (!response.ok) {\r\n      alert(`Invalid response while loading remote study, code ${ response.status }: ${ response.statusText }`)\r\n      return\r\n    }\r\n\r\n    // Parse JSON\r\n    let data\r\n    try {\r\n      data = await response.json()\r\n    } catch(e) {\r\n      alert(`Couldn't decode study data: ${ e }`)\r\n      return\r\n    }\r\n\r\n    // Parse state\r\n    const state = fromObject(data)\r\n\r\n    // Remove URL parameter\r\n    window.history.pushState({}, document.title, \"/\")\r\n\r\n    // Return new application state\r\n    return state\r\n  }\r\n}\r\n","import { createStore } from 'redux'\r\nimport { composeWithDevTools } from 'redux-devtools-extension'\r\n\r\nimport reducer from './reducers'\r\nimport { retrieveState } from './logic/util/persistence'\r\nimport { fromURL } from './logic/util/remoteStudy'\r\n\r\nconst configureStore = async initialState =>\r\n  createStore(\r\n    reducer,\r\n    initialState || await fromURL() || await retrieveState(),\r\n    composeWithDevTools(),\r\n  )\r\n\r\nexport default configureStore\r\n","import defaultSlugify from 'slugify'\r\n\r\nexport const slugify = title =>\r\n  defaultSlugify(title).toLowerCase()\r\n","import { slugify } from '../util/slug'\r\n\r\nexport const makeFilename = state =>\r\n  // TODO: Simplify this once optional chaining becomes available\r\n  slugify((\r\n    state.components['root'] &&\r\n    state.components['root'].metadata &&\r\n    state.components['root'].metadata.title &&\r\n    state.components['root'].metadata.title.trim()\r\n  ) || 'study')\r\n","import { cloneDeep, pick, mapValues, omitBy, pickBy } from 'lodash'\r\nimport moment from 'moment'\r\nimport { saveAs } from 'file-saver'\r\n\r\nimport { children } from '../tree'\r\nimport { makeFilename } from './filename'\r\nimport { embeddedFiles } from '../util/files'\r\n\r\nexport const stateToJSON = (state, exportedComponent='root',\r\n  { removeInternals=false }={}) => {\r\n  const { version, components: allComponents,\r\n    files: { files: allFiles, bundledFiles }} = state\r\n\r\n  // From all available components,\r\n  // include only the root, and those\r\n  // nested below any exported component\r\n  const components = cloneDeep(pick(\r\n    allComponents,\r\n    [\r\n      'root', // Include root in any case\r\n      exportedComponent, // Additionally, include exported component (or root)\r\n      ...children(exportedComponent, allComponents) // Add children\r\n    ]\r\n  ))\r\n\r\n  // Per default, include all children\r\n  // of the root component as before.\r\n  // If a component is exported, make it\r\n  // the single child of the root component.\r\n  components['root'].children = exportedComponent === 'root'\r\n    ? allComponents['root'].children\r\n    : [ exportedComponent ]\r\n\r\n  // Remove internal options relating to UI state\r\n  // (that start with an underscore)\r\n  const filteredComponents = !removeInternals\r\n    ? components\r\n    : mapValues(components, c => omitBy(c, (v, k) => k.startsWith('_')))\r\n\r\n  // Save only files that are embedded\r\n  const filesInUse = embeddedFiles(filteredComponents)\r\n\r\n  const files = pickBy(\r\n    allFiles,\r\n    (file, filename) =>\r\n      file.source !== 'embedded' ||\r\n      filesInUse.includes(filename)\r\n  )\r\n\r\n  return JSON.stringify({\r\n    components: filteredComponents,\r\n    version,\r\n    files: {\r\n      files,\r\n      bundledFiles,\r\n    },\r\n  }, null, 2)\r\n}\r\n\r\nexport const stateToDownload = (state, { exportedComponent='root',\r\n  filenameOverride=null, removeInternals=false }={}) => {\r\n  const stateJSON = stateToJSON(state, exportedComponent, { removeInternals })\r\n\r\n  // Determine filename if not set explicitly\r\n  let filename\r\n  if (!filenameOverride) {\r\n    const fileprefix = exportedComponent === 'root'\r\n      ? makeFilename(state)\r\n      : makeFilename(state) + '-' +\r\n        state.components[exportedComponent].title.toLowerCase()\r\n    const timestamp = moment().format('YYYY-MM-DD--HH:mm')\r\n    filename = `${ fileprefix }-${ timestamp }.study.json`\r\n  } else {\r\n    filename = filenameOverride\r\n  }\r\n\r\n  // Output JSON file\r\n  const output = new Blob(\r\n    [ stateJSON ],\r\n    { type: 'application/json;charset=utf-8' }\r\n  )\r\n  return saveAs(output, filename)\r\n}\r\n","import React, { Component } from 'react'\r\n\r\nimport { Card as BaseCard, CardHeader, Badge, CardBody } from 'reactstrap'\r\nimport classnames from 'classnames'\r\n\r\nclass Card extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      isOpen: props.open !== false\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { title, badge, children,\r\n      className,\r\n      collapsable, wrapContent } = this.props\r\n    const content = wrapContent !== false\r\n      ? <CardBody>{ children }</CardBody>\r\n      : children\r\n\r\n    return <BaseCard\r\n        style={ this.props.style }\r\n        className={ classnames('my-1', className) }\r\n      >\r\n      {\r\n        title\r\n          ? <CardHeader\r\n              style={{\r\n                borderBottomStyle: (this.state.isOpen ? 'solid' : 'none'),\r\n              }}\r\n              onClick={ () => {\r\n                if (collapsable) this.setState({ isOpen: !this.state.isOpen })\r\n              } }\r\n            >\r\n              { title }\r\n              { badge && <>&nbsp;<Badge color=\"secondary\">{ badge }</Badge></> }\r\n            </CardHeader>\r\n          : null\r\n      }\r\n      { this.state.isOpen ? content : null }\r\n    </BaseCard>\r\n  }\r\n}\r\n\r\nexport default Card\r\n","import React, { useState } from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { Container, Row, Col, Alert, Button, ButtonGroup } from 'reactstrap'\r\nimport { sample } from 'lodash'\r\n\r\nimport { stateToDownload } from '../../logic/io/save'\r\nimport Card from '../Card'\r\n\r\n// Source: https://en.wiktionary.org/wiki/Category:English_minced_oaths\r\n// and https://en.wiktionary.org/wiki/Appendix:Fictional_English_curse_words\r\nconst mincedOaths = [\r\n  'Well, crikey',\r\n  'Dangnabbit!',\r\n  'What the cabbage?',\r\n  'What a total cluster-cuss.', // 🦊\r\n  'Belgium!', // 🇧🇪\r\n]\r\n\r\nconst gifs = [\r\n  'https://media.giphy.com/media/XsUtdIeJ0MWMo/giphy.mp4', // Picard facepalm\r\n  'https://media.giphy.com/media/155lQxHOx9Bni/giphy.mp4', // Hermione slow clap\r\n  'https://media.giphy.com/media/FYenMRUx3LGy4/giphy.mp4', // McG disapproval\r\n  'https://media.giphy.com/media/p3RblYx4T7vmU/giphy.mp4', // Dumbledore shrugs\r\n  'https://media.giphy.com/media/8QIgBwVvZVrG0/giphy.mp4', // Ford?\r\n  'https://media.giphy.com/media/pPhyAv5t9V8djyRFJH/giphy.mp4', // Obama\r\n  'https://media.giphy.com/media/APqEbxBsVlkWSuFpth/giphy.mp4', // Seems fishy\r\n  'https://media.giphy.com/media/Rhkq4ehWqVX56/giphy.mp4', // Sheldon Cooper I\r\n  'https://media.giphy.com/media/fOVGTYyYtV6Ra/giphy.mp4', // Sheldon Cooper II\r\n]\r\n\r\nconst Error = ({ reset, error, errorInfo, eventId }) => {\r\n  const [backup, setBackup] = useState(false)\r\n\r\n  // TODO: This is not (yet) canonical redux: The component is still\r\n  // accessing the store directly, for instance to dispatch actions.\r\n  // This should be refactored to use action creators in the mid-term.\r\n  const store = useStore()\r\n\r\n  return (\r\n    <Container>\r\n      <Row>\r\n        <Col\r\n          sm={{ size: 4, offset: 4 }}\r\n          className=\"text-center my-4\"\r\n        >\r\n          <video\r\n            autoPlay loop\r\n            className=\"rounded-circle shadow\"\r\n            style={{\r\n              width: '300px',\r\n              height: '300px',\r\n              marginTop: '10vh',\r\n              objectFit: 'cover',\r\n            }}\r\n          >\r\n            <source\r\n              src={ sample(gifs) }\r\n              type=\"video/mp4\"\r\n            />\r\n          </video>\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col sm={{ size: 6, offset: 3 }}>\r\n          <Alert color=\"danger\" className=\"my-4\">\r\n            <h4 className=\"alert-heading mt-2\">\r\n              { sample(mincedOaths) }\r\n            </h4>\r\n            <hr />\r\n            <p className=\"mb-1\">\r\n              <strong>We're really, really sorry, something just went badly wrong.</strong> In a nutshell, <code>lab.js</code> encountered an error it couldn't recover from, and the application can't run or restart. The team has been alerted.\r\n            </p>\r\n          </Alert>\r\n          <Alert color=\"light\" style={{ background: 'white', border: 'none' }}>\r\n            <p><strong>We want to help you get back to work as quickly as possible.</strong> Here are a few things to speed up that process:</p>\r\n            <p>First of all, please make sure you <strong>download a backup</strong> of the study you've been working on. We can almost certainly help you recover your last change, even if the file doesn't load.</p>\r\n            <Button\r\n              outline color=\"primary\"\r\n              block size=\"lg\"\r\n              onClick={ e => {\r\n                stateToDownload(store.getState())\r\n                setBackup(true)\r\n              } }\r\n            >\r\n              Download study backup\r\n            </Button>\r\n            <p className=\"mt-3\"><strong>With the backup in hand, you're safe for the moment.</strong> Please <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://lab.js.org/resources/support/\"> join the support channel</a> where we would be happy to help you track down and fix the bug. We make mistakes sometimes, but also love to learn how we can improve things, and would be glad to make things better for everyone!</p>\r\n            <p>There are two more things you can try. <strong>We recommend to only attempt these in consultation with support.</strong> You'll need to download a backup of your current study first.</p>\r\n            <ButtonGroup className=\"w-100\">\r\n              <Button\r\n                outline className=\"w-50 py-3\"\r\n                disabled={ !backup }\r\n                onClick={ () => {\r\n                  store.dispatch({\r\n                    type: 'SHOW_COMPONENT_DETAIL',\r\n                    id: undefined,\r\n                  })\r\n                  reset()\r\n                } }\r\n              >\r\n                Close currently<br />\r\n                open component\r\n              </Button>\r\n              <Button\r\n                outline className=\"w-50 py-3\"\r\n                disabled={ !backup }\r\n                onClick={ () => {\r\n                  const warning = 'This will discard the currently active study. Are you sure?'\r\n\r\n                  if (window.confirm(warning)) {\r\n                    store.dispatch({ type: 'RESET_STATE' })\r\n                  }\r\n                  reset()\r\n                } }\r\n              >\r\n                Start from scratch<br />\r\n                with an empty study\r\n              </Button>\r\n            </ButtonGroup>\r\n            <Card\r\n              title=\"Guru meditation / technical details\"\r\n              className=\"mt-3\"\r\n              collapsable={ true }\r\n              open={ false }\r\n            >\r\n              <dl>\r\n                <dt>Error message</dt>\r\n                <dd>{ (error && error.toString()) || <em>(unavailable)</em> }</dd>\r\n                <dt>Component stack</dt>\r\n                <dd style={{ whiteSpace: \"pre-wrap\" }}>\r\n                  { errorInfo.componentStack || <em>(unavailable)</em> }\r\n                </dd>\r\n                <dt>EventId</dt>\r\n                <dd>{ eventId || <em>(unavailable)</em> }</dd>\r\n              </dl>\r\n            </Card>\r\n          </Alert>\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  )\r\n}\r\n\r\nError.defaultProps = {\r\n  error: undefined,\r\n  errorInfo: {},\r\n}\r\n\r\nexport default Error\r\n","import React from 'react'\r\n\r\n// Bootstrap integration\r\nimport './bootstrap-custom.scss'\r\nimport { Container } from 'reactstrap'\r\n\r\n// Fira\r\nimport 'fira/fira.css'\r\n\r\n// Grid layout\r\nimport './index.css'\r\n\r\nexport default ({ sidebar, footer, children }) =>\r\n  <div className=\"grid-wrapper\">\r\n    <div className=\"grid-sidebar\">\r\n      { sidebar }\r\n    </div>\r\n    <div className=\"grid-footer\">\r\n      { footer }\r\n    </div>\r\n    <div className=\"grid-contents\">\r\n      {/* TODO: Remove xs size jump to 510px,\r\n          possibly by setting minWidth */}\r\n      <Container fluid\r\n        className=\"h-100 d-flex flex-column\"\r\n        style={{\r\n          minWidth: '510px',\r\n          maxWidth: '1200px',\r\n          minHeight: '600px',\r\n          padding: '0',\r\n        }}\r\n      >\r\n        { children }\r\n      </Container>\r\n    </div>\r\n  </div>\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { Card, CardGroup, CardHeader, CardBody,\r\n  ListGroup, ListGroupItem } from 'reactstrap'\r\nimport CollapsingCard from '../../../../../Card'\r\nimport { metadata, defaults, getMetadataByCategory\r\n  } from '../../../../../../logic/components'\r\nimport Icon from '../../../../../Icon'\r\n\r\nimport './style.css'\r\n\r\nconst addComponent = (store, type, parent, index) => {\r\n  store.dispatch({\r\n    type: 'ADD_COMPONENT',\r\n    parent, index,\r\n    data: {\r\n      ...metadata[type].defaults,\r\n      title: metadata[type].name,\r\n    },\r\n  })\r\n  // Because the component is assigned an id automatically\r\n  // via the action, we need to look it up here\r\n  store.dispatch({\r\n    type: 'SHOW_COMPONENT_DETAIL',\r\n    id: store.getState().components[parent].children[index],\r\n  })\r\n  // Closing the modal after changing the content below\r\n  // improves rendering\r\n  store.dispatch({\r\n    type: 'HIDE_MODAL',\r\n  })\r\n}\r\n\r\nconst ComponentShortcut = ({ type, parent, index }) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <Card\r\n      className=\"add-component-card\"\r\n      onClick={ () => addComponent(store, type, parent, index) }\r\n    >\r\n      <CardHeader\r\n        className=\"text-center\"\r\n      >\r\n        <Icon\r\n          icon={ metadata[type].icon }\r\n          weight={ metadata[type].iconWeight }\r\n          fallbackWeight={ metadata[type].iconFallbackWeight }\r\n        />\r\n      </CardHeader>\r\n      <CardBody\r\n        className=\"text-center\"\r\n      >\r\n        <h5 className=\"card-title\">\r\n          { metadata[type].name }\r\n        </h5>\r\n        <h6\r\n          className=\"card-subtitle mb-2 text-muted\"\r\n          style={{ fontWeight: '400' }}\r\n        >\r\n          { metadata[type].category }\r\n        </h6>\r\n      </CardBody>\r\n    </Card>\r\n  )\r\n}\r\n\r\nconst ComponentList = ({ parent, index }) => {\r\n  const store = useStore()\r\n\r\n  return Object.entries(getMetadataByCategory()).map(([category, types]) =>\r\n    <CollapsingCard\r\n      key={ category }\r\n      title={ category } open={ false }\r\n      collapsable={ true }\r\n      wrapContent={ false }\r\n    >\r\n      <ListGroup className=\"list-group-flush\">\r\n        {\r\n          types.map(type =>\r\n            <ListGroupItem\r\n              key={ type }\r\n              tag=\"a\" href=\"#\" action\r\n              className=\"d-flex justify-content-between\"\r\n              onClick={\r\n                () => addComponent(store, type, parent, index)\r\n              }\r\n            >\r\n              <span>\r\n                <strong>\r\n                  { metadata[type].name }\r\n                </strong>&nbsp;\r\n                <small className=\"text-muted\">\r\n                  · { metadata[type].description }\r\n                </small>\r\n              </span>\r\n              <Icon\r\n                icon={ metadata[type].icon }\r\n                className=\"mt-1\"\r\n                weight={ metadata[type].iconWeight }\r\n                fallbackWeight={ metadata[type].iconFallbackWeight }\r\n              />\r\n            </ListGroupItem>\r\n          )\r\n        }\r\n      </ListGroup>\r\n    </CollapsingCard>\r\n  )\r\n}\r\n\r\nexport default ({ parent, index }) =>\r\n  <>\r\n    <CardGroup className=\"mb-3\">\r\n      {\r\n        defaults.map(type =>\r\n          <ComponentShortcut\r\n            key={ type }\r\n            type={ type }\r\n            parent={ parent }\r\n            index={ index }\r\n          />\r\n        )\r\n      }\r\n    </CardGroup>\r\n    <ComponentList\r\n      parent={ parent }\r\n      index={ index }\r\n    />\r\n  </>\r\n","import React, { Component } from 'react'\r\nimport { ReactReduxContext } from 'react-redux'\r\n\r\nimport { CardBody, CardText, CardTitle, CardSubtitle,\r\n  ListGroup, ListGroupItem } from 'reactstrap'\r\n\r\nimport { fromObject } from '../../../../../logic/io/load'\r\n\r\nconst basePath =\r\n  process.env.REACT_APP_EXAMPLE_PATH ??\r\n  'https://raw.githubusercontent.com/FelixHenninger/lab.js/master/tasks/'\r\n\r\n// Transform an array of names into an author list, e.g.\r\n// ['Felix', 'Yury', 'Ulf', 'Pascal', 'Ben'] => 'Felix, Yury, ... & Ben'\r\nconst etAl = (acc='', c, i, arr) =>\r\n  acc === ''\r\n    ? c\r\n    : acc + (i < arr.length - 1 ? ', ' : ' & ') + c\r\n\r\nconst Task = ({ name, contributors, description, url, clickHandler }) =>\r\n  <ListGroupItem action\r\n    style={{ cursor: 'pointer' }}\r\n    onClick={ clickHandler }\r\n  >\r\n    <div className=\"d-flex w-100 justify-content-between\">\r\n      <strong>\r\n        { name }\r\n      </strong>\r\n      <span className=\"text-muted\">\r\n        { (contributors || [''])\r\n            .filter(c => !c.includes('Felix Henninger'))\r\n            .reduce(etAl, '') }\r\n      </span>\r\n    </div>\r\n    {/* Give further content class mt-1 --> */}\r\n  </ListGroupItem>\r\n\r\nexport class TaskList extends Component {\r\n  static contextType = ReactReduxContext\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      state: 'empty',\r\n      tasks: [],\r\n    }\r\n  }\r\n\r\n  async componentDidMount() {\r\n    try {\r\n      const response = await fetch(this.props.path + 'metadata.json')\r\n      const data = await response.json()\r\n      this.setState({ state: 'loaded', tasks: data })\r\n    } catch {\r\n      this.setState({ state: 'error' })\r\n    }\r\n  }\r\n\r\n  async loadTask(path) {\r\n    const response = await fetch(this.props.path + path)\r\n    const task = fromObject(await response.json())\r\n    this.props.loadHandler(task, this.context.store.dispatch)\r\n  }\r\n\r\n  render() {\r\n    if (this.state.state === 'error') {\r\n      return (\r\n        <ListGroup className=\"list-group-flush\">\r\n          <ListGroupItem className=\"text-center text-muted\">\r\n            <i className=\"fas fa-exclamation-circle fa-2x mt-3 mb-2\" />{' '}\r\n            <p>\r\n              <strong>\r\n                Sorry, I couldn't load the { this.props.taskLabel }\r\n              </strong><br />\r\n              <small>\r\n                This shouldn't happen.\r\n                If it persists even though you're online,\r\n                could you please{' '}\r\n                <a href=\"http://labjs.readthedocs.io/en/latest/meta/contribute/help.html\" target=\"_blank\" rel=\"noopener noreferrer\">let us know</a>?\r\n              </small>\r\n            </p>\r\n          </ListGroupItem>\r\n        </ListGroup>\r\n      )\r\n\r\n    } else if (this.state.tasks.length === 0) {\r\n      // Loading spinner\r\n      return (\r\n        <ListGroup className=\"list-group-flush\">\r\n          <ListGroupItem className=\"text-center\">\r\n            <i className=\"fas fa-spinner-third fa-spin\" />\r\n          </ListGroupItem>\r\n        </ListGroup>\r\n      )\r\n    } else {\r\n      // Example overview\r\n      return (\r\n        <ListGroup className=\"list-group-flush\">\r\n          {\r\n            this.state.tasks.map(\r\n              (task, i) => <Task\r\n                key={`task-${i}`}\r\n                clickHandler={ () => this.loadTask(task.path) }\r\n                { ...task }\r\n              />\r\n            )\r\n          }\r\n        </ListGroup>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nTaskList.defaultProps = {\r\n  taskLabel: 'tasks',\r\n}\r\n\r\nexport default () =>\r\n  <>\r\n    <CardBody>\r\n      <CardTitle className=\"h5 mt-2\">Examples</CardTitle>\r\n      <CardSubtitle className=\"text-muted mb-3\">\r\n        Pre-made, ready-to-run studies\r\n      </CardSubtitle>\r\n      <CardText>\r\n        These examples are made by researchers like you! If you're building a study, we'd love to add it here &mdash; please <a href=\"https://labjs.readthedocs.io/en/latest/meta/contribute/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">let us know</a>!\r\n      </CardText>\r\n      <CardText>\r\n        Please click on any of the paradigms to open it; they're yours to try, demonstrate, replicate and extend.\r\n      </CardText>\r\n    </CardBody>\r\n    <TaskList\r\n      path={ basePath }\r\n      taskLabel=\"examples\"\r\n      loadHandler={\r\n        (state, dispatch) => dispatch({\r\n          type: 'HYDRATE',\r\n          state,\r\n        })\r\n      }\r\n    />\r\n    <CardBody>\r\n      <small className=\"text-muted\">\r\n        Missing a task? Something to improve? Please <a href=\"https://labjs.readthedocs.io/en/latest/meta/contribute/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">suggest or contribute</a>!\r\n      </small>\r\n    </CardBody>\r\n  </>\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport Uploader from '../../../../../Uploader'\r\nimport { fromJSON } from '../../../../../../logic/io/load'\r\n\r\nexport const importComponent = (parent, index, state, store) => {\r\n  // Hydrate store from resulting object\r\n  if (state.components.root.children.length === 1) {\r\n    // If the root component has only a single child,\r\n    // import that.\r\n    store.dispatch({\r\n      type: 'IMPORT_COMPONENT',\r\n      parent, index,\r\n      id: state.components.root.children[0],\r\n      source: state.components,\r\n    })\r\n  } else {\r\n    // If the root component has multiple descendants,\r\n    // import them as a sequence\r\n\r\n    // Remove metadata collection plugin\r\n    // (which is automatically added to every study root)\r\n    state.components.root.plugins =\r\n      state.components.root.plugins.filter(\r\n        x => x.type !== 'lab.plugins.Metadata'\r\n      )\r\n\r\n    // Rename task from metadata\r\n    state.components.root.title =\r\n      state.components.root.metadata.title || 'Unnamed task'\r\n\r\n    store.dispatch({\r\n      type: 'IMPORT_COMPONENT',\r\n      parent, index,\r\n      id: 'root',\r\n      source: state.components,\r\n    })\r\n  }\r\n\r\n  // Merge files\r\n  store.dispatch({\r\n    type: 'MERGE_FILES',\r\n    files: state.files.files\r\n  })\r\n\r\n  // Open component options\r\n  store.dispatch({\r\n    type: 'SHOW_COMPONENT_DETAIL',\r\n    id: store.getState().components[parent].children[index],\r\n  })\r\n\r\n  store.dispatch({\r\n    type: 'HIDE_MODAL',\r\n  })\r\n}\r\n\r\nconst ImportTab = ({ parent, index }) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <Uploader\r\n      accept=\"application/json\"\r\n      multiple={ false }\r\n      maxSize={ 55 * 1024 ** 2 } // 55MB\r\n      onUpload={\r\n        ([[fileContent]]) => {\r\n          try {\r\n            // Parse file from JSON\r\n            const data = fromJSON(fileContent)\r\n            importComponent(parent, index, data, store)\r\n          } catch(e) {\r\n            // If things don't work out, let the user know\r\n            alert('Couldn\\'t load file, found error', e)\r\n          }\r\n        }\r\n      }\r\n    >\r\n      <button className=\"btn btn-outline-secondary btn-lg btn-block\">\r\n        <strong>Import component</strong> from file\r\n      </button>\r\n    </Uploader>\r\n  )\r\n}\r\n\r\nexport default ImportTab\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\nimport { Card } from 'reactstrap'\r\nimport { TaskList } from '../../../../../ComponentOptions/components/Welcome/components/ExampleTab'\r\n\r\nimport { importComponent } from '../importTab'\r\n\r\nconst basePath =\r\n  process.env.REACT_APP_TEMPLATE_PATH ??\r\n  'https://raw.githubusercontent.com/FelixHenninger/lab.js/master/templates/'\r\n\r\nconst TemplateTab = ({ parent, index }) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"h5 mt-1\">\r\n        <span>Templates</span>\r\n      </h2>\r\n      <p>Click on any template to include it in your study; they're yours to use and extend. Please consider <a href=\"https://labjs.readthedocs.io/en/latest/meta/contribute/index.html\">sharing your own favorites!</a></p>\r\n      <Card className=\"card-flush\">\r\n        <TaskList\r\n          path={ basePath }\r\n          taskLabel=\"templates\"\r\n          loadHandler={ data => {\r\n            try {\r\n              importComponent(parent, index, data, store)\r\n            } catch(e) {\r\n              // If things don't work out, let the user know\r\n              alert('Couldn\\'t load file, found error', e)\r\n            }\r\n          } }\r\n        />\r\n      </Card>\r\n      <div className=\"mt-3\">\r\n        <small className=\"text-muted\">\r\n          Missing something? Ideas for improving things? Please <a href=\"https://labjs.readthedocs.io/en/latest/meta/contribute/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">suggest or contribute</a>!\r\n        </small>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default TemplateTab\r\n\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { repeat } from 'lodash'\r\nimport { Button, ButtonGroup, Input } from 'reactstrap'\r\nimport { children, flatTree } from '../../../../../../logic/tree'\r\n\r\nimport './style.css'\r\n\r\nconst CopyTab = ({ parent, index }) => {\r\n  let sourceSelect = React.createRef()\r\n  const store = useStore()\r\n\r\n  return <div className=\"copy-component-tab\">\r\n    <Input\r\n      type=\"select\" bsSize=\"lg\"\r\n      name=\"copySelect\" id=\"copySelect\"\r\n      className=\"custom-select\"\r\n      innerRef={ sourceSelect }\r\n    >\r\n      {\r\n        flatTree(store.getState().components).map(\r\n          ([id, level, data], index) =>\r\n            <option value={ id } key={ index }>\r\n              { level > 0 ? repeat(' ', level - 1) + '∙ ' : '' }\r\n              { data.title }\r\n            </option>\r\n        )\r\n      }\r\n    </Input>\r\n    <ButtonGroup>\r\n      <Button\r\n        outline color=\"secondary\"\r\n        onClick={ () => {\r\n          if (sourceSelect.current.value !== '') {\r\n            store.dispatch({\r\n              type: 'COPY_COMPONENT',\r\n              id: sourceSelect.current.value,\r\n              parent, index,\r\n            })\r\n            // TODO: Show the new component\r\n            store.dispatch({\r\n              type: 'HIDE_MODAL',\r\n            })\r\n          }\r\n        } }\r\n      >\r\n        Copy\r\n      </Button>\r\n      <Button\r\n        outline color=\"secondary\"\r\n        onClick={ () => {\r\n          if (sourceSelect.current.value !== '') {\r\n            // Check whether a component is being\r\n            // cloned into itself, thus creating\r\n            // and infinite recursion.\r\n            const sourceChildren = [\r\n              sourceSelect.current.value,\r\n              ...children(\r\n                sourceSelect.current.value,\r\n                store.getState().components\r\n              ),\r\n            ]\r\n            if (sourceChildren.includes(parent)) {\r\n              alert(\r\n                'I\\'m sorry, I\\'m afraid I can\\'t do that: ' +\r\n                'Cloning a component inside itself would create ' +\r\n                'an endless chain of nested components. ' +\r\n                'Please use a regular copy instead.'\r\n              )\r\n              return\r\n            }\r\n            store.dispatch({\r\n              type: 'CLONE_COMPONENT',\r\n              id: sourceSelect.current.value,\r\n              parent, index,\r\n            })\r\n            // TODO: Show the new component\r\n            store.dispatch({\r\n              type: 'HIDE_MODAL',\r\n            })\r\n          }\r\n        } }\r\n      >\r\n        Clone\r\n      </Button>\r\n    </ButtonGroup>\r\n  </div>\r\n}\r\n\r\nexport default CopyTab\r\n","import React, { useState } from 'react'\r\n\r\nimport { Button, ModalBody, ModalFooter, Nav } from 'reactstrap'\r\n\r\nimport Icon from '../../../Icon'\r\nimport { NavEntry, NavCloseModal } from '../../../Nav'\r\n\r\nimport NewTab from './components/newTab'\r\nimport TemplateTab from './components/templateTab'\r\nimport CopyTab from './components/copyTab'\r\nimport ImportTab from './components/importTab'\r\n\r\nconst TabContent = ({ tab, ...tabProps }) => {\r\n  switch(tab) {\r\n    case 'new':\r\n      return <NewTab { ...tabProps } />\r\n    case 'template':\r\n      return <TemplateTab { ...tabProps } />\r\n    case 'copy':\r\n      return <CopyTab { ...tabProps } />\r\n    case 'import':\r\n      return <ImportTab { ...tabProps } />\r\n    default:\r\n      return <div>Requested tab not found</div>\r\n  }\r\n}\r\n\r\nexport default ({ parent, index, closeHandler }) => {\r\n  const [tab, setTab] = useState('new')\r\n\r\n  return (\r\n    <div className=\"modal-content\">\r\n      <Nav tabs>\r\n        <NavEntry id=\"new\" activeId={ tab } setId={ setTab }>\r\n          <Icon icon=\"plus\" weight=\"s\" />\r\n        </NavEntry>\r\n        <NavEntry id=\"copy\" activeId={ tab } setId={ setTab }>\r\n          <Icon icon=\"clone\" fallbackWeight=\"r\" />\r\n        </NavEntry>\r\n        <NavEntry id=\"template\" activeId={ tab } setId={ setTab }>\r\n          <Icon icon=\"box-open\" fallbackWeight=\"s\" />\r\n        </NavEntry>\r\n        <NavEntry id=\"import\" activeId={ tab } setId={ setTab }>\r\n          <Icon icon=\"folder-open\" fallbackWeight=\"r\" />\r\n        </NavEntry>\r\n        <NavCloseModal onClick={ closeHandler } />\r\n      </Nav>\r\n      <ModalBody>\r\n        <TabContent tab={ tab } parent={ parent } index={ index } />\r\n      </ModalBody>\r\n      <ModalFooter>\r\n        <Button\r\n          outline color=\"secondary\"\r\n          onClick={ closeHandler }\r\n          >\r\n          Cancel\r\n        </Button>\r\n      </ModalFooter>\r\n    </div>\r\n  )\r\n}\r\n","export const updateComponent = (id, data) => ({\r\n  type: 'UPDATE_COMPONENT',\r\n  id, data,\r\n})\r\n","import React from 'react'\r\n\r\nimport { Formik, Field } from 'formik'\r\nimport { FormGroup, Label, FormText, Col } from 'reactstrap'\r\n\r\nimport { AutoSave, Input } from '../../../Form'\r\nimport { updateComponent } from '../../../../actions/components'\r\nimport { connect } from 'react-redux'\r\n\r\nconst MetadataForm = ({ data, updateComponent }) =>\r\n  <Formik\r\n    initialValues={ data }\r\n  >\r\n    <form>\r\n      <h4 className=\"mt-1\">\r\n        Study information\r\n      </h4>\r\n      <p className=\"text-muted\">\r\n        Please tell your fellow scientists a few things about your study.\r\n      </p>\r\n      <hr />\r\n      <FormGroup row>\r\n        <Label for=\"title\" sm={2}>\r\n          Title\r\n        </Label>\r\n        <Col sm={10}>\r\n          <Field\r\n            name=\"title\"\r\n            component={ Input }\r\n            bsSize=\"lg\"\r\n            className=\"font-weight-bold\"\r\n            style={{\r\n              paddingLeft: '12px',\r\n            }}\r\n          />\r\n        </Col>\r\n      </FormGroup>\r\n      <FormGroup row>\r\n        <Label for=\"description\" sm={2}>\r\n          Description\r\n        </Label>\r\n        <Col sm={10}>\r\n          <Field\r\n            name=\"description\"\r\n            component={ Input }\r\n            type=\"textarea\"\r\n            rows=\"3\"\r\n          />\r\n          <FormText color=\"muted\">\r\n            What does your study do?\r\n          </FormText>\r\n        </Col>\r\n      </FormGroup>\r\n      <hr />\r\n      <FormGroup row>\r\n        <Label for=\"repository\" size=\"sm\" sm={2}>\r\n          Repository\r\n        </Label>\r\n        <Col sm={10}>\r\n          <Field\r\n            name=\"repository\"\r\n            placeholder=\"https://osf.io/... / https://github.com/...\"\r\n            component={ Input }\r\n            bsSize=\"sm\"\r\n            className=\"text-monospace\"\r\n          />\r\n          <FormText color=\"muted\">\r\n            Where can researchers find the canonical or latest version of your study?\r\n          </FormText>\r\n        </Col>\r\n      </FormGroup>\r\n      <FormGroup row>\r\n        <Label for=\"contributors\" size=\"sm\" sm={2}>\r\n          Contributors\r\n        </Label>\r\n        <Col sm={10}>\r\n          <Field\r\n            name=\"contributors\"\r\n            placeholder=\"Rita Levi-Montalcini &lt;rlm@nobel.example&gt; (http://ibcn.cnr.it)\"\r\n            component={ Input }\r\n            type=\"textarea\" rows=\"3\"\r\n            bsSize=\"sm\" className=\"text-monospace\"\r\n          />\r\n          <FormText color=\"muted\">\r\n            <em>One line each, please!</em> To keep things tidy, please enter full names (or secret pseudonyms) for everyone who helped build this study. You can also add an email address (in angle brackets) and a link (in round brackets).\r\n          </FormText>\r\n        </Col>\r\n      </FormGroup>\r\n      <AutoSave\r\n        onSave={\r\n          data => updateComponent('root', { metadata: data })\r\n        }\r\n      />\r\n    </form>\r\n  </Formik>\r\n\r\nconst mapStateToProps = state => ({\r\n  data: state.components['root'].metadata\r\n})\r\nconst mapDispatchToProps = {\r\n  updateComponent\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(MetadataForm)\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { Button } from 'reactstrap'\r\nimport { sortBy } from 'lodash'\r\n\r\nimport Icon from '../Icon'\r\nimport { dataURItoIcon } from '../../logic/util/fileType'\r\nimport { sizeFromDataURI } from '../../logic/util/dataURI'\r\n\r\nexport const FileTableColGroup = () =>\r\n  <colgroup>\r\n    <col style={{ width: '60px' }} />\r\n    <col style={{ width: '80%' }} />\r\n    <col style={{ width: '20%' }} />\r\n    <col style={{ width: '60px' }} />\r\n  </colgroup>\r\n\r\nexport const FileTableHeader = () =>\r\n  <thead>\r\n    <tr>\r\n      <th></th>\r\n      <th>Filename</th>\r\n      <th className=\"text-right\">\r\n        Size <span className=\"text-muted font-weight-normal\">[KB]</span>\r\n      </th>\r\n      <th></th>\r\n    </tr>\r\n  </thead>\r\n\r\nconst FileTableRow = ({ path, content, onDelete }) =>\r\n  <tr>\r\n    <td>\r\n      <div\r\n        className=\"text-muted text-center\"\r\n        style={{\r\n          padding: '0.375rem 0.75rem',\r\n          border: '1px solid transparent',\r\n          lineHeight: '1.5',\r\n        }}\r\n      >\r\n        <Icon\r\n          icon={ dataURItoIcon(content) }\r\n          fixedWidth\r\n          style={{\r\n            color: 'var(--secondary)',\r\n            position: 'relative',\r\n            top: '1px',\r\n          }}\r\n        />\r\n      </div>\r\n    </td>\r\n    <td className=\"text-monospace\">\r\n      <div style={{ padding: \"0.55rem 0 0.2rem\" }}>\r\n        { path }\r\n      </div>\r\n    </td>\r\n    <td className=\"text-monospace text-right\">\r\n      <div style={{ padding: \"0.55rem 0 0.2rem\" }}>\r\n        { sizeFromDataURI(content) }\r\n      </div>\r\n    </td>\r\n    <td>\r\n      <Button\r\n        block\r\n        outline color=\"muted\"\r\n        onClick={ onDelete }\r\n      >\r\n        <Icon\r\n          icon=\"trash\"\r\n          fixedWidth\r\n        />\r\n      </Button>\r\n    </td>\r\n  </tr>\r\n\r\nconst _FileTableBody = ({ files, sources=['embedded-global'], deleteFile }) =>\r\n  <tbody>\r\n    {\r\n      sortBy(Object.entries(files), ([path, _]) => path)\r\n        // Ignore library files (keep embedded and embedded-global)\r\n        .filter(([_, { source }]) => sources.includes(source))\r\n        .map(([path, { content }]) =>\r\n          <FileTableRow\r\n            key={ path }\r\n            path={ path }\r\n            content={ content }\r\n            onDelete={ () => deleteFile(path) }\r\n          />\r\n        )\r\n    }\r\n  </tbody>\r\n\r\nconst mapStateToProps = state => ({\r\n  files: state.files.files,\r\n})\r\nconst mapDispatchToProps = {\r\n  deleteFile: (path) => ({\r\n    type: 'DELETE_FILE',\r\n    file: path,\r\n  })\r\n}\r\n\r\nexport const FileTableBody = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(_FileTableBody)\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { Progress } from 'reactstrap'\r\n\r\nimport { sizeFromDataURI } from '../../logic/util/dataURI'\r\n\r\nconst StorageLevel = ({ space }) =>\r\n  <Progress\r\n    value={ space }\r\n    max={ 50 * 1024 }\r\n    style={{\r\n      height: '25px',\r\n    }}\r\n  >\r\n    <span className=\"pl-2\">\r\n      { (space / 1024).toFixed(1) } / 50 MB\r\n    </span>\r\n  </Progress>\r\n\r\nconst mapStateToProps = (state) => ({\r\n  space: Object.entries(state.files.files)\r\n    .reduce((acc, [, { content }]) => acc + sizeFromDataURI(content), 0)\r\n})\r\n\r\nexport default connect(mapStateToProps)(StorageLevel)\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { Table, Button } from 'reactstrap'\r\nimport { FileTableHeader, FileTableBody, FileTableColGroup } from '../../../FileTable'\r\nimport Icon from '../../../Icon'\r\nimport Uploader from '../../../Uploader'\r\nimport { addFiles } from '../../../../logic/util/files'\r\n\r\nimport FileStorage from '../../../FileStorageIndicator'\r\n\r\nconst Files = () => {\r\n  const store = useStore()\r\n\r\n  // We borrow styles from the grid component,\r\n  // please make global adjustments there.\r\n  // (TODO: check whether the border can be generalized)\r\n  return (\r\n    <Table\r\n      className=\"grid border-top-0\"\r\n      style={{ borderBottom: '2px solid #eceeef' }}\r\n    >\r\n      <FileTableColGroup />\r\n      <FileTableHeader />\r\n      <FileTableBody />\r\n      <tfoot>\r\n        <tr>\r\n          <td />\r\n          <td colSpan=\"2\">\r\n            <Uploader\r\n              decodeAs=\"dataURL\"\r\n              onUpload={\r\n                files => {\r\n                  try {\r\n                    // TODO: Refactor this into an action\r\n                    addFiles(store, files.map(([content, file]) => ({\r\n                      poolPath: `static/${ file.name }`,\r\n                      data: {\r\n                        content: content,\r\n                        source: 'embedded-global',\r\n                      }\r\n                    })))\r\n                  } catch(e) {\r\n                    console.log('Error while adding file', e)\r\n                    alert('Encountered error while adding file:', e)\r\n                  }\r\n                }\r\n              }\r\n            >\r\n              <Button\r\n                size=\"sm\" block\r\n                outline color=\"muted\"\r\n                className=\"hover-target\"\r\n              >\r\n                <Icon icon=\"plus\" />\r\n              </Button>\r\n            </Uploader>\r\n          </td>\r\n          <td />\r\n        </tr>\r\n      </tfoot>\r\n    </Table>\r\n  )\r\n}\r\n\r\nexport default () =>\r\n  <>\r\n    <h4 className=\"mt-1\">\r\n      Storage in use\r\n    </h4>\r\n    <FileStorage />\r\n    <small className=\"text-muted d-block mt-2\">While storage is not strictly limited, we strongly recommend that studies use substantially less than 50 MB overall, and ideally below 20MB. This is not because of technical limitations but to reduce loading time and network traffic. If larger media are required, for example videos, these should be hosted outside of the study.</small>\r\n\r\n    <hr />\r\n    <h5 className=\"h5 mt-1\">\r\n      Study-wide static files\r\n    </h5>\r\n    <p className=\"text-muted\">The following files are available study-wide from the <code>static</code> directory.</p>\r\n    <Files />\r\n  </>\r\n","import React from 'react'\r\nimport MonacoEditor from 'react-monaco-editor'\r\n\r\nimport { throttle } from 'lodash'\r\n\r\nimport './editor-style-overrides.css'\r\n\r\nexport default class Editor extends React.Component {\r\n  editorWillMount(monaco) {\r\n    monaco.editor.defineTheme('labjs', {\r\n      base: 'vs', inherit: true,\r\n      rules: [\r\n        { token: 'attribute.name', foreground: '0275d8' },\r\n        { token: 'attribute.value', foreground: '569cd6' },\r\n        { token: 'attribute.value.html', foreground: '569cd6' },\r\n        { token: 'comment', foreground: '999999' },\r\n        { token: 'comment.content', foreground: '999999' },\r\n        { token: 'comment.html', foreground: '999999' },\r\n        { token: 'comment.content.html', foreground: '999999' },\r\n        { token: 'keyword', foreground: '0275d8' },\r\n        { token: 'metatag.content', foreground: '0275d8' },\r\n        { token: 'metatag.content.html', foreground: '0275d8' },\r\n        { token: 'metatag.html', foreground: '999999' },\r\n        { token: 'property-name', foreground: '0275d8' },\r\n        { token: 'token.content', foreground: '0275d8' },\r\n      ],\r\n      colors: {\r\n        'editor.background': '#ffffff',\r\n        'editorIndentGuide.background': '#eceeef',\r\n        'editorLineNumber.foreground': '#818a91',\r\n        'editorRuler.foreground': '#eceeef',\r\n      },\r\n    })\r\n  }\r\n\r\n  editorDidMount(editor, monaco) {\r\n    const model = editor.getModel()\r\n\r\n    // Set tab width\r\n    model.updateOptions({\r\n      tabSize: 2,\r\n    })\r\n\r\n    // Hook up custom linter (currently only for HTML)\r\n    if (this.props.language === 'html') {\r\n      // The HTMLHint library loads many dependencies,\r\n      // and is not needed directly when the editor\r\n      // is first loaded, therefore it is split out here.\r\n      import('htmlhint').then(({ default: HTMLHint }) => {\r\n        model.onDidChangeContent(throttle(() => {\r\n          const hints = HTMLHint.verify(\r\n            model.getValue(), {\r\n              \"tagname-lowercase\": true,\r\n              \"attr-lowercase\": true,\r\n              \"attr-value-double-quotes\": true,\r\n              \"tag-pair\": true,\r\n              \"spec-char-escape\": true,\r\n              \"id-unique\": true,\r\n              \"src-not-empty\": true,\r\n              \"attr-no-duplication\": true,\r\n              \"attr-unsafe-chars\": true\r\n            }\r\n          ).map(hint => ({\r\n            startLineNumber: hint.line, startColumn: hint.col,\r\n            endLineNumber: hint.line, endColumn: hint.col + hint.raw.length,\r\n            message: hint.message,\r\n            severity: 1,\r\n          }))\r\n\r\n          monaco.editor.setModelMarkers(\r\n            model, 'custom-linter', hints\r\n          )\r\n        }, 500))\r\n      }).catch(e => console.log('Couldn\\'t load HTMLHint:', e))\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <MonacoEditor\r\n      width=\"100%\"\r\n      language=\"html\" value={''}\r\n      theme=\"labjs\"\r\n      editorDidMount={ this.editorDidMount.bind(this) }\r\n      editorWillMount={ this.editorWillMount.bind(this) }\r\n      {...this.props}\r\n      options={{\r\n        // Behavior\r\n        contextmenu: false,\r\n        cursorBlinking: 'solid',\r\n        lineNumbers: true,\r\n        lineNumbersMinChars: 4,\r\n        overviewRulerLanes: 0,\r\n        rulers: [80],\r\n        scrollbar: {\r\n          useShadows: false,\r\n        },\r\n        scrollBeyondLastLine: false,\r\n        tabSize: 2,\r\n        // Wrapping\r\n        wordWrap: 'wordWrapColumn',\r\n        wordWrapColumn: 80,\r\n        wrappingIndent: \"indent\",\r\n        // Style\r\n        fontFamily: 'Fira Mono',\r\n        fontSize: 18,\r\n        lineHeight: 26,\r\n        ...this.props.options\r\n      }}\r\n    />\r\n  }\r\n}\r\n","import React, { useState } from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { ModalBody, ModalFooter, Nav, Button } from 'reactstrap'\r\n\r\nimport MetadataForm from './MetadataForm'\r\nimport Files from './Files'\r\nimport Editor from '../../../Editor'\r\nimport { NavEntry, NavCloseModal } from '../../../Nav'\r\nimport Icon from '../../../Icon'\r\n\r\nimport { makeDataURI, readDataURI } from '../../../../logic/util/dataURI'\r\nimport './style.css'\r\n\r\nconst TabContent = ({ tab }) => {\r\n  // TODO: Refactor to use connect()\r\n  const store = useStore()\r\n  const files = store.getState().files.files\r\n  switch(tab) {\r\n    case 'meta':\r\n      return <MetadataForm />\r\n    case 'files':\r\n      return <Files />\r\n    case 'html':\r\n      return (\r\n        <div className=\"d-flex flex-column\" style={{ minHeight: '60vh' }}>\r\n          <Editor\r\n            key=\"html\"\r\n            value={ readDataURI(files['index.html'].content).data }\r\n            onChange={\r\n              newContent => store.dispatch({\r\n                type: 'UPDATE_FILE',\r\n                file: 'index.html',\r\n                data: {\r\n                  content: makeDataURI(newContent, 'text/html')\r\n                }\r\n              })\r\n            }\r\n          />\r\n        </div>\r\n      )\r\n    case 'css':\r\n      return (\r\n        <div className=\"d-flex flex-column\" style={{ minHeight: '60vh' }}>\r\n          <Editor\r\n            key=\"css\"\r\n            height=\"400\"\r\n            language=\"css\"\r\n            value={ readDataURI(files['style.css'].content).data }\r\n            onChange={\r\n              newContent => store.dispatch({\r\n                type: 'UPDATE_FILE',\r\n                file: 'style.css',\r\n                data: {\r\n                  content: makeDataURI(newContent, 'text/css')\r\n                }\r\n              })\r\n            }\r\n          />\r\n        </div>\r\n      )\r\n    default:\r\n      return <div>Requested tab not found</div>\r\n  }\r\n}\r\n\r\nconst OptionsModal = ({ closeHandler }) => {\r\n  const [tab, setTab] = useState('meta')\r\n\r\n  return (\r\n    <div className=\"modal-content\">\r\n      <Nav tabs>\r\n        <NavEntry id=\"meta\" activeId={ tab } setId={ setTab }>\r\n          <Icon icon=\"info\" weight=\"s\" />\r\n        </NavEntry>\r\n        <NavEntry id=\"files\" activeId={ tab } setId={ setTab }>\r\n          <Icon icon=\"folder\" />\r\n        </NavEntry>\r\n        <NavEntry id=\"html\" activeId={ tab } setId={ setTab }>\r\n          HTML\r\n        </NavEntry>\r\n        <NavEntry id=\"css\" activeId={ tab } setId={ setTab }>\r\n          CSS\r\n        </NavEntry>\r\n        <NavCloseModal onClick={ closeHandler } />\r\n      </Nav>\r\n      <ModalBody>\r\n        <TabContent tab={ tab } />\r\n      </ModalBody>\r\n      <ModalFooter>\r\n        <Button\r\n          outline color=\"secondary\"\r\n          onClick={ closeHandler }\r\n        >\r\n          Done\r\n        </Button>\r\n      </ModalFooter>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default OptionsModal\r\n","import React from 'react'\r\nimport { ModalHeader, ModalBody, ModalFooter, Button } from 'reactstrap'\r\n\r\nexport default ({\r\n  title, children,\r\n  confirmLabel, confirmHandler,\r\n  closeLabel, closeHandler\r\n}) =>\r\n  <div className=\"modal-content\">\r\n    <ModalHeader\r\n      toggle={ closeHandler }\r\n    >\r\n      { title }\r\n    </ModalHeader>\r\n    <ModalBody>\r\n      { children }\r\n    </ModalBody>\r\n    <ModalFooter>\r\n      <Button\r\n        outline color={ confirmHandler ? 'secondary' : 'primary' }\r\n        onClick={ closeHandler }\r\n      >\r\n        { closeLabel || 'Cancel' }\r\n      </Button>\r\n      {\r\n        confirmHandler\r\n          ? <Button\r\n              outline color=\"primary\"\r\n              onClick={ confirmHandler }\r\n            >\r\n              { confirmLabel || 'Okay' }\r\n            </Button>\r\n          : null\r\n      }\r\n    </ModalFooter>\r\n  </div>\r\n","import React from 'react'\r\nimport { isNil } from 'lodash'\r\n\r\nexport const errors = [\r\n  [\r\n    isNil(navigator.serviceWorker),\r\n    <li>\r\n      Your browser does not support <a href=\"http://caniuse.com/#feat=serviceworkers\">service workers</a>, which are required for the study preview. This might be because you are browsing in private mode &mdash; if your browser is up to date, please check whether private mode is active.\r\n    </li>\r\n  ],\r\n  [\r\n    [Array.from, Object.entries].some(isNil),\r\n    <li>\r\n      The browser you are using does not support JavaScript features required by the builder. Please update or switch to a modern browser!\r\n    </li>\r\n  ],\r\n  [\r\n    isNil(window.localStorage),\r\n    <li>\r\n      Your browser does not offer <a href=\"https://caniuse.com/#search=localstorage\">local storage</a> capabilities, which we use to keep a backup of your data when you leave the site. You are missing one of our safety nets, please make sure that you save regularly!\r\n    </li>\r\n  ],\r\n].filter(e => e[0]).map(e => e[1])\r\n\r\nexport const check = (store) => {\r\n  if (errors.length > 0) {\r\n    store.dispatch({\r\n      type: 'SHOW_MODAL',\r\n      modalType: 'SYSTEM_COMPATIBILITY',\r\n      modalProps: {\r\n        large: false,\r\n      },\r\n    })\r\n  }\r\n}\r\n","import React from 'react'\r\nimport Confirm from '../Confirm'\r\n\r\nimport { errors } from '../../../../logic/util/compatibility'\r\n\r\nexport default ({ closeHandler }) =>\r\n  <Confirm\r\n    title=\"You're missing out!\"\r\n    closeLabel=\"Continue\"\r\n    closeHandler={ closeHandler }\r\n  >\r\n    <p><strong className=\"text-danger\">For the <code>lab.js</code> builder to work as it should, it needs functionality that is not available in your browser.</strong> You'll get the most out of the builder by using <a href=\"https://getfirefox.com\" className=\"font-weight-bold\">Firefox</a> or <a href=\"https://www.google.com/intl/en/chrome/\" className=\"font-weight-bold\">Chrome</a>.</p>\r\n    <p>Here's what we found:</p>\r\n    <ul\r\n      style={{\r\n        paddingLeft: '1.5rem',\r\n      }}\r\n    >\r\n      { errors }\r\n    </ul>\r\n    <p><strong className=\"text-primary\">The studies you design will work fine on a much larger range of systems</strong> &mdash; it's just the builder interface that requires more capabilities.</p>\r\n  </Confirm>\r\n","const fullscreen = {\r\n  title: 'Fullscreen',\r\n  description: 'Enable fullscreen mode for portions of the study',\r\n  version: '0.1.0',\r\n  path: 'lab.plugins.Fullscreen',\r\n  files: {},\r\n  headers: [],\r\n  options: {\r\n    'message': {\r\n      label: 'Message',\r\n      type: 'text',\r\n      placeholder: 'This experiment requires full screen display',\r\n    },\r\n    'hint': {\r\n      label: 'Help text',\r\n      type: 'text',\r\n      placeholder: 'Please click to continue in full screen mode',\r\n    }\r\n  }\r\n}\r\n\r\nconst mousetrap = {\r\n  title: 'Mousetrap',\r\n  description: 'Mouse-tracking data collection',\r\n  version: '0.1.0',\r\n  path: 'global.MousetrapPlugin',\r\n  files: {\r\n  },\r\n  headers: [\r\n    ['comment', { content: 'MousetrapPlugin' }],\r\n    // eslint-disable-next-line no-template-curly-in-string\r\n    ['script', { src: 'https://mousetrap.felixhenninger.com/0.1.0/mousetrap.js' }],\r\n  ],\r\n  options: {\r\n    'mode': {\r\n      label: 'Data format',\r\n      type: 'select',\r\n      options: [\r\n        { label: 'Mousetrap default', coding: 'mousetrap' },\r\n        { label: 'Event stream', coding: 'events' },\r\n      ],\r\n      default: 'mousetrap',\r\n      help: 'Standard moustrap output or raw event stream',\r\n    }\r\n  }\r\n}\r\n\r\nexport const plugins = {\r\n  fullscreen,\r\n  mousetrap,\r\n}\r\n\r\nexport const loadPlugin = name => plugins[name]\r\n","import { fromPairs, mapValues, template, uniqBy } from 'lodash'\r\n\r\nimport { loadPlugin } from './library'\r\n\r\n// File management\r\n// Plugin files are placed in `lib/plugins/${ pluginName }`.\r\n// This code moves plugin files and updates the paths accordingly.\r\nconst pluginDir = 'lib/plugins'\r\n\r\n// Prepend plugin path to filenames\r\nconst prependPath = (files={}, pluginName) =>\r\n  fromPairs(\r\n    Object.entries(files).map(([path, data]) => [\r\n      `${ pluginDir }/${ pluginName }/${ path }`,\r\n      data,\r\n    ])\r\n  )\r\n\r\n// Add plugin path to header attributes\r\nconst parseHeaders = (headers=[], pluginName) =>\r\n  headers.map(([tag, attributes]) => [\r\n    tag,\r\n    mapValues(attributes, a =>\r\n      typeof a === 'string'\r\n        ? template(a)({ pluginPath: `${ pluginDir }/${ pluginName }` })\r\n        : a\r\n    ),\r\n  ])\r\n\r\nexport const embedPlugins = state => {\r\n  // Collect plugins used in components\r\n  const plugins = Object.entries(state.components)\r\n    .map(([_, c]) => c.plugins || [])\r\n    .reduce((prev, a) => prev.concat(a), [])\r\n\r\n  // Remove duplicate plugins\r\n  const uniquePlugins = uniqBy(plugins, p => p.type)\r\n\r\n  // Load plugins, ignoring unknown ones\r\n  // (plugins are represented in the following by [type, data] tuples)\r\n  const loadedPlugins = uniquePlugins\r\n    .map(data => [data.type, loadPlugin(data.type)])\r\n    .filter(([, data]) => data !== undefined)\r\n\r\n  // Move files and update page headers\r\n  const pluginFiles = loadedPlugins\r\n    .map(([type, data]) => prependPath(data.files, type))\r\n    .reduce((prev, o) => Object.assign(prev, o), {})\r\n\r\n  const pluginHeaders = loadedPlugins\r\n    .map(([type, data]) => parseHeaders(data.headers, type))\r\n    .reduce((prev, a) => prev.concat(a), [])\r\n\r\n  // Collect plugin load path information\r\n  const pluginPaths = fromPairs(\r\n    loadedPlugins\r\n      .map(([type, data]) => [type, data.path])\r\n      .filter(([, path]) => path !== undefined)\r\n  )\r\n\r\n  return {\r\n    pluginFiles,\r\n    pluginHeaders,\r\n    pluginPaths,\r\n  }\r\n}\r\n","import { toString, toNumber } from 'lodash'\r\n\r\nexport const makeType = (value, type) => {\r\n  if (type === undefined) {\r\n    // Return value unchanged\r\n    return value\r\n  } else {\r\n    // Convert types\r\n    switch (type) {\r\n      case 'string':\r\n        // Trim strings to avoid problems\r\n        // caused by invisible spaces\r\n        return toString(value).trim()\r\n      case 'number':\r\n        return value.trim() === '' ? null : toNumber(value)\r\n      case 'boolean':\r\n        // Only 'true' and 'false' are\r\n        // accepted as values.\r\n        // eslint-disable-next-line default-case\r\n        switch (value.trim()) {\r\n          case 'true':\r\n            return true\r\n          case 'false':\r\n            return false\r\n        }\r\n      // eslint-disable-next-line no-fallthrough\r\n      default:\r\n        return null\r\n    }\r\n  }\r\n}\r\n","// Regex for detecting awaits in a code snippet\r\nexport const awaitRegex = /(^|[^\\w])await\\s+/m\r\n\r\n// Async function constructor\r\n// The eval call here is needed to circumvent CRA's polyfills,\r\n// and probably can be removed at some later point\r\n// eslint-disable-next-line no-new-func\r\nexport const AsyncFunction = new Function(\r\n  'return Object.getPrototypeOf(async function(){}).constructor'\r\n)()\r\n\r\nexport const adaptiveFunction = code =>\r\n  // Build an async function if await appears in the source\r\n  // NOTE: This is a relatively coarse and naive check.\r\n  // It works for us™ because we don't need to be careful\r\n  // about accidentally declaring a function async:\r\n  // In the situations where we apply them, the return values\r\n  // are not important, just that the function returns at all.\r\n  // Alternatively, we could check whether parsing the function\r\n  // works, and listen for syntax errors. I'm lazy. -F\r\n  code.match(awaitRegex)\r\n    ? new AsyncFunction(code)\r\n    // eslint-disable-next-line no-new-func\r\n    : new Function(code)\r\n","import { fromPairs, zip,\r\n  pick, pickBy, groupBy,\r\n  identity, isEmpty } from 'lodash'\r\nimport serialize from 'serialize-javascript'\r\n\r\nimport { makeType } from '../../util/makeType'\r\nimport { adaptiveFunction } from '../../util/async'\r\nimport { slugify } from '../../util/slug'\r\n\r\n// Generic grid processing\r\nconst processGrid = (grid, colnames=null, types=undefined) =>\r\n  grid.rows\r\n    // Filter rows without data\r\n    .filter( r => !r.every( c => c.trim() === '' ) )\r\n    // Convert types if requested\r\n    .map( r => r.map( (c, i) => makeType(c, types ? types[i] : undefined) ) )\r\n    // Use column names to create array of row objects.\r\n    // If column names are passed as a parameter,\r\n    // use those, otherwise rely on the grid object\r\n    .map( r => fromPairs(zip(colnames || grid.columns, r)) )\r\n\r\nconst processFiles = files =>\r\n  fromPairs(\r\n    files.map(f => [f.localPath.trim(), f.poolPath.trim()])\r\n  )\r\n\r\nconst processMessageHandlers = (messageHandlers) =>\r\n  fromPairs(\r\n    messageHandlers\r\n      .filter(h => h.message.trim() !== '' && h.code.trim() !== '')\r\n      // TODO: Evaluate the safety implications\r\n      // of the following de-facto-eval.\r\n      .map(h => [\r\n        h.message,\r\n        adaptiveFunction(h.code)\r\n      ])\r\n  )\r\n\r\nconst processParameters = parameters =>\r\n  fromPairs(\r\n    parameters\r\n      .filter(r => r.name.trim() !== '' && r.value.trim() !== '')\r\n      .map(r => [r.name.trim(), makeType(r.value, r.type)])\r\n  )\r\n\r\nconst createResponsePair = r =>\r\n  // Process an object with the structure\r\n  // { label: 'label', event: 'keypress', ...}\r\n  // into an array with two parts: a label,\r\n  // and an event definition, such as\r\n  // ['keypress(r)', 'red']\r\n  [\r\n    `${ r.event }` +\r\n      `${ r.filter ? `(${ r.filter.trim() })` : ''}` +\r\n      `${ r.target ? ` ${ r.target.trim() }`  : ''}`,\r\n    r.label.trim()\r\n  ]\r\n\r\n// Process individual fields\r\nconst processResponses = (responses) => {\r\n  // Process each of these objects into an array\r\n  // of [responseParams, label] pairs\r\n  const pairs = responses.map(createResponsePair)\r\n  // Finally, create an object of\r\n  // { responseParams: label } mappings\r\n  return fromPairs(pairs)\r\n}\r\n\r\n// Template parameters are also a grid,\r\n// but column names and data types are defined\r\n// as properties of an object.\r\nconst processTemplateParameters = grid =>\r\n  processGrid(\r\n    grid,\r\n    grid.columns.map(c => c.name.trim()),\r\n    grid.columns.map(c => c.type)\r\n  )\r\n\r\nconst processShuffleGroups = columns =>\r\n  Object.values(\r\n    // Collect columns with the same shuffleGroup property\r\n    groupBy(\r\n      columns.filter(c => c.shuffleGroup !== undefined),\r\n      'shuffleGroup'\r\n    )\r\n  ).map(\r\n    // Extract column names\r\n    g => g.map(c => c.name)\r\n  )\r\n\r\nconst processItems = items =>\r\n  items\r\n    .filter(i => i.label !== '')\r\n    .map(i => {\r\n      // Provide a default name based on the label\r\n      // for the items that require one\r\n      if (['text', 'divider'].includes(i.type)) {\r\n        return i\r\n      } else {\r\n        return ({\r\n          ...i,\r\n          name: i.name || slugify(i.label || '')\r\n        })\r\n      }\r\n    })\r\n\r\nconst processContent = (nodeType, content) => {\r\n  switch (nodeType) {\r\n    case 'lab.canvas.Screen':\r\n      return content.map(c => pick(c, [\r\n        'type', 'left', 'top', 'angle', 'width', 'height',\r\n        'stroke', 'strokeWidth', 'fill',\r\n        // Text\r\n        'text', 'fontStyle', 'fontWeight', 'fontSize', 'fontFamily',\r\n        'lineHeight', 'textAlign', 'textBaseline',\r\n        // Image\r\n        'src', 'autoScale',\r\n        // AOI\r\n        'label',\r\n      ]))\r\n    default:\r\n      return content\r\n  }\r\n}\r\n\r\n// Process any single node in isolation\r\nconst processNode = node => {\r\n  // Options to exclude from JSON output\r\n  const filteredOptions = ['skipCondition']\r\n\r\n  // TODO: This filters empty string values, which are\r\n  // created by empty form fields in the builder. This is\r\n  // hackish, and may not work indefinately -- it might\r\n  // have to be solved on the input side, or by making\r\n  // the library more resilient to malformed input.\r\n  // Either way, this is probably not the final solution.\r\n  const filterOptions = (value, key) =>\r\n    value !== '' &&\r\n    !(key.startsWith('_') || filteredOptions.includes(key))\r\n\r\n  const output = Object.assign({}, pickBy(node, filterOptions), {\r\n    content: processContent(node.type, node.content),\r\n    files: node.files\r\n      ? processFiles(node.files)\r\n      : {},\r\n    messageHandlers: node.messageHandlers\r\n      ? processMessageHandlers(node.messageHandlers)\r\n      : node.messageHandlers,\r\n    parameters: node.parameters\r\n      ? processParameters(node.parameters)\r\n      : {},\r\n    items: node.items\r\n      ? processItems(node.items)\r\n      : null,\r\n    responses: node.responses\r\n      ? processResponses(node.responses)\r\n      : {},\r\n    skip: node.skip || node.skipCondition || undefined,\r\n    templateParameters: node.templateParameters\r\n      ? processTemplateParameters(node.templateParameters)\r\n      : node.templateParameters,\r\n    shuffleGroups: node.templateParameters\r\n      ? processShuffleGroups(node.templateParameters.columns || [])\r\n      : node.shuffleGroups,\r\n  })\r\n\r\n  // Remove undefined and null values\r\n  // (serialize-js used to do this for us)\r\n  return pickBy(output, identity)\r\n}\r\n\r\n// Process a node and its children\r\nconst makeComponentTree = (data, root) => {\r\n  const currentNode = processNode(data[root])\r\n\r\n  if (currentNode) {\r\n    const output = Object.assign({}, currentNode)\r\n\r\n    // Convert children, if available\r\n    if (currentNode.children) {\r\n      switch (currentNode.type) {\r\n        case 'lab.flow.Sequence':\r\n          // A sequence can have several components as content\r\n          output.content = currentNode.children\r\n            .map(c => makeComponentTree(data, c))\r\n          break\r\n        case 'lab.flow.Loop':\r\n          // A loop has a single template\r\n          if (!isEmpty(currentNode.children)) {\r\n            output.template = makeComponentTree(data, currentNode.children[0])\r\n          }\r\n          break\r\n        case 'lab.canvas.Frame':\r\n        case 'lab.html.Frame':\r\n          // A loop has a single template\r\n          if (!isEmpty(currentNode.children)) {\r\n            output.content = makeComponentTree(data, currentNode.children[0])\r\n          }\r\n          break\r\n        default:\r\n          // TODO: This won't catch canvas-based\r\n          // components, but it also doesn't need\r\n          // to right now.\r\n          break\r\n      }\r\n\r\n      // After parsing, children components are no longer needed\r\n      delete output.children\r\n    }\r\n\r\n    // Delete unused fields\r\n    delete output.id\r\n\r\n    return output\r\n  } else {\r\n    return {}\r\n  }\r\n}\r\n\r\nexport const makeStudyTree = (state) => {\r\n  // Process study tree\r\n  const componentTree = makeComponentTree(state.components, 'root')\r\n  return serialize(componentTree, { space: 2 })\r\n}\r\n\r\nconst makeStudyScript = studyTree =>\r\n`// Define study\r\nconst study = lab.util.fromObject(${ studyTree })\r\n\r\n// Let's go!\r\nstudy.run()`\r\n\r\nexport const makeScript = (state) => {\r\n  const studyTree = makeStudyTree(state)\r\n  return makeStudyScript(studyTree)\r\n}\r\n","import { readDataURI } from '../../util/dataURI'\r\nimport { template } from 'lodash'\r\n\r\n// Render HTML from a list of objects\r\n// (TODO: I'm not sure if this isn't too convoluted.\r\n// We might switch back to string-based node element\r\n// generation at some later point)\r\nconst renderNode = ([type, attrs={}]) => {\r\n  if (type === 'comment') {\r\n    return `<!-- ${ attrs.content } -->`\r\n  } else {\r\n    const node = document.createElement(type)\r\n    Object.entries(attrs)\r\n      .forEach(([attr, value]) => node.setAttribute(attr, value))\r\n    return node.outerHTML\r\n  }\r\n}\r\n\r\nconst makeHeader = (state, { beforeHeader=[], libraryPath='lib', dev=false }={}) => {\r\n  const defaultHeader = [\r\n    ['comment', { content: 'lab.js library code' }],\r\n    ['script', {\r\n      'src': `${ libraryPath }/${ dev ? 'lab.dev.js' : 'lab.js' }`,\r\n      'data-labjs-script': 'library'\r\n    }],\r\n    ['script', {\r\n      'src': `${ libraryPath }/lab.fallback.js`,\r\n      'data-labjs-script': 'fallback'\r\n    }],\r\n    ['link', { rel: 'stylesheet', href: `${ libraryPath }/lab.css` }],\r\n    ['comment', { content: 'study code and styles' }],\r\n    ['script', { src: 'script.js', defer: true }],\r\n    ['link', { rel: 'stylesheet', href: 'style.css' }],\r\n  ]\r\n\r\n  // TBC ...\r\n  return [...beforeHeader, ...defaultHeader]\r\n    .map(renderNode)\r\n    .map((l, i) => i === 0 ? l : `  ${ l }`) // Indent from second line\r\n    .join('\\n')\r\n}\r\n\r\nexport const makeHTML = (state, headerOptions) => {\r\n  const { data } = readDataURI(state.files.files['index.html'].content)\r\n\r\n  const updatedHTML = template(data, {\r\n    escape: '',\r\n    evaluate: '',\r\n  })({\r\n    header: makeHeader(state, headerOptions)\r\n  })\r\n\r\n  return updatedHTML\r\n}\r\n","import { pickBy, cloneDeep, fromPairs, mapValues } from 'lodash'\r\nimport { embeddedFiles } from '../../util/files'\r\nimport { embedPlugins } from '../../plugins'\r\nimport { makeDataURI } from '../../util/dataURI'\r\nimport { makeScript } from './script.js'\r\nimport { makeHTML } from './html.js'\r\n\r\n// TODO: At some later point, header options\r\n// should be derived from the study state\r\n// to the greatest possible extent (i.e. via plugins).\r\n\r\nconst assemble = (state,\r\n  stateModifier=state => state,\r\n  { additionalFiles={}, headerOptions={} }={}\r\n) => {\r\n  // Apply modification function to copy of current state\r\n  const updatedState = stateModifier(cloneDeep(state))\r\n\r\n  // Filter files that are not embedded in components\r\n  const filesInUse = embeddedFiles(updatedState.components)\r\n\r\n  const files = pickBy(\r\n    updatedState.files.files,\r\n    (file, filename) =>\r\n      file.source !== 'embedded' ||\r\n      filesInUse.includes(filename)\r\n  )\r\n\r\n  // Collect plugin data\r\n  const { pluginFiles, pluginHeaders, pluginPaths } = embedPlugins(updatedState)\r\n\r\n  // Inject plugin headers\r\n  const updatedHeaderOptions = {\r\n    ...headerOptions,\r\n    beforeHeader: [\r\n      ...(headerOptions.beforeHeader || []),\r\n      ...pluginHeaders,\r\n    ]\r\n  }\r\n\r\n  // Inject plugin paths, where available\r\n  updatedState.components = mapValues(updatedState.components, c => ({\r\n    ...c,\r\n    plugins: c.plugins\r\n      ? c.plugins.map(p => ({\r\n          ...p,\r\n          path: Object.keys(pluginPaths).includes(p.type)\r\n            ? pluginPaths[p.type]\r\n            : p.path\r\n        }) )\r\n      : c.plugins\r\n  }) )\r\n\r\n  // Reassemble state object that now includes the generated script,\r\n  // as well as any additional files required for the deployment target\r\n  return {\r\n    files: {\r\n      // Static files stored in state\r\n      ...files,\r\n      // Files required by plugins\r\n      ...pluginFiles,\r\n      // Additional files injected by the export modifier\r\n      ...additionalFiles,\r\n      // Generated experiment files\r\n      'script.js': {\r\n        content: makeDataURI(\r\n          makeScript(updatedState),\r\n          'application/javascript',\r\n        )\r\n      },\r\n      'index.html': {\r\n        content: makeDataURI(\r\n          makeHTML(updatedState, updatedHeaderOptions),\r\n          'text/html'\r\n        )\r\n      },\r\n    },\r\n    bundledFiles: fromPairs(Object.entries(updatedState.files.bundledFiles).map(\r\n      // Add source path to data, so that bundled files can be moved\r\n      ([path, data]) => [path, { source: path, ...data }]\r\n    ))\r\n  }\r\n}\r\n\r\nexport default assemble\r\n","import JSZip from 'jszip'\r\nimport { saveAs } from 'file-saver'\r\nimport * as Sentry from '@sentry/browser'\r\n\r\nimport assemble from '../assemble'\r\nimport { readDataURI } from '../../util/dataURI'\r\nimport { makeFilename } from '../filename'\r\n\r\nconst createZip = async ({ files, bundledFiles }) => {\r\n  const zip = new JSZip()\r\n\r\n  const addFile = ([filename, payload]) => {\r\n    const { data, base64 } = readDataURI(payload.content)\r\n    zip.file(filename, data, { base64 })\r\n  }\r\n\r\n  // Include study-specific static files\r\n  Object.entries(files).forEach(addFile)\r\n\r\n  await Promise.all(\r\n    // Add library static files to bundle\r\n    Object.entries(bundledFiles).map(\r\n      ([path, data]) =>\r\n        fetch(`${ process.env.PUBLIC_URL }/api/_defaultStatic/${ data.source }`)\r\n          .then(data => zip.file(path, data.blob()))\r\n    )\r\n  )\r\n\r\n  // Generate zip file and return blob\r\n  return await zip.generateAsync({ type: 'blob' })\r\n}\r\n\r\nexport const downloadZip = async (data, filename='study_export.zip') => {\r\n  // Generate blob and save file\r\n  try {\r\n    const blob = await createZip(data, filename)\r\n    return saveAs(blob, filename)\r\n  } catch (error) {\r\n    Sentry.withScope((scope) => {\r\n      scope.setTag('scope', 'export')\r\n      Sentry.captureException(error)\r\n    })\r\n    alert(`Couldn't export bundle: ${ error }`)\r\n  }\r\n}\r\n\r\nexport const createStaticBlob = (state,\r\n  stateModifier=state => state,\r\n  options\r\n) =>\r\n  createZip(\r\n    assemble(state, stateModifier, options),\r\n  )\r\n\r\n// Bundle all files into a zip archive\r\nexport const downloadStatic = (state,\r\n  stateModifier=state => state,\r\n  options\r\n) =>\r\n  downloadZip(\r\n    assemble(state, stateModifier, options),\r\n    makeFilename(state) + '-export.zip'\r\n  )\r\n\r\n","import parseAuthor from 'parse-author'\r\nimport { stripIndent } from 'common-tags'\r\nimport { repeat } from 'lodash'\r\nimport { makeFilename } from '../../filename'\r\nimport assemble from '../../assemble'\r\nimport { downloadZip } from '../index'\r\nimport { makeDataURI } from '../../../util/dataURI'\r\nimport { transform } from 'lodash'\r\n\r\n// Reduce array of authors to 'a, b, and c' format\r\nlet reduceAuthors = (curr, next, i, a) => {\r\n  switch (i) {\r\n    case 0:\r\n      return next\r\n    case a.length - 1:\r\n      if (a.length === 2) {\r\n        return curr + ' and ' + next\r\n      } else {\r\n        return curr + ', and ' + next\r\n      }\r\n    default:\r\n      return curr + ', ' + next\r\n  }\r\n}\r\n\r\nconst makeReadme = (state) => {\r\n  const metadata = state.components.root.metadata\r\n  const credits = metadata.contributors\r\n    ? metadata.contributors\r\n        .split('\\n')\r\n        .map(c => parseAuthor(c))\r\n        .map(c => c.url ? `[${ c.name }](${ c.url })` : `${ c.name }`)\r\n        .reduce(reduceAuthors)\r\n    : 'excellent folks'\r\n\r\n  const data = stripIndent`\r\n    ${ metadata.title || 'Study' }\r\n    ${ repeat('=', metadata.title ? metadata.title.length : 5) }\r\n\r\n    ${ metadata.description ? `\r\n    ${ metadata.description }\r\n\r\n    ----\r\n\r\n    ` : '' }\r\n    Built by ${ credits } with [lab.js](https://lab.js.org)\r\n  `\r\n\r\n  return makeDataURI(data)\r\n}\r\n\r\nconst makeConfig = (state) => {\r\n  const metadata = state.components.root.metadata\r\n\r\n  const data = {\r\n    name: metadata.title,\r\n    exp_id: makeFilename(state),\r\n    url: metadata.repository,\r\n    description: metadata.description,\r\n    contributors: metadata.contributors\r\n      .split('\\n').map(c => c.trim()),\r\n    template: 'lab.js',\r\n    instructions: '',\r\n    time: 5,\r\n  }\r\n\r\n  return makeDataURI(JSON.stringify(data, null, 2))\r\n}\r\n\r\nconst addTransmitPlugin = (state) => {\r\n  // Add data transmission\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    {\r\n      type: 'lab.plugins.Transmit',\r\n      url: '/save',\r\n      encoding: 'form',\r\n      updates: {\r\n        incremental: false,\r\n      },\r\n      callbacks: {\r\n        setup: function() {\r\n          this.headers['X-CSRFToken'] = window.csrf_token\r\n        },\r\n        full: function(response) {\r\n          if (response && response.ok) {\r\n            window.location = '/next'\r\n          }\r\n        }\r\n      },\r\n    },\r\n  ]\r\n\r\n  return state\r\n}\r\n\r\nexport default async (state, { container=true }={}) => {\r\n  const files = assemble(state, addTransmitPlugin) // additionalFiles\r\n\r\n  // Add packaged files\r\n  files.files['readme.md'] = { content: makeReadme(state) }\r\n  files.files['config.json'] = { content: makeConfig(state) }\r\n\r\n  // Move all generated files into a folder\r\n  const prefix = container ? 'experiments/' : ''\r\n  const expId = makeFilename(state)\r\n  const moveFile = (result, file, path) => {\r\n    result[`${ prefix }${ expId }/${ path }`] = file\r\n    return result\r\n  }\r\n\r\n  files.bundledFiles = transform(files.bundledFiles, moveFile, {})\r\n  files.files = transform(files.files, moveFile, {})\r\n\r\n  if (container) {\r\n    // Fetch most recent version of the CircleCI config from\r\n    // the expfactory/labjs integration\r\n    const request = await fetch(\r\n      'https://raw.githubusercontent.com/expfactory/builder-labjs/master/' +\r\n      '.circleci/config.yml'\r\n    )\r\n\r\n    files.files['.circleci/config.yml'] = {\r\n      content: makeDataURI(await request.text())\r\n    }\r\n  }\r\n\r\n  downloadZip(files)\r\n}\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { ButtonGroup, Button } from 'reactstrap'\r\nimport Confirm from '../Confirm'\r\n\r\nimport downloadStaticExpFactory\r\n  from '../../../../logic/io/export/modifiers/expfactory'\r\n\r\nconst ExportExpFactory = ({ closeHandler }) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <Confirm\r\n      title={ <span>Export to <strong>the Experiment Factory</strong></span> }\r\n      closeHandler={ closeHandler }\r\n    >\r\n      <p>\r\n        <strong>The Experiment Factory </strong> creates reproducible, reusable, and modular study containers. <span className=\"text-muted\">If you're getting started, you'll want to start with a new container; alternatively, you can export the study by itself.</span>\r\n      </p>\r\n      <ButtonGroup vertical size=\"l\" className=\"w-100\">\r\n        <Button\r\n          block color=\"primary\" className=\"p-3\"\r\n          onClick={ async () => {\r\n            await downloadStaticExpFactory(store.getState())\r\n            closeHandler()\r\n          } }\r\n        >\r\n          Export study in a <strong>new container</strong>\r\n        </Button>\r\n        <Button\r\n          block outline color=\"secondary\" className=\"p-3\"\r\n          onClick={ async () => {\r\n            await downloadStaticExpFactory(\r\n              store.getState(), { container: false }\r\n            )\r\n            closeHandler()\r\n          } }\r\n        >\r\n          Export study for use in an <strong>existing container</strong>\r\n        </Button>\r\n      </ButtonGroup>\r\n    </Confirm>\r\n  )\r\n}\r\n\r\nexport default ExportExpFactory\r\n","import { createStaticBlob } from '../index'\r\nimport { makeDataURI, readDataURI } from '../../../../logic/util/dataURI'\r\nimport { stripIndent } from 'common-tags'\r\n\r\nconst form = `\r\n  <form name=\"labjs-data\" netlify netlify-honeypot=\"bot-field\" hidden>\r\n    <input name=\"bot-field\">\r\n    <input type=\"text\" name=\"dataRaw\" />\r\n    <input type=\"file\" name=\"dataFile\" />\r\n  </form>\\n</body>`\r\n\r\nconst addSubmissionForm = (state) => {\r\n  // Extract content of study's HTML file\r\n  const { data: index, mime } = readDataURI(\r\n    state.files.files['index.html'].content\r\n  )\r\n\r\n  // Add form to HTML file and replace file content\r\n  state.files.files['index.html'].content = makeDataURI(\r\n    index.replace('</body>', form),\r\n    mime\r\n  )\r\n\r\n  // Add submission plugin to root component\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    { type: 'lab.plugins.Submit' },\r\n  ]\r\n\r\n  return state\r\n}\r\n\r\nconst makeRedirects = ({ site }) => makeDataURI(stripIndent`\r\n  # Enforce HTTPS for subdomain url\r\n  http://${ site }   https://${ site }          301\r\n  http://${ site }/* https://${ site }/:splat   301\r\n\r\n  # Rewrite paths to create multi-site entries\r\n  /e/:entry   /e/:entry/index.html              302\r\n  /e/:entry/* /:splat                           200\r\n`)\r\n\r\nexport default (state, options) =>\r\n  createStaticBlob(\r\n    state,\r\n    addSubmissionForm,\r\n    {\r\n      '_redirects': { content: makeRedirects(options) }\r\n    },\r\n  )\r\n","import React, { Component, createRef, forwardRef } from 'react'\r\nimport { ReactReduxContext } from 'react-redux'\r\nimport { findDOMNode } from 'react-dom'\r\n\r\nimport { Formik, Field, Form } from 'formik'\r\nimport { Input } from '../../../Form'\r\n\r\nimport { FormGroup, Label, FormText,\r\n  Nav, NavItem,  NavLink } from 'reactstrap'\r\nimport Icon from '../../../Icon'\r\n\r\nimport exportStaticNetlify from '../../../../logic/io/export/modifiers/netlify'\r\n\r\n// Validation\r\nconst validateApiKey = value => {\r\n  if (!value) {\r\n    return 'We\\'ll need a API key to upload the study'\r\n  } else if (value.length !== 64) {\r\n    return 'The keys are typically 64 characters long'\r\n  }\r\n}\r\n\r\nconst NetlifyForm = forwardRef(({ onSubmit }, ref) =>\r\n  <Formik\r\n    initialValues={{ site: '', apiKey: '' }}\r\n    onSubmit={ onSubmit }\r\n  >\r\n    {({ errors, touched }) => (\r\n      <Form ref={ ref }>\r\n        <FormGroup>\r\n          <Label for=\"site\">\r\n            Study domain/site{' '}\r\n            <small className=\"text-muted\">(optional)</small>\r\n          </Label>\r\n          <Field\r\n            name=\"site\" id=\"site\"\r\n            placeholder=\"random-domain-name.netlify.com\"\r\n            component={ Input }\r\n            className=\"text-monospace\"\r\n          />\r\n          <FormText color=\"muted\">\r\n            If you've previously created <a href=\"https://app.netlify.com/account/sites\" target=\"_blank\" rel=\"noopener noreferrer\">a site for your study</a>, you can enter the domain here. Leave empty to create a new site with a preliminary domain name.\r\n          </FormText>\r\n        </FormGroup>\r\n        <FormGroup>\r\n          <Label for=\"apiKey\">API access code</Label>\r\n          <Field\r\n            name=\"apiKey\" id=\"apiKey\"\r\n            component={ Input }\r\n            className=\"text-monospace\"\r\n            validate={ validateApiKey }\r\n          />\r\n          { errors.apiKey && touched.apiKey &&\r\n            <FormText color=\"danger\">{ errors.apiKey }</FormText> }\r\n          <FormText color=\"muted\">\r\n            You'll need to <a href=\"https://app.netlify.com/account/applications\"  target=\"_blank\" rel=\"noopener noreferrer\">create an API token</a> or enter an existing one. We don't save or share this information, so make sure to jot it down!\r\n          </FormText>\r\n        </FormGroup>\r\n      </Form>\r\n    )}\r\n  </Formik>\r\n)\r\n\r\nclass NetlifyWidget extends Component {\r\n  static contextType = ReactReduxContext\r\n\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      widgetState: 'form'\r\n    }\r\n    this.formRef = createRef()\r\n  }\r\n\r\n  triggerSubmit() {\r\n    findDOMNode(this.formRef.current).requestSubmit()\r\n  }\r\n\r\n  async send(data) {\r\n    this.setState({ widgetState: 'submitting' })\r\n\r\n    // If a site has been specified, deploy to it,\r\n    // otherwise create a new site with a random URL\r\n    const url = data.site\r\n      ? `https://api.netlify.com/api/v1/sites/${ data.site }/deploys`\r\n      : 'https://api.netlify.com/api/v1/sites'\r\n\r\n    const studyBlob = await exportStaticNetlify(\r\n      this.context.store.getState(),\r\n      { site: data.site },\r\n    )\r\n\r\n    try {\r\n      const r = await fetch(url, {\r\n        method: 'post',\r\n        headers: {\r\n          'Content-Type': 'application/zip',\r\n          'Authorization': `Bearer ${ data.apiKey }`,\r\n        },\r\n        body: studyBlob,\r\n      })\r\n\r\n      // Transmission succeeded\r\n      if (r.ok) {\r\n        // Response 2xx\r\n        const d = await r.json()\r\n\r\n        this.setState({\r\n          widgetState: 'done',\r\n          site_url: d.ssl_url\r\n            || `https://${ d.subdomain }.netlify.com/`,\r\n          admin_url: d.admin_url\r\n            || `https://app.netlify.com/sites/${ d.subdomain }/`,\r\n          statusCode: r.status,\r\n          statusText: r.statusText,\r\n        })\r\n      } else {\r\n        // Non-2xx response\r\n        this.setState({\r\n          widgetState: 'error',\r\n          statusCode: r.status,\r\n          statusText: r.statusText,\r\n        })\r\n      }\r\n    } catch (error) {\r\n      this.setState({\r\n        widgetState: 'error_transmission',\r\n        statusCode: undefined,\r\n        statusText: undefined,\r\n      })\r\n      console.log('transmission error', error)\r\n    }\r\n  }\r\n\r\n  render() {\r\n    switch(this.state.widgetState) {\r\n      case 'submitting':\r\n        return <div className=\"text-center\">\r\n          <Icon icon=\"spinner-third\" className=\"fa-spin\" />\r\n        </div>\r\n      case 'done':\r\n        return <>\r\n          <p>\r\n            <strong className=\"text-success\">Uploaded study.</strong> The final deployment is now in the hands of Netlify, and may take a few moments to complete.\r\n          </p>\r\n          <Nav vertical>\r\n            <NavItem>\r\n              <NavLink\r\n                href={ this.state.site_url }\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n              >\r\n                Open study\r\n              </NavLink>\r\n            </NavItem>\r\n            <NavItem>\r\n              <NavLink\r\n                href={ this.state.admin_url }\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n              >\r\n                Site settings\r\n              </NavLink>\r\n            </NavItem>\r\n          </Nav>\r\n        </>\r\n      case 'error':\r\n        return <p>\r\n          <strong className=\"text-warning\">Something went wrong.</strong> We got an error <code>{ this.state.statusCode }</code>, which means { this.state.statusText }. Please take a look at your <a href=\"https://app.netlify.com\" target=\"_blank\" rel=\"noopener noreferrer\">Dashboard</a> for more detailed information.\r\n        </p>\r\n      case 'error_transmission':\r\n        return <p>\r\n          <strong className=\"text-danger\">Something went wrong.</strong> We can't tell exactly what happened, but the transfer of the study to Netlify was cancelled. Could you check your login credentials? Otherwise please take a look at your <a href=\"https://app.netlify.com\"  target=\"_blank\" rel=\"noopener noreferrer\">Dashboard</a> for more detailed information.\r\n        </p>\r\n      default:\r\n        return <NetlifyForm\r\n          ref={ this.formRef }\r\n          onSubmit={ data => this.send(data) }\r\n        />\r\n    }\r\n  }\r\n}\r\n\r\nexport default NetlifyWidget\r\n","import React from 'react'\r\nimport Confirm from '../Confirm'\r\n\r\nimport NetlifyWidget from './widget'\r\n\r\nconst ExportNetlify = ({ closeHandler }) => {\r\n  // Add variable to keep track of the Open Lab widget\r\n  let widget = React.createRef()\r\n\r\n  return <Confirm\r\n    title={ <span>Upload to Netlify</span> }\r\n    closeLabel=\"Close\"\r\n    closeHandler={ closeHandler }\r\n    confirmLabel=\"Upload\"\r\n    confirmHandler={ () => {\r\n      widget.current.triggerSubmit()\r\n    } }\r\n  >\r\n    <p><strong><a href=\"https://www.netlify.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Netlify</a> will host your study for you and take care of data collection.</strong> Their service is very easy to use, free for basic studies, and inexpensive for large ones.</p>\r\n    <p>To use Netlify, you'll need to <a href=\"https://app.netlify.com/signup\" target=\"_blank\" rel=\"noopener noreferrer\">set up an account</a> with them. Our documentation describes in more detail <a href=\"http://labjs.readthedocs.io/en/latest/learn/deploy/4-netlify.html\" target=\"_blank\" rel=\"noopener noreferrer\">how to do that</a>.</p>\r\n    <hr />\r\n    <NetlifyWidget ref={ widget } />\r\n  </Confirm>\r\n}\r\n\r\nexport default ExportNetlify\r\n","import React, { Component } from 'react'\r\nimport { ReactReduxContext } from 'react-redux'\r\n\r\nimport Icon from '../../../Icon'\r\n\r\nimport { stateToJSON } from '../../../../logic/io/save'\r\n\r\nclass OpenLabWidget extends Component {\r\n  static contextType = ReactReduxContext\r\n\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      widgetState: 'dormant'\r\n    }\r\n  }\r\n\r\n  async submit() {\r\n    this.setState({ widgetState: 'submitting' })\r\n\r\n    const state = this.context.store.getState()\r\n    const stateJSON = stateToJSON(state)\r\n\r\n    const data = new window.FormData()\r\n    data.append(\r\n      'script',\r\n      new Blob(\r\n        [ stateJSON ],\r\n        { type: 'application/json;charset=utf-8' }\r\n      ),\r\n      'labjs-study.json'\r\n    )\r\n    data.append('name',\r\n      state.components['root'].metadata.title || 'Unnamed study')\r\n    data.append('description',\r\n      state.components['root'].metadata.description)\r\n\r\n    try {\r\n      // Send study to Open Lab\r\n      const r = await fetch('https://open-lab.online/tests/labjs', {\r\n        method: 'POST',\r\n        body: data,\r\n      })\r\n\r\n      if (r.ok) {\r\n        this.setState({\r\n          widgetState: 'done',\r\n          site_url: r.url,\r\n          statusCode: r.status,\r\n          statusText: r.statusText,\r\n        })\r\n      } else {\r\n        // Non-2xx response\r\n        this.setState({\r\n          widgetState: 'error',\r\n          statusCode: r.status,\r\n          statusText: r.statusText,\r\n        })\r\n      }\r\n    } catch (error) {\r\n      this.setState({\r\n        widgetState: 'error_transmission',\r\n        statusCode: undefined,\r\n        statusText: undefined,\r\n      })\r\n      console.log('transmission error', error)\r\n    }\r\n  }\r\n\r\n  render() {\r\n    switch(this.state.widgetState) {\r\n      case 'submitting':\r\n        return <div className=\"text-center\">\r\n          <Icon icon=\"spinner-third\" className=\"fa-spin\" />\r\n        </div>\r\n      case 'done':\r\n        return <>\r\n          <p>\r\n            <strong className=\"text-success\">Uploaded study.</strong> Please finalize the transfer by following the link below.\r\n          </p>\r\n          <a\r\n            className=\"btn btn-outline-primary btn-lg btn-block\"\r\n            href={ this.state.site_url }\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            Manage study on Open Lab\r\n          </a>\r\n        </>\r\n      case 'error':\r\n        return <p>\r\n          <strong className=\"text-warning\">Something went wrong during transmission.</strong> Open Lab sent us an error <code>{ this.state.statusCode }</code>, which means { this.state.statusText }.\r\n        </p>\r\n      case 'error_transmission':\r\n        return <p>\r\n          <strong className=\"text-danger\">Something went wrong.</strong> We can't tell exactly what happened, but the transfer of the study to Open Lab was cancelled. Could you check your connection?\r\n        </p>\r\n      default:\r\n        return null\r\n    }\r\n  }\r\n}\r\n\r\nexport default OpenLabWidget\r\n","import React from 'react'\r\nimport Confirm from '../Confirm'\r\n\r\nimport OpenLabWidget from './widget'\r\n\r\nconst ExportOpenLab = ({ closeHandler }) => {\r\n  // Add variable to keep track of the Open Lab widget\r\n  let widget = React.createRef()\r\n\r\n  return <Confirm\r\n    title={ <span>Upload to Open Lab</span> }\r\n    closeLabel=\"Close\"\r\n    closeHandler={ closeHandler }\r\n    confirmLabel=\"Upload\"\r\n    confirmHandler={ () => {\r\n      widget.current.submit()\r\n    } }\r\n  >\r\n    <p><strong><a href=\"https://www.open-lab.online/\" target=\"_blank\" rel=\"noopener noreferrer\">Open Lab</a></strong> takes care of running your experiment and collecting, storing and managing data. It supports collaboration in projects, customization of task parameters and invitation of participants. The basic version of the application is available for free. </p>\r\n    <OpenLabWidget\r\n      ref={ widget }\r\n    />\r\n  </Confirm>\r\n}\r\n\r\nexport default ExportOpenLab\r\n","import { makeDataURI } from '../../../util/dataURI'\r\nimport { downloadStatic } from '../index'\r\n\r\nconst backend_php = `<?php\r\n\r\n// Define path for the database file\r\ndefine('DB_PATH', getcwd() . '/data/data.sqlite');\r\n\r\n// Establish a database connection\r\n$db = new PDO('sqlite:' . DB_PATH);\r\n\r\n// Throw exceptions when errors occur\r\n$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n// Create table, if necessary\r\n$db->exec(\r\n  'CREATE TABLE IF NOT EXISTS labjs (\r\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n    session TEXT,\r\n    timestamp TEXT,\r\n    url TEXT,\r\n    metadata TEXT,\r\n    data TEXT\r\n  )'\r\n);\r\n\r\n// Establish or continue session\r\nsession_start([\r\n  'cookie_lifetime' => 86400, // 24 hours\r\n  'cookie_httponly' => true,  // Not accessible via JavaScript\r\n  'read_and_close'  => true,  // Extract information and remove lock\r\n]);\r\n\r\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\r\n  // Decode transmitted data\r\n  $data = json_decode(file_get_contents('php://input'), true);\r\n\r\n  // (Cursory) validity check\r\n  if (is_array($data)) {\r\n    // Setup prepared statement\r\n    $insert =\r\n      'INSERT INTO labjs (session, timestamp, url, metadata, data)\r\n       VALUES (:session, :timestamp, :url, :metadata, :data)';\r\n    $stmt = $db->prepare($insert);\r\n\r\n    // Insert data\r\n    $stmt->execute(array(\r\n      ':session' => session_id() ?: 'unknown',\r\n      ':timestamp' => date('c'),\r\n      ':url' => isset($data['url']) ? $data['url'] : 'none',\r\n      ':metadata' => isset($data['metadata']) ? json_encode($data['metadata']) : 'none',\r\n      ':data' => isset($data['data']) ? json_encode($data['data']) : 'none'\r\n    ));\r\n\r\n    http_response_code(200);\r\n  } else {\r\n    http_response_code(400);\r\n  }\r\n\r\n} else {\r\n  http_response_code(405);\r\n}\r\n\r\n?>`\r\n\r\nconst htaccess = `Deny from all`\r\n\r\nconst phpBackendStatic = {\r\n  'backend.php': {\r\n    content: makeDataURI(backend_php, 'application/php'),\r\n  },\r\n  'data/.htaccess': {\r\n    content: makeDataURI(htaccess, 'text/plain'),\r\n  },\r\n}\r\n\r\nconst addTransmitPlugin = (state) => {\r\n  // Add transmit plugin to root component\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    { type: 'lab.plugins.Transmit', url: 'backend.php' },\r\n  ]\r\n\r\n  return state\r\n}\r\n\r\nexport default state =>\r\n  downloadStatic(\r\n    state, addTransmitPlugin,\r\n    { additionalFiles: phpBackendStatic }\r\n  )\r\n","import { downloadStatic } from '../index'\r\n\r\nconst addPostMessagePlugin = (state) => {\r\n  // Add postMessage plugin to root component\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    { type: 'lab.plugins.PostMessage' },\r\n  ]\r\n\r\n  return state\r\n}\r\n\r\nexport default state =>\r\n  downloadStatic(state, addPostMessagePlugin)\r\n","import React, { useEffect, useState } from 'react'\r\n\r\nimport Confirm from '../Confirm'\r\n\r\nconst ExternalContent = ({ url }) => {\r\n  const [state, setState] = useState({ state: 'empty', content: '' })\r\n\r\n  const load = async (url) => {\r\n    try {\r\n      const response = await fetch(url)\r\n      const content = await response.text()\r\n      setState({ state: 'loaded', content })\r\n    } catch (error) {\r\n      setState({ state: 'error' })\r\n    }\r\n  }\r\n  useEffect(() => { load(url) }, [url])\r\n\r\n  return <div dangerouslySetInnerHTML={{ __html: state.content }}></div>\r\n}\r\n\r\n\r\nconst Legal = ({ closeHandler }) =>\r\n  <Confirm\r\n    title={ <span>Legal</span> }\r\n    closeLabel=\"Done\"\r\n    closeHandler={ closeHandler }\r\n  >\r\n    <ExternalContent url=\"/content/legal.html\" />\r\n  </Confirm>\r\n\r\nexport default Legal\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport GenericModal from './index'\r\n\r\n// Individual, task-specific modal content\r\nimport AddComponentModal from './components/AddComponent'\r\nimport OptionsModal from './components/Options'\r\nimport SystemCompatibilityModal from './components/SystemCompatibility'\r\nimport ExportExpFactoryModal from './components/ExportExpFactory'\r\nimport ExportNetlifyModal from './components/ExportNetlify'\r\nimport ExportOpenLabModal from './components/ExportOpenLab'\r\nimport ExportPHPModal from './components/ExportPHP'\r\nimport ExportPostMessageModal from './components/ExportPostMessage'\r\nimport LegalModal from './components/Legal'\r\n\r\nconst MODAL_COMPONENTS = {\r\n  'ADD_COMPONENT': AddComponentModal,\r\n  'OPTIONS': OptionsModal,\r\n  'SYSTEM_COMPATIBILITY': SystemCompatibilityModal,\r\n  'EXPORT_EXPFACTORY': ExportExpFactoryModal,\r\n  'EXPORT_NETLIFY': ExportNetlifyModal,\r\n  'EXPORT_OPENLAB': ExportOpenLabModal,\r\n  'EXPORT_PHP': ExportPHPModal,\r\n  'EXPORT_PM': ExportPostMessageModal,\r\n  'LEGAL': LegalModal,\r\n}\r\n\r\nconst MODAL_SIZES = {\r\n  'OPTIONS': 'xl'\r\n}\r\n\r\n// TODO: See if the Modal component from react-modal\r\n// can be replaced by its counterpart from reactstrap\r\nconst CustomModal = ({ modalType, modalProps, hideModal }) => {\r\n  const SpecificModal = MODAL_COMPONENTS[modalType]\r\n  return (\r\n    <GenericModal\r\n      isOpen={ modalType !== null }\r\n      onRequestClose={ hideModal }\r\n      modalProps={{\r\n        size: MODAL_SIZES[modalType] || 'md',\r\n        ...modalProps\r\n      }}\r\n    >\r\n      {\r\n        SpecificModal !== undefined\r\n          ? <SpecificModal\r\n              { ...modalProps }\r\n              closeHandler={ hideModal }\r\n            />\r\n          : ''\r\n      }\r\n    </GenericModal>\r\n  )\r\n}\r\n\r\n// TODO: This is a duplicated action creator, pull out of component\r\nconst mapStateToProps = (state) => state.modal\r\nconst mapDispatchToProps = {\r\n  hideModal: () => ({\r\n    type: 'HIDE_MODAL',\r\n  })\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(CustomModal)\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { Alert } from 'reactstrap'\r\nimport Confirm from '../Confirm'\r\n\r\nimport downloadStaticPHP from '../../../../logic/io/export/modifiers/php'\r\n\r\nconst ExportPHP = ({ closeHandler }) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <Confirm\r\n      title={ <span>Export with <code>PHP</code> backend</span> }\r\n      confirmLabel=\"Continue to download\"\r\n      confirmHandler={ () => {\r\n        downloadStaticPHP(store.getState())\r\n        closeHandler()\r\n      } }\r\n      closeHandler={ closeHandler }\r\n    >\r\n      <p><strong>You are about to download the study with a <code>PHP</code> backend.</strong> It contains code that will run on your server and collect the data as it accumulates.</p>\r\n      <Alert color=\"danger\">\r\n        <strong>Though we do our best, we cannot take responsibility for code the runs on your server.</strong> Please make sure to <a href=\"http://labjs.readthedocs.io/en/latest/learn/deploy/\" className=\"alert-link font-weight-bold\" target=\"_blank\" rel=\"noopener noreferrer\">consult the documentation on how to set up data collection correctly</a>, and ask your friendly neighborhood IT staff if you're unsure.\r\n      </Alert>\r\n    </Confirm>\r\n  )\r\n}\r\n\r\nexport default ExportPHP\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport Confirm from '../Confirm'\r\nimport downloadStaticPM from '../../../../logic/io/export/modifiers/postMessage'\r\n\r\nconst ExportPM = ({ closeHandler }) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <Confirm\r\n      title={ <span>Export for <strong>generic survey software</strong></span> }\r\n      confirmLabel=\"Continue to download\"\r\n      confirmHandler={ () => {\r\n        downloadStaticPM(store.getState())\r\n        closeHandler()\r\n      } }\r\n      closeHandler={ closeHandler }\r\n    >\r\n      <p><strong>The copy you're about to download is set up to work with most third-party survey tools</strong> (e.g. <a href=\"https://www.limesurvey.org/\" target=\"_blank\" rel=\"noopener noreferrer\">LimeSurvey</a>, <a href=\"https://qualtrics.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Qualtrics</a> or <a href=\"https://www.soscisurvey.com/\" target=\"_blank\" rel=\"noopener noreferrer\">SoSci</a>). This is useful if you're planning to run the study you're building as part of a survey or a larger questionnaire.</p>\r\n      <p>Please check out our documentation to <a href=\"https://labjs.readthedocs.io/en/latest/learn/deploy/3-third-party.html\" target=\"_blank\" rel=\"noopener noreferrer\">find out how to use <code>lab.js</code> in combination with third-party software</a>.</p>\r\n    </Confirm>\r\n  )\r\n}\r\n\r\nexport default ExportPM\r\n","// Not using JSX, we don't need to import React proper\r\nimport { Component } from 'react'\r\nimport { ReactReduxContext } from 'react-redux'\r\n\r\nimport { stateToDownload } from '../../logic/io/save'\r\n\r\n// Commands are associated with the command key on macs,\r\n// and with CTRL elsewhere\r\nconst commandKey = navigator.platform.startsWith('Mac')\r\n  ? 'metaKey'\r\n  : 'ctrlKey'\r\n\r\nclass Shortcuts extends Component {\r\n  static contextType = ReactReduxContext\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.handleKeyDown = this.handleKeyDown.bind(this)\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if(e[commandKey] && e.key === 's') {\r\n      e.preventDefault()\r\n\r\n      // Save study\r\n      if (!e.repeat) {\r\n        stateToDownload(\r\n          this.context.store.getState(), { removeInternals: e.shiftKey }\r\n        )\r\n      }\r\n    } else if (e[commandKey] && e.key === 'p') {\r\n      window.dispatchEvent(new Event('preview:preempt'))\r\n      e.preventDefault()\r\n      window.dispatchEvent(new Event('preview:show'))\r\n    } else if (e.key === 'Backspace' && e.target === document.body) {\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('keydown', this.handleKeyDown)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('keydown', this.handleKeyDown)\r\n  }\r\n\r\n  render() {\r\n    return null\r\n  }\r\n}\r\n\r\nexport default Shortcuts\r\n","import React from 'react'\r\n\r\n// Create context for system state\r\nexport const SystemContext = React.createContext({\r\n  previewState: undefined\r\n})\r\n\r\nexport const SystemContextProvider = ({ value, children }) =>\r\n  <SystemContext.Provider value={ value }>\r\n    { children }\r\n  </SystemContext.Provider>\r\n","import * as Sentry from '@sentry/browser'\r\n\r\nimport assemble from '../assemble'\r\nimport { blobFromDataURI } from '../../util/dataURI'\r\nimport { quotaExceededErrors } from '../../util/monitoring'\r\n\r\nconst cacheName = 'labjs-preview'\r\n\r\n// Prepare cache when builder is loaded ----------------------------------------\r\n\r\n// Add default static files to cache directly\r\nconst bundledFiles = [\r\n  'lib/lab.css',\r\n  'lib/lab.dev.js',\r\n  'lib/lab.js',\r\n  'lib/lab.js.map',\r\n  'lib/lab.legacy.js',\r\n  'lib/lab.legacy.js.map',\r\n  'lib/lab.fallback.js',\r\n  'lib/loading.svg',\r\n]\r\n\r\nexport const prePopulateCache = async () => {\r\n  const cache = await caches.open(cacheName)\r\n  await cache.addAll(\r\n    bundledFiles.map(\r\n      path => `${ process.env.PUBLIC_URL }/api/_defaultStatic/${ path }`\r\n    )\r\n  )\r\n}\r\n\r\n// Generate study preview ------------------------------------------------------\r\n\r\n// Drop a single file into cache\r\n// (cache passed as an object)\r\nconst putFile = async (cache, [path, { content, type }], previewPath) =>\r\n  await cache.put(\r\n    new Request(`/api/${ previewPath }/${ path }`),\r\n    new Response(blobFromDataURI(content)),\r\n  )\r\n\r\n// Create link to default static files in preview location\r\nconst linkStatic = async (cache, [path, data], previewPath) => {\r\n  // (load from cache if possible, otherwise fetch anew)\r\n  const response = await cache.match(`/api/_defaultStatic/${ path }`) ??\r\n    await fetch(`/api/_defaultStatic/${ path }`)\r\n\r\n  await cache.put(\r\n    new Request(`/api/${ previewPath }/${ path }`),\r\n    response\r\n  )\r\n}\r\n\r\n// Setup study preview\r\nexport const populateCache = async (state, stateModifier,\r\n  assemblyOptions={}, previewPath='labjs_preview') => {\r\n  const cache = await caches.open(cacheName)\r\n\r\n  // Empty cache, except for copy of library static files\r\n  await cache.keys().then(keylist => Promise.all(\r\n    keylist.map(\r\n      // TODO: Think about filtering using\r\n      // the bundledFiles array above\r\n      key => !key.url.includes('_defaultStatic') ? cache.delete(key) : null\r\n    )\r\n  ))\r\n\r\n  try {\r\n    const study = assemble(state, stateModifier, assemblyOptions)\r\n\r\n    // Place generated study files into the cache\r\n    await Promise.all([\r\n      ...Object.entries(study.files)\r\n        .map(file => putFile(cache, file, previewPath)),\r\n      // Update links to static library files\r\n      ...Object.entries(study.bundledFiles)\r\n        .map(path => linkStatic(cache, path, previewPath)),\r\n      // Copy development library version directly (TODO technical debt)\r\n      linkStatic(cache,\r\n        ['lib/lab.dev.js', { type: 'application/javascript', }],\r\n        previewPath\r\n      ),\r\n    ])\r\n\r\n    console.log('Preview cache updated successfully')\r\n  } catch (e) {\r\n    console.log(`Error during preview cache update: ${ e }`)\r\n    if (quotaExceededErrors.some(message => e.message.includes(message))) {\r\n      // TODO alert user\r\n    } else {\r\n      Sentry.withScope((scope) => {\r\n        scope.setTag('scope', 'preview-cache')\r\n        Sentry.captureException(e)\r\n      })\r\n      throw e\r\n    }\r\n  }\r\n}\r\n","import { makeFilename } from '../../filename'\r\n\r\nexport const addDebugPlugin = (state) => {\r\n  // Add debug plugin to root component\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    {\r\n      type: 'lab.plugins.Debug',\r\n      filePrefix: `${ makeFilename(state) }-preview`,\r\n    },\r\n  ]\r\n\r\n  return state\r\n}\r\n","import { downloadStatic } from '../index'\r\nimport { makeFilename } from '../../filename'\r\n\r\nexport const addDownloadPlugin = (state) => {\r\n  // Add download plugin to root component\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    {\r\n      type: 'lab.plugins.Download',\r\n      filePrefix: makeFilename(state),\r\n    },\r\n  ]\r\n\r\n  return state\r\n}\r\n\r\nexport default state => downloadStatic(state, addDownloadPlugin)\r\n","export default class Preview {\r\n  constructor(url, stateChangeCallback) {\r\n    this.url = url\r\n    this.stateChangeCallback = stateChangeCallback\r\n\r\n    this.window = null\r\n    window.addEventListener(\r\n      'beforeunload', () => { this.close() }\r\n    )\r\n  }\r\n\r\n  // Open, close, reload, ... the preview window\r\n  open() {\r\n    this.window = window.open(\r\n      `${ process.env.PUBLIC_URL }/api/_defaultStatic/empty.html`,\r\n      'labjs_preview',\r\n      'menubar=no,location=no,resizable=yes,scrollbars=yes,status=no'\r\n    )\r\n    this.window.addEventListener(\r\n      'unload', () => this.checkWindow(), { once: true }\r\n    )\r\n    // Trigger callback\r\n    this.stateChangeCallback('opened')\r\n  }\r\n\r\n  close() {\r\n    if (this.window) {\r\n      this.window.close()\r\n    }\r\n  }\r\n\r\n  reload(url) {\r\n    // Reset window location instead of merely reloading,\r\n    // to make sure that the URL preview is correct.\r\n    if (this.window) {\r\n      this.window.location.href = url || this.url\r\n    }\r\n  }\r\n\r\n  focus() {\r\n    this.window.focus()\r\n  }\r\n\r\n  openOrFocus() {\r\n    if (this.window === null || this.window.closed) {\r\n      this.open()\r\n    } else {\r\n      this.focus()\r\n    }\r\n  }\r\n\r\n  // Check window status\r\n  checkWindow() {\r\n    // This function is run when the unload event\r\n    // on the preview window is caught, to check\r\n    // whether the window was closed or just reloaded\r\n    window.setTimeout(() => {\r\n      // NOTE: There were some bugs coming out of this,\r\n      // specifically with this.window being null and\r\n      // therefore the .closed property not being\r\n      // accessible. This is now fixed by the additional\r\n      // check below, but because the error is not\r\n      // reproducable, the source is not entirely\r\n      // clear -- it could be that the browser sets\r\n      // this.window to null when it is closed, or that\r\n      // the calback is called twice, this.window being\r\n      // null on the second call.\r\n      if (this.window === null || this.window.closed) {\r\n        // Detected closed window, removing reference\r\n        this.window = null\r\n        this.stateChangeCallback('closed')\r\n      } else {\r\n        // Window is still open, renew unload listener\r\n        this.window.addEventListener(\r\n          'unload', () => this.checkWindow(), { once: true }\r\n        )\r\n      }\r\n    }, 25)\r\n  }\r\n\r\n}\r\n","import React, { Component } from 'react'\r\nimport { ReactReduxContext } from 'react-redux'\r\n\r\nimport { Button } from 'reactstrap'\r\nimport * as Sentry from '@sentry/browser'\r\n\r\nimport Icon from '../../Icon'\r\nimport { SystemContext } from '../../System'\r\n\r\nimport { populateCache } from '../../../logic/io/preview'\r\nimport { addDebugPlugin } from '../../../logic/io/export/modifiers/preview'\r\nimport { addDownloadPlugin } from '../../../logic/io/export/modifiers/local'\r\nimport PreviewWindow from '../../../logic/io/preview/PreviewWindow'\r\n\r\nexport default class PreviewButton extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      windowState: 'closed',\r\n    }\r\n\r\n    // A PreviewWindow object keeps track\r\n    // of the window state, and provides a\r\n    // callback for status updates\r\n    this.previewWindow = new PreviewWindow(\r\n      // TODO: When we enable multiple\r\n      // parallel instances, change labjs_preview\r\n      // with a variable instance identifier\r\n      `${ process.env.PUBLIC_URL }/api/labjs_preview/index.html`,\r\n      windowState => this.setState({ windowState })\r\n    )\r\n\r\n    // Create reference to the actual button element\r\n    this.button = React.createRef()\r\n\r\n    this.openPreview = this.openPreview.bind(this)\r\n    this.simulateClick = this.simulateClick.bind(this)\r\n  }\r\n\r\n  // NOTE: This is a fairly indirect way of opening the preview,\r\n  // which is used to react to keyboard shortcuts. The click\r\n  // simulation is necessary to be able to use the store link,\r\n  // which is being passed through the react context. In the future,\r\n  // the entire PreviewButton component could subscribe to the store,\r\n  // making it available throughout this code, and enabling direct\r\n  // access to the openPreview method.\r\n  componentDidMount() {\r\n    window.addEventListener('preview:show', this.simulateClick)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('preview:show', this.simulateClick)\r\n  }\r\n\r\n  simulateClick() {\r\n    this.button.current.onClick()\r\n  }\r\n\r\n  async openPreview(store) {\r\n    this.previewWindow.openOrFocus()\r\n\r\n    try {\r\n      await populateCache(\r\n        store.getState(),\r\n        state => addDownloadPlugin(addDebugPlugin(state)),\r\n        { headerOptions: { dev: true }}, // load development build for preview\r\n      )\r\n\r\n      // Reload page to provided URL\r\n      // as soon as the preview study is complete.\r\n      this.previewWindow.reload()\r\n    } catch (error) {\r\n      this.previewWindow.close()\r\n      if (error.name === 'QuotaExceededError') {\r\n        alert(\r\n          \"Sorry, we couldn't generate the preview because \" +\r\n          \"the browser wouldn't allow us to use storage space. \" +\r\n          \"Could you check whether there's room on your hard drive?\"\r\n        )\r\n      } else {\r\n        console.log(`Received error while generating preview: ${ error }`)\r\n        Sentry.withScope((scope) => {\r\n          scope.setTag('scope', 'preview')\r\n          Sentry.captureException(error)\r\n        })\r\n        alert(\r\n          'Sorry, an error occured while we were trying ' +\r\n          `to put together the study preview: ${ error }`\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { windowState } = this.state\r\n    return (\r\n      <SystemContext.Consumer>\r\n        {({ previewActive }) =>\r\n          <ReactReduxContext.Consumer>\r\n            {({ store }) =>\r\n              <Button\r\n                color=\"primary\"\r\n                ref={ this.button }\r\n                onClick={ () => this.openPreview(store) }\r\n                onMouseEnter={ () => {\r\n                  // Prepare potential preview\r\n                  if (previewActive) {\r\n                    const event = new Event('preview:preempt')\r\n                    window.dispatchEvent(event)\r\n                  }\r\n                }}\r\n                disabled={ !previewActive }\r\n              >\r\n                <Icon\r\n                  icon={ windowState === 'closed' ? 'play' : 'sync-alt' }\r\n                  weight=\"s\"\r\n                />\r\n              </Button>\r\n            }\r\n          </ReactReduxContext.Consumer>\r\n        }\r\n      </SystemContext.Consumer>\r\n    )\r\n  }\r\n}\r\n","import { makeFilename } from '../../filename'\r\nimport assemble from '../../assemble'\r\nimport { downloadZip } from '../index'\r\nimport { makeDataURI, updateDataURI } from '../../../util/dataURI'\r\nimport { transform } from 'lodash'\r\nimport { stripIndent } from 'common-tags'\r\nimport uuid from 'uuid4'\r\n\r\nconst makeConfig = (state) => {\r\n  const metadata = state.components.root.metadata\r\n  const filename = makeFilename(state)\r\n\r\n  const data = {\r\n    version: '3',\r\n    data: {\r\n      uuid: uuid(),\r\n      title: metadata.title || 'Unnamed study',\r\n      description: metadata.description || '',\r\n      groupStudy: false,\r\n      dirName: filename,\r\n      comments: '',\r\n      jsonData: null,\r\n      componentList: [\r\n        {\r\n          \"uuid\": uuid(),\r\n          \"title\": metadata.title || 'Unamed study',\r\n          \"htmlFilePath\": \"index.html\",\r\n          \"reloadable\": true,\r\n          \"active\": true,\r\n          \"comments\": \"\",\r\n          \"jsonData\": null\r\n        }\r\n      ],\r\n      batchList: [\r\n        {\r\n          \"uuid\": uuid(),\r\n          \"title\": \"Default\",\r\n          \"active\": true,\r\n          \"maxActiveMembers\": null,\r\n          \"maxTotalMembers\": null,\r\n          \"maxTotalWorkers\": null,\r\n          \"allowedWorkerTypes\": null,\r\n          \"comments\": null,\r\n          \"jsonData\": null\r\n        }\r\n      ]\r\n    },\r\n  }\r\n\r\n  return makeDataURI(JSON.stringify(data, null, 2))\r\n}\r\n\r\nconst updateIndex = (source, expId) => {\r\n  // Include JATOS helper script\r\n  source = source.replace(\r\n    // eslint-disable-next-line no-useless-escape\r\n    /^(\\s*)<script src=\"[\\d\\w\\/\\.]+\" data-labjs-script=\"library\"><\\/script>/mg,\r\n    '$&\\n' +\r\n    '$1<script src=\"/assets/javascripts/jatos.js\"></script>',\r\n  )\r\n\r\n  // Rewrite paths\r\n  // (TODO: There is probably a better way to do this,\r\n  // maybe replacing all local src and href paths in the head)\r\n  source = source.replace(\r\n    /lib\\/lab/g,\r\n    `/study_assets/${ expId }/lib/lab`\r\n  )\r\n\r\n  source = source.replace(\r\n    'script.js',\r\n    `/study_assets/${ expId }/script.js`\r\n  )\r\n\r\n  source = source.replace(\r\n    'style.css',\r\n    `/study_assets/${ expId }/style.css`\r\n  )\r\n\r\n  return source\r\n}\r\n\r\nconst updateScript = (source) =>\r\n  source.replace(\r\n    'study.run()',\r\n    'jatos.onLoad(() => study.run())'\r\n  )\r\n\r\nconst addJatosIntegration = (state) => {\r\n  // Add logic for saving data\r\n  state.components.root.messageHandlers =\r\n    (state.components.root.messageHandlers || { rows: [] })\r\n\r\n  // TODO: This is probably not the most elegant way to\r\n  // achieve integration -- possibly a plugin would be nicer?\r\n  state.components.root.messageHandlers.push([{\r\n    title: 'JATOS integration',\r\n    message: 'epilogue',\r\n    code: stripIndent`\r\n      var resultJson = study.options.datastore.exportJson();\r\n      jatos.submitResultData(resultJson, jatos.startNextComponent);\r\n    `\r\n  }])\r\n\r\n  return state\r\n}\r\n\r\nexport default (state) => {\r\n  // Generate files\r\n  const files = assemble(state, addJatosIntegration)\r\n  const expId = makeFilename(state)\r\n\r\n  // Add changes to index.html and script\r\n  files.files['index.html'].content = updateDataURI(\r\n    files.files['index.html'].content,\r\n    updateIndex, expId\r\n  )\r\n  files.files['script.js'].content = updateDataURI(\r\n    files.files['script.js'].content,\r\n    updateScript\r\n  )\r\n\r\n  // Move all generated files into a folder\r\n  const moveFile = (result, file, path) => {\r\n    result[`${ expId }/${ path }`] = file\r\n    return result\r\n  }\r\n\r\n  files.bundledFiles = transform(files.bundledFiles, moveFile, {})\r\n  files.files = transform(files.files, moveFile, {})\r\n\r\n  // Add packaged files\r\n  files.files[`${ expId }.jas`] = { content: makeConfig(state) }\r\n\r\n  downloadZip(files)\r\n}\r\n","import { transform } from 'lodash'\r\n\r\nimport { makeFilename } from '../../filename'\r\nimport assemble from '../../assemble'\r\nimport { downloadZip } from '../index'\r\n\r\nconst addPavloviaPlugin = (state) => {\r\n  // Add postMessage plugin to root component\r\n  state.components.root.plugins = [\r\n    ...state.components.root.plugins,\r\n    { type: 'global.Pavlovia' },\r\n  ]\r\n\r\n  return state\r\n}\r\n\r\nconst headerOptions = {\r\n  beforeHeader: [\r\n    ['comment', { content: 'pavlovia.org dependencies' }],\r\n    ['script', {\r\n      type: 'text/javascript',\r\n      src: 'lib/vendors/jquery-2.2.0.min.js',\r\n    }],\r\n    ['script', {\r\n      type: 'text/javascript',\r\n      src: 'lib/labjs-pavlovia-3.0.0.js',\r\n    }],\r\n  ],\r\n  libraryPath: 'lab.js',\r\n}\r\n\r\nexport default state => {\r\n  const files = assemble(state, addPavloviaPlugin, { headerOptions })\r\n  const fileName = makeFilename(state) + '-pavlovia.zip'\r\n\r\n  // Move library files from /lib to a new path\r\n  // (Pavlovia has reserved the lib path for its own library files)\r\n  const moveFile = (result, file, path) => {\r\n    result[path.replace(/^lib/, headerOptions.libraryPath)] = file\r\n    return result\r\n  }\r\n\r\n  files.bundledFiles = transform(files.bundledFiles, moveFile, {})\r\n\r\n  return downloadZip(files, fileName)\r\n}\r\n","import { saveAs } from 'file-saver'\r\nimport parseAuthor from 'parse-author'\r\n\r\nconst makeCreator = metadata =>\r\n  metadata.contributors\r\n    .split('\\n')\r\n    .map(c => parseAuthor(c))\r\n    .filter(c => c.name && c.name !== '')\r\n    .map(c => ({\r\n      '@type': 'Person',\r\n      ...c, // add whatever data we have\r\n    }))\r\n\r\nconst defaultVariables = [\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'sender',\r\n    'description': 'Name of component or screen in the study that generated the current data row',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'sender_type',\r\n    'description': 'Type of component that generated the current data row',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'sender_id',\r\n    'description': 'Position of component in the study hierarchy',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'timestamp',\r\n    'description': 'Time and date of data storage',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'meta',\r\n    'description': 'Technical browser metadata',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'correct',\r\n    'description': 'Response veracity',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'duration',\r\n    'description': 'Component presentation duration',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'ended_on',\r\n    'description': 'Reason for component end',\r\n    'levels': ['response', 'timeout', 'skipped'],\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'response',\r\n    'description': 'Participant response',\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'time_commit',\r\n    'description': 'Timestamp of data logging',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'time_end',\r\n    'description': 'Frame timestamp at which component presentation ended',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'time_render',\r\n    'description': 'Frame timestamp at which component was rendered',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'time_run',\r\n    'description': 'Timestamp at which component was initialized',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'time_show',\r\n    'description': 'Frame timestamp at which component was shown on screen',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'time_switch',\r\n    'description': 'Frame timestamp at which the next component was shown',\r\n    'unitCode': 'C26',\r\n    'unitText': 'milliseconds',\r\n    'minValue': 0,\r\n  },\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'url',\r\n    'description': 'Page URL from which study was loaded',\r\n  },\r\n]\r\n\r\n/*\r\n  {\r\n    '@type': 'PropertyValue',\r\n    'name': 'Template',\r\n    'description': '',\r\n    'unitCode': '',\r\n    'unitText': '',\r\n    'levels': [],\r\n    'minValue': 0,\r\n    'naValues': [],\r\n  },\r\n*/\r\n\r\nconst makeVariables = state => {\r\n  // Only return predefined set of default variables for now\r\n  return defaultVariables\r\n}\r\n\r\nconst makeMetadata = state => {\r\n  const metadata = state.components['root'].metadata\r\n\r\n  return {\r\n    '@context': 'http://schema.org',\r\n    '@type': 'Dataset',\r\n    'schemaVersion': 'Psych-DS 0.1.0',\r\n    'name': `${ metadata.title || 'Study' } dataset`,\r\n    'description': metadata.description,\r\n    'creator': makeCreator(metadata),\r\n    'variableMeasured': makeVariables(state),\r\n  }\r\n}\r\n\r\nexport const makeSidecar = state =>\r\n  JSON.stringify(\r\n    makeMetadata(state),\r\n    null, 2\r\n  )\r\n\r\nexport const downloadSidecar = state => {\r\n  const payload = new Blob(\r\n    [ makeSidecar(state) ],\r\n    { type: 'application/ld+json;charset=utf-8' }\r\n  )\r\n\r\n  // NOTE: Right now, we use the most generic file name.\r\n  // However, there are multiple plausible alternatives:\r\n  // - `${ makeFilename(state) }_data.json`\r\n  //   (to match individual data files)\r\n  // - `dataset_description-${ makeFilename(state) }.json`\r\n  //   (to retain a link to the specific study)\r\n  const filename = 'dataset_description.json'\r\n  return saveAs(payload, filename)\r\n}\r\n","import React, { useState } from 'react'\r\nimport { useStore } from 'react-redux'\r\n\r\nimport { ButtonDropdown, Button, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap'\r\n\r\nimport Uploader from '../../../Uploader'\r\nimport Icon from '../../../Icon'\r\n\r\nimport { fromJSON } from '../../../../logic/io/load'\r\nimport { stateToDownload } from '../../../../logic/io/save'\r\nimport downloadStaticLocal from '../../../../logic/io/export/modifiers/local'\r\nimport downloadStaticJatos from '../../../../logic/io/export/modifiers/jatos'\r\nimport downloadStaticPavlovia from '../../../../logic/io/export/modifiers/pavlovia'\r\nimport { downloadSidecar as downloadPsychDS\r\n  } from '../../../../logic/metadata/psych-ds'\r\n\r\n// TODO: Refactor dispatch calls to action creators\r\n\r\nconst IOButton = () => {\r\n  const [dropdownOpen, setDropdownOpen] = useState(false)\r\n  const store = useStore()\r\n\r\n  return <ButtonDropdown\r\n    isOpen={ dropdownOpen }\r\n    toggle={ () => setDropdownOpen(!dropdownOpen) }\r\n  >\r\n    <Button id=\"caret\" outline color=\"secondary\"\r\n      onClick={ e => stateToDownload(\r\n        store.getState(), { removeInternals: e.shiftKey }\r\n      ) }\r\n    >\r\n      <Icon icon=\"save\" weight=\"l\" fallbackWeight=\"r\" />\r\n    </Button>\r\n    <DropdownToggle\r\n      caret split\r\n      outline color=\"secondary\"\r\n    />\r\n    <DropdownMenu>\r\n      <DropdownItem header>Study</DropdownItem>\r\n      <DropdownItem\r\n        onClick={() => {\r\n          if (window.confirm('Are you sure you want to reset the study?')) {\r\n            store.dispatch({ type: 'RESET_STATE' })\r\n          }\r\n        }}\r\n      >\r\n        New\r\n      </DropdownItem>\r\n      <Uploader\r\n        accept=\"application/json\"\r\n        multiple={ false }\r\n        maxSize={ 255 * 1024 ** 2 } // 250MB + some headroom\r\n        onUpload={\r\n          ([[content]]) => {\r\n            try {\r\n              // Parse file from JSON\r\n              const state = fromJSON(content)\r\n              // Hydrate store from resulting object\r\n              store.dispatch({\r\n                type: 'HYDRATE', state,\r\n              })\r\n            } catch(e) {\r\n              // If things don't work out, let the user know\r\n              alert('Couldn\\'t load file, found error', e)\r\n            } finally {\r\n              // TODO: Close this earlier if possible\r\n              setDropdownOpen(false)\r\n            }\r\n          }\r\n        }\r\n        className=\"dropdown-item\"\r\n      >\r\n        Open\r\n      </Uploader>\r\n      <DropdownItem\r\n        onClick={ e => stateToDownload(\r\n          store.getState(), { removeInternals: e.shiftKey }\r\n        ) }\r\n      >\r\n        Save\r\n      </DropdownItem>\r\n      <DropdownItem divider/>\r\n      <DropdownItem header>Export for local use</DropdownItem>\r\n      <DropdownItem\r\n        onClick={ () => downloadStaticLocal(store.getState()) }\r\n      >\r\n        Offline data collection\r\n      </DropdownItem>\r\n      <DropdownItem divider/>\r\n      <DropdownItem header>Deploy study online</DropdownItem>\r\n      <DropdownItem\r\n        onClick={\r\n          () => store.dispatch({\r\n            type: 'SHOW_MODAL',\r\n            modalType: 'EXPORT_PHP',\r\n            modalProps: {},\r\n          })\r\n        }\r\n      >\r\n        Generic web host… <span className=\"text-muted\">(PHP backend)</span>\r\n      </DropdownItem>\r\n      <DropdownItem\r\n        onClick={\r\n          () => store.dispatch({\r\n            type: 'SHOW_MODAL',\r\n            modalType: 'EXPORT_NETLIFY',\r\n            modalProps: {},\r\n          })\r\n        }\r\n      >\r\n        Upload to Netlify… <span className=\"text-muted\">(cloud provider)</span>\r\n      </DropdownItem>\r\n      <DropdownItem\r\n        onClick={\r\n          () => store.dispatch({\r\n            type: 'SHOW_MODAL',\r\n            modalType: 'EXPORT_OPENLAB',\r\n            modalProps: {},\r\n          })\r\n        }\r\n      >\r\n        Upload to Open Lab…\r\n      </DropdownItem>\r\n      <DropdownItem divider/>\r\n      <DropdownItem header>Export as integration</DropdownItem>\r\n      <DropdownItem\r\n        onClick={\r\n          () => store.dispatch({\r\n            type: 'SHOW_MODAL',\r\n            modalType: 'EXPORT_PM',\r\n            modalProps: {},\r\n          })\r\n        }\r\n      >\r\n        Generic survey tools… <span className=\"text-muted\">(Qualtrics, etc.)</span>\r\n      </DropdownItem>\r\n      <DropdownItem\r\n        onClick={ () => downloadStaticJatos(store.getState()) }\r\n      >\r\n        JATOS <span className=\"text-muted\">(Just Another Tool for Online Studies)</span>\r\n      </DropdownItem>\r\n      <DropdownItem\r\n        onClick={ () => downloadStaticPavlovia(store.getState()) }\r\n      >\r\n        Pavlovia\r\n      </DropdownItem>\r\n      <DropdownItem\r\n        onClick={\r\n          () => store.dispatch({\r\n            type: 'SHOW_MODAL',\r\n            modalType: 'EXPORT_EXPFACTORY',\r\n            modalProps: {},\r\n          })\r\n        }\r\n      >\r\n        The Experiment Factory… <span className=\"text-muted\">(v3)</span>\r\n      </DropdownItem>\r\n      <DropdownItem divider/>\r\n      <DropdownItem header>Generate metadata</DropdownItem>\r\n      <DropdownItem\r\n        onClick={\r\n          () => downloadPsychDS(store.getState())\r\n        }\r\n      >\r\n        Psych-DS sidecar template{' '}\r\n        <span className=\"text-muted\">(JSON-LD)</span>\r\n      </DropdownItem>\r\n    </DropdownMenu>\r\n  </ButtonDropdown>\r\n}\r\n\r\nexport default IOButton\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { ButtonGroup, Button } from 'reactstrap'\r\n\r\nimport PreviewButton from './components/PreviewButton'\r\nimport IOButton from './components/IOButton'\r\nimport Icon from '../Icon'\r\nimport './styles.css'\r\n\r\nconst Toolbar = ({ showModal }) =>\r\n  <div className=\"toolbar\">\r\n    <ButtonGroup>\r\n      <PreviewButton />\r\n    </ButtonGroup>{' '}\r\n    <ButtonGroup>\r\n      <IOButton />\r\n    </ButtonGroup>{' '}\r\n    <ButtonGroup>\r\n      <Button\r\n        outline color=\"secondary\"\r\n        onClick={\r\n          () => showModal('OPTIONS')\r\n        }\r\n      >\r\n        <Icon icon=\"sliders-h\" weight=\"l\" />\r\n      </Button>\r\n    </ButtonGroup>\r\n  </div>\r\n\r\n// TODO: This is a duplicated action creator,\r\n// refactor to share this with the Sidebar component\r\nconst mapDispatchToProps = {\r\n  showModal: (type) => ({\r\n    type: 'SHOW_MODAL',\r\n    modalType: type,\r\n  })\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(Toolbar)\r\n","import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\nclass Tree extends Component {\r\n  getChildContext() {\r\n    return {\r\n      onNodeClick: this.props.onNodeClick,\r\n      onNodeAdd: this.props.onNodeAdd,\r\n      onNodeDelete: this.props.onNodeDelete,\r\n      onNodeDuplicate: this.props.onNodeDuplicate,\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { Node, rootId } = this.props\r\n\r\n    return <Node\r\n      id={ rootId }\r\n      renderBody={ false }\r\n      parentId={ null }\r\n    />\r\n  }\r\n}\r\n\r\nTree.childContextTypes = {\r\n  onNodeClick: PropTypes.func,\r\n  onNodeAdd: PropTypes.func,\r\n  onNodeDelete: PropTypes.func,\r\n  onNodeDuplicate: PropTypes.func,\r\n}\r\n\r\nexport default Tree\r\n","import React from 'react'\r\n\r\nimport Icon from '../../../Icon'\r\n\r\nimport './index.css'\r\n\r\nexport default ({ pinned, onClick }) =>\r\n  <div\r\n    className={ `addButton ${ pinned ? 'addButton-pinned' : '' }`}\r\n    onClick={ onClick }\r\n  >\r\n    <Icon icon=\"plus\" />\r\n  </div>\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { createSelectorCreator, defaultMemoize } from 'reselect'\r\n\r\nimport { DropTarget } from 'react-dnd'\r\nimport classnames from 'classnames'\r\nimport { isEqual, flow } from 'lodash'\r\n\r\nimport { parents } from '../../../../logic/tree'\r\n\r\nimport './index.css'\r\n\r\nconst TreeDropTarget = (props) =>\r\n  props.connectDropTarget(\r\n    <div\r\n      className={ classnames({\r\n        'dropTarget': true,\r\n        'dropTarget-available': props.canDrop,\r\n        'dropTarget-hover': props.validTarget & props.canDrop,\r\n        'dropTarget-children': props.children,\r\n      }) }\r\n    >\r\n      { props.children || <div className=\"dropTargetButton\" /> }\r\n    </div>\r\n  )\r\n\r\n// Wrap everything up to conform to react-dnd ----------------------------------\r\nconst targetSpec = {\r\n  drop: (targetProps, monitor, component) => {\r\n    // Information from DropSource\r\n    const { id, parentId: oldParent, index: oldIndex } = monitor.getItem()\r\n\r\n    // Information from DropTarget\r\n    const { id: newParent, index: newIndex } = targetProps\r\n\r\n    targetProps.dispatch({\r\n      type: 'MOVE_COMPONENT',\r\n      id,\r\n      oldParent, oldIndex,\r\n      newParent, newIndex,\r\n    })\r\n  },\r\n  canDrop: (targetProps, monitor) => {\r\n    // Retrieve dragged node\r\n    const itemProps = monitor.getItem()\r\n\r\n    return !(\r\n      // The item must not be dropped below the same\r\n      // parent, at the target preceding or following\r\n      // its original position.\r\n      (itemProps.parentId === targetProps.id\r\n        && (itemProps.index === targetProps.index\r\n          || itemProps.index === targetProps.index - 1))\r\n      // Nor may the item be dropped within itself\r\n      || [targetProps.id, ...targetProps.parentIds].includes(itemProps.id)\r\n    )\r\n  }\r\n}\r\n\r\nconst collect = (connect, monitor) => ({\r\n  connectDropTarget: connect.dropTarget(),\r\n  isOver: monitor.isOver(),\r\n  canDrop: monitor.canDrop(),\r\n  validTarget: monitor.canDrop() && monitor.isOver({ shallow: true }),\r\n})\r\n\r\n// Redux integration -----------------------------------------------------------\r\n\r\nconst getParents = (state, props) =>\r\n  parents(props.id, state.components)\r\n\r\nconst createDeepEqualSelector = createSelectorCreator(\r\n  defaultMemoize,\r\n  isEqual\r\n)\r\n\r\nconst makeMapStateToProps = () => {\r\n  const parentSelector = createDeepEqualSelector(\r\n    [getParents], parents => parents,\r\n  )\r\n  const mapStateToProps = (state, props) => ({\r\n    parentIds: parentSelector(state, props)\r\n  })\r\n  return mapStateToProps\r\n}\r\n\r\n// Make the component a DropTarget\r\nexport default flow(\r\n  DropTarget('node', targetSpec, collect),\r\n  connect(makeMapStateToProps),\r\n)(TreeDropTarget)\r\n","import React from 'react'\r\nimport { useStore } from 'react-redux'\r\nimport { UncontrolledDropdown, DropdownToggle,\r\n  DropdownMenu, DropdownItem } from 'reactstrap'\r\n\r\n/* TODO: Importing an external helper like this totally breaks\r\n   the idea of decoupled components. For the moment, however,\r\n   I have decided to not pass through another helper --\r\n   rather the node component as a whole should be made\r\n   pluggable, someday */\r\nimport { stateToDownload } from '../../../../../logic/io/save'\r\nimport './index.css'\r\nimport { connect } from 'react-redux'\r\n\r\nconst NodeDropdown = ({\r\n  id, parent, index,\r\n  collapsed, hasChildren,\r\n  onDelete, onDuplicate, collapseComponent,\r\n}) => {\r\n  const store = useStore()\r\n\r\n  return (\r\n    <UncontrolledDropdown>\r\n      <DropdownToggle\r\n        caret size=\"sm\"\r\n        outline color=\"secondary\"\r\n      />\r\n      <DropdownMenu right>\r\n        <DropdownItem header>Actions</DropdownItem>\r\n        <DropdownItem\r\n          onClick={ () => stateToDownload(\r\n            store.getState(),\r\n            { exportedComponent: id }\r\n          ) }\r\n        >\r\n          Export\r\n        </DropdownItem>\r\n        <DropdownItem\r\n          onClick={ () => onDuplicate(id, parent, index) }\r\n        >\r\n          Duplicate\r\n        </DropdownItem>\r\n        <DropdownItem\r\n          onClick={ () => onDelete(id, parent, index) }\r\n        >\r\n          Delete\r\n        </DropdownItem>\r\n        {\r\n          hasChildren\r\n            ? <div>\r\n                <DropdownItem divider/>\r\n                <DropdownItem header>View</DropdownItem>\r\n                <DropdownItem\r\n                  onClick={ () => collapseComponent(id) }\r\n                >\r\n                  { collapsed ? 'Expand' : 'Collapse' }\r\n                </DropdownItem>\r\n              </div>\r\n            : null\r\n        }\r\n      </DropdownMenu>\r\n    </UncontrolledDropdown>\r\n  )\r\n}\r\n\r\n// TODO: This is a duplicated action creator,\r\n// refactor to share this with the Sidebar component\r\nconst mapDispatchToProps = {\r\n  collapseComponent: (id) => ({\r\n    type: 'COLLAPSE_COMPONENT', id\r\n  })\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(NodeDropdown)\r\n","import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { connect } from 'react-redux'\r\nimport { DragSource } from 'react-dnd'\r\nimport { Nav, NavItem, NavLink } from 'reactstrap'\r\n\r\nimport AddButton from '../AddButton'\r\nimport DropTarget from '../DropTarget'\r\nimport Icon from '../../../Icon'\r\n\r\nimport { metadata } from '../../../../logic/components'\r\nimport NodeDropDown from './dropdown'\r\n\r\nimport classnames from 'classnames'\r\nimport './index.css'\r\n\r\nconst NodeBody = (\r\n  { id, parent, index, children,\r\n    active, collapsed, skipped, tardy,\r\n    isDragging, hasChildren },\r\n  { onNodeClick, onNodeDelete, onNodeDuplicate }\r\n) =>\r\n  <NavLink\r\n    href='#' active={ active }\r\n    className={ classnames({\r\n      isDragging,\r\n      'text-muted': skipped\r\n    }) }\r\n  >\r\n    <div\r\n      className='nav-link-main'\r\n      onClick={ e => onNodeClick(e, id) }\r\n    >\r\n      { children }\r\n      { collapsed ? <Icon icon=\"plus\" /> : null }\r\n      { skipped ? <Icon icon=\"minus-circle\" /> : null }\r\n      { tardy ? <Icon icon=\"alarm-clock\" /> : null }\r\n    </div>\r\n    <div className='nav-link-tools'>\r\n      <NodeDropDown\r\n        id={ id }\r\n        parent={ parent }\r\n        index={ index }\r\n        collapsed={ collapsed }\r\n        hasChildren={ hasChildren }\r\n        onDelete={ onNodeDelete }\r\n        onDuplicate={ onNodeDuplicate }\r\n      />\r\n    </div>\r\n  </NavLink>\r\n\r\nNodeBody.contextTypes = {\r\n  onNodeClick: PropTypes.func,\r\n  onNodeDelete: PropTypes.func,\r\n  onNodeDuplicate: PropTypes.func,\r\n}\r\n\r\nconst NodeGap = ({ id, index, onNodeAdd, pinned }) =>\r\n  <div className=\"nodeGap\">\r\n    {\r\n      pinned\r\n        ? <DropTarget id={ id } index={ index } >\r\n            <AddButton\r\n              id={ id } index={ index }\r\n              onClick={ () => onNodeAdd(id, index) }\r\n              pinned={ pinned }\r\n            />\r\n          </DropTarget>\r\n        : <div>\r\n            <DropTarget\r\n              id={ id } index={ index }\r\n            />\r\n            <AddButton\r\n              id={ id } index={ index }\r\n              onClick={ () => onNodeAdd(id, index) }\r\n            />\r\n          </div>\r\n    }\r\n  </div>\r\n\r\nconst NodeTail = ({ id, children, pinned, vacancies }, { onNodeAdd }) =>\r\n  <Nav pills className='flex-column'>\r\n    {\r\n      !vacancies ? null :\r\n        <NodeGap\r\n          id={ id }\r\n          index={ 0 }\r\n          pinned={ pinned }\r\n          onNodeAdd={ onNodeAdd }\r\n        />\r\n    }\r\n    {\r\n      children.map((childId, childIndex) =>\r\n        <NavItem key={ `${ id }_${ childIndex }_${ childId }` }>\r\n          <DraggableNode\r\n            id={ childId }\r\n            parentId={ id } index={ childIndex }\r\n          />\r\n          {\r\n            /* Allow users to add more children only if there are vacancies */\r\n            !vacancies ? null :\r\n              <NodeGap\r\n                id={ id }\r\n                index={ childIndex + 1 }\r\n                onNodeAdd={ onNodeAdd }\r\n              />\r\n          }\r\n        </NavItem>\r\n      )\r\n    }\r\n  </Nav>\r\n\r\nNodeTail.contextTypes = {\r\n  onNodeAdd: PropTypes.func,\r\n}\r\n\r\nconst Node = ({ id, parentId, index, data, active, renderBody,\r\n  isDragging, connectDragSource }) => {\r\n  const { type, _collapsed: collapsed, _template: template } = data\r\n  const { minChildren, maxChildren } = metadata[type]\r\n\r\n  const children = data.children || []\r\n\r\n  // Show the add button permanently if the component\r\n  // expects subordinate components\r\n  const tailPinned = children.length < minChildren &&\r\n    children.length < maxChildren\r\n\r\n  // Don't allow adding or dropping additional\r\n  // subordinate components if there is no more room\r\n  const tailVacancies = children.length < maxChildren\r\n\r\n  return (\r\n    <div className='tree-node'>\r\n      {\r\n        renderBody !== false\r\n          ? connectDragSource(\r\n              // (React-DnD requires a native element wrapper)\r\n              <div>\r\n                <NodeBody\r\n                  id={ id }\r\n                  parent={ parentId }\r\n                  index={ index }\r\n                  hasChildren={ (children || []).length > 0 }\r\n                  active={ active }\r\n                  collapsed={ collapsed }\r\n                  skipped={ data.skip }\r\n                  tardy={ data.tardy }\r\n                  isDragging={ isDragging }\r\n                >\r\n                  { data.title }\r\n                </NodeBody>\r\n              </div>\r\n            )\r\n          : null\r\n      }\r\n      {\r\n        collapsed || template\r\n          ? null\r\n          : <NodeTail\r\n              id={ id }\r\n              children={ children || [] }\r\n              pinned={ tailPinned }\r\n              vacancies={ tailVacancies }\r\n            />\r\n      }\r\n    </div>\r\n  )\r\n}\r\n\r\n// Redux integration\r\nconst ConnectedNode = connect(\r\n  (state, props) => ({\r\n    data: state.components[props.id],\r\n    active: props.id === state.componentDetail.viewProps.id,\r\n  })\r\n)(Node)\r\n\r\n// Dnd integration\r\nconst nodeSource = {\r\n  beginDrag(props) {\r\n    // Extract identifying data from the\r\n    // dragged node, to be provided to the target\r\n    const { id, parentId, index } = props\r\n    return { id, parentId, index }\r\n  }\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n  return {\r\n    connectDragSource: connect.dragSource(),\r\n    isDragging: monitor.isDragging(),\r\n  }\r\n}\r\n\r\nconst DraggableNode = DragSource(\r\n  'node',\r\n  nodeSource,\r\n  collect\r\n)(ConnectedNode)\r\n\r\nexport default DraggableNode\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport Toolbar from '../Toolbar'\r\nimport Tree from '../Tree'\r\nimport Node from '../Tree/components/Node'\r\n\r\nconst Sidebar = ({\r\n  collapseComponent, deleteComponent, duplicateComponent,\r\n  showComponentDetail, showAddModal\r\n}) =>\r\n  <>\r\n    <div style={{ textAlign: 'center' }}>\r\n      <Toolbar />\r\n    </div>\r\n    <hr style={{ marginBottom: '14px' }} />\r\n    <Tree\r\n      Node={ Node }\r\n      rootId=\"root\"\r\n      onNodeClick={\r\n        (e, id) => {\r\n          // Collapse view if shift key is pressed\r\n          if (e.shiftKey) {\r\n            collapseComponent(id)\r\n          } else {\r\n            showComponentDetail(id)\r\n          }\r\n        }\r\n      }\r\n      onNodeDelete={\r\n        (id, parent, index) => {\r\n          if (window.confirm('Do you really want to delete this component?')) {\r\n            deleteComponent(id, parent, index)\r\n          }\r\n        }\r\n      }\r\n      onNodeDuplicate={ duplicateComponent }\r\n      onNodeAdd={ showAddModal }\r\n    />\r\n  </>\r\n\r\nconst mapDispatchToProps = {\r\n  collapseComponent: (id) => ({\r\n    type: 'COLLAPSE_COMPONENT', id,\r\n  }),\r\n  deleteComponent: (id, parent, index) => ({\r\n    type: 'DELETE_COMPONENT',\r\n    id, parent, index,\r\n  }),\r\n  duplicateComponent: (id, parent, index) => ({\r\n    type: 'COPY_COMPONENT',\r\n    id, parent,\r\n    index: index+1,\r\n  }),\r\n  showComponentDetail: (id) => ({\r\n    type: 'SHOW_COMPONENT_DETAIL', id,\r\n  }),\r\n  showAddModal: (parent, index) => ({\r\n    type: 'SHOW_MODAL',\r\n    modalType: 'ADD_COMPONENT',\r\n    modalProps: {\r\n      parent: parent,\r\n      index: index,\r\n    },\r\n  })\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(Sidebar)\r\n","import React, { Component } from 'react'\r\nimport { Popover, PopoverHeader, PopoverBody } from 'reactstrap'\r\nimport { uniqueId } from 'lodash'\r\n\r\nimport Icon from '../Icon'\r\n\r\nimport './hint.css'\r\n\r\nconst HintTarget = ({ id, onClick }) =>\r\n  <span id={ id } onClick={ onClick }>\r\n    <Icon icon=\"info-circle\" className=\"hint-icon\" title=\"More information\" />\r\n    <span className=\"sr-only\">More information</span>\r\n  </span>\r\n\r\nexport default class HintPopover extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.id = this.props.id || uniqueId('hint_')\r\n    this.target = this.props.target || HintTarget\r\n\r\n    this.toggle = this.toggle.bind(this)\r\n    this.state = {\r\n      isOpen: false,\r\n    }\r\n  }\r\n\r\n  toggle(e) {\r\n    if (e) {\r\n      e.preventDefault()\r\n    }\r\n\r\n    this.setState({\r\n      isOpen: !this.state.isOpen,\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const Target = this.target\r\n\r\n    return (\r\n      <span className={ this.props.className } style={ this.props.style }>\r\n        {' '}\r\n        <Target id={ this.id } onClick={ this.toggle } />\r\n        <Popover\r\n          target={ this.id }\r\n          placement={ this.props.placement || \"bottom\" }\r\n          trigger=\"legacy\"\r\n          delay={0}\r\n          isOpen={ this.state.isOpen } toggle={ this.toggle }\r\n        >\r\n          <PopoverHeader>{ this.props.title }</PopoverHeader>\r\n          <PopoverBody>{ this.props.children }</PopoverBody>\r\n        </Popover>\r\n      </span>\r\n    )\r\n  }\r\n}\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { Button } from 'reactstrap'\r\n\r\nimport Hint from '../Hint'\r\nimport Icon from '../Icon'\r\n\r\nconst HelpHint = () =>\r\n  <Hint\r\n    target={ ({ id, onClick }) =>\r\n      <span id={ id } onClick={ onClick } style={{ cursor: 'pointer' }}>\r\n        Help\r\n      </span>\r\n    }\r\n    title=\"Finding help\"\r\n  >\r\n    <p className=\"mt-1\">\r\n      <strong>We would love to help you build your research!</strong>{' '}\r\n      Here are some resources to get you started and assist you while you're using <code>lab.js</code>:\r\n    </p>\r\n    <p>\r\n      The <a className=\"font-weight-bold\" target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://labjs.readthedocs.io\">online documentation</a> provides tutorials, useful tricks, and detailed technical reference. It is probably the best place to gain an overview.\r\n    </p>\r\n    <p>\r\n      You're always welcome to <a className=\"font-weight-bold\" target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://slackin-nmbrcrnchrs.herokuapp.com/\">join the project chat</a>, where fellow users will answer questions and help you get unstuck. If you can, please pay it forward by helping in turn.\r\n    </p>\r\n    <p>\r\n      You've probably already spotted the <Icon icon=\"info-circle\" className=\"text-muted\" /> symbols in the interface; they provide further <strong>contextual information</strong>, which you can access by clicking on them.\r\n    </p>\r\n    <p>\r\n      As always, if something isn't working as you'd expect, please <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://labjs.readthedocs.io/en/latest/meta/contribute/ways.html\">let us know</a>!\r\n    </p>\r\n  </Hint>\r\n\r\nconst _ImprintHint = ({ showModal }) =>\r\n  <Hint\r\n    target={ ({ id, onClick }) =>\r\n      <span id={ id } onClick={ onClick } style={{ cursor: 'pointer' }}>\r\n        Imprint\r\n      </span>\r\n    }\r\n    title=\"Imprint\"\r\n  >\r\n    <p>\r\n      <strong>Thank you for using <a href=\"https://felixhenninger.github.io/lab.js\" className=\"font-weight-bold\" target=\"_blank\" rel=\"noopener noreferrer\"><code>lab.js</code></a> — <br />It's a pleasure to have you around!</strong><br />\r\n      Here's some information to help keep our lawyers happy, too.\r\n    </p>\r\n    <h6>Authors</h6>\r\n    <p>\r\n      This software is developed by <a href=\"http://felixhenninger.com\" target=\"_blank\" rel=\"noopener noreferrer\">Felix Henninger</a>, with help from many awesome <a href=\"https://github.com/felixhenninger/lab.js#contributors\" target=\"_blank\" rel=\"noopener noreferrer\">contributors</a>. Felix is a member of the <a href=\"https://www.cognition.uni-landau.de/\" target=\"_blank\" rel=\"noopener noreferrer\">University of Landau Cognition Lab</a> and a student at the <a href=\"http://gess.uni-mannheim.de/\">University of Mannheim</a>.\r\n    </p>\r\n    <Button\r\n      size=\"sm\" block\r\n      color=\"primary\" outline\r\n      className=\"mb-2\"\r\n      onClick={ () => showModal('LEGAL', { large: 'true' }) }\r\n    >\r\n      Legal\r\n    </Button>\r\n  </Hint>\r\n\r\nconst mapDispatchToProps = {\r\n  showModal: (modalType, modalProps) => ({\r\n    type: 'SHOW_MODAL',\r\n    modalType, modalProps,\r\n  })\r\n}\r\n\r\nconst ImprintHint = connect(null, mapDispatchToProps)(_ImprintHint)\r\n\r\nexport const Imprint = () =>\r\n  <small className=\"text-muted\">\r\n    <HelpHint /> ·{' '}\r\n    <ImprintHint />\r\n  </small>\r\n\r\n","import React from 'react'\r\n\r\nimport { sample } from 'lodash'\r\nimport { Imprint } from './imprint'\r\n\r\nimport './index.css'\r\nimport logo from './flask_micro.png'\r\n\r\nconst message = sample([\r\n  'built with ♥︎',\r\n])\r\n\r\nexport default () =>\r\n  <footer>\r\n    <hr />\r\n    <div className=\"d-flex justify-content-between\">\r\n      <a\r\n        className=\"text-muted text-decoration-none logo\"\r\n        href=\"https://lab.js.org/\"\r\n        target=\"_blank\"\r\n        rel=\"noopener noreferrer\"\r\n      >\r\n        <img\r\n          alt=\"lab.js logo\"\r\n          src={ logo }\r\n        />{' '}\r\n        <small>{ message }</small>\r\n      </a>\r\n      <Imprint />\r\n    </div>\r\n  </footer>\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { Nav, NavItem, NavLink,\r\n  FormGroup, InputGroup, InputGroupAddon,\r\n  UncontrolledTooltip } from 'reactstrap'\r\n\r\nimport { Formik, Field } from 'formik'\r\nimport { AutoSave, Input } from '../Form'\r\n\r\nimport classnames from 'classnames'\r\n\r\nimport Icon from '../Icon'\r\nimport { updateComponent } from '../../actions/components'\r\nimport { metadata, defaultTab } from '../../logic/components'\r\n\r\nconst tabIcons = {\r\n  'Files': 'folder',\r\n  'Parameters': 'box-open',\r\n  // 'Scripts': 'fa-code', // TODO: This doesn't feel right atm\r\n  'Plugins': 'plug',\r\n  'More': 'ellipsis-h',\r\n}\r\n\r\nconst HeaderForm = ({ title, typeCategory, typeName, template,\r\n  icon, iconWeight, iconFallbackWeight, onChange }) =>\r\n  <Formik\r\n    initialValues={{ title }}\r\n    enableReinitialize={ true }\r\n  >\r\n    <FormGroup\r\n      className=\"mr-sm-2\"\r\n      style={{ width: '40%' }}\r\n    >\r\n      <InputGroup>\r\n        <Field\r\n          name=\"title\"\r\n          component={ Input }\r\n          bsSize=\"lg\"\r\n          className=\"font-weight-bold\"\r\n          style={{\r\n            padding: '0.5rem 0.75rem',\r\n            height: '42px',\r\n          }}\r\n        />\r\n        <InputGroupAddon addonType=\"append\">\r\n          <span className=\"input-group-text\">\r\n            <Icon\r\n              id=\"typeIcon\"\r\n              icon={ icon }\r\n              fixedWidth\r\n              weight={ iconWeight }\r\n              fallbackWeight={ iconFallbackWeight }\r\n            />\r\n          </span>\r\n          <UncontrolledTooltip placement=\"right\" target=\"typeIcon\">\r\n            {\r\n              template\r\n              ? 'Template'\r\n              : <span>\r\n                  { typeName }\r\n                  <span className=\"text-muted\"> · { typeCategory }</span>\r\n                </span>\r\n            }\r\n          </UncontrolledTooltip>\r\n        </InputGroupAddon>\r\n      </InputGroup>\r\n      <AutoSave onSave={ data => onChange(data) } />\r\n    </FormGroup>\r\n  </Formik>\r\n\r\nconst HeaderNav = ({ tabs, tab, onChange }) =>\r\n  <Nav pills> {\r\n    tabs.map(t =>\r\n      <NavItem key={ t }>\r\n        <NavLink\r\n          href=\"#\"\r\n          className={ classnames({\r\n            active: tab === t\r\n          }) }\r\n          style={{\r\n            height: '42px',\r\n            padding: '9px 16px 7px',\r\n            minWidth: '2.8rem',\r\n            textAlign: 'center',\r\n          }}\r\n          onClick={\r\n            () => onChange(t)\r\n          }\r\n        >\r\n          {\r\n            tabIcons[t]\r\n              ? <Icon icon={ tabIcons[t] } weight=\"s\" fixedWidth />\r\n              : t\r\n          }\r\n        </NavLink>\r\n      </NavItem>\r\n    )\r\n  } </Nav>\r\n\r\nconst Header = ({ id, type, title, tab, template, updateComponent }) => {\r\n  // Only show content if a valid id is provided\r\n  if (id) {\r\n    const visibleTabs = metadata[type].tabs\r\n      .filter(t => !template || t === tab || ['Parameters', 'More'].includes(t))\r\n\r\n    return <div className=\"d-flex justify-content-between\">\r\n      <HeaderForm\r\n        id={ id }\r\n        title={ title }\r\n        typeName={ metadata[type].name }\r\n        typeCategory={ metadata[type].category }\r\n        template={ template }\r\n        icon={ template ? 'box-open' : metadata[type].icon }\r\n        iconWeight={ metadata[type].iconWeight }\r\n        iconFallbackWeight={ metadata[type].iconFallbackWeight }\r\n        onChange={ data => updateComponent(id, data) }\r\n      />\r\n      <HeaderNav\r\n        tabs={ visibleTabs }\r\n        tab={ tab }\r\n        onChange={ _tab => updateComponent(id, { _tab }) }\r\n      />\r\n    </div>\r\n  } else {\r\n    return null\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  const id = state.componentDetail.viewProps.id\r\n\r\n  // Check whether the corresponding component exists\r\n  if (state.components[id]) {\r\n    const { type, title, _tab: tab, _template: template } =\r\n      state.components[id]\r\n    return {\r\n      key: id, id,\r\n      type, title, template,\r\n      tab: defaultTab(tab, type),\r\n    }\r\n  } else {\r\n    return {\r\n      id: undefined\r\n    }\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n  updateComponent,\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Header)\r\n","import React, { useState } from 'react'\r\n\r\nimport { CardBody, CardText,\r\n  Container, Row, Col, Collapse, Badge } from 'reactstrap'\r\nimport classnames from 'classnames'\r\nimport Icon from '../../../../../Icon'\r\n\r\nimport './index.css'\r\n\r\nconst SplashHeader = () =>\r\n  <CardBody\r\n    style={{ textAlign: 'center' }}\r\n  >\r\n    <h2 style={{ margin: '2rem 0 1rem' }} >\r\n      Welcome!\r\n    </h2>\r\n    <CardText className=\"mb-3\">\r\n      <strong>Thank you for using <code>lab.js</code>!</strong><br/>\r\n      We hope you find it useful, and that<br />\r\n      you enjoy using it as much as we did building it.\r\n    </CardText>\r\n  </CardBody>\r\n\r\nconst SplashTab = ({ icon, children, active,\r\n  borderRight, borderBottom, onClick }) =>\r\n  // This used to use p-4\r\n  <Col\r\n    className={ classnames(\r\n      'splash-tab-icon',\r\n      'pt-4 pb-3', {\r\n      'active': active,\r\n      'border-right': borderRight,\r\n      'border-bottom': borderBottom,\r\n    }) }\r\n    style={{\r\n      cursor: active ? 'default' : 'pointer',\r\n    }}\r\n    onClick={ active ? undefined : onClick }\r\n  >\r\n    <Icon\r\n      icon={ icon }\r\n      className=\"fa-2x d-block mt-2 mb-3\"\r\n    />\r\n    { children }\r\n    <Icon\r\n      icon=\"angle-down\"\r\n      className={ classnames(\r\n        'd-block', (active ? 'visible': 'invisible'),\r\n        'text-muted',\r\n        'mt-1',\r\n      ) }\r\n    />\r\n  </Col>\r\n\r\nconst SplashButton = ({ icon, onClick, children }) =>\r\n  <Col\r\n    className=\"pt-3 pb-4\"\r\n    style={{\r\n      cursor: 'pointer',\r\n    }}\r\n    onClick={ onClick }\r\n  >\r\n    <Icon\r\n      icon={ icon }\r\n      className=\"fa-2x d-block mt-2 mb-3\"\r\n    />\r\n    { children }\r\n  </Col>\r\n\r\n// TODO: This is a bit of a mess, and deserves some\r\n// refactoring in an inspired moment.\r\nconst splashOptions = {\r\n  start: {\r\n    title: <p className=\"mb-1\"><strong>Get started</strong></p>,\r\n    icon: 'map',\r\n    content: (switchTab) =>\r\n      <Container><Row className=\"text-center pt-3 pb-2\">\r\n        <SplashButton\r\n          icon=\"shoe-prints\"\r\n          onClick={ () =>\r\n            alert('Sorry, but this isn\\'t quite ready yet. Please join us on Slack and we\\'d be happy to give you a personal tour!')\r\n          }\r\n        >\r\n          <p className=\"mb-1\">Take a <strong>tour</strong></p>\r\n          <p className=\"mb-0 text-muted\">\r\n            <small>We'd love to<br />show you around!</small>\r\n          </p>\r\n          <Badge>Alpha</Badge>\r\n        </SplashButton>\r\n        <SplashButton\r\n          icon=\"book-open\"\r\n          onClick={ () => window.open(\r\n            'https://lab.js.org/docs/en/latest/learn/builder/',\r\n            '_blank'\r\n          ) }\r\n        >\r\n          <p className=\"mb-1\">Watch the<br /><strong>tutorial</strong></p>\r\n          <p className=\"mb-0 text-muted\">\r\n            <small>... and build a study step by step</small>\r\n          </p>\r\n        </SplashButton>\r\n        <SplashButton\r\n          icon=\"rocket\"\r\n          onClick={ () => switchTab('examples') }\r\n        >\r\n          <p className=\"mb-1\">\r\n            Browse some<br /><strong>examples</strong>\r\n          </p>\r\n        </SplashButton>\r\n      </Row></Container>\r\n  },\r\n  learn: {\r\n    title: <p className=\"mb-1\"><strong>Learn</strong> more</p>,\r\n    icon: 'graduation-cap',\r\n    content: (switchTab) =>\r\n      <Container className=\"py-4\">\r\n        <p><strong>Wow, it's cool that you're interested!</strong> Here are some things we hope you'll find helpful:</p>\r\n        <ul>\r\n          <li>We've collected <a href=\"https://lab.js.org/docs/en/latest/recipes/\" target=\"_blank\" rel=\"noopener noreferrer\">tips, tricks and recipes</a> for common use cases.</li>\r\n          <li>\r\n            Maybe the paradigm you're looking for is already among the{' '}\r\n            <a\r\n              href=\"#example-tab\"\r\n              onClick={ (e) => {\r\n                e.preventDefault()\r\n                switchTab('examples')\r\n              } }\r\n            >examples</a>\r\n            ?\r\n          </li>\r\n          <li>The <a href=\"https://lab.js.org/docs/en/latest/reference/\" target=\"_blank\" rel=\"noopener noreferrer\">reference documentation</a> covers the nitty-gritty library internals.</li>\r\n        </ul>\r\n      </Container>\r\n  },\r\n  support: {\r\n    title: <p className=\"mb-1\">Find <strong>support</strong></p>,\r\n    icon: 'life-ring',\r\n    content: () =>\r\n      <Container className=\"py-4\">\r\n        <p><strong>We'd love to support you!</strong> Please don't hesitate to reach out if there's anything we can do to help, we'd be glad to.</p>\r\n        <p>The easiest way to find help is our <a href=\"https://lab.js.org/resources/support/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>support channel</strong></a>, where there's usually someone around to chat and provide information. You can <a href=\"https://lab.js.org/resources/support/\" target=\"_blank\" rel=\"noopener noreferrer\">join by providing your email address</a> — you'll receive access in seconds.</p>\r\n        <div className=\"text-center\">\r\n          <Icon icon=\"heart-circle\" />\r\n        </div>\r\n      </Container>\r\n  },\r\n}\r\n\r\nconst SplashAdditions = ({ switchTab }) => {\r\n  const [tab, setTab] = useState(undefined)\r\n\r\n  return <>\r\n    <Container className=\"border-top text-center\">\r\n      <Row>\r\n        {\r\n          Object.entries(splashOptions).map(([k, o], i) =>\r\n            <SplashTab\r\n              key={ `splash-tab-${ k }` }\r\n              icon={ o.icon }\r\n              onClick={ () => setTab(k) }\r\n              active={ tab === k }\r\n              borderRight={ i !== Object.entries(splashOptions).length - 1 }\r\n              borderBottom={\r\n                tab !== undefined && tab !== k\r\n              }\r\n            >\r\n              { o.title }\r\n            </SplashTab>\r\n          )\r\n        }\r\n      </Row>\r\n    </Container>\r\n    <Collapse\r\n      isOpen={ tab !== undefined }\r\n    >\r\n      {\r\n        tab !== undefined\r\n          ? splashOptions[tab].content(switchTab)\r\n          : ''\r\n      }\r\n    </Collapse>\r\n  </>\r\n}\r\n\r\nexport default ({ switchTab }) =>\r\n  <>\r\n    <SplashHeader />\r\n    <SplashAdditions switchTab={ switchTab } />\r\n  </>\r\n","import React, { useState } from 'react'\r\n\r\nimport { Card, CardHeader, Nav, NavItem, NavLink,\r\n  UncontrolledTooltip } from 'reactstrap'\r\nimport classnames from 'classnames'\r\n\r\nimport Icon from '../../../Icon'\r\n\r\nimport { NavEntry } from '../../../Nav'\r\nimport SplashTab from './components/SplashTab'\r\nimport ExampleTab from './components/ExampleTab'\r\n\r\nconst TabContent = ({ tab, setTab }) => {\r\n  switch(tab) {\r\n    case 'splash':\r\n      return <SplashTab switchTab={ tab => setTab(tab) } />\r\n    case 'examples':\r\n      return <ExampleTab />\r\n    default:\r\n      return <div>Requested tab not found</div>\r\n  }\r\n}\r\n\r\nexport default () => {\r\n  const [tab, setTab] = useState('splash')\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n      }}\r\n    >\r\n      <Card\r\n        style={{ width: '500px' }}\r\n      >\r\n        <CardHeader>\r\n          <Nav tabs className=\"card-header-tabs justify-content-center\">\r\n            <NavEntry id=\"splash\" activeId={ tab } setId={ setTab }>\r\n              <Icon icon=\"heart\" />\r\n            </NavEntry>\r\n            <NavItem>\r\n              <NavLink\r\n                id=\"splash-tab-examples\"\r\n                className={ classnames({\r\n                  active: tab === 'examples'\r\n                }) }\r\n                onClick={ () => setTab('examples') }\r\n              >\r\n                <Icon icon=\"rocket\" />\r\n              </NavLink>\r\n              <UncontrolledTooltip\r\n                target=\"splash-tab-examples\"\r\n                placement=\"bottom\"\r\n                delay={{ show: 0, hide: 100 }}\r\n              >\r\n                {/* TODO: Reduce the offset of the tooltips, around 8-10px,\r\n                    as soon as the option is available via reactstrap */}\r\n                Examples\r\n              </UncontrolledTooltip>\r\n            </NavItem>\r\n          </Nav>\r\n        </CardHeader>\r\n        <TabContent tab={ tab } setTab={ setTab } />\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nimport Icon from '../../Icon'\r\n\r\nexport default () =>\r\n  <div\r\n    style={{\r\n      textAlign: 'center'\r\n    }}\r\n  >\r\n    <Icon\r\n      icon=\"exclamation-circle\"\r\n      weight=\"s\"\r\n      style={{\r\n        fontSize: '5rem',\r\n        color: 'var(--gray)',\r\n        marginTop: '3rem',\r\n      }}\r\n    />\r\n    <h2 style={{ margin: '2rem 0 1rem' }} >\r\n      No component selected\r\n    </h2>\r\n    <p>\r\n      <strong>Please select a component on the left to get started</strong>,<br/>\r\n      or add a new one via the plus button if you haven't already.\r\n    </p>\r\n  </div>\r\n","import React from 'react'\r\n\r\nexport default () =>\r\n  <div className=\"text-center\">\r\n    <i className=\"fas fa-spinner-third fa-spin my-3\" />\r\n  </div>\r\n","import React, { lazy, Suspense } from 'react'\r\nimport { Field, useFormikContext } from 'formik'\r\nimport { CardBody, FormGroup, Col, Label,\r\n  InputGroup, InputGroupAddon } from 'reactstrap'\r\n\r\nimport Card from '../../../../../Card'\r\nimport Hint from '../../../../../Hint'\r\nimport Spinner from '../../../../../Spinner'\r\nimport { Input } from '../../../../../Form'\r\n\r\nimport { numberOrPlaceholder } from './util'\r\n\r\nconst TimelineWidget = lazy(() => import('./widget'))\r\n\r\nexport default () => {\r\n  const formikContext = useFormikContext()\r\n\r\n  return (\r\n    <Card title=\"Timeline\" badge=\"Beta\" wrapContent={ false }>\r\n      <Suspense fallback={ <Spinner /> }>\r\n        <TimelineWidget\r\n          data={ formikContext.values.timeline || [] }\r\n          formikContext={ formikContext }\r\n        />\r\n      </Suspense>\r\n      <hr />\r\n      <CardBody>\r\n        <FormGroup row>\r\n          <Label for=\"timeout\" xs=\"2\">\r\n            Timeout\r\n            <Hint\r\n              title=\"Timeout\"\r\n              className=\"float-right\"\r\n            >\r\n              <p className=\"font-weight-bold\">\r\n                End component automatically after a given number of milliseconds.\r\n              </p>\r\n              <p className=\"text-muted\">\r\n                If responses are defined alongside a timeout, whichever comes first will end the component.\r\n              </p>\r\n            </Hint>\r\n          </Label>\r\n          <Col xs=\"10\">\r\n            <InputGroup>\r\n              <Field\r\n                name=\"timeout\" id=\"timeout\"\r\n                placeholder=\"Never\"\r\n                pattern={ numberOrPlaceholder }\r\n                component={ Input }\r\n                className=\"text-monospace\"\r\n              />\r\n              <InputGroupAddon addonType=\"append\">\r\n                <span className=\"input-group-text text-muted\">ms</span>\r\n              </InputGroupAddon>\r\n            </InputGroup>\r\n          </Col>\r\n        </FormGroup>\r\n      </CardBody>\r\n    </Card>\r\n  )\r\n}\r\n","import React, { createContext, useContext, Fragment } from 'react'\r\n\r\nimport { FieldArray, useFormikContext, getIn } from 'formik'\r\n\r\n// State management ------------------------------------------------------------\r\n\r\nconst ArrayContext = createContext({})\r\n\r\nconst ArrayContextProvider = ({ name, values,\r\n  arrayHelpers, setValues, setFieldValue, ...props\r\n}) => {\r\n  const getRows = () => getIn(values, name) ?? []\r\n\r\n  const overwriteRows = (newValue) =>\r\n    setFieldValue(name, newValue)\r\n\r\n  // TODO: A fair amount of these helper functions are grid-specific.\r\n  // Maybe it might be worth investigating splitting them out\r\n  const overwriteAll = (rows, columns) => {\r\n    const baseName = name.replace('.rows', '')\r\n\r\n    setValues({\r\n      [baseName]: {\r\n        ...getIn(values, baseName),\r\n        rows, columns,\r\n      }\r\n    })\r\n  }\r\n\r\n  const dispatch = (f) => {\r\n    const columnName = name.replace('.rows', '.columns')\r\n\r\n    overwriteAll(...f(\r\n      getIn(values, name) ?? [],\r\n      getIn(values, columnName) ?? [],\r\n    ))\r\n  }\r\n\r\n  const addRow = () => arrayHelpers.push([])\r\n\r\n  const mapRows = (f) =>\r\n    overwriteRows(getRows().map(f))\r\n\r\n  const addColumn = (defaultCell, defaultColumn) =>\r\n    dispatch((rows, columns) => ([\r\n      rows.map(row => [...row, defaultCell]),\r\n      [...columns, defaultColumn],\r\n    ]))\r\n\r\n  const deleteColumn = (index) =>\r\n    dispatch((rows, columns) => ([\r\n      rows.map(row => row.filter((_, i) => i !== index)),\r\n      columns.filter((_, i) => i !== index),\r\n    ]))\r\n\r\n  const clearColumn = (index) =>\r\n    mapRows(row => {\r\n      const output = [...row]\r\n      output[index] = ''\r\n      return output\r\n    })\r\n\r\n  const fillColumn = (index) => {\r\n    // Gather cells with content\r\n    const availableCells = getRows()\r\n      .map(r => r[index])\r\n      .filter(r => r !== '')\r\n\r\n    return mapRows((r, rowIndex) => {\r\n      const output = [...r]\r\n      output[index] = output[index] ||\r\n        availableCells[rowIndex % availableCells.length]\r\n      return output\r\n    })\r\n  }\r\n\r\n  return (\r\n    <ArrayContext.Provider\r\n      value={{ setValues, setFieldValue, dispatch, overwriteAll,\r\n        addRow, addColumn, clearColumn, fillColumn, deleteColumn\r\n      }}\r\n      { ...props }\r\n    />\r\n  )\r\n}\r\n\r\nexport const useArrayContext = () => useContext(ArrayContext)\r\n\r\n// Basic form array ------------------------------------------------------------\r\n\r\nexport const FormArray = ({\r\n  name, item: Item,\r\n  header: Header, footer: Footer,\r\n  wrapper: Wrapper=Fragment,\r\n  wrapperProps,\r\n  bodyWrapper: BodyWrapper=Fragment,\r\n  defaultItem={},\r\n}) => {\r\n  const { values, setFieldValue, setValues }  = useFormikContext()\r\n  const rows = getIn(values, name)\r\n\r\n  return (\r\n    <FieldArray name={ name }>\r\n      {\r\n        arrayHelpers => <Wrapper { ...wrapperProps }>\r\n          <ArrayContextProvider\r\n            name={ name }\r\n            values={ values }\r\n            arrayHelpers={ arrayHelpers }\r\n            setValues={ setValues }\r\n            setFieldValue={ setFieldValue }\r\n          >\r\n            { Header && <Header name={ name } /> }\r\n            <BodyWrapper>\r\n              {\r\n                (rows || []).map(\r\n                  (data, index) =>\r\n                    <Item\r\n                      key={ `${ name }[${ index }]` }\r\n                      name={ `${ name }[${ index }]` }\r\n                      index={ index }\r\n                      isLastItem={ index === rows.length - 1 }\r\n                      data={ data }\r\n                      arrayHelpers={ arrayHelpers }\r\n                    />\r\n                )\r\n              }\r\n            </BodyWrapper>\r\n            { Footer && <Footer addItem={ (item) => arrayHelpers.push(item || defaultItem) } /> }\r\n          </ArrayContextProvider>\r\n        </Wrapper>\r\n      }\r\n    </FieldArray>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nimport { Button } from 'reactstrap'\r\n\r\nimport Icon from '../Icon'\r\nimport './table.css'\r\nimport { FormArray } from './array'\r\n\r\nexport const ButtonCell = ({ icon, onClick, style, disabled=false, type }) => {\r\n  const Wrapper = type ?? 'td'\r\n\r\n  return (\r\n    <Wrapper>\r\n      <Button\r\n        block outline color=\"muted\"\r\n        onClick={ onClick }\r\n        style={ style }\r\n        disabled={ disabled }\r\n      >\r\n        <Icon icon={ icon } />\r\n      </Button>\r\n    </Wrapper>\r\n  )\r\n}\r\n\r\nconst DefaultColgroup = ({ name, columns=1 }) =>\r\n  <colgroup>\r\n    <col style={{ width: '5%' }} />\r\n    {\r\n      (new Array(columns)).fill(null).map(\r\n        (_, i) => <col\r\n          key={ `table-${ name }-colgroup-${ i }` }\r\n          style={{ width: `${ 90/columns }%` }}\r\n        />\r\n      )\r\n    }\r\n    <col style={{ width: '5%' }} />\r\n  </colgroup>\r\n\r\nexport const DefaultRow = ({\r\n  index, name, children, arrayHelpers, isLastItem,\r\n  leftColumn: LeftColumn,\r\n  rightColumn: RightColumn,\r\n  wrapper: Wrapper='td'\r\n}) =>\r\n  <tr>\r\n    { LeftColumn\r\n      ? <LeftColumn\r\n          name={ name } index={ index }\r\n          arrayHelpers={ arrayHelpers }\r\n          isLastItem={ isLastItem }\r\n        />\r\n      : <ButtonCell icon=\"bars\" /> }\r\n    <Wrapper>\r\n      { children }\r\n    </Wrapper>\r\n    { RightColumn\r\n      ? <RightColumn\r\n          name={ name } index={ index }\r\n          arrayHelpers={ arrayHelpers }\r\n          isLastItem={ isLastItem }\r\n        />\r\n      : <ButtonCell\r\n          icon=\"trash\"\r\n          onClick={ () => arrayHelpers.remove(index) }\r\n        /> }\r\n  </tr>\r\n\r\nconst DefaultFooter = ({ addItem, columns }) =>\r\n  <tfoot>\r\n    <tr>\r\n      <td></td>\r\n      <td colSpan={ columns }>\r\n        <Button\r\n          block size=\"sm\"\r\n          outline color=\"muted\"\r\n          className=\"hover-target\"\r\n          onClick={ () => addItem() }\r\n        >\r\n          <Icon icon=\"plus\" />\r\n        </Button>\r\n      </td>\r\n      <td></td>\r\n    </tr>\r\n  </tfoot>\r\n\r\nexport const Table = ({\r\n  header: Header,\r\n  row,\r\n  footer: Footer=DefaultFooter,\r\n  columns=1,\r\n  className, ...props\r\n}) =>\r\n  <FormArray\r\n    wrapper=\"table\"\r\n    wrapperProps={{ className: `table grid ${ className }` }}\r\n    header={ ({ name }) =>\r\n      <>\r\n        <DefaultColgroup name={ props.name } columns={ columns }/>\r\n        { Header && <Header name={ name } columns={ columns } /> }\r\n      </>\r\n    }\r\n    bodyWrapper=\"tbody\"\r\n    item={ row }\r\n    footer={ (props) => <Footer columns={ columns } { ...props } /> }\r\n    { ...props }\r\n  />\r\n","import React, { Fragment } from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { CardBody, FormGroup, Col, Label } from 'reactstrap'\r\n\r\nimport { Input } from '../../../../Form'\r\nimport { Table, DefaultRow } from '../../../../Form/table'\r\n\r\nimport Card from '../../../../Card'\r\nimport Hint from '../../../../Hint'\r\n\r\nconst ResponseHeader = () =>\r\n  <thead>\r\n    <tr>\r\n      <th />\r\n      <th className=\"px-2 pt-3\">\r\n        label\r\n        <Hint className=\"ml-2\">\r\n          <p className=\"font-weight-bold\">\r\n            <code>label</code> assigned to a particular response action on part of the participant.\r\n          </p>\r\n          <p className=\"text-muted\">\r\n            The label reflects the <em>meaning</em> of participants' responses. We save the label corresponding to the recorded action in the data.\r\n          </p>\r\n          <p className=\"text-muted\">\r\n            It is possible to have multiple alternative response actions with the same label, for example if participants can use one of several response modalities to indicate their response.\r\n          </p>\r\n        </Hint>\r\n      </th>\r\n      <th className=\"px-2 pt-3\">\r\n        action\r\n        <span className=\"text-muted font-weight-normal\"> · event</span>\r\n        <Hint className=\"ml-2\">\r\n          <p className=\"font-weight-bold\">\r\n            Type of <code>action</code> participants can take to indicate a response. This corresponds to browser events.\r\n          </p>\r\n          <dl className=\"text-muted\">\r\n            <dt>keypress</dt>\r\n            <dd>Pushing a key on the keyboard and releasing it.</dd>\r\n            <dt>keydown</dt>\r\n            <dd>Holding down a key.</dd>\r\n            <dt>keyup</dt>\r\n            <dd>Releasing a key.</dd>\r\n            <dt>click</dt>\r\n            <dd>Pressing and releasing a mouse button.</dd>\r\n            <dt>mousedown</dt>\r\n            <dd>Holding down a mouse button.</dd>\r\n            <dt>mouseup</dt>\r\n            <dd>Releasing a mouse button.</dd>\r\n          </dl>\r\n        </Hint>\r\n      </th>\r\n      <th className=\"px-2 pt-3\">\r\n        target\r\n        <Hint className=\"ml-2\">\r\n          <p className=\"font-weight-bold\">\r\n            The <code>target</code> of the action. This limits a response to certain parts of the screen &ndash; leave blank to record responses for the entire window.\r\n          </p>\r\n          <p>\r\n            The best example for this is if you're looking for clicks on a specific part of the screen rather than anywhere.\r\n          </p>\r\n          <p className=\"text-muted\">\r\n            On <strong>canvas-based screens</strong>, <code>AOIs</code> can be used as target areas. To do so, please enter the <code>@</code> sign followed by the <code>AOI</code> label, for example <code>@label</code>.\r\n          </p>\r\n          <p className=\"text-muted\">\r\n            On <strong><code>HTML</code>-based screens</strong>, the target areas are defined by <code>CSS</code> selectors, e.g. <code>button#option_a</code> corresponds to a <code>&lt;button id=\"option_a\" /&gt;</code> element on screen.\r\n          </p>\r\n        </Hint>\r\n      </th>\r\n      <th className=\"px-2 pt-3\">\r\n        filter\r\n        <span className=\"text-muted font-weight-normal\"> · key/button</span>\r\n        <Hint className=\"ml-2\">\r\n          <p className=\"font-weight-bold\">\r\n            Additional <code>filter</code> applied to the action.\r\n          </p>\r\n          <p>\r\n            For the most part, this specifies the key or button corresponding to the response. Leave empty to count any key or button as the corresponding response.\r\n          </p>\r\n          <p>\r\n            Multiple options are allowed if seperated by a comma.\r\n          </p>\r\n          <dl className=\"text-muted\">\r\n            <dt>Keyboard events</dt>\r\n            <dd>Label of the key pressed, e.g. <code>s</code>, <code>l</code>, <code>Space</code> etc. (upper case is available for letters)</dd>\r\n            <dt>Mouse events</dt>\r\n            <dd>Number corresponding to the mouse button, where <code>0</code> is the innermost button (to the left on a right-handed mouse and vice-versa).</dd>\r\n          </dl>\r\n        </Hint>\r\n      </th>\r\n      <th />\r\n    </tr>\r\n  </thead>\r\n\r\nconst ResponseRow = ({ index, name, arrayHelpers }) =>\r\n  <DefaultRow\r\n    index={ index } arrayHelpers={ arrayHelpers }\r\n    wrapper={ Fragment }\r\n  >\r\n    <td>\r\n      <Field\r\n        name={ `${ name }.label` }\r\n        component={ Input }\r\n        className=\"text-monospace\"\r\n      />\r\n    </td>\r\n    <td>\r\n      <Field\r\n        name={ `${ name }.event` }\r\n        as=\"select\"\r\n        className=\"text-monospace form-control custom-select\"\r\n      >\r\n        <option value=\"\">none (inactive)</option>\r\n        <option value=\"keypress\">keypress</option>\r\n        <option value=\"keydown\">keydown</option>\r\n        <option value=\"keyup\">keyup</option>\r\n        <option value=\"click\">click</option>\r\n        <option value=\"mousedown\">mousedown</option>\r\n        <option value=\"mouseup\">mouseup</option>\r\n      </Field>\r\n    </td>\r\n    <td>\r\n      <Field\r\n        name={ `${ name }.target` }\r\n        placeholder=\"window\"\r\n        component={ Input }\r\n        className=\"text-monospace\"\r\n      />\r\n    </td>\r\n    <td>\r\n      <Field\r\n        name={ `${ name }.filter` }\r\n        placeholder=\"any\"\r\n        component={ Input }\r\n        className=\"text-monospace\"\r\n      />\r\n    </td>\r\n  </DefaultRow>\r\n\r\nexport default () =>\r\n  <Card title=\"Responses\" wrapContent={ false } className=\"mt-4\">\r\n    <Table\r\n      name=\"responses\"\r\n      columns={ 4 }\r\n      row={ ResponseRow }\r\n      header={ ResponseHeader }\r\n      className=\"grid border-top-0 border-bottom\"\r\n    />\r\n    <CardBody>\r\n      <FormGroup row>\r\n        <Label for=\"correctResponse\" xs=\"2\">\r\n          Correct response\r\n          <Hint\r\n            title=\"Correct response\"\r\n            className=\"float-right\"\r\n          >\r\n            <p className=\"font-weight-bold\">\r\n              Label of the response classified as correct.\r\n            </p>\r\n            <p className=\"text-muted\">\r\n              The entry here should correspond to one of the labels assigned to responses in the first column above (placeholders can also be used for varying correct responses).\r\n            </p>\r\n          </Hint>\r\n        </Label>\r\n        <Col xs=\"10\">\r\n          <Field\r\n            name=\"correctResponse\"\r\n            placeholder=\"Undefined\"\r\n            component={ Input }\r\n            className=\"text-monospace\"\r\n          />\r\n        </Col>\r\n      </FormGroup>\r\n    </CardBody>\r\n  </Card>\r\n","import React from 'react'\r\n\r\nimport { Field, useFormikContext } from 'formik'\r\nimport { FormGroup, Col, Label,\r\n  InputGroup, InputGroupAddon, InputGroupText } from 'reactstrap'\r\n\r\nimport Card from '../../../../Card'\r\nimport Hint from '../../../../Hint'\r\nimport { Input, CustomInput } from '../../../../Form'\r\n\r\nexport default () => {\r\n  const { values } = useFormikContext()\r\n\r\n  return (\r\n    <Card title=\"Meta\" className=\"mt-4\">\r\n      <FormGroup row>\r\n        <Label for=\"skip\" xs=\"2\">\r\n          Skip\r\n          <Hint\r\n            title=\"Skip\"\r\n            className=\"float-right\"\r\n          >\r\n            <p className=\"font-weight-bold\">\r\n              Don't run the component during the study.\r\n            </p>\r\n            <p className=\"text-muted\">\r\n              This will cause any component to be prepared, but not run.\r\n            </p>\r\n          </Hint>\r\n        </Label>\r\n        <Col xs=\"10\">\r\n          <InputGroup>\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Field\r\n                  name=\"skip\" id=\"skip\"\r\n                  component={ CustomInput }\r\n                  type=\"checkbox\"\r\n                />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name=\"skipCondition\"\r\n              component={ Input }\r\n              className=\"text-monospace\"\r\n              // eslint-disable-next-line no-template-curly-in-string\r\n              placeholder=\"${ optional condition }\"\r\n              disabled={ values.skip === true }\r\n            />\r\n          </InputGroup>\r\n        </Col>\r\n      </FormGroup>\r\n      <FormGroup row>\r\n        <Label for=\"tardy\" xs=\"2\">\r\n          Tardy\r\n          <Hint\r\n            title=\"Tardiness\"\r\n            className=\"float-right\"\r\n          >\r\n            <p className=\"font-weight-bold\">\r\n              Prepare the component at the last possible moment, just before it is run.\r\n            </p>\r\n            <p className=\"text-muted\">\r\n              This is useful if the component depends on information that becomes available only during the study, for example if a screen's content depends on participant behavior.\r\n            </p>\r\n            <p className=\"text-muted\">\r\n              Ordinarily, a component is prepared when the page is loaded.\r\n            </p>\r\n          </Hint>\r\n        </Label>\r\n        <Col xs=\"10\" className=\"pt-2\">\r\n          <Field\r\n            name=\"tardy\" id=\"tardy\"\r\n            component={ CustomInput }\r\n            type=\"checkbox\"\r\n          />\r\n        </Col>\r\n      </FormGroup>\r\n    </Card>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { Formik } from 'formik'\r\nimport { pick } from 'lodash'\r\n\r\nimport { AutoSave } from '../../Form'\r\nimport { updateComponent } from '../../../actions/components'\r\n\r\nconst Form = ({\r\n  id, data, keys,\r\n  updateComponent,\r\n  postProcess=d => d,\r\n  children,\r\n  ...props\r\n}) =>\r\n  <Formik\r\n    initialValues={ pick(data, keys) }\r\n    enableReinitialize={ true }\r\n    { ...props }\r\n  >\r\n    <>\r\n      { children }\r\n      <AutoSave onSave={ data => updateComponent(id, postProcess(data)) } />\r\n    </>\r\n  </Formik>\r\n\r\nconst mapDispatchToProps = {\r\n  updateComponent\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(Form)\r\n","import React from 'react'\r\n\r\nimport Timeline from './components/Timeline'\r\nimport Responses from './components/Responses'\r\nimport Meta from './components/Meta'\r\n\r\nimport Form from '../Form'\r\n\r\nexport default ({ id, data }) =>\r\n  <Form\r\n    id={ id } data={ data }\r\n    keys={ [\r\n      'responses', 'correctResponse',\r\n      'skip', 'skipCondition',\r\n      'tardy', 'timeline', 'timeout',\r\n    ] }\r\n  >\r\n    <Timeline />\r\n    <Responses />\r\n    <Meta />\r\n  </Form>\r\n","import React, { useMemo } from 'react'\r\nimport { Card as RawCard, CardFooter, Row, Col } from 'reactstrap'\r\nimport { Field, useField } from 'formik'\r\n\r\nimport Form from '../Form'\r\nimport { Input } from '../../../Form'\r\nimport { Table, DefaultRow } from '../../../Form/table'\r\nimport Card from '../../../Card'\r\nimport Editor from '../../../Editor'\r\n\r\nimport { adaptiveFunction } from '../../../../logic/util/async'\r\n\r\nimport './style.css'\r\n\r\nconst WrappedEditor = ({ name }) => {\r\n  const [{ value }, , { setValue }] = useField(name)\r\n\r\n  // TODO: Throttle error checking\r\n  const errors = useMemo(\r\n    () => parsingErrors(value),\r\n    [value]\r\n  )\r\n\r\n  return (\r\n    <RawCard\r\n      outline\r\n      color={ errors ? 'warning' : 'secondary' }\r\n      className=\"editor-field\"\r\n    >\r\n      <Editor\r\n        height={600}\r\n        language=\"javascript\"\r\n        value={ value }\r\n        onChange={ value => setValue(value) }\r\n      />\r\n      {\r\n        errors\r\n          ? <CardFooter>\r\n              <strong>{ errors && errors.name }:</strong>&nbsp;\r\n              { errors && errors.message }\r\n            </CardFooter>\r\n          : null\r\n      }\r\n    </RawCard>\r\n  )\r\n}\r\n\r\nconst parsingErrors = (code) => {\r\n  // TODO: Ideally, the error checking performed here\r\n  //   would be done by a linter. Sadly, eslint doesn't\r\n  //   work in the browser directly, but there appear\r\n  //   to be some workarounds that, however, require\r\n  //   a custom build.\r\n  try {\r\n    adaptiveFunction(code)\r\n    return null\r\n  } catch (e) {\r\n    return {\r\n      name: e.name,\r\n      message: e.message,\r\n    }\r\n  }\r\n}\r\n\r\nconst GridRow = ({ name, arrayHelpers }) =>\r\n  <DefaultRow name={ name } arrayHelpers={ arrayHelpers }>\r\n    <Row form>\r\n      <Col xs=\"6\">\r\n        <Field\r\n          name={ `${ name }.name` }\r\n          component={ Input }\r\n          placeholder=\"parameter\"\r\n          className=\"text-monospace\"\r\n        />\r\n      </Col>\r\n      <Col xs=\"6\">\r\n        <Field\r\n          name={ `${ name }.message` } as=\"select\"\r\n          className=\"text-monospace form-control custom-select\"\r\n        >\r\n          <option value=\"\">event</option>\r\n          <option value=\"before:prepare\">before:prepare</option>\r\n          <option value=\"after:prepare\">after:prepare</option>\r\n          <option value=\"run\">run</option>\r\n          <option value=\"end\">end</option>\r\n          <option value=\"after:end\">after:end</option>\r\n          <option value=\"commit\">commit</option>\r\n        </Field>\r\n      </Col>\r\n    </Row>\r\n    <WrappedEditor\r\n      name={ `${ name }.code` }\r\n    />\r\n  </DefaultRow>\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Scripts\" wrapContent={ false }>\r\n    <Form\r\n      id={ id } data={ data }\r\n      keys={ ['messageHandlers'] }\r\n    >\r\n      <Table\r\n        name=\"messageHandlers\"\r\n        defaultItem={{ title: '', message: '', code: '' }}\r\n        row={ GridRow }\r\n        className=\"no-header\"\r\n      />\r\n    </Form>\r\n  </Card>\r\n","import React from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\nimport { Button } from 'reactstrap'\r\n\r\nimport FileSelector from '../../../FileSelector'\r\nimport Icon from '../../../Icon'\r\n\r\nconst Footer = ({ addItem }, { id }) => {\r\n  let fileSelector = React.createRef()\r\n\r\n  return <tfoot>\r\n    <tr>\r\n      <td />\r\n      <td>\r\n        <FileSelector\r\n          ref={ fileSelector }\r\n          component={ id }\r\n        />\r\n        <Button\r\n          size=\"sm\" block\r\n          outline color=\"muted\"\r\n          className=\"hover-target\"\r\n          onClick={ async () => {\r\n            try {\r\n              await fileSelector.current.select()\r\n            } catch (error) {\r\n              console.log('Error while adding file', error)\r\n            }\r\n          } }\r\n          onMouseUp={ e => e.target.blur() }\r\n        >\r\n          <Icon icon=\"plus\" />\r\n        </Button>\r\n      </td>\r\n      <td />\r\n    </tr>\r\n  </tfoot>\r\n}\r\n\r\nFooter.contextTypes = {\r\n  id: PropTypes.oneOfType([\r\n    PropTypes.string,\r\n    PropTypes.number,\r\n  ]),\r\n}\r\n\r\nexport default Footer\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Field } from 'formik'\r\n\r\nimport Card from '../../../Card'\r\nimport { Input } from '../../../Form'\r\nimport { Table, DefaultRow, ButtonCell } from '../../../Form/table'\r\nimport Form from '../Form'\r\nimport Footer from './footer'\r\n\r\nimport { dataURItoIcon } from '../../../../logic/util/fileType'\r\n\r\nconst mapStateToProps = (state, { poolPath }) => {\r\n  const file = state.files.files[poolPath]\r\n\r\n  // If the file can't be found, something is wrong\r\n  const icon = file\r\n    ? dataURItoIcon(file.content)\r\n    : 'file-exclamation'\r\n\r\n  return { icon }\r\n}\r\n\r\nconst FileIconCell = connect(mapStateToProps)(ButtonCell)\r\n\r\nconst FileRow = ({ index, name, data, arrayHelpers }) =>\r\n  <DefaultRow\r\n    index={ index } arrayHelpers={ arrayHelpers }\r\n    leftColumn={ () => <FileIconCell poolPath={ data.poolPath } />}\r\n  >\r\n    <Field\r\n      name={ `${ name }.localPath` }\r\n      placeholder=\"filename\"\r\n      component={ Input }\r\n      className=\"text-monospace\"\r\n    />\r\n  </DefaultRow>\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Files\" wrapContent={ false }>\r\n    <Form\r\n      id={ id } data={ data }\r\n      keys={ ['files'] }\r\n    >\r\n      <Table\r\n        name=\"files\"\r\n        row={ FileRow }\r\n        footer={ Footer }\r\n        className=\"no-header\"\r\n      />\r\n    </Form>\r\n  </Card>\r\n","import React from 'react'\r\n\r\nimport { ListGroup, ListGroupItem, Card as BaseCard } from 'reactstrap'\r\n\r\nimport Modal from '../../../Modal'\r\nimport Confirm from '../../../Modal/components/Confirm'\r\nimport { plugins } from '../../../../logic/plugins/library'\r\n\r\nexport default ({ isOpen, onRequestClose: requestClose, onAdd }) =>\r\n  <Modal\r\n    isOpen={ isOpen }\r\n    onRequestClose={ requestClose }\r\n  >\r\n    <Confirm\r\n      title=\"Plugins\"\r\n      closeHandler={ requestClose }\r\n    >\r\n      <p><strong>Plugins change the behavior of a component</strong>, and can add further functionality. Please select one to include it.</p>\r\n      <BaseCard className=\"card-flush\">\r\n        <ListGroup className=\"list-group-flush\">\r\n          {\r\n            Object.entries(plugins).map(([type, pluginData], index) =>\r\n              <ListGroupItem\r\n                key={ `plugin-available-${ index }` }\r\n                action style={{ cursor: 'pointer' }}\r\n                onClick={ () => {\r\n                  onAdd(type)\r\n                  requestClose()\r\n                } }\r\n              >\r\n                <strong>{ pluginData.title }</strong>\r\n              </ListGroupItem>\r\n            )\r\n          }\r\n        </ListGroup>\r\n      </BaseCard>\r\n      <div className=\"mt-3\">\r\n        <small className=\"text-muted\">\r\n          Missing something? Ideas for improving things? Please <a href=\"https://labjs.readthedocs.io/en/latest/meta/contribute/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">suggest or contribute</a>!\r\n        </small>\r\n      </div>\r\n    </Confirm>\r\n  </Modal>\r\n","import React, { useState } from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { FormGroup, Label, Col, Button } from 'reactstrap'\r\nimport { fromPairs } from 'lodash'\r\n\r\nimport Card from '../../../Card'\r\nimport Form from '../Form'\r\nimport Icon from '../../../Icon'\r\n\r\nimport { Input } from '../../../Form'\r\nimport { Table, DefaultRow } from '../../../Form/table'\r\nimport PluginAddModal from './modal'\r\nimport { loadPlugin } from '../../../../logic/plugins/library'\r\n\r\nconst PluginHeader = ({ metadata }) =>\r\n  <>\r\n    <h3 className=\"h5 mt-2\">\r\n      { metadata.title }\r\n      {\r\n        metadata.description\r\n          && <small className=\"text-muted\"> · { metadata.description }</small>\r\n      }\r\n    </h3>\r\n    <hr className=\"my-3\" />\r\n  </>\r\n\r\nconst PluginHint = ({ visible }) =>\r\n  visible\r\n    ? <div className=\"text-center p-5 pb-2\">\r\n        <Icon\r\n          icon=\"plug\"\r\n          className=\"d-block text-muted p-3\"\r\n          style={{\r\n            fontSize: '3.5rem',\r\n          }}\r\n        />\r\n        <div className=\"text-muted\">\r\n          <strong>\r\n            Plugins extend components' functionality\r\n          </strong><br />\r\n          <small>Please click below to add one.</small>\r\n        </div>\r\n      </div>\r\n    : null\r\n\r\n const PluginControl = ({ name, type, options=[], placeholder }) => {\r\n    switch (type) {\r\n      case 'select':\r\n        return <Field\r\n          name={ name } as=\"select\"\r\n          className=\"form-control custom-select text-monospace\"\r\n        >\r\n          {\r\n            options.map(o =>\r\n              <option key={ `${ name }-${ o.coding }` } value={ o.coding }>\r\n                { o.label }\r\n              </option>\r\n            )\r\n          }\r\n        </Field>\r\n      default:\r\n        return <Field\r\n          name={ name }\r\n          component={ Input }\r\n          placeholder={ placeholder }\r\n          className=\"text-monospace\"\r\n        />\r\n    }\r\n  }\r\n\r\nconst PluginOption = (props) =>\r\n  <FormGroup row>\r\n    <Label for={ props.option } sm={ 3 }>{ props.label }</Label>\r\n    <Col sm={ 9 }>\r\n      <PluginControl { ...props } />\r\n      {\r\n        props.help &&\r\n          <small className=\"form-text text-muted\">{ props.help }</small>\r\n      }\r\n    </Col>\r\n  </FormGroup>\r\n\r\nconst PluginBody = ({ name, index, metadata }) =>\r\n  <>\r\n    {\r\n      Object.entries(metadata.options).map(\r\n        ([optionName, { default: defaultValue, ...optionProps }]) =>\r\n          <PluginOption\r\n            key={ `plugin-${ index }-${ optionName }` }\r\n            name={ `${ name }.${ optionName }` }\r\n            defaultValue={ defaultValue }\r\n            { ...optionProps }\r\n          />\r\n      )\r\n    }\r\n  </>\r\n\r\nconst PluginRow = ({ index, name, data, arrayHelpers }) => {\r\n  const metadata = loadPlugin(data.type)\r\n\r\n  return (\r\n    <DefaultRow index={ index } arrayHelpers={ arrayHelpers }>\r\n      <PluginHeader metadata={ metadata } />\r\n      <PluginBody\r\n        name={ name } index={ index }\r\n        data={ data } metadata={ metadata }\r\n      />\r\n    </DefaultRow>\r\n  )\r\n}\r\n\r\nconst getDefaultSettings = (pluginType) => {\r\n  const metadata = loadPlugin(pluginType)\r\n\r\n  return {\r\n    type: pluginType,\r\n    ...fromPairs(\r\n      Object.entries(metadata.options)\r\n        .map(([k, v]) => [k, v.default || ''])\r\n    ),\r\n  }\r\n}\r\n\r\nconst PluginFooter = ({ addItem }) => {\r\n  const [modalOpen, setModalOpen] = useState(false)\r\n\r\n  return (\r\n    <tfoot>\r\n      <tr>\r\n        <td />\r\n        <td>\r\n          <PluginAddModal\r\n            isOpen={ modalOpen }\r\n            onRequestClose={ () => setModalOpen(false) }\r\n            onAdd={ type => addItem(getDefaultSettings(type)) }\r\n          />\r\n          <Button\r\n            size=\"sm\" block\r\n            outline color=\"muted\"\r\n            className=\"hover-target\"\r\n            onClick={ () => setModalOpen(true) }\r\n            onMouseUp={ e => e.target.blur() }\r\n          >\r\n            <Icon icon=\"plus\" />\r\n          </Button>\r\n        </td>\r\n        <td />\r\n      </tr>\r\n    </tfoot>\r\n  )\r\n}\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Plugins\" badge=\"Beta\" wrapContent={ false }>\r\n    <Form\r\n      id={ id } data={ data }\r\n      keys={ ['plugins'] }\r\n    >\r\n      <PluginHint\r\n        visible={\r\n          !data.plugins ||\r\n          (Array.isArray(data.plugins) && data.plugins.length === 0)\r\n        }\r\n      />\r\n      <Table\r\n        name=\"plugins\"\r\n        row={ PluginRow }\r\n        footer={ PluginFooter }\r\n        className=\"no-header\"\r\n      />\r\n    </Form>\r\n  </Card>\r\n","import React, { useState } from 'react'\r\n\r\nimport { Row, Col, InputGroup, InputGroupButtonDropdown, DropdownToggle, DropdownMenu, DropdownItem, CardBody, FormGroup } from 'reactstrap'\r\nimport { useField, Field } from 'formik'\r\nimport classnames from 'classnames'\r\n\r\nimport Card from '../../Card'\r\nimport Icon from '../../Icon'\r\nimport Form from './Form'\r\nimport { Input } from '../../Form'\r\nimport { Table, DefaultRow } from '../../Form/table'\r\n\r\nconst CellTypeSelector = ({ name, disabled }) => {\r\n  const [, meta, helpers] = useField(name)\r\n  const { value } = meta\r\n  const { setValue } = helpers\r\n\r\n  const [dropdownOpen, setDropdownOpen] = useState(false)\r\n\r\n  return (\r\n    <InputGroupButtonDropdown\r\n      addonType=\"append\"\r\n      disabled={ disabled }\r\n      isOpen={ dropdownOpen }\r\n      toggle={ () => setDropdownOpen(!dropdownOpen) }\r\n    >\r\n      <DropdownToggle\r\n        caret={ !disabled }\r\n        disabled={ disabled }\r\n        outline color=\"secondary\"\r\n        // Ensure that the right-hand side\r\n        // always has rounded corners\r\n        // (this didn't work if the button was disabled)\r\n        className=\"rounded-right\"\r\n      >\r\n        <Icon\r\n          icon={{\r\n            string: 'font',\r\n            number: 'tachometer',\r\n            boolean: 'adjust'\r\n          }[value]}\r\n          fixedWidth\r\n        />\r\n      </DropdownToggle>\r\n      <DropdownMenu right>\r\n        <DropdownItem header>Data type</DropdownItem>\r\n        <DropdownItem\r\n          className={ classnames({\r\n            'dropdown-item-active': value === 'string'\r\n          }) }\r\n          onClick={ () => setValue('string') }\r\n        >\r\n          Text <span className=\"text-muted\">(categorical)</span>\r\n        </DropdownItem>\r\n        <DropdownItem\r\n          className={ classnames({\r\n            'dropdown-item-active': value === 'number'\r\n          }) }\r\n          onClick={ () => setValue('number') }\r\n        >\r\n          Numerical <span className=\"text-muted\">(continuous)</span>\r\n        </DropdownItem>\r\n        <DropdownItem\r\n          className={ classnames({\r\n            'dropdown-item-active': value === 'boolean'\r\n          }) }\r\n          onClick={ () => setValue('boolean') }\r\n        >\r\n          Boolean <span className=\"text-muted\">(binary)</span>\r\n        </DropdownItem>\r\n      </DropdownMenu>\r\n    </InputGroupButtonDropdown>\r\n  )\r\n}\r\n\r\nconst TemplateRow = ({ index, name, arrayHelpers, readOnly }) =>\r\n  <DefaultRow index={ index } arrayHelpers={ arrayHelpers }>\r\n    <Row form>\r\n      <Col xs=\"6\">\r\n        <Field\r\n          name={ `${ name }.name` }\r\n          component={ Input }\r\n          placeholder=\"parameter\"\r\n          disabled={ readOnly }\r\n          className=\"text-monospace\"\r\n        />\r\n      </Col>\r\n      <Col xs=\"6\">\r\n        <InputGroup>\r\n          <Field\r\n            name={ `${ name }.value` }\r\n            component={ Input }\r\n            placeholder=\"value\"\r\n            className=\"text-monospace\"\r\n          />\r\n          <CellTypeSelector\r\n            name={ `${ name }.type` }\r\n          />\r\n        </InputGroup>\r\n      </Col>\r\n    </Row>\r\n  </DefaultRow>\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Template\" wrapContent={false}>\r\n    <Form\r\n      id={ id } data={ data }\r\n      keys={ ['notes', 'parameters'] }\r\n    >\r\n      <CardBody className=\"border-bottom\">\r\n        <FormGroup>\r\n          <Field\r\n            name=\"notes\"\r\n            component=\"textarea\"\r\n            rows=\"5\"\r\n            placeholder=\"Notes\"\r\n            className=\"form-control form-control-sm\"\r\n            style={{\r\n              padding: '0.5rem 0.75rem',\r\n            }}\r\n          />\r\n        </FormGroup>\r\n      </CardBody>\r\n      <Table\r\n        name=\"parameters\"\r\n        defaultItem={{ name: '', value: '', type: 'string' }}\r\n        row={ TemplateRow }\r\n        className=\"no-header\"\r\n      />\r\n    </Form>\r\n  </Card>\r\n","import React from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { FormGroup, Col, Label } from 'reactstrap'\r\n\r\nimport Card from '../../Card'\r\nimport Hint from '../../Hint'\r\n\r\nimport Form from './Form'\r\nimport { CustomInput } from '../../Form'\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Advanced options\">\r\n    <Form\r\n      id={ id } data={ data }\r\n      keys={ ['scrollTop', '_template'] }\r\n    >\r\n      <FormGroup row>\r\n        <Col xs={2}>\r\n          <Label>\r\n            Run\r\n          </Label>\r\n        </Col>\r\n        <Col xs={10}>\r\n          <FormGroup check>\r\n            <Field\r\n              name=\"scrollTop\"\r\n              component={ CustomInput }\r\n              id=\"scrollTop\"\r\n              type=\"checkbox\"\r\n              inline={true}\r\n              label=\"Scroll to top before running\"\r\n            />\r\n            <Hint\r\n              title=\"Scroll to Top\"\r\n              style={{\r\n                marginLeft: '1rem',\r\n              }}\r\n            >\r\n              <p className=\"font-weight-bold\">\r\n                Reset scroll position to the top of the page\r\n                when showing content\r\n              </p>\r\n              <p className=\"text-muted\">\r\n                This is useful if the preceding and current screen\r\n                both occupy a lot of vertical space, as it saves\r\n                participants from having to scroll back upwards\r\n                manually between pages.\r\n              </p>\r\n            </Hint>\r\n          </FormGroup>\r\n        </Col>\r\n      </FormGroup>\r\n      <FormGroup row>\r\n        <Col xs={2}>\r\n          <Label>\r\n            Display\r\n          </Label>\r\n        </Col>\r\n        <Col xs={10}>\r\n          <FormGroup check>\r\n            <Field\r\n              name=\"_template\"\r\n              component={ CustomInput }\r\n              id=\"_template\"\r\n              type=\"checkbox\"\r\n              inline={true}\r\n              label=\"Template\"\r\n            />\r\n            <Hint\r\n              title=\"Template\"\r\n              style={{\r\n                marginLeft: '1rem',\r\n              }}\r\n            >\r\n              <p className=\"font-weight-bold\">\r\n                Reduce visible settings so that only parameters can be changed.\r\n              </p>\r\n              <p className=\"text-muted\">\r\n                Making a component a template simplifies complex components and bundle nested hierarchies into a single module. This creates reusable components that are defined only by their parameters.\r\n              </p>\r\n              <p className=\"text-muted\">\r\n                Making a component a template prevents direct modification of all component details, and hides nested components.\r\n              </p>\r\n            </Hint>\r\n          </FormGroup>\r\n        </Col>\r\n      </FormGroup>\r\n\r\n    </Form>\r\n  </Card>\r\n","import React, { lazy, Suspense } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport Card from '../../../../Card'\r\nimport Spinner from '../../../../Spinner'\r\nimport { updateComponent } from '../../../../../actions/components'\r\n\r\nconst CanvasEditor = lazy(() => import('./editor'))\r\n\r\nconst Editor = ({ id, data, updateComponent }) =>\r\n  <Card title=\"Content\">\r\n    <Suspense fallback={ <Spinner /> }>\r\n      <CanvasEditor\r\n        id={ id }\r\n        data={ data.content }\r\n        onChange={\r\n          newData => updateComponent(id, { content: newData })\r\n        }\r\n      />\r\n    </Suspense>\r\n  </Card>\r\n\r\nconst mapDispatchToProps = {\r\n  updateComponent\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(Editor)\r\n","import React from 'react'\r\nimport { useField } from 'formik'\r\n\r\nimport Editor from './index'\r\n\r\nexport default ({ name, ...props }) => {\r\n  const [field, , helpers] = useField(name)\r\n\r\n  return <Editor\r\n    value={ field.value }\r\n    onChange={ helpers.setValue }\r\n    {...props}\r\n  />\r\n}\r\n","import React from 'react'\r\nimport { CardBody } from 'reactstrap'\r\n\r\nimport Form from '../Form'\r\nimport Card from '../../../Card'\r\nimport EditorField from '../../../Editor/field'\r\n\r\nexport default ({ id, data }) =>\r\n  // Chrome requires explicit height settings\r\n  // throughout, which in turn necessitates\r\n  // manually wrapping the content in a <CardBody>\r\n  // as well as the h-100 classes at every level\r\n  // TODO: The layout here should be revisited\r\n  // periodically to check whether the chrome bug\r\n  // has been addressed\r\n  <Card title=\"Content\"\r\n    className=\"flex-grow-1\"\r\n    wrapContent={ false }\r\n  >\r\n    {/* Holy multiply nested flexbox Batman! */}\r\n    <CardBody className=\"h-100 d-flex flex-column\">\r\n      <Form\r\n        id={ id }\r\n        data={ data }\r\n        keys={ ['content'] }\r\n        className=\"flex-grow-1 d-flex flex-column\"\r\n      >\r\n        <EditorField\r\n          name=\"content\"\r\n          language=\"html\"\r\n        />\r\n      </Form>\r\n    </CardBody>\r\n  </Card>\r\n","import React from 'react'\r\nimport { Field } from 'formik'\r\nimport { CardBody, FormGroup, Label, FormText } from 'reactstrap'\r\n\r\nimport Form from '../Form'\r\nimport { Input } from '../../../Form'\r\nimport Card from '../../../Card'\r\nimport EditorField from '../../../Editor/field'\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Content\"\r\n    wrapContent={ false }\r\n    className=\"flex-grow-1 d-flex flex-column\"\r\n  >\r\n    {/* Holy multiply nested flexbox Batman! */}\r\n    <Form\r\n      id={ id }\r\n      data={ data }\r\n      keys={ ['context', 'contextSelector'] }\r\n      className=\"flex-grow-1 d-flex flex-column\"\r\n    >\r\n      <CardBody className=\"flex-grow-1 d-flex flex-column\">\r\n        <EditorField\r\n          name=\"context\"\r\n          language=\"html\"\r\n        />\r\n      </CardBody>\r\n      <CardBody\r\n        className=\"flex-grow-0\"\r\n        style={{\r\n          borderTop: '1px solid rgba(0, 0, 0, 0.125)',\r\n        }}\r\n      >\r\n        <FormGroup>\r\n          <Label for=\"contextSelector\">\r\n            Context selector\r\n          </Label>\r\n          <Field\r\n            name=\"contextSelector\" id=\"contextSelector\"\r\n            component={ Input }\r\n            className=\"text-monospace\"\r\n          />\r\n          <FormText color=\"muted\">\r\n            This CSS selector defines where nested components get to insert their content.\r\n          </FormText>\r\n        </FormGroup>\r\n      </CardBody>\r\n    </Form>\r\n  </Card>\r\n","import React, { useState } from 'react'\r\n\r\nimport { InputGroupButtonDropdown, DropdownToggle, DropdownMenu, DropdownItem,\r\n  InputGroup } from 'reactstrap'\r\nimport classnames from 'classnames'\r\n\r\nimport { useArrayContext } from '../../../../../Form/array'\r\nimport { ButtonCell } from '../../../../../Form/table'\r\nimport Icon from '../../../../../Icon'\r\nimport { FastField, useField } from 'formik'\r\n\r\nconst CellTypeDropdown = ({ name, index, actions, disabled=false }) => {\r\n  const [field, , helpers] = useField(name)\r\n  const [dropdownOpen, setDropdownOpen] = useState(false)\r\n\r\n  return (\r\n    <InputGroupButtonDropdown\r\n      addonType=\"append\"\r\n      disabled={ disabled }\r\n      isOpen={ dropdownOpen }\r\n      toggle={ () => setDropdownOpen(!dropdownOpen) }\r\n    >\r\n      <DropdownToggle\r\n        caret={ !disabled }\r\n        disabled={ disabled }\r\n        outline color=\"secondary\"\r\n        // Ensure that the right-hand side always has rounded corners\r\n        // (this didn't work if the button was disabled)\r\n        className=\"rounded-right\"\r\n      >\r\n        <Icon\r\n          icon={{\r\n            string: 'font',\r\n            number: 'tachometer',\r\n            boolean: 'adjust'\r\n          }[field.value]}\r\n          fixedWidth\r\n        />\r\n      </DropdownToggle>\r\n      <DropdownMenu right>\r\n        <DropdownItem header>Data type</DropdownItem>\r\n        <DropdownItem\r\n          className={ classnames({\r\n            'dropdown-item-active': field.value === 'string'\r\n          }) }\r\n          onClick={ () => helpers.setValue('string') }\r\n        >\r\n          Text <span className=\"text-muted\">(categorical)</span>\r\n        </DropdownItem>\r\n        <DropdownItem\r\n          className={ classnames({\r\n            'dropdown-item-active': field.value === 'number'\r\n          }) }\r\n          onClick={ () => helpers.setValue('number') }\r\n        >\r\n          Numerical <span className=\"text-muted\">(continuous)</span>\r\n        </DropdownItem>\r\n        <DropdownItem\r\n          className={ classnames({\r\n            'dropdown-item-active': field.value === 'boolean'\r\n          }) }\r\n          onClick={ () => helpers.setValue('boolean') }\r\n        >\r\n          Boolean <span className=\"text-muted\">(binary)</span>\r\n        </DropdownItem>\r\n        {\r\n          actions\r\n            ? <div>\r\n                <DropdownItem divider />\r\n                <DropdownItem header>\r\n                  Actions\r\n                </DropdownItem>\r\n                {\r\n                  Object.entries(actions).map(([k, v], i) =>\r\n                    <DropdownItem onClick={ () => v(index) } key={ i }>\r\n                      { k }\r\n                    </DropdownItem>\r\n                  )\r\n                }\r\n              </div>\r\n            : <div></div>\r\n        }\r\n      </DropdownMenu>\r\n    </InputGroupButtonDropdown>\r\n  )\r\n}\r\n\r\nexport const HeaderCell = ({ index, actions }) =>\r\n  <InputGroup>\r\n    <FastField\r\n      name={ `templateParameters.columns[${ index }].name` }\r\n      placeholder={ `parameter${ index }` }\r\n      className=\"form-control text-monospace font-weight-bolder\"\r\n      style={{ height: '42px' }}\r\n    />\r\n    <CellTypeDropdown\r\n      name={ `templateParameters.columns[${ index }].type` }\r\n      index={ index }\r\n      actions={ actions }\r\n    />\r\n  </InputGroup>\r\n\r\nexport default ({ name, columns }) => {\r\n  const { addColumn, fillColumn, clearColumn, deleteColumn } = useArrayContext()\r\n\r\n  return (\r\n    <thead>\r\n      <tr>\r\n        <th></th>\r\n        { Array(columns).fill(null).map((_, i) =>\r\n          <th key={ `${ name }-header-${ i }` }>\r\n            <HeaderCell\r\n              index={ i }\r\n              actions={{\r\n                'Fill': fillColumn,\r\n                'Clear': clearColumn,\r\n                'Delete': deleteColumn,\r\n              }}\r\n            />\r\n          </th>\r\n        ) }\r\n        <ButtonCell\r\n          type=\"th\" icon=\"plus\"\r\n          style={{ height: '42px' }}\r\n          onClick={ () => addColumn('', { name: '', type: 'string' }) }\r\n          disabled={ columns >= 12 }\r\n        />\r\n      </tr>\r\n    </thead>\r\n  )\r\n}\r\n","import React, { Fragment, Component } from 'react'\r\n\r\nimport { Formik, Form, Field } from 'formik'\r\nimport { ModalHeader, ModalBody, ModalFooter, Button } from 'reactstrap'\r\n\r\nimport Modal from '../../../../../Modal'\r\nimport { Table, DefaultRow } from '../../../../../Form/table'\r\nimport { Input } from '../../../../../Form'\r\n\r\n// Logic -----------------------------------------------------------------------\r\n// (copied from the library combinatorics implementation)\r\n\r\nconst product = function* (...sets) {\r\n  let thresholds = sets\r\n    .map(s => Math.max(s.length, 1)).reverse()\r\n    .reduce(\r\n      (acc, current, i) => acc.concat([\r\n        (acc[i - 1] || 1) * current\r\n      ]), []\r\n    )\r\n    .reverse()\r\n\r\n  for (let counter = 0; counter < thresholds[0]; counter++) {\r\n    yield sets.map(\r\n      (s, i) => s[Math.floor(counter / (thresholds[i + 1] || 1)) % s.length]\r\n    )\r\n  }\r\n}\r\n\r\nconst generateTable = (factors) => {\r\n  const names = factors.map(f => f.name)\r\n  const levels = factors.map(f => f.levels.split('\\n').filter(c => c !== ''))\r\n\r\n  return {\r\n    columns: names.map(name => ({ name, type: 'string' })),\r\n    rows: Array.from(product(...levels)),\r\n  }\r\n}\r\n\r\n// UI --------------------------------------------------------------------------\r\n\r\nconst TableRow = ({ name, arrayHelpers }) =>\r\n  <DefaultRow name={ name } arrayHelpers={ arrayHelpers } wrapper={ Fragment }>\r\n    <td>\r\n      <Field\r\n        name={ `${ name }.name` }\r\n        component={ Input }\r\n        placeholder=\"Parameter name\"\r\n        className=\"text-monospace\"\r\n      />\r\n    </td>\r\n    <td>\r\n      <Field\r\n        name={ `${ name }.levels` }\r\n        component=\"textarea\"\r\n        placeholder=\"Levels (one line each)\"\r\n        className=\"form-control text-monospace\"\r\n        style={{\r\n          height: `${ (2 + 1.5) * 1.6 }em`, // TODO: Re-enable dynamic sizing\r\n          minHeight: '80px',\r\n          maxHeight: '150px',\r\n        }}\r\n      />\r\n    </td>\r\n  </DefaultRow>\r\n\r\nconst Header = () =>\r\n  <thead>\r\n    <tr>\r\n      <th />\r\n      <th className=\"px-2 pt-3\">Factor</th>\r\n      <th className=\"px-2 pt-3\">Levels</th>\r\n      <th />\r\n    </tr>\r\n  </thead>\r\n\r\nclass FactorialModal extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = { isOpen: false }\r\n    this.promiseHandlers = {}\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({ isOpen: !this.state.isOpen })\r\n  }\r\n\r\n  async show() {\r\n    this.toggle()\r\n    return new Promise(\r\n      (resolve, reject) => {\r\n        this.promiseHandlers = {\r\n          resolve: result => {\r\n            this.setState({ isOpen: false })\r\n            return resolve(result)\r\n          },\r\n          reject\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return <Modal\r\n      isOpen={ this.state.isOpen }\r\n      modalProps={{ size: 'lg' }}\r\n    >\r\n      <Formik\r\n        initialValues={{\r\n          factors: [\r\n            { name: 'Factor A', levels: 'Level A1\\nLevel A2' },\r\n            { name: 'Factor B', levels: 'Level B1\\nLevel B2' },\r\n          ]\r\n        }}\r\n        onSubmit={ (values) => {\r\n          console.log('in Onsubmit')\r\n          const table = generateTable(values.factors)\r\n          if (this.promiseHandlers.resolve) {\r\n            this.promiseHandlers.resolve(table)\r\n          }\r\n        } }\r\n      >\r\n        <Form>\r\n          <div className=\"modal-content\">\r\n            <ModalHeader toggle={ this.toggle }>\r\n              Generate factorial design\r\n            </ModalHeader>\r\n            <ModalBody>\r\n              <p><strong>Please specify the factors in your design, as well as their levels.</strong> <span className=\"text-muted\">The resulting design is fully crossed, meaning that in the loop, every level of a factor is combined with every level of every other factor.</span></p>\r\n              <hr style={{ marginBottom: '0' }} />\r\n            </ModalBody>\r\n            <Table\r\n              name=\"factors\"\r\n              columns={ 2 }\r\n              row={ TableRow }\r\n              header={ Header }\r\n              defaultItem={{ name: '', levels: '' }}\r\n              className=\"grid border-top-0 mb-0\"\r\n            />\r\n            <ModalFooter>\r\n              <Button outline color=\"secondary\" onClick={ this.toggle }>\r\n                Close\r\n              </Button>\r\n              <Button outline color=\"primary\" type=\"submit\">\r\n                Generate\r\n              </Button>\r\n            </ModalFooter>\r\n          </div>\r\n        </Form>\r\n      </Formik>\r\n    </Modal>\r\n  }\r\n}\r\n\r\nexport default FactorialModal\r\n","import React, { useState, createRef } from 'react'\r\n\r\nimport { ButtonDropdown, Button,\r\n  DropdownToggle, DropdownMenu, DropdownItem  } from 'reactstrap'\r\nimport { range } from 'lodash'\r\n\r\nimport Icon from '../../../../../Icon'\r\nimport FactorialModal from '../DesignWizard/FactorialModal'\r\nimport { useArrayContext } from '../../../../../Form/array'\r\n\r\nimport Uploader from '../../../../../Uploader'\r\nimport { saveAs } from 'file-saver'\r\nimport { parse, unparse } from 'papaparse'\r\n\r\nconst exportGrid = (data, columns) => {\r\n  const output = unparse({\r\n    fields: columns.map(c => c.name),\r\n    data\r\n  })\r\n\r\n  return saveAs(\r\n    new Blob(\r\n      [ output ],\r\n      { type: 'text/csv;charset=utf-8' }\r\n    ),\r\n    'loop.csv'\r\n  )\r\n}\r\n\r\nexport default ({ addItem, columns }) => {\r\n  const [dropdownOpen, setDropdownOpen] = useState(false)\r\n  const factorialModal = createRef()\r\n  const { dispatch, overwriteAll } = useArrayContext()\r\n\r\n  return (\r\n    <tfoot>\r\n      <tr>\r\n        <td />\r\n        <td colSpan={ columns }>\r\n          <FactorialModal ref={ factorialModal } />\r\n          <ButtonDropdown\r\n            size=\"sm\"\r\n            className=\"w-100\"\r\n            isOpen={ dropdownOpen }\r\n            toggle={ () => setDropdownOpen(!dropdownOpen) }\r\n          >\r\n            <Button\r\n              block size=\"sm\"\r\n              outline color=\"muted\"\r\n              className=\"hover-target\"\r\n              onClick={ () => addItem(Array(columns).fill('')) }\r\n              onMouseUp={ e => e.target.blur() }\r\n              style={{\r\n                paddingLeft: '32px', // 6px standard + 24px toggle width\r\n              }}\r\n            >\r\n              <Icon icon=\"plus\" />\r\n            </Button>\r\n            <DropdownToggle\r\n              caret split size=\"sm\"\r\n              outline color=\"muted\"\r\n              className=\"hover-target\"\r\n              style={{\r\n                width: '24px',\r\n              }}\r\n            />\r\n            <DropdownMenu right>\r\n              <DropdownItem header>Generate</DropdownItem>\r\n              <DropdownItem\r\n                onClick={ () => factorialModal.current.show().then(result => {\r\n                  overwriteAll(result.rows, result.columns)\r\n                }) }\r\n              >\r\n                Factorial design\r\n              </DropdownItem>\r\n              <DropdownItem divider />\r\n              <DropdownItem header>Repeat</DropdownItem>\r\n              <DropdownItem\r\n                onClick={ () => {\r\n                  const n = window.prompt('How many times?')\r\n                  if (n) {\r\n                    dispatch((rows, columns) => [\r\n                      rows.flatMap(r => range(n).map(() => r)),\r\n                      columns,\r\n                    ])\r\n                  }\r\n                } }\r\n              >\r\n                Each row\r\n              </DropdownItem>\r\n              <DropdownItem\r\n                onClick={ () => {\r\n                  const n = window.prompt('How many times?')\r\n                  if (n) {\r\n                    dispatch((rows, columns) => [\r\n                      range(n).flatMap(() => rows),\r\n                      columns,\r\n                    ])\r\n                  }\r\n                } }\r\n              >\r\n                Entire grid\r\n              </DropdownItem>\r\n              <DropdownItem divider />\r\n              <DropdownItem header>CSV / TSV</DropdownItem>\r\n              <Uploader\r\n                accept=\"text/csv,text/tab-separated-values,.csv,.tsv\"\r\n                multiple={ false }\r\n                onUpload={\r\n                  ([[content]]) => {\r\n                    // TODO: Close the dropdown when the file selector\r\n                    // is shown. This needs some more work to make sure\r\n                    // that the uploader component isn't removed from the\r\n                    // page in between\r\n                    setDropdownOpen(false)\r\n\r\n                    const parseResult = parse(\r\n                      content.trim(),\r\n                      { header: true }\r\n                    )\r\n\r\n                    if (\r\n                      // No detected issues\r\n                      parseResult.errors.length === 0 ||\r\n                      // Data is present, but no delimiter found\r\n                      (parseResult.data && parseResult.errors.length === 1 &&\r\n                        parseResult.errors[0].code === 'UndetectableDelimiter')\r\n                    ) {\r\n                      overwriteAll(\r\n                        parseResult.data.map(r => Object.values(r)),\r\n                        Object.keys(parseResult.data[0])\r\n                          .map(c => ({ name: c, type: 'string' })),\r\n                      )\r\n                    } else {\r\n                      console.log(\r\n                        'CSV import found errors: ',\r\n                        parseResult.errors\r\n                      )\r\n                      alert(\r\n                        'Sorry, I couldn\\'t parse that CSV file. ' +\r\n                        'There seems to be an error. ' +\r\n                        'Could you check it, please?'\r\n                      )\r\n                    }\r\n                  }\r\n                }\r\n              >\r\n                <div className=\"dropdown-item\">\r\n                  Import\r\n                </div>\r\n              </Uploader>\r\n              <DropdownItem\r\n                onClick={ () => dispatch((rows, columns) => {\r\n                  exportGrid(rows, columns)\r\n                  // TODO: Can we do without rewriting the data?\r\n                  return [rows, columns]\r\n                }) }\r\n              >\r\n                Export\r\n              </DropdownItem>\r\n            </DropdownMenu>\r\n          </ButtonDropdown>\r\n        </td>\r\n        <td />\r\n      </tr>\r\n    </tfoot>\r\n  )\r\n}\r\n","import React, { Fragment } from 'react'\r\n\r\nimport { FastField, useFormikContext } from 'formik'\r\nimport classnames from 'classnames'\r\n\r\nimport Header from './header'\r\nimport Footer from './footer'\r\nimport { Table, DefaultRow } from '../../../../../Form/table'\r\n\r\nimport './style.css'\r\n\r\nconst Row = ({ index: rowIndex, name, data, arrayHelpers }) =>\r\n  <DefaultRow\r\n    index={ rowIndex } arrayHelpers={ arrayHelpers }\r\n    wrapper={ Fragment }\r\n  >\r\n    { data.map(\r\n      (_, columnIndex) =>\r\n        <td key={ `${ name }[${ columnIndex }]` }>\r\n          <FastField\r\n            name={ `${ name }[${ columnIndex }]` }\r\n            className=\"form-control text-monospace\"\r\n          />\r\n        </td>\r\n    ) }\r\n  </DefaultRow>\r\n\r\nexport default () => {\r\n  const { values } = useFormikContext()\r\n  const { templateParameters } = values\r\n  const columns = templateParameters.columns.length\r\n\r\n  return <Table\r\n    name=\"templateParameters.rows\"\r\n    row={ Row }\r\n    columns={ columns }\r\n    header={ Header }\r\n    footer={ Footer }\r\n    defaultItem={ Array(columns).fill('') }\r\n    className={ classnames({\r\n      'table': true,\r\n      'grid': true,\r\n      'grid-slim': columns > 5,\r\n      'border-top-0 border-bottom': true,\r\n    }) }\r\n  />\r\n}\r\n","import React from 'react'\r\n\r\nimport { Field, useFormikContext } from 'formik'\r\nimport { FormGroup, Label, Col, InputGroup } from 'reactstrap'\r\n\r\nimport Hint from '../../../../../Hint'\r\nimport { Input } from '../../../../../Form'\r\nimport { integerOrPlaceholder } from '../../../Behavior/components/Timeline/util'\r\n\r\nconst switchLabels = ({\r\n  templateParameters={ rows: [] },\r\n  sample={ n: undefined }\r\n}, labels) => {\r\n  const samples = parseInt(sample.n)\r\n  const parameters = templateParameters.rows.length\r\n\r\n  if (samples < parameters) {\r\n    return labels[0]\r\n  } else if (isNaN(samples) || samples === parameters) {\r\n    return labels[1]\r\n  } else {\r\n    return labels[2]\r\n  }\r\n}\r\n\r\nexport default () => {\r\n  const { values } = useFormikContext()\r\n\r\n  return <FormGroup row>\r\n    <Label xs={ 2 } for=\"sampleN\">\r\n      Sample\r\n      <Hint\r\n        title=\"Sampling\"\r\n        className=\"float-right\"\r\n        placement=\"left\"\r\n      >\r\n        <p className=\"font-weight-bold\">\r\n          Control how many, and which of the above parameter sets are used.\r\n        </p>\r\n        <p className=\"text-muted\">\r\n          The <strong>sample size</strong> defines the number of loop iterations. The <strong>mode</strong> determines how the iterations are drawn from the entries above.\r\n        </p>\r\n        <dl className=\"text-muted\">\r\n          <dt>Sequential</dt>\r\n          <dd>Proceed in order, starting from the top. If more samples are requested than entries are available, start over.</dd>\r\n\r\n          <dt>Random order</dt>\r\n          <dd>Present entries in shuffled order<br /> (only available without sampling).</dd>\r\n\r\n          <dt>Sample without replacement</dt>\r\n          <dd>Draw entries at random, starting over when all are exhausted. Shuffles the result for a completely random order.</dd>\r\n\r\n          <dt>Sample w/o replacement (in blocks)</dt>\r\n          <dd>As above, but without shuffling.<br /> If the number of samples exceeds the number of entries, this results in blocks of all entries in random order.</dd>\r\n\r\n          <dt>Sample with replacement</dt>\r\n          <dd>Draw entries without regard to which have been selected before.</dd>\r\n        </dl>\r\n      </Hint>\r\n    </Label>\r\n    <Col xs={10}>\r\n      <InputGroup>\r\n        <Field\r\n          name=\"sample.n\"\r\n          component={ Input }\r\n          pattern={ integerOrPlaceholder }\r\n          placeholder={\r\n            (values.sample || {}).mode === 'draw-replace'\r\n              ? 'As many as rows above'\r\n              : 'Use all'\r\n          }\r\n          className=\"text-monospace\"\r\n        />\r\n        <Field\r\n          name={ 'sample.mode' }\r\n          as=\"select\"\r\n          className=\"form-control custom-select text-monospace\"\r\n        >\r\n          <option value=\"sequential\">\r\n            In sequence\r\n          </option>\r\n          <option value=\"draw-shuffle\">\r\n            {\r\n              switchLabels(values, [\r\n                'Sampled without replacement',\r\n                'In random order',\r\n                'Sampled without replacement (then shuffled)'\r\n              ])\r\n            }\r\n          </option>\r\n          <option value=\"draw\">\r\n            Sampled without replacement (in blocks)\r\n          </option>\r\n          <option value=\"draw-replace\">\r\n            Sampled with replacement\r\n          </option>\r\n        </Field>\r\n      </InputGroup>\r\n    </Col>\r\n  </FormGroup>\r\n}\r\n","import React from 'react'\r\nimport { DragSource } from 'react-dnd'\r\n\r\nconst itemSource = {\r\n  beginDrag: ({ column }) => {\r\n    return { column }\r\n  },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n  return {\r\n    connectDragSource: connect.dragSource(),\r\n    isDragging: monitor.isDragging(),\r\n  }\r\n}\r\n\r\nconst Item = ({ name, connectDragSource, isDragging }) =>\r\n  connectDragSource(\r\n    <div\r\n      className=\"d-inline-block m-1 mr-2 p-2 px-4 border rounded-pill\"\r\n      style={{\r\n        opacity: isDragging ? 0.4 : 1,\r\n        transform: 'translate(0, 0)',\r\n        cursor: isDragging ? 'grabbing' : 'grab',\r\n      }}\r\n    >\r\n      <span style={{ position: 'relative', top: '1px' }}>\r\n        { name }\r\n      </span>\r\n    </div>\r\n  )\r\n\r\nexport default DragSource('item', itemSource, collect)(Item)\r\n","import React from 'react'\r\nimport { DropTarget } from 'react-dnd'\r\n\r\nimport classnames from 'classnames'\r\n\r\nimport Item from './Item'\r\n\r\nconst groupTarget = {\r\n  drop: (targetProps, monitor) => {\r\n    const { column } = monitor.getItem()\r\n    targetProps.move(\r\n      column, // id\r\n      targetProps.groupId // target\r\n    )\r\n  },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n  return {\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver()\r\n  }\r\n}\r\n\r\nconst Group = ({ columns=[], title, connectDropTarget, isOver, children }) =>\r\n  connectDropTarget(\r\n    <tr\r\n      className={ classnames({\r\n        'bg-light': isOver,\r\n      }) }\r\n    >\r\n      <td style={{ padding: '0.75rem 1.25rem', width: '8rem' }}>\r\n        <small className=\"text-muted\">{ title }</small>\r\n      </td>\r\n      <td className=\"text-center\" style={{ padding: '0.75rem 1.25rem' }}>\r\n        {\r\n          children || columns.map((c, i) =>\r\n            <Item\r\n              key={ i }\r\n              column={ c.id }\r\n              name={ c.name }\r\n            />\r\n          )\r\n        }\r\n      </td>\r\n      <td style={{ padding: '0.75rem 1.25rem', width: '8rem' }}>\r\n      </td>\r\n    </tr>\r\n  )\r\n\r\nexport default DropTarget('item', groupTarget, collect)(Group)\r\n","import React from 'react'\r\n\r\nimport { useFormikContext } from 'formik'\r\nimport { groupBy } from 'lodash'\r\nimport { Table } from 'reactstrap'\r\n\r\nimport Group from './Group'\r\nimport Icon from '../../../../../Icon'\r\n\r\nexport default () => {\r\n  const { values, setFieldValue } = useFormikContext()\r\n  const globalShuffle = values.shuffle\r\n\r\n  const groups = groupBy(\r\n    values.templateParameters.columns\r\n      .filter(c => c.name !== '')\r\n      .map((c, i) => ({ ...c, id: i })),\r\n    'shuffleGroup'\r\n  )\r\n  const entries = Object.entries(groups)\r\n\r\n  const moveHandler = (key, target) =>\r\n    setFieldValue(\r\n      `templateParameters.columns[${ key }]['shuffleGroup']`,\r\n      target\r\n    )\r\n\r\n  const nextGroup = Math.max(\r\n    ...Object.keys(groups)\r\n      .map(Number)\r\n      .filter(x => !isNaN(x)),\r\n    0\r\n  ) + 1\r\n\r\n  return (\r\n    <Table className=\"border-top-0\">\r\n      <tbody>\r\n        {/* Default group */}\r\n        <Group\r\n          title={ globalShuffle ? \"Default\" : \"Not shuffled\" }\r\n          groupId={ undefined }\r\n          key={ -1 }\r\n          columns={ groups['undefined'] }\r\n          move={ moveHandler }\r\n          children={\r\n            entries.length > 0\r\n              ? undefined\r\n              : <small className=\"text-muted font-italic\">\r\n                  (no columns yet)\r\n                </small>\r\n          }\r\n        />\r\n        {/* Actual shuffled groups */}\r\n        {\r\n          entries\r\n            .filter(([group]) => group !== 'undefined')\r\n            .map(([group, columns]) =>\r\n              <Group\r\n                groupId={ group }\r\n                key={ group }\r\n                columns={ columns }\r\n                move={ moveHandler }\r\n              />\r\n          )\r\n        }\r\n        {/* Empty group */}\r\n        <Group\r\n          groupId={ nextGroup }\r\n          key={ nextGroup }\r\n          move={ moveHandler }\r\n        >\r\n          <small className=\"text-muted\">\r\n            <span\r\n              className=\"text-right d-inline d-lg-inline-block\"\r\n              style={{ width: '45%' }}\r\n            >\r\n              Drag columns into rows\r\n            </span>\r\n            <Icon icon=\"ellipsis-v\" className=\"text-muted m-2\" />\r\n            <span\r\n              className=\"text-left d-inline d-lg-inline-block\"\r\n              style={{ width: '45%' }}\r\n            >\r\n              to create independently shuffled groups\r\n            </span>\r\n          </small>\r\n        </Group>\r\n      </tbody>\r\n    </Table>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nimport { CardBody } from 'reactstrap'\r\nimport { uniqBy } from 'lodash'\r\n\r\nimport Card from '../../../../Card'\r\nimport Form from '../../Form'\r\n\r\nimport Grid from './Grid'\r\nimport SampleWidget from './SampleWidget'\r\nimport ShuffleGroups from './ShuffleGroups'\r\n\r\nexport default ({ id, data }) =>\r\n  <Form\r\n    id={ id } data={ data }\r\n    keys={ [ 'sample', 'shuffle', 'templateParameters' ] }\r\n  >\r\n    <Card title=\"Loop\" wrapContent={ false }>\r\n      <Grid />\r\n      <CardBody>\r\n        <SampleWidget />\r\n      </CardBody>\r\n    </Card>\r\n    <Card title=\"Further options\"\r\n      open={\r\n        uniqBy(\r\n          data.templateParameters.columns,\r\n          c => c.shuffleGroup\r\n        ).length > 1\r\n      }\r\n      collapsable={ true }\r\n      wrapContent={ false }\r\n      className=\"mt-4\"\r\n    >\r\n      <CardBody className=\"pb-0\">\r\n        <h2 className=\"h6\">Parameter groups</h2>\r\n      </CardBody>\r\n      <ShuffleGroups />\r\n    </Card>\r\n  </Form>\r\n","import React from 'react'\r\n\r\nimport { Col, FormGroup, Label } from 'reactstrap'\r\nimport { Field } from 'formik'\r\n\r\nimport Form from '../../Form'\r\nimport { CustomInput } from '../../../../Form'\r\nimport Card from '../../../../Card'\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Content\">\r\n    <Form\r\n      id={ id }\r\n      data={ data }\r\n      keys={ ['shuffle', 'localParameters'] }\r\n    >\r\n      <FormGroup row>\r\n        <Col xs={2}>\r\n          <Label\r\n            style={{\r\n              paddingTop: '0', // This is a hack to override .col-form-label\r\n            }}\r\n          >\r\n            Order\r\n          </Label>\r\n        </Col>\r\n        <Col xs={10}>\r\n          <FormGroup check>\r\n            <Field\r\n              name=\"shuffle\" id=\"shuffle\"\r\n              component={ CustomInput }\r\n              type=\"checkbox\"\r\n              label=\"Shuffle nested components\"\r\n            />\r\n          </FormGroup>\r\n        </Col>\r\n      </FormGroup>\r\n    </Form>\r\n  </Card>\r\n","import React from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { Row, Col } from 'reactstrap'\r\n\r\nimport { Input } from '../../../../../../../Form'\r\n\r\nexport default ({ name }) =>\r\n  <>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.title` }\r\n          placeholder=\"Title\"\r\n          component={ Input }\r\n          className=\"font-weight-bold\"\r\n        />\r\n      </Col>\r\n    </Row>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.content` }\r\n          as=\"textarea\"\r\n          placeholder=\"Text\"\r\n          className=\"form-control mt-2\"\r\n        />\r\n      </Col>\r\n    </Row>\r\n  </>\r\n","import React, { useContext } from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\nimport { Field } from 'formik'\r\nimport {\r\n  Row, Col, Collapse,\r\n  InputGroup, InputGroupAddon, InputGroupText\r\n} from 'reactstrap'\r\n\r\nimport Icon from '../../../../../../../Icon'\r\nimport FileSelectorField from '../../../../../../../FileSelector/field'\r\n\r\nimport { ItemContext } from '../../../index'\r\n\r\nexport const ImageOptions = ({ name, index }) => {\r\n  const { openItem } = useContext(ItemContext)\r\n\r\n  return (\r\n    <Row form>\r\n      <Col>\r\n        <Collapse isOpen={ openItem === index }>\r\n          <InputGroup className=\"mt-2\">\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"arrows-h\" fixedWidth />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.width` }\r\n              defaultValue=\"\"\r\n              placeholder=\"width\"\r\n              className=\"form-control text-monospace\"\r\n            />\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"arrows-v\" fixedWidth />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.height` }\r\n              defaultValue=\"\"\r\n              placeholder=\"height\"\r\n              className=\"form-control text-monospace\"\r\n            />\r\n          </InputGroup>\r\n        </Collapse>\r\n      </Col>\r\n    </Row>\r\n  )\r\n}\r\n\r\nconst ImageSelector = ({ name }, { id }) =>\r\n  <Row form>\r\n    <Col>\r\n      <FileSelectorField\r\n        name={ `${ name }.src`}\r\n        accept=\"image/*\"\r\n        placeholder=\"source\"\r\n        component={ id }\r\n      />\r\n    </Col>\r\n  </Row>\r\n\r\nImageSelector.contextTypes = {\r\n  id: PropTypes.oneOfType([\r\n    PropTypes.string,\r\n    PropTypes.number,\r\n  ]),\r\n}\r\n\r\nexport default ({ name, index }) =>\r\n  <>\r\n    <ImageSelector name={ name } />\r\n    <ImageOptions name={ name } index={ index } />\r\n  </>\r\n","import React from 'react'\r\n\r\nexport default () =>\r\n  <hr\r\n    style={{\r\n      position: 'relative',\r\n      top: '2px',\r\n    }}\r\n  />\r\n","import React from 'react'\r\n\r\nimport { Row, Col } from 'reactstrap'\r\n\r\nimport EditorField from '../../../../../../../Editor/field'\r\n\r\nexport default ({ name }) =>\r\n  <>\r\n    <Row form>\r\n      <Col>\r\n        <div className=\"border rounded py-2 pr-2\" style={{ height: '220px' }}>\r\n          <EditorField\r\n            name={ `${ name }.content` }\r\n            language=\"html\"\r\n            height=\"100%\"\r\n            options={{\r\n              folding: false,\r\n              fontSize: 16,\r\n              glyphMargin: false,\r\n              lineHeight: 24,\r\n              lineNumbers: 'off',\r\n              minimap: {\r\n                enabled: false,\r\n              },\r\n            }}\r\n          />\r\n        </div>\r\n      </Col>\r\n    </Row>\r\n  </>\r\n","import React, { useContext } from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { FormGroup, Label, FormText,\r\n  Row, Col, Collapse } from 'reactstrap'\r\n\r\nimport { Input, CustomInput } from '../../../../../../../Form'\r\n\r\nimport { ItemContext } from '../../../index'\r\n\r\nexport const BaseOptions = ({ name, index, children,\r\n  validation, shuffle=false, borderTop=true }) =>\r\n  <>\r\n    { children && borderTop && <hr /> }\r\n    { children }\r\n    {\r\n      shuffle && <>\r\n        <hr />\r\n        Display\r\n        <FormGroup className=\"my-2\">\r\n          <FormText color=\"muted\" className=\"mb-2\">\r\n            Randomize item order\r\n          </FormText>\r\n          <Field\r\n            name={ `${ name }.shuffle` } id={ `item-shuffle-${ index }` }\r\n            component={ CustomInput }\r\n            type=\"checkbox\"\r\n            label=\"Shuffle items\"\r\n          />\r\n        </FormGroup>\r\n      </>\r\n    }\r\n    <hr />\r\n    <FormGroup className=\"my-2\">\r\n      <Label for={ `page-item-${ index }-help` } className=\"mb-0\">\r\n        Help &amp; further instructions\r\n      </Label>\r\n      <FormText color=\"muted\">\r\n        Tell your participants more about the question.\r\n      </FormText>\r\n      <Field\r\n        name={ `${ name }.help` } id={ `page-item-${ index }-help` }\r\n        component={ Input }\r\n        type=\"textarea\"\r\n        bsSize=\"sm\"\r\n        rows=\"3\"\r\n        className=\"mt-2 text-muted\"\r\n      />\r\n    </FormGroup>\r\n    <hr />\r\n    <FormGroup className=\"my-2\">\r\n      <Label for={ `page-item-${ index }-name` } className=\"mb-0\">\r\n        Name\r\n      </Label>\r\n      <FormText color=\"muted\" className=\"mb-2\">\r\n        The column in which to save the data\r\n      </FormText>\r\n      <Field\r\n        name={ `${ name }.name` } id={ `page-item-${ index }-name` }\r\n        component={ Input }\r\n        className=\"text-monospace\"\r\n        placeholder=\"(auto-generate from question)\"\r\n      />\r\n    </FormGroup>\r\n    <hr />\r\n    Validation\r\n    <FormGroup className=\"my-2\">\r\n      <FormText color=\"muted\" className=\"mb-2\">\r\n        Checks to run before accepting data\r\n      </FormText>\r\n      <Field\r\n        name={ `${ name }.required` } id={ `item-required-${ index }` }\r\n        component={ CustomInput }\r\n        type=\"checkbox\"\r\n        label=\"Require answer\"\r\n      />\r\n    </FormGroup>\r\n    { validation }\r\n  </>\r\n\r\nexport const CollapsingOptions = ({ name, index, ...props }) => {\r\n  const { openItem } = useContext(ItemContext)\r\n\r\n  return (\r\n    <Row form>\r\n      <Col>\r\n        <Collapse isOpen={ openItem === index }>\r\n          <BaseOptions\r\n            name={ name }\r\n            index={ index }\r\n            { ...props }\r\n          />\r\n        </Collapse>\r\n      </Col>\r\n    </Row>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nimport { Field, useFormikContext, getIn } from 'formik'\r\nimport { Row, Col,\r\n  InputGroup, InputGroupAddon, InputGroupText,\r\n  FormGroup, Label, FormText } from 'reactstrap'\r\n\r\nimport { CollapsingOptions } from './BaseOptions'\r\nimport Icon from '../../../../../../../Icon'\r\nimport { Input } from '../../../../../../../Form'\r\n\r\nexport const ExtraOptions = ({ name, type }) => {\r\n  switch (type) {\r\n    case 'number':\r\n      return <>\r\n        <FormGroup>\r\n          <InputGroup>\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"arrow-to-bottom\" fallback=\"arrow-down\" />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.attributes.min` }\r\n              placeholder=\"No lower limit\"\r\n              component={ Input }\r\n              className=\"text-monospace\"\r\n            />\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"arrow-to-top\" fallback=\"arrow-up\" />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.attributes.max` }\r\n              placeholder=\"No upper limit\"\r\n              component={ Input }\r\n              className=\"text-monospace\"\r\n            />\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"shoe-prints\" />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.attributes.step` }\r\n              placeholder=\"Default step (1)\"\r\n              component={ Input }\r\n              className=\"text-monospace\"\r\n            />\r\n          </InputGroup>\r\n        </FormGroup>\r\n      </>\r\n    case 'date':\r\n      return <>\r\n        <FormGroup>\r\n          <InputGroup>\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"arrow-to-bottom\" fallback=\"arrow-down\" />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.attributes.min` }\r\n              placeholder=\"No earliest date (yyyy-mm-dd)\"\r\n              component={ Input }\r\n              className=\"text-monospace\"\r\n            />\r\n            <InputGroupAddon addonType=\"prepend\">\r\n              <InputGroupText>\r\n                <Icon icon=\"arrow-to-top\" fallback=\"arrow-up\" />\r\n              </InputGroupText>\r\n            </InputGroupAddon>\r\n            <Field\r\n              name={ `${ name }.attributes.max` }\r\n              placeholder=\"No latest date (yyyy-mm-dd)\"\r\n              component={ Input }\r\n              className=\"text-monospace\"\r\n            />\r\n          </InputGroup>\r\n        </FormGroup>\r\n      </>\r\n    default:\r\n      return null\r\n  }\r\n}\r\n\r\nexport default ({ name, index, type }) => {\r\n  const { values } = useFormikContext()\r\n  const attributes = getIn(values, `${ name }.attributes`)\r\n\r\n  return <>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.label` }\r\n          placeholder=\"Question\"\r\n          component={ Input }\r\n        />\r\n      </Col>\r\n    </Row>\r\n    <CollapsingOptions\r\n      name={ name }\r\n      index={ index }\r\n    >\r\n      {\r\n        type === 'input' && <>\r\n          <FormGroup className=\"my-2\">\r\n            <Label for={ `page-item-${ index }-attrs-type` } className=\"mb-1\">\r\n              Data type\r\n            </Label>\r\n            <FormText color=\"muted\" className=\"mb-2\">\r\n              Check input format, and restrict input\r\n            </FormText>\r\n            <Field\r\n              name={ `${ name }.attributes.type` }\r\n              index={ `page-item-${ index }-attrs-type` }\r\n              as=\"select\"\r\n              className=\"form-control custom-select text-monospace\"\r\n            >\r\n              <option value=\"text\">Text</option>\r\n              <option value=\"number\">Number</option>\r\n              <option value=\"email\">Email</option>\r\n              <option value=\"date\">Date</option>\r\n            </Field>\r\n          </FormGroup>\r\n          <ExtraOptions\r\n            name={ name }\r\n            type={ attributes && attributes.type }\r\n          />\r\n        </>\r\n      }\r\n    </CollapsingOptions>\r\n  </>\r\n}\r\n","import React, { useState } from 'react'\r\n\r\nimport { FastField, FieldArray, useFormikContext, getIn } from 'formik'\r\nimport { Row, Col,\r\n  InputGroup, InputGroupAddon, InputGroupText, InputGroupButtonDropdown,\r\n  DropdownMenu, DropdownToggle, DropdownItem } from 'reactstrap'\r\n\r\nimport Icon from '../../../../../../../Icon'\r\nimport { Input } from '../../../../../../../Form'\r\n\r\nconst CodingPair = ({\r\n  name, index, arrayHelpers,\r\n  icon, iconFallbackWeight='r', totalPairs\r\n}) => {\r\n  const [dropdownOpen, setDropdownOpen] = useState(false)\r\n\r\n  return (\r\n    <InputGroup>\r\n      <InputGroupAddon addonType=\"prepend\">\r\n        <InputGroupText>\r\n          <Icon\r\n            icon={ icon } fixedWidth\r\n            fallbackWeight={ iconFallbackWeight }\r\n            className=\"text-muted\"\r\n          />\r\n        </InputGroupText>\r\n      </InputGroupAddon>\r\n      <FastField\r\n        name={ `${ name }[${ index }].label` }\r\n        placeholder=\"label\"\r\n        component={ Input }\r\n      />\r\n      <FastField\r\n        name={ `${ name }[${ index }].coding` }\r\n        placeholder=\"coding\"\r\n        component={ Input }\r\n        className=\"text-monospace\"\r\n      />\r\n      <InputGroupButtonDropdown\r\n        addonType=\"append\"\r\n        isOpen={ dropdownOpen }\r\n        toggle={ () => setDropdownOpen(!dropdownOpen) }\r\n      >\r\n        {/* For some reason, the rounded corners need to be set explicitly */}\r\n        <DropdownToggle\r\n          outline caret split\r\n          color=\"secondary\" className=\"rounded-right\"\r\n        />\r\n        <DropdownMenu right>\r\n          <DropdownItem header>\r\n            Add and delete\r\n          </DropdownItem>\r\n          <DropdownItem\r\n            onClick={ () => arrayHelpers.insert(index + 1, {}) }\r\n          >\r\n            Add below\r\n          </DropdownItem>\r\n          <DropdownItem\r\n            onClick={ () => arrayHelpers.remove(index) }\r\n          >\r\n            Delete\r\n          </DropdownItem>\r\n          <DropdownItem divider />\r\n          <DropdownItem header>\r\n            Move\r\n          </DropdownItem>\r\n          <DropdownItem\r\n            onClick={ () => arrayHelpers.swap(index, index - 1) }\r\n            disabled={ index === 0 }\r\n          >\r\n            Up\r\n          </DropdownItem>\r\n          <DropdownItem\r\n            onClick={ () => arrayHelpers.swap(index, index + 1) }\r\n            disabled={ index >= totalPairs - 1 }\r\n          >\r\n            Down\r\n          </DropdownItem>\r\n        </DropdownMenu>\r\n      </InputGroupButtonDropdown>\r\n    </InputGroup>\r\n  )\r\n}\r\n\r\nexport const CodingGroup = ({ name, icon, iconFallbackWeight }) => {\r\n  const { values } = useFormikContext()\r\n  const data = getIn(values, name) ?? []\r\n\r\n  return (\r\n    // TODO: Think about moving the manipulation logic out of the\r\n    // individual pairs, and up to a higher level such as this one.\r\n    <div className=\"pt-1\">\r\n      <FieldArray\r\n        name={ name }\r\n        render={ arrayHelpers =>\r\n          [...data, {}].map((x, i) => (\r\n            <Row form key={ `coding-${ name }-${ i }` }>\r\n              <Col className=\"pt-1\">\r\n                <CodingPair\r\n                  name={ `${ name }` }\r\n                  index={ i }\r\n                  arrayHelpers={ arrayHelpers }\r\n                  icon={ icon }\r\n                  iconFallbackWeight={ iconFallbackWeight }\r\n                  totalPairs={ data.length }\r\n                />\r\n              </Col>\r\n            </Row>\r\n          )  )\r\n        }\r\n      />\r\n    </div>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { Row, Col } from 'reactstrap'\r\n\r\nimport { CodingGroup } from './Coding'\r\nimport { CollapsingOptions } from './BaseOptions'\r\n\r\nimport { Input } from '../../../../../../../Form'\r\n\r\nexport default ({ name, index }) =>\r\n  <>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.label` }\r\n          placeholder=\"Question\"\r\n          component={ Input }\r\n        />\r\n      </Col>\r\n    </Row>\r\n    <CodingGroup\r\n      name={ `${ name }.options` }\r\n      icon=\"circle\"\r\n    />\r\n    <CollapsingOptions\r\n      name={ name }\r\n      index={ index }\r\n      shuffle={ true }\r\n    />\r\n  </>\r\n","import React from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { Row, Col } from 'reactstrap'\r\n\r\nimport { CodingGroup } from './Coding'\r\nimport { CollapsingOptions } from './BaseOptions'\r\n\r\nimport { Input } from '../../../../../../../Form'\r\n\r\n// TODO: Collapse this code with the radio button UI\r\n\r\nexport default ({ name, index }) =>\r\n  <>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.label` }\r\n          placeholder=\"Question\"\r\n          component={ Input }\r\n        />\r\n      </Col>\r\n    </Row>\r\n    <CodingGroup\r\n      name={ `${ name }.options` }\r\n      icon=\"square\"\r\n    />\r\n    <CollapsingOptions\r\n      name={ name }\r\n      index={ index }\r\n      shuffle={ true }\r\n    />\r\n  </>\r\n","import React from 'react'\r\n\r\nimport { Field } from 'formik'\r\nimport { Row, Col } from 'reactstrap'\r\n\r\nimport { Input } from '../../../../../../../Form'\r\n\r\nimport { CollapsingOptions } from './BaseOptions'\r\nimport { ExtraOptions } from './Input'\r\n\r\nexport default ({ name, index }) =>\r\n  <>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.label` }\r\n          placeholder=\"Question\"\r\n          component={ Input }\r\n        />\r\n      </Col>\r\n    </Row>\r\n    <CollapsingOptions\r\n      name={ name }\r\n      index={ index }\r\n      borderTop={ false }\r\n    >\r\n      <div className=\"mt-2\">\r\n        <ExtraOptions name={ name } type=\"number\" />\r\n      </div>\r\n    </CollapsingOptions>\r\n  </>\r\n","import React from 'react'\r\n\r\nimport { range } from 'lodash'\r\nimport { Field, FastField, useFormikContext, getIn } from 'formik'\r\nimport { Row, Col, FormGroup, Label, FormText,\r\n  InputGroup, InputGroupAddon, InputGroupText } from 'reactstrap'\r\n\r\nimport { Input } from '../../../../../../../Form'\r\n\r\nimport { CodingGroup } from './Coding'\r\nimport { CollapsingOptions } from './BaseOptions'\r\n\r\nexport default ({ name, index }) => {\r\n  const { values } = useFormikContext()\r\n  const width = getIn(values, `${ name }.width`)\r\n\r\n  return <>\r\n    <Row form>\r\n      <Col>\r\n        <Field\r\n          name={ `${ name }.label` }\r\n          placeholder=\"Question\"\r\n          component={ Input }\r\n        />\r\n      </Col>\r\n    </Row>\r\n    <CodingGroup\r\n      name={ `${ name }.items` }\r\n      icon=\"ellipsis-h-alt\"\r\n      iconFallbackWeight=\"s\"\r\n    />\r\n    <CollapsingOptions\r\n      name={ name }\r\n      index={ index }\r\n      shuffle={ true }\r\n    >\r\n      <Row>\r\n        <Col>\r\n          <FormGroup className=\"my-2\">\r\n            <Label for={ `page-item-${ index }-width` } className=\"mb-0\">\r\n              Scale width\r\n            </Label>\r\n            <FormText color=\"muted\">\r\n              How many points to offer\r\n            </FormText>\r\n            <FormGroup>\r\n              {\r\n                [5, 7, 9, 11].map(w =>\r\n                  <div\r\n                    key={ `page-item-${ index }-width-${ w }` }\r\n                    className=\"custom-radio custom-control\"\r\n                  >\r\n                    <Field\r\n                      name={ `${ name }.width` }\r\n                      type=\"radio\"\r\n                      value={ `${ w }` }\r\n                      id={ `page-item-${ index }-width-${ w }` }\r\n                      className=\"custom-control-input\"\r\n                    />\r\n                    <label\r\n                      htmlFor={ `page-item-${ index }-width-${ w }` }\r\n                      className=\"custom-control-label\"\r\n                    >\r\n                      { w }\r\n                    </label>\r\n                  </div>\r\n                )\r\n              }\r\n            </FormGroup>\r\n          </FormGroup>\r\n        </Col>\r\n        <Col>\r\n          <FormGroup className=\"my-2\">\r\n            <Label for={ `page-item-${ index }-anchors` } className=\"mb-0\">\r\n              Anchors\r\n            </Label>\r\n            <FormText color=\"muted\">\r\n              Scale anchors\r\n            </FormText>\r\n            <div className=\"mt-2\">\r\n              {\r\n                range(width).map(i =>\r\n                  <Row form\r\n                    className=\"my-1\"\r\n                    key={ `page-item-${ index }-anchors-${ i }` }\r\n                  >\r\n                    <Col>\r\n                      <InputGroup>\r\n                        <InputGroupAddon addonType=\"prepend\">\r\n                          <InputGroupText>\r\n                            <small className=\"text-monospace text-muted\">\r\n                              { i + 1 }\r\n                            </small>\r\n                          </InputGroupText>\r\n                        </InputGroupAddon>\r\n                        <FastField\r\n                          name={ `${ name }.anchors[${ i }]` }\r\n                          component={ Input }\r\n                        />\r\n                      </InputGroup>\r\n                    </Col>\r\n                  </Row>\r\n                )\r\n              }\r\n            </div>\r\n          </FormGroup>\r\n        </Col>\r\n      </Row>\r\n    </CollapsingOptions>\r\n  </>\r\n}\r\n","import React from 'react'\r\n\r\nimport Text from './components/Text'\r\nimport Image from './components/Image'\r\nimport Divider from './components/Divider'\r\nimport Raw from './components/Raw'\r\nimport Input from './components/Input'\r\nimport Radio from './components/Radio'\r\nimport Checkbox from './components/Checkbox'\r\nimport Slider from './components/Slider'\r\nimport Likert from './components/Likert'\r\n\r\nconst selectItem = (type) => {\r\n  switch(type) {\r\n    case 'text':\r\n      return Text\r\n    case 'image':\r\n      return Image\r\n    case 'divider':\r\n      return Divider\r\n    case 'html':\r\n      return Raw\r\n    case 'input':\r\n    case 'textarea':\r\n      return Input\r\n    case 'radio':\r\n      return Radio\r\n    case 'checkbox':\r\n      return Checkbox\r\n    case 'slider':\r\n      return Slider\r\n    case 'likert':\r\n      return Likert\r\n    default:\r\n      return null\r\n  }\r\n}\r\n\r\nexport default (props) => {\r\n  const Item = selectItem(props.type)\r\n  return <Item { ...props } />\r\n}\r\n","import React, { useContext } from 'react'\r\n\r\nimport { Button, Collapse } from 'reactstrap'\r\nimport Icon from '../../../../../Icon'\r\n\r\nimport { ItemContext } from '../index'\r\nimport { useFormikContext, getIn } from 'formik'\r\n\r\nconst icons = {\r\n  'text': 'info',\r\n  'image': 'image',\r\n  'divider': 'horizontal-rule', // could be page-break\r\n  'html': 'code',\r\n  'input': 'comment-alt-minus',\r\n  'textarea': 'comment-alt-lines',\r\n  'radio': 'list-ul',\r\n  'checkbox': 'tasks',\r\n  'slider': 'sliders-h',\r\n  'likert': 'grip-horizontal',\r\n}\r\n\r\nexport const LeftColumn = ({ name, index, arrayHelpers, isLastItem }) => {\r\n  const { openItem, setOpenItem } = useContext(ItemContext)\r\n  const { values } = useFormikContext()\r\n  const type = getIn(values, `${ name }.type`)\r\n\r\n  return (\r\n    <td>\r\n      <div\r\n        className=\"text-center text-black-50\"\r\n        style={{\r\n          padding: '6px 12px',\r\n          border: '1px solid transparent',\r\n          position: 'relative',\r\n          top: '1px',\r\n        }}\r\n      >\r\n        <Icon icon={ icons[type] || 'question' } />\r\n      </div>\r\n      <Collapse isOpen={ openItem === index && type !== 'divider' }>\r\n        <Button\r\n          block\r\n          outline color=\"muted\"\r\n          className=\"mt-2\"\r\n        >\r\n          <Icon icon=\"bars\" />\r\n        </Button>\r\n        <Button\r\n          block\r\n          outline color=\"muted\"\r\n          className=\"mt-2\"\r\n          onClick={ () => {\r\n            const o = openItem\r\n            setOpenItem(undefined)\r\n            arrayHelpers.swap(index, index - 1)\r\n            setOpenItem(o - 1)\r\n          } }\r\n          disabled={ index === 0 }\r\n        >\r\n          <Icon icon=\"arrow-up\" />\r\n        </Button>\r\n        <Button\r\n          block\r\n          outline color=\"muted\"\r\n          className=\"mt-2\"\r\n          onClick={ () => {\r\n            const o = openItem\r\n            setOpenItem(undefined)\r\n            arrayHelpers.swap(index, index + 1)\r\n            setOpenItem(o + 1)\r\n          } }\r\n          disabled={ isLastItem }\r\n        >\r\n          <Icon icon=\"arrow-down\" />\r\n        </Button>\r\n      </Collapse>\r\n    </td>\r\n  )\r\n}\r\n\r\nexport const RightColumn = ({ name, index, arrayHelpers }) => {\r\n  const { openItem, setOpenItem } = useContext(ItemContext)\r\n  const { values } = useFormikContext()\r\n  const type = getIn(values, `${ name }.type`)\r\n\r\n  return (\r\n    <td>\r\n      {\r\n        type !== 'divider'\r\n          ? <Button\r\n              block outline color=\"muted\"\r\n              onClick={ () => {\r\n                // TODO: Think about moving logic into the ItemContext\r\n                if (openItem === index) {\r\n                  setOpenItem(undefined)\r\n                } else {\r\n                  setOpenItem(index)\r\n                }\r\n              } }\r\n            >\r\n              <Icon icon=\"cog\" />\r\n            </Button>\r\n          : null\r\n      }\r\n      <Collapse isOpen={ type === 'divider' || openItem === index }>\r\n        <Button block\r\n          outline color=\"muted\"\r\n          className={ type !== 'divider' ? 'mt-2' : '' }\r\n          onClick={ () => arrayHelpers.remove(index) }\r\n        >\r\n          <Icon icon=\"trash\" />\r\n        </Button>\r\n      </Collapse>\r\n    </td>\r\n  )\r\n}\r\n","import React, { useState } from 'react'\r\n\r\nimport {\r\n  ButtonDropdown, DropdownToggle, DropdownMenu, DropdownItem,\r\n  Row, Col\r\n} from 'reactstrap'\r\n\r\nimport Icon from '../../../../../Icon'\r\n\r\nconst Item = ({ onClick, disabled, children }) =>\r\n  <DropdownItem\r\n    onClick={ onClick }\r\n    disabled={ disabled }\r\n  >\r\n    { children }\r\n  </DropdownItem>\r\n\r\nconst AddWidget = ({ addItem: defaultAddItem }) => {\r\n  const [dropdownOpen, setDropdownOpen] = useState(false)\r\n  const addItem = (data) => defaultAddItem({ required: true, ...data })\r\n\r\n  return (\r\n    <ButtonDropdown\r\n      direction=\"down\"\r\n      isOpen={ dropdownOpen }\r\n      toggle={ () => setDropdownOpen(!dropdownOpen) }\r\n      className=\"w-100\"\r\n    >\r\n      <DropdownToggle\r\n        outline color=\"muted\" size=\"sm\"\r\n        className=\"hover-target\"\r\n      >\r\n        <Icon icon=\"plus\" fixedWidth />\r\n        <Icon\r\n          icon=\"caret-down\"\r\n          className=\"float-right\"\r\n          weight=\"s\"\r\n          style={{ position: 'relative', top: '3px' }}\r\n        />\r\n      </DropdownToggle>\r\n      <DropdownMenu\r\n        className=\"p-0 w-100\"\r\n      >\r\n        <Row noGutters>\r\n          <Col className=\"border-right pt-2 pb-3\">\r\n            <DropdownItem header>\r\n              Content\r\n            </DropdownItem>\r\n            <Item onClick={ () => addItem({ type: 'text' }) }>\r\n              Text <span className=\"text-muted\">/ Instructions</span>\r\n            </Item>\r\n            <Item onClick={ () => addItem({ type: 'image' }) }>\r\n              Image\r\n            </Item>\r\n            <Item onClick={ () => addItem({ type: 'divider' }) }>\r\n              Divider\r\n            </Item>\r\n            <DropdownItem divider />\r\n            <DropdownItem header>\r\n              Advanced\r\n            </DropdownItem>\r\n            <Item onClick={ () => addItem({ type: 'html' }) }>\r\n              Raw <code className=\"text-body\">HTML</code>\r\n            </Item>\r\n          </Col>\r\n          <Col className=\"border-right pt-2 pb-3\">\r\n            <DropdownItem header>\r\n              Free-form input\r\n            </DropdownItem>\r\n            <Item onClick={ () => addItem({ type: 'input' }) }>\r\n              Single-line\r\n            </Item>\r\n            <Item onClick={ () => addItem({ type: 'textarea' }) }>\r\n              Multi-line\r\n            </Item>\r\n            <DropdownItem divider />\r\n            <DropdownItem header>\r\n              Structured input\r\n            </DropdownItem>\r\n            <Item onClick={ () => addItem({ type: 'radio' }) }>\r\n              Multiple choice\r\n            </Item>\r\n            <Item onClick={ () => addItem({ type: 'checkbox' }) }>\r\n              Check all that apply\r\n            </Item>\r\n          </Col>\r\n          <Col className=\"pt-2 pb-3\">\r\n            <DropdownItem header>\r\n              Ranges\r\n            </DropdownItem>\r\n            <Item onClick={ () => addItem({ type: 'slider' }) }>\r\n              Slider\r\n            </Item>\r\n            <Item disabled={ true }>\r\n              Visual analogue scale\r\n            </Item>\r\n            <Item\r\n              onClick={ () => addItem({\r\n                type: 'likert',\r\n                items: [],\r\n                width: 5,\r\n                anchors: [],\r\n              }) }\r\n            >\r\n              Likert scale\r\n            </Item>\r\n          </Col>\r\n        </Row>\r\n      </DropdownMenu>\r\n    </ButtonDropdown>\r\n  )\r\n}\r\n\r\nexport default ({ columns, addItem }) =>\r\n  <tfoot>\r\n    <tr>\r\n      <td />\r\n      <td colSpan={ columns.length }>\r\n        <AddWidget addItem={ addItem } />\r\n      </td>\r\n      <td />\r\n    </tr>\r\n  </tfoot>\r\n","import React, { createContext, useState } from 'react'\r\nimport { Field, useFormikContext } from 'formik'\r\nimport { CardFooter, FormGroup, InputGroup, Label, Button,\r\n  Row, Col, Collapse } from 'reactstrap'\r\n\r\nimport Card from '../../../../Card'\r\nimport Form from '../../Form'\r\nimport { Table, DefaultRow } from '../../../../Form/table'\r\nimport { Input } from '../../../../Form'\r\nimport Icon from '../../../../Icon'\r\n\r\nimport ItemOptions from './components/ItemOptions'\r\nimport { LeftColumn, RightColumn } from './components/Columns'\r\nimport GridFooter from './components/Footer'\r\n\r\n// Grid contents ---------------------------------------------------------------\r\n\r\nconst ItemRow = ({ index, name, data, arrayHelpers, isLastItem }) =>\r\n  <DefaultRow\r\n    name={ name } index={ index }\r\n    isLastItem={ isLastItem }\r\n    arrayHelpers={ arrayHelpers }\r\n    leftColumn={ LeftColumn }\r\n    rightColumn={ RightColumn }\r\n  >\r\n    <ItemOptions\r\n      name={ name }\r\n      type={ data.type }\r\n      data={ data }\r\n      index={ index }\r\n    />\r\n  </DefaultRow>\r\n\r\nconst Footer = () => {\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const { values } = useFormikContext()\r\n\r\n  return (\r\n    <CardFooter className=\"px-0\">\r\n      <table className=\"table grid no-header border-bottom-0 my-0\">\r\n        <colgroup>\r\n          <col style={{ width: '5%' }} />\r\n          <col style={{ width: '90%' }} />\r\n          <col style={{ width: '5%' }} />\r\n        </colgroup>\r\n        <tbody>\r\n          <tr>\r\n            <td><div style={{ width: '40px' }} /></td>\r\n            <td>\r\n              <Row form>\r\n                <Col>\r\n                  <InputGroup>\r\n                    <Field\r\n                      name=\"submitButtonText\"\r\n                      component={ Input }\r\n                      placeholder=\"Submit button text\"\r\n                      default=\"Continue →\"\r\n                      disabled={ values.submitButtonPosition === 'hidden' }\r\n                    />\r\n                    <Field\r\n                      name=\"submitButtonPosition\" id=\"submitButtonPosition\"\r\n                      className=\"form-control custom-select\"\r\n                      as=\"select\"\r\n                    >\r\n                      <option value=\"right\">\r\n                        Show submit button\r\n                      </option>\r\n                      <option value=\"hidden\">\r\n                        Hide submit button\r\n                      </option>\r\n                    </Field>\r\n                  </InputGroup>\r\n                </Col>\r\n              </Row>\r\n              <Collapse isOpen={ isOpen }>\r\n                <hr />\r\n                <h3 className=\"h6\">Presentation</h3>\r\n                <FormGroup row className=\"mt-2\">\r\n                  <Label xs={ 3 } for=\"width\">\r\n                    Page width\r\n                  </Label>\r\n                  <Col xs={9}>\r\n                    <InputGroup>\r\n                      <Field\r\n                        name=\"width\" id=\"width\"\r\n                        as=\"select\"\r\n                        defaultValue=\"m\"\r\n                        className=\"form-control custom-select\"\r\n                      >\r\n                        <option value=\"s\">\r\n                          Small\r\n                        </option>\r\n                        <option value=\"m\">\r\n                          Medium\r\n                        </option>\r\n                        <option value=\"l\">\r\n                          Large\r\n                        </option>\r\n                      </Field>\r\n                    </InputGroup>\r\n                  </Col>\r\n                </FormGroup>\r\n              </Collapse>\r\n            </td>\r\n            <td>\r\n              <Button\r\n                block outline color=\"muted\"\r\n                onClick={ () => setIsOpen(!isOpen) }\r\n              >\r\n                <Icon icon=\"cog\" />\r\n              </Button>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </CardFooter>\r\n  )\r\n}\r\n\r\n// State management ------------------------------------------------------------\r\n\r\nexport const ItemContext = createContext({})\r\n\r\nconst ItemContextProvider = (props) => {\r\n  const [openItem, setOpenItem] = useState(undefined)\r\n\r\n  return (\r\n    <ItemContext.Provider\r\n      value={{ openItem, setOpenItem }}\r\n      { ...props }\r\n    />\r\n  )\r\n}\r\n\r\n// Main component --------------------------------------------------------------\r\n\r\nexport default ({ id, data }) =>\r\n  <Card title=\"Content\" wrapContent={false}>\r\n    <Form\r\n      id={ id } data={ data }\r\n      keys={ [\r\n        'items',\r\n        'submitButtonText', 'submitButtonPosition',\r\n        'width'\r\n      ] }\r\n      validateOnChange={ false }\r\n    >\r\n      <ItemContextProvider>\r\n        <Table\r\n          name=\"items\"\r\n          defaultItem={{ type: '' }}\r\n          row={ ItemRow }\r\n          footer={ GridFooter }\r\n          className=\"no-header\"\r\n        />\r\n      </ItemContextProvider>\r\n      <Footer />\r\n    </Form>\r\n  </Card>\r\n","import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { connect } from 'react-redux'\r\n\r\n// Meta-screens\r\nimport Welcome from './components/Welcome'\r\nimport Fallback from './components/Fallback'\r\n\r\n// General-purpose tabs\r\nimport Behavior from './components/Behavior'\r\nimport Scripts from './components/Scripts'\r\nimport Files from './components/Files'\r\nimport Plugins from './components/Plugins'\r\nimport Template from './components/Template'\r\nimport Advanced from './components/Advanced'\r\n\r\n// Content-specific tabs\r\nimport CanvasContent from './components/Content/Canvas'\r\nimport EditorContent from './components/Content/Editor'\r\nimport FrameContent from './components/Content/Frame'\r\nimport LoopContent from './components/Content/Loop'\r\nimport SequenceContent from './components/Content/Sequence'\r\nimport PageContent from './components/Content/Page'\r\n\r\n// Tab selection helper\r\nimport { defaultTab } from '../../logic/components'\r\n\r\nconst selectTab = (type, tab) => {\r\n  switch(tab) {\r\n    case 'Content':\r\n      switch(type) {\r\n        case 'lab.canvas.Screen':\r\n          return CanvasContent\r\n        case 'lab.html.Screen':\r\n        case 'lab.html.Form':\r\n          return EditorContent\r\n        case 'lab.canvas.Frame':\r\n        case 'lab.html.Frame':\r\n          return FrameContent\r\n        case 'lab.html.Questionnaire':\r\n        case 'lab.html.Page':\r\n          return PageContent\r\n        case 'lab.flow.Loop':\r\n          return LoopContent\r\n        case 'lab.flow.Sequence':\r\n          return SequenceContent\r\n        default:\r\n          throw new Error(`Unknown component type, can't show content`)\r\n      }\r\n    case 'Behavior':\r\n      return Behavior\r\n    case 'Scripts':\r\n      return Scripts\r\n    case 'Files':\r\n      return Files\r\n    case 'Plugins':\r\n      return Plugins\r\n    case 'Parameters':\r\n      return Template\r\n    case 'More':\r\n      return Advanced\r\n    default:\r\n      return ({ id, data }) =>\r\n        <div>\r\n          id: { id }, type: { data.type },\r\n          tab: { data._tab }\r\n        </div>\r\n  }\r\n}\r\n\r\nclass ComponentDetail extends Component {\r\n  getChildContext() {\r\n    return {\r\n      id: this.props.id,\r\n      type: this.props.type,\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { id, type, tab, data } = this.props\r\n\r\n    // Catch special cases:\r\n    // Welcome screen and unknown component fallback\r\n    if (id === 'welcome') {\r\n      return <Welcome />\r\n    } else if (type === undefined) {\r\n      return <Fallback />\r\n    }\r\n\r\n    // Select appropriate content tab\r\n    const Tab = selectTab(type, tab)\r\n    return <Tab\r\n      id={ id }\r\n      data={ data }\r\n    />\r\n  }\r\n}\r\n\r\nComponentDetail.childContextTypes = {\r\n  id: PropTypes.oneOfType([\r\n    PropTypes.string,\r\n    PropTypes.number,\r\n  ]),\r\n  type: PropTypes.string,\r\n}\r\n\r\n// Redux integration\r\nconst mapStateToProps = (state) => {\r\n  const id = state.componentDetail.viewProps.id\r\n\r\n  // Provide default values\r\n  // if a component does not exist\r\n  const type = state.components[id]\r\n    ? state.components[id].type\r\n    : undefined\r\n  const tab = state.components[id]\r\n    ? defaultTab(state.components[id]._tab, type)\r\n    : undefined\r\n  const data = state.components[id]\r\n    ? state.components[id]\r\n    : {}\r\n\r\n  return {\r\n    key: `${ id }-${ tab }`,\r\n    id, type, tab, data\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(ComponentDetail)\r\n","import React, { Component } from 'react'\r\nimport * as Sentry from '@sentry/browser'\r\n\r\nimport Error from './Error'\r\nimport Layout from '../Layout'\r\nimport ReduxModal from '../Modal/redux'\r\nimport Shortcuts from '../Shortcuts'\r\n\r\nimport Sidebar from '../Sidebar'\r\nimport Footer from '../Footer'\r\nimport ComponentHeader from '../ComponentHeader'\r\nimport ComponentOptions from '../ComponentOptions'\r\n\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.defaultState = { error: null, errorInfo: {} }\r\n    this.state = { ...this.defaultState }\r\n  }\r\n\r\n  componentDidCatch(error, info) {\r\n    Sentry.withScope((scope) => {\r\n      scope.setExtras(info)\r\n      scope.setTag('scope', 'crash')\r\n      scope.setLevel('fatal')\r\n      const eventId = Sentry.captureException(error)\r\n      this.setState({ error, errorInfo: info, eventId })\r\n    })\r\n  }\r\n\r\n  resetError() {\r\n    this.setState({ ...this.defaultState })\r\n  }\r\n\r\n  render() {\r\n    if (this.state.error) {\r\n      return <Error\r\n        error={ this.state.error }\r\n        errorInfo={ this.state.errorInfo }\r\n        eventId={ this.state.eventId }\r\n        reset={ () => this.resetError() }\r\n      />\r\n    } else {\r\n      return (\r\n        <>\r\n          <Shortcuts />\r\n          <ReduxModal />\r\n          <Layout\r\n            sidebar={ <Sidebar /> }\r\n            footer={ <Footer /> }\r\n          >\r\n            <ComponentHeader />\r\n            <ComponentOptions />\r\n          </Layout>\r\n        </>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nexport default App\r\n","import { prePopulateCache } from './index'\r\n\r\nexport default async (store) => {\r\n  if ('serviceWorker' in navigator) {\r\n    // Compute root URL by removing filename from path, if present\r\n    const rootUrl = window.location.pathname.substring(\r\n      0, window.location.pathname.lastIndexOf('/') + 1\r\n    ) + 'api/'\r\n\r\n    // Register service worker\r\n    const registrations = await navigator.serviceWorker.getRegistrations()\r\n\r\n    // Remove legacy workers during architectural transition\r\n    await Promise.all(\r\n      registrations.map( r => r.unregister() )\r\n    )\r\n\r\n    try {\r\n      // Setup new worker\r\n      await navigator.serviceWorker.register(\r\n        process.env.PUBLIC_URL + '/api/worker.js', { scope: rootUrl }\r\n      )\r\n      console.log(`Preview worker registered successfully at ${ rootUrl }`)\r\n\r\n      // Prepopulate cache with library files\r\n      await prePopulateCache()\r\n    } catch (error) {\r\n      throw error\r\n    }\r\n  } else {\r\n    throw new Error('Service workers not available')\r\n  }\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\n// Why did you (re)render?\r\nimport './wdyr.js'\r\n\r\n// React-redux integration\r\nimport { Provider as ReduxProvider } from 'react-redux'\r\nimport configureStore from './store'\r\n\r\n// React-dnd integration\r\nimport { DragDropContext } from 'react-dnd'\r\nimport HTML5DragDropBackend from 'react-dnd-html5-backend'\r\n\r\n// App content\r\nimport App from './components/App'\r\nimport './index.css'\r\n\r\n// Sentry error reporting for production releases\r\n// (if a DSN is specified as an environment parameter, that is)\r\nimport * as Sentry from '@sentry/browser'\r\n\r\nif (\r\n  process.env.NODE_ENV === 'production' &&\r\n  process.env.REACT_APP_SENTRY_DSN\r\n) {\r\n  Sentry.init({\r\n    dsn: process.env.REACT_APP_SENTRY_DSN,\r\n    release: `@lab.js/builder@${ process.env.REACT_APP_SENTRY_RELEASE }`,\r\n  })\r\n}\r\n\r\n/* eslint-disable import/first */\r\nimport { check } from './logic/util/compatibility'\r\nimport { persistState } from './logic/util/persistence'\r\nimport installPreviewWorker from './logic/io/preview/worker'\r\nimport { register as registerServiceWorker } from './registerServiceWorker'\r\nimport { SystemContextProvider } from './components/System'\r\n/* eslint-enable import/first */\r\n\r\n(async () => {\r\n  const store = await configureStore()\r\n\r\n  // Check browser compatibility\r\n  check(store)\r\n\r\n  // Persist store to localFtorage\r\n  await persistState(store)\r\n\r\n  // Enable preview service worker\r\n  let previewActive\r\n  try {\r\n    await installPreviewWorker(store)\r\n    previewActive = true\r\n  } catch (e) {\r\n    console.log('Error during preview worker registration:', e)\r\n    previewActive = false\r\n\r\n    // A lack of service worker support is now well-captured\r\n    // in the remaining app, and need not be logged\r\n    if (e.message !== 'Service workers not available') {\r\n      Sentry.withScope((scope) => {\r\n        scope.setTag('scope', 'worker')\r\n        Sentry.captureException(e)\r\n      })\r\n    }\r\n  } finally {\r\n    // Wrap main app component\r\n    const WrappedApp = DragDropContext(HTML5DragDropBackend)(App)\r\n\r\n    // Render wrapped app\r\n    ReactDOM.render(\r\n      <SystemContextProvider\r\n        value={{\r\n          previewActive\r\n        }}\r\n      >\r\n        <ReduxProvider store={ store }>\r\n          <WrappedApp />\r\n        </ReduxProvider>\r\n      </SystemContextProvider>,\r\n      document.getElementById('root')\r\n    )\r\n\r\n    // Setup progressive content caching\r\n    // TODO: This doesn't work because the SW registration code\r\n    // sets up a hook for the 'onload' event -- which has passed\r\n    // by the time this function is run.\r\n    // This is fixed in an existing pull request, so we'll either\r\n    // have to wait, or move this code elsewhere, see\r\n    // https://github.com/facebook/create-react-app/pull/3654\r\n    registerServiceWorker()\r\n  }\r\n})()\r\n\r\n\r\n\r\n\r\n\r\n"],"sourceRoot":""}