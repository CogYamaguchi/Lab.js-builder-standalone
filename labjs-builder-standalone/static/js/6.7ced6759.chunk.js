(this["webpackJsonplab.js.builder"]=this["webpackJsonplab.js.builder"]||[]).push([[6],{905:function(e,t,a){"use strict";t.a={root:"rgb(33, 37, 41)",outline:"rgba(0, 0, 0, 0.125)",buttonBorder:"#ced4da",gray:"#f8f9fa",active:"#0275d7",muted:"#6c757d"}},980:function(e,t,a){"use strict";var n=a(0),r=a.n(n),o=a(43),i=a.n(o),l=a(868),s=a(29),c=a(905);const m=(e,t)=>0===t?"".concat(e,"ms"):"".concat(e/1e3,"s"),d=({gridWidth:e=100},{range:t,height:a,toX:n,zoom:o})=>{return r.a.createElement(l.Layer,null,Object(s.range)((i=t.min-e*Math.pow(10,o),d=o+2,Math.floor(i/Math.pow(10,d))*Math.pow(10,d)),t.max+e,e*Math.pow(10,o)).map((t,i)=>r.a.createElement(l.Group,{key:"t-".concat(t)},r.a.createElement(l.Rect,{x:n(t)+.5,y:0,width:e,height:a,fill:i%2===0?"white":c.a.gray}),r.a.createElement(l.Text,{text:m(t,o),x:n(t)+6,y:a-15,fontFamily:"Fira Sans",fontSize:10,fill:c.a.muted,align:"left",verticalAlign:"bottom"}),r.a.createElement(l.Line,{x:n(t)+.5,y:0,stroke:c.a.gray,strokeWidth:1,points:[0,0,0,a]}))));var i,d};d.contextTypes={range:i.a.object,zoom:i.a.number,toX:i.a.func,height:i.a.number,padding:i.a.number},t.a=d},981:function(e,t,a){"use strict";var n=a(37),r=a.n(n),o=a(54),i=a(184),l=a(0),s=a.n(l),c=a(33),m=a(43),d=a.n(m),h=a(814),u=a(27),p=a(822),g=a(982),E=a(852),y=a(840),f=a(841),b=a(428),v=a(821),x=a(819),w=a(820),C=a(436),I=a(853),k=a(829),j=a(833),D=a(846),T=a(847),O=a(29),M=a(30),F=a(258),S=a(284);const P=({add:e,duplicateCurrent:t,deleteCurrent:a,activeItem:n},{zoom:r,setZoom:o})=>s.a.createElement("div",{style:{position:"absolute",right:"0"}},s.a.createElement(p.a,null,s.a.createElement(g.a,{direction:"up"},s.a.createElement(E.a,{outline:!0,color:"secondary"},s.a.createElement(M.a,{icon:"plus",fixedWidth:!0,style:{position:"relative",top:"0.5px"}})),s.a.createElement(y.a,null,s.a.createElement(f.a,{header:!0},"Audio"),s.a.createElement(f.a,{onClick:()=>e({type:"sound"})},"Sound file"),s.a.createElement(f.a,{onClick:()=>e({type:"oscillator"})},"Oscillator"),s.a.createElement(f.a,{divider:!0}),s.a.createElement(f.a,{header:!0},"From selected"),s.a.createElement(f.a,{onClick:()=>t()},"Duplicate"))),s.a.createElement(b.a,{outline:!0,color:"secondary",disabled:!n,onClick:a},s.a.createElement(M.a,{icon:"trash",fixedWidth:!0,style:{position:"relative",top:"0.5px"}}))),s.a.createElement(p.a,{className:"ml-2"},s.a.createElement(b.a,{outline:!0,color:"secondary",disabled:0===r,onClick:()=>o(0)},s.a.createElement(M.a,{icon:"search-plus",fixedWidth:!0,style:{position:"relative",top:"0.5px"}})),s.a.createElement(b.a,{outline:!0,color:"secondary",disabled:1===r,onClick:()=>o(1)},s.a.createElement(M.a,{icon:"search-minus",fixedWidth:!0,style:{position:"relative",top:"0.5px"}}))));P.contextTypes={zoom:d.a.number,setZoom:d.a.func};const z=({firstComponentId:e},{id:t})=>e===t?s.a.createElement(v.a,{color:"warning"},s.a.createElement("h3",{className:"h6 mt-2"},"Adding audio to the first component in a study"),"Many browsers don't allow a website to play media until a user has interacted with the page. To make sure that you participants can hear the sounds you're adding, please ask for user input on your study's first screen."):null;z.contextTypes={id:d.a.oneOfType([d.a.string,d.a.number])};const L=Object(c.connect)(e=>({firstComponentId:e.components.root.children[0]}))(z),A=({activeItem:e,add:t,duplicateCurrent:a,deleteCurrent:n})=>s.a.createElement(s.a.Fragment,null,s.a.createElement(x.a,{form:!0,className:"clearfix"},s.a.createElement(w.a,{style:{position:"relative"}},s.a.createElement(P,{add:t,duplicateCurrent:a,deleteCurrent:n,activeItem:e}),e?s.a.createElement("h3",{className:"h5 mt-2"},Object(O.capitalize)(e.type)):s.a.createElement("div",{className:"text-muted text-center"},s.a.createElement("small",null,"Please add or select a timeline item")))),e?s.a.createElement(x.a,null,s.a.createElement(w.a,null,s.a.createElement("hr",null),s.a.createElement(L,null))):null),X=({icon:e,fallbackIcon:t,tooltip:a,unit:n})=>{const r=Object(l.createRef)();return(s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"input-group-prepend",ref:r},s.a.createElement(C.a,null,s.a.createElement(M.a,{fixedWidth:!0,icon:e,fallback:t}))),a?s.a.createElement(I.a,{target:r,placement:"left",delay:{show:0,hide:150}},a,n&&s.a.createElement("span",{className:"text-muted"}," (",n,")")):null))},W=e=>{let t=e.model,a=Object(i.a)(e,["model"]);return(s.a.createElement(u.Control,Object.assign({model:t,component:k.a,debounce:200,className:"form-control",style:{fontFamily:"Fira Mono"}},a)))},N=()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(x.a,{form:!0},s.a.createElement(w.a,null,s.a.createElement(j.a,null,s.a.createElement(D.a,null,s.a.createElement(X,{icon:"arrow-from-left",fallbackIcon:"play-circle",tooltip:"Start",unit:"ms"}),s.a.createElement(W,{model:".start",pattern:S.b}),s.a.createElement(X,{icon:"arrow-to-right",fallbackIcon:"stop-circle",tooltip:"End",unit:"ms"}),s.a.createElement(W,{model:".stop",pattern:S.b}),s.a.createElement(X,{icon:"volume",tooltip:"Gain",unit:"fraction"}),s.a.createElement(W,{model:".payload.gain",placeholder:"gain",pattern:S.b})))),s.a.createElement(w.a,null,s.a.createElement(j.a,null,s.a.createElement(D.a,null,s.a.createElement(X,{icon:"location-arrow",tooltip:"Panning",unit:"-1 \u2026 +1"}),s.a.createElement(W,{model:".payload.pan",placeholder:"pan",pattern:S.b}),s.a.createElement(X,{icon:"plane-departure",tooltip:"Ramp up duration",unit:"ms"}),s.a.createElement(W,{model:".payload.rampUp",placeholder:"0",pattern:S.b}),s.a.createElement(X,{icon:"plane-arrival",tooltip:"Ramp down duration",unit:"ms"}),s.a.createElement(W,{model:".payload.rampDown",placeholder:"0",pattern:S.b})))))),R=({handleChange:e},{id:t})=>{const a=Object(l.createRef)();return(s.a.createElement(s.a.Fragment,null,s.a.createElement(F.a,{accept:"audio/*,video/ogg",component:t,ref:a}),s.a.createElement(N,null),s.a.createElement(x.a,{form:!0},s.a.createElement(w.a,null,s.a.createElement(j.a,null,s.a.createElement(D.a,null,s.a.createElement(T.a,{addonType:"prepend"},s.a.createElement(C.a,null,s.a.createElement(M.a,{fixedWidth:!0,icon:"file-audio"}))),s.a.createElement(u.Control,{model:".payload.src",component:k.a,placeholder:"source",debounce:200,className:"form-control",style:{fontFamily:"Fira Mono"}}),s.a.createElement(T.a,{addonType:"append"},s.a.createElement(b.a,{outline:!0,color:"secondary",style:{minWidth:"3rem"},onClick:Object(o.a)(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.current.select();case 3:n=t.sent,e("payload.src",'${ this.files["'.concat(n[0].localPath,'"] }')),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("Error while inserting audio",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))},s.a.createElement(M.a,{fixedWidth:!0,icon:"folder"})))))),s.a.createElement(w.a,null,s.a.createElement(j.a,null,s.a.createElement(D.a,null,s.a.createElement(X,{icon:"repeat",fallbackIcon:"redo",tooltip:"Loop audio",unit:"boolean"}),s.a.createElement(u.Control.select,{model:".payload.loop",className:"form-control custom-select",style:{fontFamily:"Fira Mono"}},s.a.createElement("option",{value:"false"},"Play sound once"),s.a.createElement("option",{value:"true"},"Repeat continuously")))))),s.a.createElement(x.a,null,s.a.createElement(w.a,null,s.a.createElement("small",{className:"text-muted"},"Please note that, for security reasons, audio files must be either embedded in the study, hosted on the same server on which the study is running, or on a server with ",s.a.createElement("a",{href:"https://enable-cors.org/server.html",target:"_blank",rel:"noopener noreferrer"},"cross-origin resource sharing")," enabled. Please also note that Chrome and Safari do not support loading sounds offline; please consider hosting the study on a server instead.")))))};R.contextTypes={id:d.a.oneOfType([d.a.string,d.a.number])};const Y=()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(N,null),s.a.createElement(x.a,{form:!0},s.a.createElement(w.a,null,s.a.createElement(j.a,null,s.a.createElement(D.a,null,s.a.createElement(X,{icon:"integral",fallbackIcon:"water",tooltip:"Waveform"}),s.a.createElement(u.Control.select,{model:".payload.type",className:"form-control custom-select",style:{fontFamily:"Fira Mono"}},s.a.createElement("option",{value:"sine"},"Sine wave"),s.a.createElement("option",{value:"square"},"Square wave"),s.a.createElement("option",{value:"sawtooth"},"Sawtooth"),s.a.createElement("option",{value:"triangle"},"Triangle"))))),s.a.createElement(w.a,null,s.a.createElement(j.a,null,s.a.createElement(D.a,null,s.a.createElement(X,{icon:"music",tooltip:"Frequency",unit:"Hz"}),s.a.createElement(W,{model:".payload.frequency",placeholder:"frequency (Hz)",pattern:S.b}),s.a.createElement(X,{icon:"tachometer-average",tooltip:"Detune",unit:"cents"}),s.a.createElement(W,{model:".payload.detune",placeholder:"detune (cents)",pattern:S.b})))))),B=({type:e,item:t,handleChange:a})=>{switch(e){case"oscillator":return s.a.createElement(Y,{item:t,handleChange:a});case"sound":return s.a.createElement(R,{item:t,handleChange:a});default:return null}};t.a=({timeline:e,activeItem:t,handleChange:a,add:n,duplicateCurrent:r,deleteCurrent:o})=>s.a.createElement(h.a,null,s.a.createElement(A,{activeItem:void 0!==t?e[t]:void 0,add:n,duplicateCurrent:r,deleteCurrent:o}),void 0!==t?s.a.createElement(u.Fieldset,{model:".timeline[".concat(t,"]")},s.a.createElement(B,{type:e[t].type,item:e[t],handleChange:a})):null)},989:function(e,t,a){"use strict";var n=a(0),r=a.n(n),o=a(43),i=a.n(o),l=a(868),s=a(29),c=a(905);const m=({label:e,priority:t,start:a,stop:o,active:i,onClick:m,update:d},{range:h,calcPosition:u,closestLayerY:p,setCursor:g})=>{const E=u(a,o,t),y=E.x,f=E.y,b=E.w,v=E.lockStart,x=E.lockStop,w=!v&&!x;let C=0;const I=e=>{const t=e.getAbsolutePosition().x,a=e.getPosition().x;C=t-a},k=()=>{C=0},j=Object(n.createRef)(),D=Object(n.createRef)(),T=Object(n.createRef)();return r.a.createElement(l.Group,{ref:j,x:y,y:f,draggable:w,dragBoundFunc:({x:e,y:t})=>({x:Object(s.clamp)(e-C,0,h.max-b)+C,y:p(t)}),onDragStart:function(){g("grabbing"),D.current.shadowEnabled(!0),I(this)},onDragEnd:()=>{D.current.shadowEnabled(i),g("grab"),k();const e=j.current.position(),t=e.x,a=e.y,n=D.current.width();d({x:t,y:a,width:n})}},r.a.createElement(l.Rect,{ref:D,x:.5,y:.5,height:36,width:Math.max(b,10),cornerRadius:4,fill:i?c.a.active:"white",stroke:i?"white":c.a.buttonBorder,strokeWidth:1,onClick:m,onMouseEnter:()=>w&&g("grab"),onMouseLeave:()=>g("default"),shadowColor:"rgba(0, 0, 0, 0.125)",shadowBlur:8,shadowEnabled:i}),r.a.createElement(l.Text,{listening:!1,x:12,y:12,text:e,fontFamily:"Fira Sans",fontSize:14,fill:i?"white":c.a.root}),r.a.createElement(l.Circle,{visible:i&&!v,listening:i&&!v,x:0,y:18,radius:6,offsetX:-.5,fill:c.a.active,stroke:"white",strokeWidth:2,draggable:!v,dragBoundFunc:({x:e})=>({x:Object(s.clamp)(e-C,0,y+b-10)+C,y:p(f)+18}),onDragStart:function(){I(this)},onDragMove:e=>{const t=e.target.getAbsolutePosition().x,a=b-(t-C-y);j.current.position({x:t-C,y:f}),D.current.width(a),T.current.position({x:a,y:18})},onDragEnd:()=>{k()},onMouseEnter:()=>g("ew-resize"),onMouseLeave:()=>g("default")}),r.a.createElement(l.Circle,{ref:T,visible:i&&!x,listening:i&&!x,x:b,y:18,radius:6,offsetX:-.5,fill:c.a.active,stroke:"white",strokeWidth:2,draggable:!x,dragBoundFunc:({x:e})=>({x:Object(s.clamp)(e-C,y+10,h.max)+C,y:p(f)+18}),onDragStart:function(){I(this)},onDragMove:e=>{D.current.width(e.target.getAbsolutePosition().x-C-y)},onDragEnd:()=>{k()},onMouseEnter:()=>g("ew-resize"),onMouseLeave:()=>g("default")}))};m.contextTypes={range:i.a.object,width:i.a.number,calcPosition:i.a.func,closestLayerY:i.a.func,setCursor:i.a.func};var d=m;const h=({timeline:e,activeItem:t,setActive:a,updateItem:n},{width:o,height:i})=>r.a.createElement(l.Layer,null,r.a.createElement(l.Rect,{x:0,y:0,width:o,height:i,onClick:()=>a(void 0)}),e.map((e,o)=>r.a.createElement(d,{key:"timelineitem-".concat(o),label:e.type?Object(s.capitalize)(e.type):"?",start:e.start,stop:e.stop,priority:e.priority,active:t===o,onClick:()=>a(o),update:e=>n(o,e)})));h.contextTypes={width:i.a.number,height:i.a.number};t.a=h},991:function(e,t,a){"use strict";a.r(t),function(e){var n=a(26),r=a(0),o=a.n(r),i=a(43),l=a.n(i),s=a(29),c=a(868),m=a(27),d=a(980),h=a(989),u=a(981),p=a(33);class g extends r.Component{constructor(e){super(e),this.state={width:0,offset:0,activeItem:void 0,zoom:e.zoom},this.calcPosition=this.calcPosition.bind(this),this.toX=this.toX.bind(this),this.closestLayerY=this.closestLayerY.bind(this),this.setActive=this.setActive.bind(this),this.setCursor=this.setCursor.bind(this),this.setZoom=this.setZoom.bind(this),this.handleChange=this.handleChange.bind(this),this.updateItem=this.updateItem.bind(this),this.handleAdd=this.handleAdd.bind(this),this.handleDuplicateCurrent=this.handleDuplicateCurrent.bind(this),this.handleDeleteCurrent=this.handleDeleteCurrent.bind(this),this.stage=Object(r.createRef)(),this.wrapper=Object(r.createRef)()}componentDidMount(){this.setState({width:this.wrapper.current.clientWidth})}getChildContext(){return{range:this.props.range,zoom:this.state.zoom,toX:this.toX,width:this.state.width,height:this.props.height,padding:this.props.padding,calcPosition:this.calcPosition,closestLayerY:this.closestLayerY,setCursor:this.setCursor,setZoom:this.setZoom}}toX(e,t=this.state.zoom){return e/Math.pow(10,t)}toTime(e,t=this.state.zoom){return e*Math.pow(10,t)}calcPosition(e,t,a){return{x:this.toX(parseInt(e)||0),y:this.layerY(a),w:this.toX(parseInt(t)-parseInt(e)||100),lockStart:"string"===typeof e&&e.includes("$"),lockStop:"string"===typeof t&&t.includes("$")}}closestLayer(e){const t=Object(s.clamp)(e,this.props.padding,this.props.height-3*this.props.padding);return Math.round((t-this.props.padding)/(this.props.layerHeight+this.props.layerGutter))}closestLayerY(e){return this.layerY(this.closestLayer(e))}layerY(e){return e*(this.props.layerHeight+this.props.layerGutter)+this.props.padding}suggestPosition(e,t=100){const a=Object(s.sortBy)(this.props.data.timeline,[e=>e.start,e=>e.priority]),r=this.closestLayer(this.props.height)+1,o=a.length>0?a[a.length-1]:{stop:0,priority:-1};return Object(n.a)({},e,{start:e.start||o.stop,stop:e.stop||o.stop+t,priority:e.priority||(o.priority+1)%r})}setActive(e){e!==this.state.activeItem&&(this.setState({activeItem:e}),this.props.formDispatch(m.actions.load("local.timeline[".concat(e,"]"),this.props.data.timeline[this.state.activeItem])))}setCursor(e){this.stage.current.container().style.cursor=e}setZoom(e){const t=this.toTime(-1*(this.stage.current.x()-this.state.width/2))-this.toTime(this.state.width/2,e),a=Object(s.clamp)(this.toX(t,e),this.toX(0,e),this.toX(this.props.range.max,e)-this.state.width);this.setState({zoom:e,offset:-a})}handleChange(e,t){this.props.formDispatch(m.actions.change("local.timeline[".concat(this.state.activeItem,"].").concat(e),t))}updateItem(e,{x:t,y:a,width:n}){this.props.updateTimelineItem(this.context.id,e,{start:this.toTime(t),stop:this.toTime(t+n),priority:this.closestLayer(a)}),this.props.formDispatch(m.actions.load("local.timeline[".concat(e,"].start"),this.toTime(t))),this.props.formDispatch(m.actions.load("local.timeline[".concat(e,"].stop"),this.toTime(t+n))),this.props.formDispatch(m.actions.load("local.timeline[".concat(e,"].priority"),this.closestLayer(a)))}handleAdd(t){this.props.formDispatch(m.actions.push("local.timeline",this.suggestPosition(t))),e(()=>this.setState({activeItem:this.props.data.timeline.length-1}))}handleDuplicateCurrent(){void 0!==this.state.activeItem&&this.handleAdd(Object(n.a)({},this.props.data.timeline[this.state.activeItem],{start:void 0,stop:void 0,priority:void 0}))}handleDeleteCurrent(){void 0!==this.state.activeItem&&(this.props.formDispatch(m.actions.remove("local.timeline",this.state.activeItem)),this.setState({activeItem:void 0}))}render(){const e=this.state,t=e.width,a=e.offset,n=this.props,r=n.data,i=n.range,l=n.height,m=n.padding;return o.a.createElement("div",{ref:this.wrapper},o.a.createElement(c.Stage,{ref:this.stage,width:t,height:l,x:a,offsetX:-m,draggable:!0,onDragEnd:()=>null,dragBoundFunc:({x:e})=>({x:Object(s.clamp)(e,-(this.toX(i.max)-t+m),-(this.toX(i.min,0)+m)),y:0}),className:"border-bottom"},o.a.createElement(d.a,{listening:!1}),o.a.createElement(h.a,{timeline:r.timeline||[],updateItem:this.updateItem,activeItem:this.state.activeItem,setActive:this.setActive})),o.a.createElement(u.a,{timeline:r.timeline||[],handleChange:this.handleChange,updateItem:this.updateItem,activeItem:this.state.activeItem,setActive:this.setActive,add:this.handleAdd,duplicateCurrent:this.handleDuplicateCurrent,deleteCurrent:this.handleDeleteCurrent}))}}g.defaultProps={height:200,padding:20,layerHeight:30,layerGutter:20,range:{min:-100,max:3e4},zoom:0},g.contextTypes={id:l.a.oneOfType([l.a.string,l.a.number])},g.childContextTypes={range:l.a.object,zoom:l.a.number,toX:l.a.func,width:l.a.number,height:l.a.number,padding:l.a.number,calcPosition:l.a.func,closestLayerY:l.a.func,setCursor:l.a.func,setZoom:l.a.func};t.default=Object(p.connect)(null,{updateTimelineItem:(e,t,{start:a,stop:n,priority:r})=>({type:"UPDATE_TIMELINE_ITEM",id:e,item:t,data:{start:a,stop:n,priority:r}})})(g)}.call(this,a(303).setImmediate)}}]);
//# sourceMappingURL=6.7ced6759.chunk.js.map