{"version":3,"sources":["components/ComponentOptions/components/Behavior/components/Timeline/colors.js","components/ComponentOptions/components/Behavior/components/Timeline/backgroundLayer.js","components/ComponentOptions/components/Behavior/components/Timeline/itemForm.js","components/ComponentOptions/components/Behavior/components/Timeline/item.js","components/ComponentOptions/components/Behavior/components/Timeline/itemLayer.js","components/ComponentOptions/components/Behavior/components/Timeline/widget.js"],"names":["root","outline","buttonBorder","gray","active","muted","label","t","zoom","BackgroundLayer","gridWidth","range","timeline","height","toX","x","min","digits","Math","floor","max","map","i","key","y","width","fill","colors","text","fontFamily","fontSize","align","verticalAlign","stroke","strokeWidth","points","contextTypes","PropTypes","object","number","func","padding","Toolbar","add","duplicateCurrent","deleteCurrent","activeItem","setZoom","style","position","right","direction","color","icon","fixedWidth","top","header","onClick","type","divider","disabled","className","_InteractionWarning","firstComponentId","id","oneOfType","string","InteractionWarning","connect","state","components","children","Header","form","capitalize","SettingGroupIcon","fallbackIcon","tooltip","unit","addon","createRef","ref","fallback","target","placement","delay","show","hide","SettingGroupControl","model","props","component","Input","debounce","GlobalSettings","pattern","numberOrPlaceholder","placeholder","SoundForm","handleChange","fileSelector","accept","addonType","minWidth","a","current","select","files","localPath","console","log","value","href","rel","OscillatorForm","TypeForm","item","ItemForm","undefined","Item","priority","start","stop","update","calcPosition","closestLayerY","setCursor","w","lockStart","lockStop","draggable","translationX","saveTranslation","absX","getAbsolutePosition","getPosition","clearTranslation","container","box","handleRight","dragBoundFunc","clamp","onDragStart","shadowEnabled","this","onDragEnd","cornerRadius","onMouseEnter","onMouseLeave","shadowColor","shadowBlur","listening","visible","radius","offsetX","dragX","onDragMove","e","ItemLayer","setActive","updateItem","pos","TimelineStage","Component","constructor","super","offset","bind","handleAdd","handleDuplicateCurrent","handleDeleteCurrent","stage","wrapper","componentDidMount","setState","clientWidth","getChildContext","toTime","layer","parseInt","layerY","includes","closestLayer","clampedY","round","layerHeight","layerGutter","suggestPosition","defaultLength","sortedItems","sortBy","data","nLayers","lastEntry","length","formDispatch","actions","load","cursor","level","newOffset","clampedOffset","change","updateTimelineItem","context","push","setImmediate","remove","render","defaultProps","childContextTypes"],"mappings":"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","file":"static/js/6.7ced6759.chunk.js","sourcesContent":["// TODO: This is a placeholder -- it would be nicer to export\n// colors directly from the bootstrap styles\nexport default {\n  root: 'rgb(33, 37, 41)', // Pseudo-black\n  outline: 'rgba(0, 0, 0, 0.125)', // Card border\n  buttonBorder: '#ced4da',\n  gray: '#f8f9fa',\n  active: '#0275d7',\n  muted: '#6c757d',\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { Layer, Group, Text, Line, Rect } from 'react-konva'\nimport { range } from 'lodash'\n\nimport colors from './colors'\n\nconst floor = (x, digits) => Math.floor(x / 10**digits) * 10**digits\n\nconst label = (t, zoom) =>\n  zoom === 0\n    ? `${ t }ms`\n    : `${ t/1000 }s`\n\nconst BackgroundLayer = (\n  { gridWidth=100 },\n  { range: timeline, height, toX, zoom }\n) =>\n  <Layer>\n    {\n      range(\n        // Background blocks must start at t with an even number of digits\n        // FIXME: Here be dragons\n        floor(timeline.min - gridWidth * 10**zoom, zoom + 2),\n        timeline.max + gridWidth,\n        gridWidth * 10**zoom\n      ).map((t, i) =>\n        <Group key={ `t-${ t }` }>\n          <Rect\n            x={ toX(t) + 0.5 }\n            y={ 0 }\n            width={ gridWidth }\n            height={ height }\n            fill={ i % 2 === 0 ? 'white' : colors.gray  }\n          />\n          <Text\n            text={ label(t, zoom) }\n            x={ toX(t) + 6 }\n            y={ height - 15 }\n            fontFamily=\"Fira Sans\"\n            fontSize={ 10 }\n            fill={ colors.muted }\n            align=\"left\"\n            verticalAlign=\"bottom\"\n          />\n          <Line\n            x={ toX(t) + 0.5 }\n            y={ 0 }\n            stroke={ colors.gray }\n            strokeWidth={ 1 }\n            points={ [0, 0, 0, height] }\n          />\n        </Group>\n      )\n    }\n  </Layer>\n\nBackgroundLayer.contextTypes = {\n  range: PropTypes.object,\n  zoom: PropTypes.number,\n  toX: PropTypes.func,\n  height: PropTypes.number,\n  padding: PropTypes.number,\n}\n\nexport default BackgroundLayer\n","import React, { createRef } from 'react'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\n\nimport { CardBody } from 'reactstrap'\nimport { Fieldset, Control } from 'react-redux-form'\nimport { Button, ButtonGroup,\n  UncontrolledButtonDropdown, DropdownToggle, DropdownMenu, DropdownItem,\n  InputGroup, InputGroupAddon, InputGroupText, Input, FormGroup,\n  UncontrolledTooltip, Row, Col, Alert } from 'reactstrap'\nimport { capitalize } from 'lodash'\n\nimport Icon from '../../../../../Icon'\nimport FileSelector from '../../../../../FileSelector'\n\nimport { numberOrPlaceholder } from './util'\n\nconst Toolbar = (\n  { add, duplicateCurrent, deleteCurrent, activeItem },\n  { zoom, setZoom }\n) =>\n  <div style={{ position: 'absolute', right: '0' }}>\n    <ButtonGroup>\n      <UncontrolledButtonDropdown direction=\"up\">\n        <DropdownToggle outline color=\"secondary\">\n          <Icon\n            icon=\"plus\" fixedWidth\n            style={{\n              position: 'relative',\n              top: '0.5px'\n            }}\n          />\n        </DropdownToggle>\n        <DropdownMenu>\n          <DropdownItem header>Audio</DropdownItem>\n          <DropdownItem\n            onClick={ () => add({ type: 'sound' }) }\n          >\n            Sound file\n          </DropdownItem>\n          <DropdownItem\n            onClick={ () => add({ type: 'oscillator' }) }\n          >\n            Oscillator\n          </DropdownItem>\n          <DropdownItem divider />\n          <DropdownItem header>From selected</DropdownItem>\n          <DropdownItem\n            onClick={ () => duplicateCurrent() }\n          >\n            Duplicate\n          </DropdownItem>\n        </DropdownMenu>\n      </UncontrolledButtonDropdown>\n      <Button\n        outline color=\"secondary\"\n        disabled={ !activeItem }\n        onClick={ deleteCurrent }\n      >\n        <Icon\n          icon=\"trash\" fixedWidth\n          style={{\n            position: 'relative',\n            top: '0.5px'\n          }}\n         />\n      </Button>\n    </ButtonGroup>\n    <ButtonGroup className=\"ml-2\">\n      <Button\n        outline color=\"secondary\"\n        disabled={ zoom === 0 }\n        onClick={ () => setZoom(0) }\n      >\n        <Icon\n          icon=\"search-plus\" fixedWidth\n          style={{\n            position: 'relative',\n            top: '0.5px'\n          }}\n         />\n      </Button>\n      <Button\n        outline color=\"secondary\"\n        disabled={ zoom === 1 }\n        onClick={ () => setZoom(1) }\n      >\n        <Icon\n          icon=\"search-minus\" fixedWidth\n          style={{\n            position: 'relative',\n            top: '0.5px'\n          }}\n         />\n      </Button>\n    </ButtonGroup>\n  </div>\n\nToolbar.contextTypes = {\n  zoom: PropTypes.number,\n  setZoom: PropTypes.func,\n}\n\nconst _InteractionWarning = ({ firstComponentId }, { id }) => {\n  // Check whether the current component is the first in the study\n  // TODO: Add a more sophisticated check,\n  // taking into account nested flow components\n  if (firstComponentId === id) {\n    return (\n      <Alert color=\"warning\">\n        <h3 className=\"h6 mt-2\">\n          Adding audio to the first component in a study\n        </h3>\n        Many browsers don't allow a website to play media until a user has interacted with the page. To make sure that you participants can hear the sounds you're adding, please ask for user input on your study's first screen.\n      </Alert>\n    )\n  } else {\n    return null\n  }\n}\n\n_InteractionWarning.contextTypes = {\n  id: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n  ]),\n}\n\nconst mapStateToProps = state => ({\n  firstComponentId: state.components['root'].children[0]\n})\nconst InteractionWarning = connect(mapStateToProps)(_InteractionWarning)\n\nconst Header = ({ activeItem, add, duplicateCurrent, deleteCurrent }) =>\n  <>\n    <Row form className=\"clearfix\">\n      <Col style={{ position: 'relative' }}>\n        <Toolbar\n          add={ add }\n          duplicateCurrent={ duplicateCurrent }\n          deleteCurrent={ deleteCurrent }\n          activeItem={ activeItem }\n        />\n        {\n          activeItem\n            ? <h3 className=\"h5 mt-2\">\n                { capitalize(activeItem.type) }\n              </h3>\n            : <div className=\"text-muted text-center\">\n                <small>Please add or select a timeline item</small>\n              </div>\n        }\n      </Col>\n    </Row>\n    {\n      activeItem\n        ? <Row>\n            <Col>\n              <hr />\n              <InteractionWarning />\n            </Col>\n          </Row>\n        : null\n    }\n  </>\n\n// Setting input group ---------------------------------------------------------\n\nconst SettingGroupIcon = ({ icon, fallbackIcon, tooltip, unit }) => {\n  const addon = createRef()\n  return (\n    <>\n      <div className=\"input-group-prepend\" ref={ addon }>\n        <InputGroupText>\n          <Icon fixedWidth icon={ icon } fallback={ fallbackIcon } />\n        </InputGroupText>\n      </div>\n      {\n        tooltip\n        ? <UncontrolledTooltip\n            target={ addon }\n            placement=\"left\"\n            delay={{ show: 0, hide: 150 }}\n          >\n            { tooltip }\n            { unit && <span className=\"text-muted\"> ({ unit })</span> }\n          </UncontrolledTooltip>\n        : null\n      }\n    </>\n  )\n}\n\nconst SettingGroupControl = ({ model, ...props }) =>\n  <Control\n    model={ model }\n    component={ Input }\n    debounce={ 200 }\n    className=\"form-control\"\n    style={{ fontFamily: 'Fira Mono' }}\n    { ...props }\n  />\n\nconst GlobalSettings = () =>\n  <>\n    <Row form>\n      <Col>\n        <FormGroup>\n          <InputGroup>\n            <SettingGroupIcon\n              icon=\"arrow-from-left\"\n              fallbackIcon=\"play-circle\"\n              tooltip=\"Start\"\n              unit=\"ms\"\n            />\n            <SettingGroupControl\n              model=\".start\"\n              pattern={ numberOrPlaceholder }\n            />\n            <SettingGroupIcon\n              icon=\"arrow-to-right\"\n              fallbackIcon=\"stop-circle\"\n              tooltip=\"End\"\n              unit=\"ms\"\n            />\n            <SettingGroupControl\n              model=\".stop\"\n              pattern={ numberOrPlaceholder }\n            />\n            <SettingGroupIcon\n              icon=\"volume\"\n              tooltip=\"Gain\"\n              unit=\"fraction\"\n            />\n            <SettingGroupControl\n              model=\".payload.gain\" placeholder=\"gain\"\n              pattern={ numberOrPlaceholder }\n            />\n          </InputGroup>\n        </FormGroup>\n      </Col>\n      <Col>\n        <FormGroup>\n          <InputGroup>\n            <SettingGroupIcon\n              icon=\"location-arrow\"\n              tooltip=\"Panning\"\n              unit=\"-1 … +1\"\n            />\n            <SettingGroupControl\n              model=\".payload.pan\" placeholder=\"pan\"\n              pattern={ numberOrPlaceholder }\n            />\n            <SettingGroupIcon\n              icon=\"plane-departure\"\n              tooltip=\"Ramp up duration\"\n              unit=\"ms\"\n            />\n            <SettingGroupControl\n              model=\".payload.rampUp\"\n              placeholder=\"0\"\n              pattern={ numberOrPlaceholder }\n            />\n            <SettingGroupIcon\n              icon=\"plane-arrival\"\n              tooltip=\"Ramp down duration\"\n              unit=\"ms\"\n            />\n            <SettingGroupControl\n              model=\".payload.rampDown\"\n              placeholder=\"0\"\n              pattern={ numberOrPlaceholder }\n            />\n          </InputGroup>\n        </FormGroup>\n      </Col>\n    </Row>\n  </>\n\nconst SoundForm = ({ handleChange }, { id }) => {\n  const fileSelector = createRef()\n\n  return (\n    <>\n      <FileSelector\n        accept=\"audio/*,video/ogg\"\n        component={ id }\n        ref={ fileSelector }\n      />\n      <GlobalSettings />\n      <Row form>\n        <Col>\n          <FormGroup>\n            <InputGroup>\n              <InputGroupAddon addonType=\"prepend\">\n                <InputGroupText>\n                  <Icon fixedWidth icon=\"file-audio\" />\n                </InputGroupText>\n              </InputGroupAddon>\n              <Control\n                model=\".payload.src\"\n                component={ Input }\n                placeholder=\"source\"\n                debounce={ 200 }\n                className=\"form-control\"\n                style={{ fontFamily: 'Fira Mono' }}\n              />\n              <InputGroupAddon addonType=\"append\">\n                <Button\n                  outline color=\"secondary\"\n                  style={{ minWidth: '3rem' }}\n                  onClick={ async () => {\n                    try {\n                      const files = await fileSelector.current.select()\n                      handleChange(\n                        'payload.src',\n                        `\\${ this.files[\"${ files[0].localPath }\"] }`\n                      )\n                    } catch (error) {\n                      console.log('Error while inserting audio', error)\n                    }\n                  } }\n                >\n                  <Icon fixedWidth icon=\"folder\" />\n                </Button>\n              </InputGroupAddon>\n            </InputGroup>\n          </FormGroup>\n        </Col>\n        <Col>\n          <FormGroup>\n            <InputGroup>\n              <SettingGroupIcon\n                icon=\"repeat\"\n                fallbackIcon=\"redo\"\n                tooltip=\"Loop audio\"\n                unit=\"boolean\"\n              />\n              <Control.select\n                model=\".payload.loop\"\n                className=\"form-control custom-select\"\n                style={{ fontFamily: 'Fira Mono' }}\n              >\n                <option value=\"false\">Play sound once</option>\n                <option value=\"true\">Repeat continuously</option>\n              </Control.select>\n            </InputGroup>\n          </FormGroup>\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <small className=\"text-muted\">Please note that, for security reasons, audio files must be either embedded in the study, hosted on the same server on which the study is running, or on a server with <a href=\"https://enable-cors.org/server.html\" target=\"_blank\" rel=\"noopener noreferrer\">cross-origin resource sharing</a> enabled. Please also note that Chrome and Safari do not support loading sounds offline; please consider hosting the study on a server instead.</small>\n        </Col>\n      </Row>\n    </>\n  )\n}\n\nSoundForm.contextTypes = {\n  id: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n  ]),\n}\n\nconst OscillatorForm = () =>\n  <>\n    <GlobalSettings />\n    <Row form>\n      <Col>\n        <FormGroup>\n          <InputGroup>\n            <SettingGroupIcon\n              icon=\"integral\" fallbackIcon=\"water\"\n              tooltip=\"Waveform\"\n            />\n            <Control.select\n              model=\".payload.type\"\n              className=\"form-control custom-select\"\n              style={{ fontFamily: 'Fira Mono' }}\n            >\n              <option value=\"sine\">Sine wave</option>\n              <option value=\"square\">Square wave</option>\n              <option value=\"sawtooth\">Sawtooth</option>\n              <option value=\"triangle\">Triangle</option>\n            </Control.select>\n          </InputGroup>\n        </FormGroup>\n      </Col>\n      <Col>\n        <FormGroup>\n          <InputGroup>\n            <SettingGroupIcon\n              icon=\"music\"\n              tooltip=\"Frequency\"\n              unit=\"Hz\"\n            />\n            <SettingGroupControl\n              model=\".payload.frequency\" placeholder=\"frequency (Hz)\"\n              pattern={ numberOrPlaceholder }\n            />\n            <SettingGroupIcon\n              icon=\"tachometer-average\"\n              tooltip=\"Detune\"\n              unit=\"cents\"\n            />\n            <SettingGroupControl\n              model=\".payload.detune\" placeholder=\"detune (cents)\"\n              pattern={ numberOrPlaceholder }\n            />\n          </InputGroup>\n        </FormGroup>\n      </Col>\n    </Row>\n  </>\n\n\nconst TypeForm = ({ type, item, handleChange }) => {\n  switch (type) {\n    case 'oscillator':\n      return <OscillatorForm item={ item } handleChange={ handleChange } />\n    case 'sound':\n      return <SoundForm item={ item } handleChange={ handleChange } />\n    default:\n      return null\n  }\n}\n\nconst ItemForm = ({ timeline, activeItem, handleChange,\n  add, duplicateCurrent, deleteCurrent\n}) =>\n  <CardBody>\n    <Header\n      activeItem={\n        activeItem !== undefined\n          ? timeline[activeItem]\n          : undefined\n      }\n      add={ add }\n      duplicateCurrent={ duplicateCurrent }\n      deleteCurrent={ deleteCurrent }\n    />\n    {\n      activeItem !== undefined\n        ? <Fieldset model={ `.timeline[${ activeItem }]` }>\n            <TypeForm\n              type={ timeline[activeItem].type }\n              item={ timeline[activeItem] }\n              handleChange={ handleChange }\n            />\n          </Fieldset>\n        : null\n    }\n  </CardBody>\n\nexport default ItemForm\n","import React, { createRef } from 'react'\nimport PropTypes from 'prop-types'\nimport { Group, Text, Rect, Circle } from 'react-konva'\nimport { clamp } from 'lodash'\n\nimport colors from './colors'\n\nconst minWidth = 10\n\nconst Item = (\n  { label, priority, start, stop, active, onClick, update },\n  { range, calcPosition, closestLayerY, setCursor }\n) => {\n  const height = 36\n  const { x, y, w, lockStart, lockStop } = calcPosition(start, stop, priority)\n  const draggable = !lockStart && !lockStop\n\n  // Difference between absolute and relative position\n  // (populated and used during dragging for bound calculation)\n  let translationX = 0\n\n  const saveTranslation = target => {\n    const { x: absX } = target.getAbsolutePosition()\n    const { x } = target.getPosition()\n    translationX = absX - x\n  }\n  const clearTranslation = () => {\n    translationX = 0\n  }\n\n  // Refs\n  const container = createRef()\n  const box = createRef()\n  const handleRight = createRef()\n\n  return (\n    <Group\n      ref={ container }\n      x={ x } y={ y }\n      draggable={ draggable }\n      dragBoundFunc={ ({ x, y }) => ({\n        x: clamp(x - translationX, 0, range.max - w) + translationX,\n        y: closestLayerY(y)\n      }) }\n      onDragStart={ function() {\n        // UI drag cues\n        setCursor('grabbing')\n        box.current.shadowEnabled(true)\n\n        // Save translation\n        saveTranslation(this)\n      } }\n      onDragEnd={ () => {\n        // UI drag cues\n        box.current.shadowEnabled(active)\n        setCursor('grab')\n\n        // Remove translation\n        clearTranslation()\n\n        // Save position\n        const { x, y } = container.current.position()\n        const width = box.current.width()\n        update({ x, y, width })\n      } }\n    >\n      <Rect\n        ref={ box }\n        x={ 0.5 } y={ 0.5 }\n        height={ height } width={ Math.max(w, minWidth) }\n        cornerRadius={ 4 }\n        fill={ active ? colors.active : 'white' }\n        stroke={ active ? 'white' : colors.buttonBorder }\n        strokeWidth={ 1 }\n        onClick={ onClick }\n        onMouseEnter={ () => draggable && setCursor('grab') }\n        onMouseLeave={ () => setCursor('default') }\n        shadowColor=\"rgba(0, 0, 0, 0.125)\"\n        shadowBlur={ 8 }\n        shadowEnabled={ active }\n      />\n      <Text\n        listening={ false }\n        x={ 12 } y={ 12 }\n        text={ label }\n        fontFamily=\"Fira Sans\"\n        fontSize={ 14 }\n        fill={ active ? 'white' : colors.root }\n      />\n      {/* TODO: Simplify the pesky rendering offsets */}\n      <Circle\n        visible={ active && !lockStart }\n        listening={ active && !lockStart }\n        x={ 0 } y={ height/2 } radius={ 6 }\n        offsetX={ -0.5 }\n        fill={ colors.active } stroke={ 'white' } strokeWidth={ 2 }\n        draggable={ !lockStart }\n        dragBoundFunc={ ({ x: dragX }) => ({\n          x: clamp(dragX - translationX, 0, x + w - minWidth) + translationX,\n          y: closestLayerY(y) + height/2\n        }) }\n        onDragStart={ function() {\n          // Save translation\n          saveTranslation(this)\n        } }\n        onDragMove={ (e) => {\n          const { x: dragX } = e.target.getAbsolutePosition()\n          const width = w - (dragX - translationX - x)\n          container.current.position({ x: dragX - translationX, y })\n\n          // All other positions are relative to the container\n          box.current.width(width)\n          handleRight.current.position({ x: width, y: height/2 })\n        } }\n        onDragEnd={ () => {\n          clearTranslation()\n        } }\n        onMouseEnter={ () => setCursor('ew-resize') }\n        onMouseLeave={ () => setCursor('default') }\n      />\n      <Circle\n        ref={ handleRight }\n        visible={ active && !lockStop }\n        listening={ active && !lockStop }\n        x={ w } y={ height/2 } radius={ 6 }\n        offsetX={ -0.5 }\n        fill={ colors.active } stroke={ 'white' } strokeWidth={ 2 }\n        draggable={ !lockStop }\n        dragBoundFunc={ ({ x: dragX }) => ({\n          // In absolute coordinates\n          x: clamp(dragX - translationX,\n              x + minWidth,\n              range.max\n            ) + translationX,\n          y: closestLayerY(y) + height/2\n        }) }\n        onDragStart={ function() {\n          // Save translation\n          saveTranslation(this)\n        } }\n        onDragMove={ (e) => {\n          box.current.width(\n            // Remove circle offset\n            e.target.getAbsolutePosition().x - translationX - x\n          )\n        } }\n        onDragEnd={ () => {\n          clearTranslation()\n        } }\n        onMouseEnter={ () => setCursor('ew-resize') }\n        onMouseLeave={ () => setCursor('default') }\n      />\n    </Group>\n  )\n}\n\nItem.contextTypes = {\n  range: PropTypes.object,\n  width: PropTypes.number,\n  calcPosition: PropTypes.func,\n  closestLayerY: PropTypes.func,\n  setCursor: PropTypes.func,\n}\n\nexport default Item\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { Layer, Rect } from 'react-konva'\nimport { capitalize } from 'lodash'\n\nimport Item from './item'\n\nconst ItemLayer = (\n  { timeline, activeItem, setActive, updateItem },\n  { width, height }\n) =>\n  <Layer>\n    {/* TODO: This is a bit of a hack,\n        it would be nicer to capture clicks on the underlying stage */}\n    <Rect\n      x={ 0 } y={ 0 }\n      width={ width } height={ height }\n      onClick={ () => setActive(undefined) }\n    />\n    {\n      timeline.map((item, i) =>\n        <Item\n          key={ `timelineitem-${ i }` }\n          label={ item.type ? capitalize(item.type) : '?' }\n          start={ item.start }\n          stop={ item.stop }\n          priority={ item.priority }\n          active={ activeItem === i }\n          onClick={ () => setActive(i) }\n          update={ pos => updateItem(i, pos) }\n        />\n      )\n    }\n  </Layer>\n\nItemLayer.contextTypes = {\n  width: PropTypes.number,\n  height: PropTypes.number,\n}\n\nexport default ItemLayer\n","import React, { Component, createRef } from 'react'\nimport PropTypes from 'prop-types'\n\nimport { clamp, sortBy } from 'lodash'\nimport { Stage } from 'react-konva'\nimport { actions } from 'react-redux-form'\n\nimport BackgroundLayer from './backgroundLayer'\nimport ItemLayer from './itemLayer'\nimport ItemForm from './itemForm'\nimport { connect } from 'react-redux'\n\nclass TimelineStage extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      width: 0, offset: 0,\n      activeItem: undefined,\n      zoom: props.zoom,\n    }\n\n    // Bindings\n    this.calcPosition = this.calcPosition.bind(this)\n    this.toX = this.toX.bind(this)\n    this.closestLayerY = this.closestLayerY.bind(this)\n    this.setActive = this.setActive.bind(this)\n    this.setCursor = this.setCursor.bind(this)\n    this.setZoom = this.setZoom.bind(this)\n    this.handleChange = this.handleChange.bind(this)\n    this.updateItem = this.updateItem.bind(this)\n    this.handleAdd = this.handleAdd.bind(this)\n    this.handleDuplicateCurrent = this.handleDuplicateCurrent.bind(this)\n    this.handleDeleteCurrent = this.handleDeleteCurrent.bind(this)\n\n    // Refs\n    this.stage = createRef()\n    this.wrapper = createRef()\n  }\n\n  componentDidMount() {\n    // Calculate available space\n    this.setState({\n      width: this.wrapper.current.clientWidth,\n    })\n  }\n\n  getChildContext() {\n    return {\n      range: this.props.range,\n      zoom: this.state.zoom,\n      toX: this.toX,\n      width: this.state.width,\n      height: this.props.height,\n      padding: this.props.padding,\n      calcPosition: this.calcPosition,\n      closestLayerY: this.closestLayerY,\n      setCursor: this.setCursor,\n      setZoom: this.setZoom,\n    }\n  }\n\n  // Position math -------------------------------------------------------------\n\n  toX(t, zoom=this.state.zoom) {\n    return t / 10**zoom\n  }\n\n  toTime(x, zoom=this.state.zoom) {\n    return x * 10**zoom\n  }\n\n  calcPosition(start, stop, layer) {\n    return {\n      x: this.toX(parseInt(start) || 0),\n      y: this.layerY(layer),\n      w: this.toX((parseInt(stop) - parseInt(start)) || 100),\n      lockStart: typeof start === 'string' && start.includes('$'),\n      lockStop: typeof stop === 'string' && stop.includes('$'),\n    }\n  }\n\n  closestLayer(y) {\n    const clampedY = clamp(y,\n      this.props.padding,\n      this.props.height - 3 * this.props.padding\n    )\n\n    return Math.round(\n      (clampedY - this.props.padding) /\n      (this.props.layerHeight + this.props.layerGutter)\n    )\n  }\n\n  closestLayerY(y) {\n    return this.layerY(this.closestLayer(y))\n  }\n\n  layerY(layer) {\n    return layer * (this.props.layerHeight + this.props.layerGutter) +\n      this.props.padding\n  }\n\n  suggestPosition(item, defaultLength=100) {\n    const sortedItems = sortBy(\n      this.props.data.timeline,\n      [i => i.start, i => i.priority]\n    )\n    const nLayers = this.closestLayer(this.props.height) + 1\n\n    const lastEntry = sortedItems.length > 0\n      ? sortedItems[sortedItems.length - 1]\n      : { stop: 0, priority: -1 }\n\n    return {\n      ...item,\n      start: item.start || lastEntry.stop,\n      stop: item.stop || lastEntry.stop + defaultLength,\n      priority: item.priority || (lastEntry.priority + 1) % nLayers,\n    }\n  }\n\n  // UI interaction ------------------------------------------------------------\n\n  setActive(item) {\n    if (item !== this.state.activeItem) {\n      this.setState({ activeItem: item })\n      this.props.formDispatch(\n        actions.load(\n          `local.timeline[${ item }]`,\n          this.props.data.timeline[this.state.activeItem]\n        )\n      )\n    }\n  }\n\n  setCursor(cursor) {\n    this.stage.current.container().style.cursor = cursor\n  }\n\n  setZoom(level) {\n    // We try to keep the center centered, changing only the scale\n    const currentCenter = this.toTime(\n      -1 * (this.stage.current.x() - this.state.width / 2)\n      // The horizontal offset is always negative because the underlying\n      // coordinate system is shifted into the opposite direction\n    )\n    // So the new horizontal offset retains the former center position,\n    // accounting for the future timeline width, at the new zoom level\n    const newOffset = currentCenter - this.toTime(this.state.width / 2, level)\n\n    // Make sure that the timeline bounds are applied\n    const clampedOffset = clamp(\n      this.toX(newOffset, level),\n      this.toX(0, level), // Padding is already applied through stage offset\n      this.toX(this.props.range.max, level) - this.state.width\n    )\n\n    this.setState({\n      zoom: level,\n      offset: -clampedOffset, // Reverse sign once more\n    })\n  }\n\n  // Store/form interaction ----------------------------------------------------\n\n  handleChange(model, value) {\n    // TODO: This has a hackish feel to it\n    this.props.formDispatch(\n      actions.change(\n        `local.timeline[${ this.state.activeItem }].${ model }`,\n        value\n      )\n    )\n  }\n\n  updateItem(item, { x, y, width }) {\n    this.props.updateTimelineItem(\n      this.context.id, item, {\n        start: this.toTime(x),\n        stop: this.toTime(x + width),\n        priority: this.closestLayer(y)\n      }\n    )\n    // TODO: This is a hack!\n    this.props.formDispatch(\n      actions.load(\n        `local.timeline[${ item }].start`, this.toTime(x)\n      )\n    )\n    this.props.formDispatch(\n      actions.load(\n        `local.timeline[${ item }].stop`, this.toTime(x + width)\n      )\n    )\n    this.props.formDispatch(\n      actions.load(\n        `local.timeline[${ item }].priority`,\n        this.closestLayer(y)\n      )\n    )\n  }\n\n  handleAdd(item) {\n    this.props.formDispatch(\n      actions.push(\n        'local.timeline', this.suggestPosition(item)\n      )\n    )\n\n    // This is a hack: If called in sequence,\n    // the newly added item is not yet available in the timeline\n    // TODO: Try to do this synchronously!\n    setImmediate(\n      () => this.setState({\n        activeItem: this.props.data.timeline.length - 1\n      })\n    )\n  }\n\n  handleDuplicateCurrent() {\n    if (this.state.activeItem !== undefined) {\n      this.handleAdd({\n        ...this.props.data.timeline[this.state.activeItem],\n        // Remove location information\n        start: undefined, stop: undefined, priority: undefined\n      })\n    }\n  }\n\n  handleDeleteCurrent() {\n    if (this.state.activeItem !== undefined) {\n      this.props.formDispatch(\n        actions.remove(\n          'local.timeline', this.state.activeItem\n        )\n      )\n      this.setState({ activeItem: undefined })\n    }\n  }\n\n  render() {\n    const { width, offset } = this.state\n    const { data, range, height, padding } = this.props\n\n    return (\n      <div ref={ this.wrapper }>\n        <Stage\n          ref={ this.stage }\n          width={ width } height={ height }\n          x={ offset } // Stage scroll/viewBox offset (changes w/ scrolling)\n          offsetX={ -padding } // Horizontal axis offset (constant)\n          draggable={ true }\n          onDragEnd={ () => null } // Avoid warning for missing drag handler\n          dragBoundFunc={ ({ x }) => ({\n            x: clamp(x,\n              // Sign reversed because the right-hand side\n              // is dragged leftward, and vice versa.\n              -(this.toX(range.max) - width + padding),\n              -(this.toX(range.min, 0) + padding)\n              // (the left bound is somewhat hackish -- this scales the\n              // left-side padding to 100ms at zoom level zero, though\n              // this breaks down at higher levels)\n            ),\n            y: 0\n          }) }\n          className=\"border-bottom\"\n        >\n          <BackgroundLayer\n            listening={ false }\n          />\n          <ItemLayer\n            timeline={ data.timeline || [] }\n            updateItem={ this.updateItem }\n            activeItem={ this.state.activeItem }\n            setActive={ this.setActive }\n          />\n        </Stage>\n        <ItemForm\n          timeline={ data.timeline || [] }\n          handleChange={ this.handleChange }\n          updateItem={ this.updateItem }\n          activeItem={ this.state.activeItem }\n          setActive={ this.setActive }\n          add={ this.handleAdd }\n          duplicateCurrent={ this.handleDuplicateCurrent }\n          deleteCurrent={ this.handleDeleteCurrent }\n        />\n      </div>\n    )\n  }\n}\n\nTimelineStage.defaultProps = {\n  height: 200,\n  padding: 20,\n  layerHeight: 30,\n  layerGutter: 20,\n  range: { min: -100, max: 30000 },\n  zoom: 0,\n}\n\nTimelineStage.contextTypes = {\n  id: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n  ]),\n}\n\nTimelineStage.childContextTypes = {\n  range: PropTypes.object,\n  zoom: PropTypes.number,\n  toX: PropTypes.func,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  padding: PropTypes.number,\n  calcPosition: PropTypes.func,\n  closestLayerY: PropTypes.func,\n  setCursor: PropTypes.func,\n  setZoom: PropTypes.func,\n}\n\nconst mapDispatchToProps = {\n  updateTimelineItem: (id, item, { start, stop, priority }) => ({\n    type: 'UPDATE_TIMELINE_ITEM',\n    id, item,\n    data: { start, stop, priority },\n  })\n}\n\nexport default connect(null, mapDispatchToProps)(TimelineStage)\n"],"sourceRoot":""}